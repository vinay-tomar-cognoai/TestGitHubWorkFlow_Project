
var EASYCHAT_IMG_PATH = "/static/EasyChatApp/img/";

////////////////  Multilingual Template Variable(with default value) start
var selected_language = SELECTED_LANGUAGE;
var EASYCHAT_INPUT_QUERY_DEFAULT_PLACEHOLDER = "How may I help you?";
var EASYCHAT_INPUT_QUERY_THEME_1_PLACEHOLDER = "Type your question here";
var EASYCHAT_INPUT_QUERY_THEME_2_PLACEHOLDER = "Type here...";
var EASYCHAT_INPUT_QUERY_THEME_3_PLACEHOLDER = "Start Conversation"
var WIDGETS_PLACEHOLDER_TEXT = "Choose from the above options$$$Attach a file to submit$$$Provide a number above$$$Select a value above$$$Record a video to send$$$Choose a date and time above$$$Fill the form and submit";
var RANGE_SLIDER_ERROR_MESSAGES = "Please select a valid value in given range$$$Please select a valid value in given range$$$Please enter a valid input$$$Please enter a valid minimum value$$$Please enter a valid maximum value$$$Mimimum value cannot be less than given range$$$Minimum value cannot be greater than given range$$$Maximum value cannot be greater than given range$$$Maximum value cannot be lesser than given range$$$Minimum value cannot be greater than maximum value"
var TYPING_TEXT = ""
var CARDS_TEXT = "Know more"
var PDF_SEARCH_CARDS_TEXT = "View Document";
var MENU_TEXT = "Menu"
var GO_BACK_TEXT = "Go Back"
var BACK_TEXT = "Back";
var SEARCH_TEXT = "Search"
var DROPDOWN_TEXT = "Choose from the following "
var START_TEXT = "Start"
var STOP_TEXT = "Stop"
var SUBMIT_TEXT = "Submit"
var CANCEL_TEXT = "Cancel"
var SAVE_TEXT = "Save"
var RESET_TEXT = "Reset"
var FEEDBACK_TEXT = "Please provide your feedback"
var FEEDBACK_ERROR_TEXT = "Please select from the below options."
var SUCCESS_FEEDBACK_TEXT = "Thank you for your feedback"
var POSITIVE_FEEDBACK_1 = "Easy Communication"
var POSITIVE_FEEDBACK_2 = "Fully Satisfied"
var POSITIVE_FEEDBACK_3 = "Quick Response"
var POSITIVE_FEEDBACK_4 = "Query Resolved Quickly"
var POSITIVE_FEEDBACK_5 = "Good Experience"
var NEGATIVE_FEEDBACK_1 = "Inappropriate Answer"
var NEGATIVE_FEEDBACK_2 = "Response is slow"
var NEGATIVE_FEEDBACK_3 = "Need more information"
var NEGATIVE_FEEDBACK_4 = "I couldn’t find what I was looking for"
var NEGATIVE_FEEDBACK_5 = "Content is too complicated"
var FILE_SIZE_LIMIT_TEXT = "File size must be less than"
var FILE_ATTACHEMENT_TEXT = "Drag and drop your files here<br>Or Click in this area.";
var UPLOAD_VIDEO_TEXT = "Your video is uploaded successfully"
var CSAT_ALL_FIELD_ERROR = "Select at least one feedback."
var INVALID_MOBILE_NUMBER = "Please enter a valid phone number."
var INVALID_EMAIL_ID = "Please fill a valid email id."
var MIN_TEXT = "Min";
var MAX_TEXT = "Max";
var RANGE_TEXT = "Range";
var INVALID_SESSION_ID_RESPONSE_TEXT = "Looks like, I can not answer your query for now. Please try again after some time.";
var FILL_FORM_TEXT = "Please fill the form"
var SUBMIT_FORM_TEXT = "Are you sure you want to submit these details?"
var YES = "Yes"
var NO = "No"
var READ_MORE = "Read More";
var READ_LESS = "Read Less";
var SHOW_LESS = "Show Less";
var VIEW_MORE = "View more";
var SPEAK_NOW = "speak now";
var BOT_MINIMIZE_TEXT = "Click here to minimize";
var BOT_MAXIMIZE_TEXT = "Click here to maximize";
var MUTE_TEXT = "Mute";
var UNMUTE_TEXT = 'Unmute';
var NO_RESULT_FOUND = "No results found";
var cancel_text_to_speech_response = true;
var SELECT_VALUE_TEXT = "Select Value";
var SELECTED_VALUE_TEXT = "Selected Value";
var OTP_SIX_DIGIT_ERROR_TEXT = "Please enter a valid 6 digit OTP.";
var OTP_FOUR_DIGIT_ERROR_TEXT = "Please enter a valid 4 digit OTP.";
var EMAIL_ERROR_TEXT = "Please enter a valid Email Id.";
var PAN_ERROR_TEXT = "Invalid PAN number";
var NAME_ERROR_TEXT = "Please enter a valid name.";
var MOBILE_ERROR_TEXT = "Mobile number is invalid. Please try again.";
var FILE_UPLOADED_TEXT = "File has been uploaded successfully."
var LABEL_DATE = "Date"
var LABEL_TIME = "Time"
var LABEL_ADD = "Add"
var LABEL_FROM = "From"
var LABEL_TO = "To"
var MIC_BUTTON_TOOLTIP = "Mic"
var THEME_3_GREETING_TEXT = "Hello"
var THEME_3_WELCOME_TEXT = "Welcome to"
var HOME_BUTTON_TOOLTIP = "Home"
var CHOOSE_LANGUAGE = "Choose Language"
var MINIMIZE_BUTTON_TOOLTIP = "Minimize"
var CSAT_FORM_TEXT = ""
var CSAT_EMOJI_TEXT = ""
var CHAT_WITH_TEXT = "Chat with"
var END_CHAT_ANDROID = "Do you want to resume the chat later or end the chat?"
var MINIMIZE_CHAT_ANDROID = "Resume Later"
var TERMINATE_CHAT_ANDROID = "End Chat"
var CLOSE_BUTTON_TOOLTIP = "Close"
var POWERED_BY_TEXT = "Powered by"
var QUERY_API_FAILURE_TEXT = "We are unable to process your request at this time. Please try again later."
var UNABLE_TO_LOAD_TEXT = "This content is blocked. Please contact the site owner to fix the issue."

var CONNECT_AGENT_TEXT = "Connect with Agent";
var FILL_DETAILS_TEXT = "Please fill in these details to connect to our agent";
var ENTER_NAME_TEXT = "Enter your Name";
var ENTER_EMAIL_TEXT = "Enter Email-ID";
var ENTER_PHONE_TEXT = "Enter Phone Number";
var CONTINUE_TEXT = "Continue"
var LIVECHAT_CONTINUE_TEXT = 'To connect with LiveChat Agent, please Click “Continue” and submit your details or Click “Back” to end the conversation.'
var CHOOSE_CATEGORY_TEXT = "Choose Category";
var CATEGORY_ERROR_TEXT = "Please select a valid category.";
var END_CHAT_TEXT = "End Chat";
var CATEGORY_AUTHENTICATION_ERROR_TEXT = "Unable to raise request, try once again. Please make sure you are not in an authenticated window.";

var REQUEST_IN_PROCESS = "Your request is in process";
var JOINED_CHAT_TEXT = "has joined the chat. Please ask your queries now."
var WEAK_INTERNET_TEXT = "Looks like your internet is weak. Unable to connect."
var AGENT_UNAVAILABLE_TEXT = "Our chat representatives are unavailable right now. Please try again in some time."
var CHAT_ENDED_TEXT = "Your chat has ended";
var AGENT_LEFT_TEXT = "Agent has left the session. LiveChat session ended."
var FEEDBACK_SUBMIT_TEXT = "Thank you for connecting with us. Hoping to help you in the future again."
var UPLOAD_TEXT = 'Upload';

var LIVECHAT_FEEDBACK_HEADER = "Feedback"
var LIVECHAT_FEEDBACK_MAIN_TEXT = "On a scale of 0-10, how likely are you to recommend LiveChat to a friend or colleague?"
var LIVECHAT_FEEDBACK_CANCEL_TEXT = "No, Thanks"
var LIVECHAT_ADD_COMMENT_TEXT = "Comments (optional)"

var LIVECHAT_VC_REQUEST = "Video Call Request has been sent"
var LIVECHAT_VC_START = "Video Call Started"
var LIVECHAT_VC_END = "Video Call Ended"
var LIVECHAT_VC_JOIN = "Please join the following link for video call"
var LIVECHAT_VC_JOIN_ACCEPTED = "Agent has accepted the request. Please join the following link"
var LIVECHAT_VC_JOIN_NOW_TEXT = "Join Now"

var LIVECHAT_VOICECALL_REQUEST = "Voice Call Request has been sent"
var LIVECHAT_VOICECALL_START = "Voice Call Started"
var LIVECHAT_VOICECALL_END = "Voice Call Ended"
var LIVECHAT_VOICECALL_JOIN_ACCEPTED = "Agent has accepted the request."
var LIVECHAT_VOICECALL_JOIN_NOW_TEXT = "Join Now"
let LIVECHAT_MALICIOUS_FILE_TEXT = "Malicious File not accepted";
let LIVECHAT_VALID_FILE_TEXT = "File type not supported. Please try again with supported file (.jpg, .docx, .pdf etc)";
let LIVECHAT_EXCEED_FILE_SIZE_TEXT = "File size is large. Please try again with file size less than 5 MB"

var AGENT_REJECTED_VOIP = "has rejected the voice call request"
var AGENT_ACCEPTED_VOIP = "has accepted the voice call request"
var AGENT_REJECTED_VC = "has rejected the video call request"
var VIDEO_CALL_TEXT = "Video Call"

let AGENT_CONNECTED_TEXT = "To avoid disconnecting with the agent, please don't minimize the browser during interaction";
let WEAK_INTERNET_OR_MINIMIZE_TEXT = "Your Internet connection was weak (or you minimised the app). Chat is disconnected";

var LIVECHAT_GOOD_BYE_TEXT = "Goodbye, Hope I was able to help you!"
var LIVECHAT_CHAT_TRANSCRIPT_MAIL_TEXT = "If you want a transcript of the chat above on your mail"
var LIVECHAT_CLICK_HERE_TEXT = "CLICK HERE"
var LIVECHAT_CONVERSATION_MAIL_TEXT = "To get your conversation on mail"
var LIVECHAT_TRANSCRIPT_SEND_TEXT = "The transcript will be sent over mail"
var LIVECHAT_CHECK_BOX_TRANSCRIPT_TEXT = "Click on check box to get chat transcript on your mail"

var WORDS_LIST = [];

var SPELL_CHECK_API_ENDPOINT = ""
var SPELL_CHECK_ID = ""
var SPELL_CHECK_WHITELISTED_SPECIAL_CHARS = "?!.,"

var is_spell_check_while_typing_enabled = false
var is_cancel_corrected_word = false;
var previous_word = "";
var is_backspace_clicked = false;

var CB_START = "Cobrowsing Session Started"
var CB_END = "Cobrowsing Session Ended"

var DO_NOT_DISTURB_TEXT = "Do not disturb"
var DO_NOT_DISTURB_CONFIRMATION_TEXT = "Are you sure, you want to enable Do not disturb? By clicking Yes, form assistant will be disabled."
var DO_NOT_DISTURB_DENIED_TEXT = "Great, How may I help you?"

var is_intent_icon_enabled_for_dnd = false;

var FAQ_TEXT = "Frequently asked questions"
var FAQ_TOOLTIP = "Questions customer ask oftenly"
var SEARCH_HERE_TEXT = "Search here"
var VIEW_ALL_TEXT = "View All"
var WAS_IT_HELPFUL_TEXT = "Was it helpful?"
var SKIP_TEXT = "Skip"
var ASK_YOUR_QUERY_TEXT = "Ask your query"

var left_pointer_mark = "&#10094;"
var right_pointer_mark = "&#10095;"

////////////////////////////////  End
var CLEAR_API_URL = "/chat/clear-user-data/";
var EASYCHAT_FEEDBACK_SAVE_URL = "/chat/save-easychat-feedback-msg/";
var EASYCHAT_QUERY_URL = "/chat/query/";
var RESPONSE_SENTENCE_SEPARATOR = "$$$";
var is_doubletick = false;
var code_list = [];
var custom_quote_list_flag = "";
var BOT_MESSAGE_COLOR = '';
var USER_MESSAGE_COLOR = '';
var DEFAULT_ICON_COLOR = "";
var bot_id = null;
var bot_name = null;
var user_id = "";
var session_id = "";
var window_location = "";
var easychat_card_counter = 0;
var captcha_id = "";
var is_map_js_loaded = false;
var is_captcha = null;
var is_flow_ended = true;
var is_bot_started = true;
var hide_mic = false;
var is_custom_complete = false;
var message = null;
var voices = null;
var final_transcript = '';
var recognizing = false;
var ignore_onend;
var recognition = null;
var marker = null;
var form_assist_enabled = false;
var GallaryslideIndex, gallery_slides, gallery_dots;
var attached_file_src = "";
var do_not_disturb = "";
var MAX_TEXT_RESPONSE_LENGTH = 200;
var embed_cookies = ""
var embed_meta_data = ""
var bot_inactivity_detection_enabled = false
var bot_inactivity_detection_required = false
var bot_inactivity_timer = null
var bot_inactivity_msg = ""
var bot_inactivity_time = null
var is_bot_inactivity_msg_present = false
var mask_next_input = false
var file_extension = null;
var is_save_attachment_required = null;
var query_token_id = null;
var session_continue = false;
var easychat_prev_session_id = ""
var max_file_size_allowed = 0;
var widget_user_selected_list = null;
var is_sticky_message = false;
var is_conversaion_started = false;
var is_video_recorder_allowed = false;
var recorded_video_data_url = null;
var livechat_trigger_message = "";
var is_remove_widget = false;

var is_sticky_intent_button_present = false;
var is_sticky_intent_menu_present = false;

var queue_timer = 0;
var livechat_queue_time = 0;
var bot_restarted = false

var EASYCHAT_BOT_THEME = "";
var entered_suggestion = false;
var file_type_ext = {
    "image(ex. .jpeg, .png, .jpg)": ".jpeg, .png, .gif, .jpg",
    "word processor(i.e. .doc,.pdf)": ".doc, .docx, .odt, .pdf, .rtf, .tex, .wks, .wkp",
    "compressed file(ex. .zip)": ".zip, .rar, .rpm, .z, .tar.gz, .pkg",
    "video file(ex. .mp4)": ".mp4",

}
var isFeedBackDone = get_cookie("isFeedBackDone") ? get_cookie("isFeedBackDone") : "0";
var is_bot_minimized = false;
var is_automatic_carousel_enabled = false;
var carousel_timer, carousel_time = 5;
var is_welcome_banner_present = true
var STATIC_MP3_PATH = '/static/EasyChatApp/mp3';
var user_message_index = 0;
var bot_message_index = 0;

var bot_response_delay_allowed = false;
var bot_response_delay_timer = null;
var bot_response_delay_message = null;
var bot_message_delay_timer = null;
var is_campaign_link = false;
var mic_access = true;
var is_bot_notification_sound_enabled = false;
var default_order_of_response = []
var form_fields_length = 0
var form_fields = []
var widget_form_name = ""
var element_response_previous_height = 0
var initial_intent_in_welcome_message = false
var is_initial_intent = false
var web_landing_intent = false
var is_web_landing_allowed = "false"
var welcome_message_appended = false
var form_data_misdashboard = ""
var user_has_uploaded_previous_file = true
var fuzzyhound = ""
var autocorrect_bot_replace = []
var change_is_flow_ended_variable = true
var suggestion_list = []
var word_mapper_list = []
var db;
var db_name = "suggestion_list"
var table_name = "suggestion_list_table"
var table_index = "suggestion_list_key"
var contentvalue = 1;
var csat_feedback_form_enabled = false;
var mark_all_fields_csat_compulsory = false;
var collect_phone_number = false;
var collect_email_id = false;
var mobile_width = 450;
var is_user_authenticated = false;
var update_last_seen_chatbot = null;
var client_location_city = null;
var client_location_state = null;
var client_location_pincode = null;
var geocoder;
var calender_date_widget_value = null;
var calender_time_widget_value = null;
var changed_date_picker_from = false;
var changed_date_picker_to = false;
var changed_date_picker_single = false;
var complete_hamburger_list;
var is_initial_trigger_intent = false;
var is_feedback_required = false;
var easychat_intent_feedback_id = ""
var is_voice_based_form_assist_enabled = false;
var default_response = ""
var welcome_banner_list = []
var is_widgets = false;

//record video initializers
var video_element_id = "global-video-captured-response-"
var video_captured_canvas = "global-canvas-video-capture-"
var start_button_id = "btn-start-recording-"
var cancel_button_id = "btn-cancel-recording-"
var preview_button_id = "btn-stop-recording-"
var is_audio_required = true
var submit_button_id = "btn-submit-recording-"
var reset_button_id = "btn-reset-recording-"
var mask_confidential_info = false;

var is_recorded_video_uploaded = false;

var drop_down_choices_theme6;
var xhttp_livechat_attachment;
var quick_menu_html;
var is_audio_notification_enabled = false;
var is_bot_response_appended = false;
var x_down_banner;
var slider_range;
var slider_from;
var slider_to;
var is_internet_explorer = false || !!document.documentMode;
var current_form_list
var global_file_name = ""
var current_request_xhttp
var last_chosen_file_type
var global_calendar_input
var currently_opened_time_modal_id = ""
var currently_time_picker_type = ""
var calendar_div_id = ""
var timepicker_in_form = true
var inital_calendar_html = ""
var show_user_input = true
var is_first_query = true
var is_text_to_speech_required = false
var speech_pause_resume_interval = null
var list_banner_img_clicked = []
var welcome_banner_query_question = "";
var is_manually_typed_query = true;
var external_trigger_intent_info = "INTENT_INFO";
var is_initial_form_assist_auto_popup = false;
var is_bot_auto_language_detected = false
var detected_language = "en"
var text_direction = 'ltr'
var pointer_direction = 'ltr'
var list_of_phonetic_typing_enabled_languages = []
var temp_selected_language = "en"
var disclaimer_text_dict = {}
var WHITE_THEME_COLOR = "#767B87"
var cobrowse_session_id = '';
var livechat_unload_event_flag = '';

var is_text_to_speech_muted = false;

var is_widget_data = false;

var speak_mic_animation_timeout = null;

language_script_type = "ltr"
language_days_list = ["Monday", "Tueday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]
language_months_list = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]

var phone_widget_error_map = ["Please enter a valid number", "Invalid country code", "The entered number is too short", "The entered number is too long", "Please enter a valid number"];
///////////////////////////////////  SVG'S ///////////////////////////////////////////

var FILE_ICON_SVG = '<svg width="22" height="30" viewBox="0 0 22 30" fill="none" xmlns="http://www.w3.org/2000/svg">\
            <path fill-rule="evenodd" clip-rule="evenodd" d="M12.8331 0V7.79765C12.8331 8.55542 13.4442 9.16652 14.202 9.16652H21.9996V27.964C21.9996 28.7218 21.3885 29.3329 20.6308 29.3329H1.36887C0.6111 29.3329 0 28.7218 0 27.964V1.36887C0 0.611101 0.6111 0 1.36887 0H12.8331ZM15.9867 0.391105L21.5844 6.01324C21.8533 6.28212 22 6.62434 22 6.991V7.33322H14.6668V0H15.009C15.3756 0 15.7179 0.146664 15.9867 0.391105Z" fill="url(#paint0_linear)"/>\
            <defs>\
            <linearGradient id="paint0_linear" x1="2.19182" y1="2.74996" x2="21.4413" y2="29.333" gradientUnits="userSpaceOnUse">\
            <stop stop-color="white"/><stop offset="1" stop-color="#C8DDFF"/></linearGradient></defs></svg>';
var FILE_ICON_SVG_FORM = '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\
            <path fill-rule="evenodd" clip-rule="evenodd" d="M6 2C4.89543 2 4 2.89543 4 4V16C4 17.1046 4.89543 18 6 18H14C15.1046 18 16 17.1046 16 16V7.41421C16 7.01639 15.842 6.63486 15.5607 6.35355L11.6464 2.43934C11.3651 2.15804 10.9836 2 10.5858 2H6ZM5 4C5 3.44772 5.44772 3 6 3H10V6.5C10 7.32843 10.6716 8 11.5 8H15V16C15 16.5523 14.5523 17 14 17H6C5.44772 17 5 16.5523 5 16V4ZM14.7929 7L11 3.20711V6.5C11 6.77614 11.2239 7 11.5 7H14.7929Z" fill="#4D4D4D"/>\
            </svg>';

var FILE_ICON_SVG2 = '<svg width="22" height="30" viewBox="0 0 22 30" fill="none" xmlns="http://www.w3.org/2000/svg">\
            <path fill-rule="evenodd" clip-rule="evenodd" d="M12.8331 0V7.79765C12.8331 8.55542 13.4442 9.16652 14.202 9.16652H21.9996V27.964C21.9996 28.7218 21.3885 29.3329 20.6308 29.3329H1.36887C0.6111 29.3329 0 28.7218 0 27.964V1.36887C0 0.611101 0.6111 0 1.36887 0H12.8331ZM15.9867 0.391105L21.5844 6.01324C21.8533 6.28212 22 6.62434 22 6.991V7.33322H14.6668V0H15.009C15.3756 0 15.7179 0.146664 15.9867 0.391105Z" fill="url(#paint1_linear)"/>\
            <defs>\
            <linearGradient id="paint1_linear" x1="2.19182" y1="2.74996" x2="21.4413" y2="29.333" gradientUnits="userSpaceOnUse">\
            <stop stop-color="white"/><stop offset="1" stop-color="#C8DDFF"/></linearGradient></defs></svg>';

var FILE_LOADER_SVG = '<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <g clip-path="url(#clip0)">\
                        <g filter="url(#filter0_d)">\
                        <path d="M9.23483 3.47016C9.38128 3.32372 9.38128 3.08628 9.23483 2.93983L9.06016 2.76516C8.91372 2.61872 8.67628 2.61872 8.52983 2.76516L6.26516 5.02983C6.11872 5.17628 5.88128 5.17628 5.73483 5.02983L3.47016 2.76516C3.32372 2.61872 3.08628 2.61872 2.93983 2.76517L2.76516 2.93983C2.61872 3.08628 2.61872 3.32372 2.76517 3.47016L5.02983 5.73483C5.17628 5.88128 5.17628 6.11872 5.02983 6.26516L2.76516 8.52983C2.61872 8.67628 2.61872 8.91372 2.76516 9.06016L2.93983 9.23483C3.08628 9.38128 3.32372 9.38128 3.47017 9.23483L5.73483 6.97016C5.88128 6.82372 6.11872 6.82372 6.26516 6.97016L8.52983 9.23483C8.67628 9.38128 8.91372 9.38128 9.06016 9.23483L9.23483 9.06016C9.38128 8.91372 9.38128 8.67628 9.23483 8.52983L6.97016 6.26516C6.82372 6.11872 6.82372 5.88128 6.97016 5.73483L9.23483 3.47016Z" fill="#979797"/>\
                        </g>\
                        </g>\
                        <defs>\
                        <filter id="filter0_d" x="-5.34473" y="-5.34473" width="30.6893" height="30.6893" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\
                        <feFlood flood-opacity="0" result="BackgroundImageFix"/>\
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"/>\
                        <feOffset dx="4" dy="4"/>\
                        <feGaussianBlur stdDeviation="6"/>\
                        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.12 0"/>\
                        <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>\
                        <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/>\
                        </filter>\
                        <clipPath id="clip0">\
                        <rect width="12" height="12" fill="white"/>\
                        </clipPath>\
                        </defs>\
                        </svg>';
var download_button_html_livechat = '<div style="right: 14px;margin: 2px 0;display: inline-block;width: 18%;text-align: right;"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.875 11.25H3.125C2.77982 11.25 2.5 11.5298 2.5 11.875C2.5 12.2202 2.77982 12.5 3.125 12.5H11.875C12.2202 12.5 12.5 12.2202 12.5 11.875C12.5 11.5298 12.2202 11.25 11.875 11.25Z" fill="#757575"></path><path d="M2.5 10.625V11.875C2.5 12.2202 2.77982 12.5 3.125 12.5C3.47018 12.5 3.75 12.2202 3.75 11.875V10.625C3.75 10.2798 3.47018 10 3.125 10C2.77982 10 2.5 10.2798 2.5 10.625Z" fill="#757575"></path><path d="M11.25 10.625V11.875C11.25 12.2202 11.5298 12.5 11.875 12.5C12.2202 12.5 12.5 12.2202 12.5 11.875V10.625C12.5 10.2798 12.2202 10 11.875 10C11.5298 10 11.25 10.2798 11.25 10.625Z" fill="#757575"></path> \
                               <path d="M7.50003 9.375C7.37046 9.37599 7.24378 9.33667 7.13753 9.2625L4.63753 7.5C4.50279 7.40442 4.41137 7.25937 4.38326 7.09658C4.35515 6.93379 4.39264 6.76649 4.48753 6.63125C4.5349 6.56366 4.59518 6.50611 4.66491 6.46194C4.73463 6.41777 4.81242 6.38785 4.89377 6.37391C4.97512 6.35996 5.05843 6.36227 5.13889 6.38069C5.21934 6.39911 5.29535 6.43329 5.36253 6.48125L7.50003 7.975L9.62503 6.375C9.75764 6.27555 9.92432 6.23284 10.0884 6.25628C10.2525 6.27973 10.4006 6.36739 10.5 6.5C10.5995 6.63261 10.6422 6.7993 10.6187 6.96339C10.5953 7.12749 10.5076 7.27555 10.375 7.375L7.87503 9.25C7.76685 9.33114 7.63526 9.375 7.50003 9.375Z" fill="#757575"></path>   \
                             <path d="M7.5 8.125C7.33424 8.125 7.17527 8.05915 7.05806 7.94194C6.94085 7.82473 6.875 7.66576 6.875 7.5V2.5C6.875 2.33424 6.94085 2.17527 7.05806 2.05806C7.17527 1.94085 7.33424 1.875 7.5 1.875C7.66576 1.875 7.82473 1.94085 7.94194 2.05806C8.05915 2.17527 8.125 2.33424 8.125 2.5V7.5C8.125 7.66576 8.05915 7.82473 7.94194 7.94194C7.82473 8.05915 7.66576 8.125 7.5 8.125Z" fill="#757575"></path></svg></div>'
var download_button_html = '<svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">\
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M9.27445 3.71163C9.27445 3.04246 9.82243 2.5 10.4984 2.5C11.1744 2.5 11.7224 3.04246 11.7224 3.71163V9.37672C11.7224 9.46299 11.793 9.53294 11.8802 9.53294H13.5586C13.7984 9.53303 14.0161 9.67168 14.1155 9.88767C14.215 10.1037 14.1779 10.3573 14.0207 10.5365L10.9605 14.0208C10.8443 14.1534 10.6757 14.2295 10.4984 14.2295C10.3211 14.2295 10.1525 14.1534 10.0363 14.0208L6.97612 10.5365C6.8189 10.3573 6.78183 10.1037 6.88128 9.88767C6.98074 9.67168 7.1984 9.53303 7.43819 9.53294H9.11664C9.20379 9.53294 9.27445 9.46299 9.27445 9.37672V3.71163ZM16.4667 13.8414C16.4667 13.4231 16.8093 13.084 17.2318 13.084C17.4352 13.0832 17.6306 13.1626 17.7748 13.3047C17.919 13.4469 18 13.64 18 13.8414V15.0005C18 16.3809 16.8695 17.5 15.4751 17.5H5.52178C4.12853 17.4983 3 16.3797 3 15.0005V13.8414C3 13.4231 3.34253 13.084 3.76506 13.084C4.18758 13.084 4.53011 13.4231 4.53011 13.8414V15.0005C4.53081 15.5423 4.97449 15.9812 5.52178 15.9816H15.4751C16.0224 15.9812 16.466 15.5423 16.4667 15.0005V13.8414Z" fill="#4D4D4D"/>\
                            </svg>';
var image_file_icon_html = '<svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">\
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M15.0714 7.14286C15.0714 8.08963 14.3039 8.85714 13.3571 8.85714C12.4104 8.85714 11.6429 8.08963 11.6429 7.14286C11.6429 6.19608 12.4104 5.42857 13.3571 5.42857C14.3039 5.42857 15.0714 6.19608 15.0714 7.14286ZM13.9286 7.14286C13.9286 7.45845 13.6727 7.71429 13.3571 7.71429C13.0416 7.71429 12.7857 7.45845 12.7857 7.14286C12.7857 6.82727 13.0416 6.57143 13.3571 6.57143C13.6727 6.57143 13.9286 6.82727 13.9286 7.14286Z" fill="#4D4D4D"/>\
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M2.5 5.42857C2.5 3.53502 4.03502 2 5.92857 2H15.0714C16.965 2 18.5 3.53502 18.5 5.42857V14.5714C18.5 16.465 16.965 18 15.0714 18H5.92857C4.03502 18 2.5 16.465 2.5 14.5714V5.42857ZM5.92857 3.14286C4.66621 3.14286 3.64286 4.16621 3.64286 5.42857V14.5714C3.64286 14.9973 3.75932 15.396 3.96214 15.7373L9.29849 10.4937C9.96545 9.83839 11.0345 9.83839 11.7015 10.4938L17.0379 15.7373C17.2407 15.396 17.3571 14.9973 17.3571 14.5714V5.42857C17.3571 4.16621 16.3338 3.14286 15.0714 3.14286H5.92857ZM5.92857 16.8571C5.50668 16.8571 5.11149 16.7428 4.77227 16.5435L10.0995 11.3089C10.3218 11.0905 10.6782 11.0905 10.9005 11.3089L16.2277 16.5435C15.8885 16.7428 15.4933 16.8571 15.0714 16.8571H5.92857Z" fill="#4D4D4D"/>\
                            </svg>';
var doc_file_icon_html = '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\
                          <path fill-rule="evenodd" clip-rule="evenodd" d="M6 2C4.89543 2 4 2.89543 4 4V16C4 17.1046 4.89543 18 6 18H14C15.1046 18 16 17.1046 16 16V7.41421C16 7.01639 15.842 6.63486 15.5607 6.35355L11.6464 2.43934C11.3651 2.15804 10.9836 2 10.5858 2H6ZM5 4C5 3.44772 5.44772 3 6 3H10V6.5C10 7.32843 10.6716 8 11.5 8H15V16C15 16.5523 14.5523 17 14 17H6C5.44772 17 5 16.5523 5 16V4ZM14.7929 7L11 3.20711V6.5C11 6.77614 11.2239 7 11.5 7H14.7929Z" fill="#4D4D4D"/>\
                          </svg>';
var zip_file_icon_html = '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <path d="M8.12501 9.375C8.12501 9.04348 8.25671 8.72554 8.49113 8.49112C8.72555 8.2567 9.04349 8.125 9.37501 8.125H10.625C10.9565 8.125 11.2745 8.2567 11.5089 8.49112C11.7433 8.72554 11.875 9.04348 11.875 9.375V10.5475L12.375 12.5462C12.4373 12.7963 12.4208 13.0596 12.3277 13.2999C12.2346 13.5402 12.0695 13.7459 11.855 13.8888L10.6925 14.6638C10.4872 14.8005 10.2461 14.8735 9.99939 14.8735C9.75271 14.8735 9.51155 14.8005 9.30626 14.6638L8.14376 13.8888C7.92949 13.7457 7.76465 13.54 7.67179 13.2997C7.57893 13.0593 7.56259 12.7962 7.62501 12.5462L8.12501 10.5475V9.375ZM10.625 9.375H9.37501V10.5475C9.375 10.6499 9.36241 10.7519 9.33751 10.8512L8.83751 12.8488L10 13.6238L11.1625 12.8488L10.6625 10.8512C10.6376 10.7519 10.625 10.6499 10.625 10.5475V9.375Z" fill="#4D4D4D"/>\
                        <path d="M2.5 2.5C2.5 1.83696 2.76339 1.20107 3.23223 0.732233C3.70107 0.263392 4.33696 0 5 0L15 0C15.663 0 16.2989 0.263392 16.7678 0.732233C17.2366 1.20107 17.5 1.83696 17.5 2.5V17.5C17.5 18.163 17.2366 18.7989 16.7678 19.2678C16.2989 19.7366 15.663 20 15 20H5C4.33696 20 3.70107 19.7366 3.23223 19.2678C2.76339 18.7989 2.5 18.163 2.5 17.5V2.5ZM9.375 1.25H5C4.66848 1.25 4.35054 1.3817 4.11612 1.61612C3.8817 1.85054 3.75 2.16848 3.75 2.5V17.5C3.75 17.8315 3.8817 18.1495 4.11612 18.3839C4.35054 18.6183 4.66848 18.75 5 18.75H15C15.3315 18.75 15.6495 18.6183 15.8839 18.3839C16.1183 18.1495 16.25 17.8315 16.25 17.5V2.5C16.25 2.16848 16.1183 1.85054 15.8839 1.61612C15.6495 1.3817 15.3315 1.25 15 1.25H11.25V2.5H10V3.75H11.25V5H10V6.25H11.25V7.5H9.375V6.25H8.125V5H9.375V3.75H8.125V2.5H9.375V1.25Z" fill="#4D4D4D"/>\
                        </svg>'
var video_file_icon_html = '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M4.17045 3.09066C3.5741 3.09066 3.09066 3.5741 3.09066 4.17045V15.8296C3.09066 16.4259 3.5741 16.9093 4.17045 16.9093H15.8296C16.4259 16.9093 16.9093 16.4259 16.9093 15.8296V4.17045C16.9093 3.5741 16.4259 3.09066 15.8296 3.09066H4.17045ZM2 4.17045C2 2.97174 2.97174 2 4.17045 2H15.8296C17.0283 2 18 2.97174 18 4.17045V15.8296C18 17.0283 17.0283 18 15.8296 18H4.17045C2.97174 18 2 17.0283 2 15.8296V4.17045Z" fill="#404040"/>\
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M6.27336 2C6.57454 2 6.81869 2.24415 6.81869 2.54533V17.4547C6.81869 17.7558 6.57454 18 6.27336 18C5.97218 18 5.72803 17.7558 5.72803 17.4547V2.54533C5.72803 2.24415 5.97218 2 6.27336 2Z" fill="#404040"/>\
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M13.7275 2C14.0286 2 14.2728 2.24415 14.2728 2.54533V17.4547C14.2728 17.7558 14.0286 18 13.7275 18C13.4263 18 13.1821 17.7558 13.1821 17.4547V2.54533C13.1821 2.24415 13.4263 2 13.7275 2Z" fill="#404040"/>\
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M2 10.0004C2 9.69923 2.24415 9.45508 2.54533 9.45508H17.4547C17.7558 9.45508 18 9.69923 18 10.0004C18 10.3016 17.7558 10.5457 17.4547 10.5457H2.54533C2.24415 10.5457 2 10.3016 2 10.0004Z" fill="#404040"/>\
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M2 6.27189C2 5.97072 2.24415 5.72656 2.54533 5.72656H6.27267C6.57384 5.72656 6.818 5.97072 6.818 6.27189C6.818 6.57307 6.57384 6.81722 6.27267 6.81722H2.54533C2.24415 6.81722 2 6.57307 2 6.27189Z" fill="#404040"/>\
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M2 13.7279C2 13.4268 2.24415 13.1826 2.54533 13.1826H6.27267C6.57384 13.1826 6.818 13.4268 6.818 13.7279C6.818 14.0291 6.57384 14.2733 6.27267 14.2733H2.54533C2.24415 14.2733 2 14.0291 2 13.7279Z" fill="#404040"/>\
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M13.1821 13.7279C13.1821 13.4268 13.4263 13.1826 13.7275 13.1826H17.4548C17.756 13.1826 18.0001 13.4268 18.0001 13.7279C18.0001 14.0291 17.756 14.2733 17.4548 14.2733H13.7275C13.4263 14.2733 13.1821 14.0291 13.1821 13.7279Z" fill="#404040"/>\
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M13.1821 6.27189C13.1821 5.97072 13.4263 5.72656 13.7275 5.72656H17.4548C17.756 5.72656 18.0001 5.97072 18.0001 6.27189C18.0001 6.57307 17.756 6.81722 17.4548 6.81722H13.7275C13.4263 6.81722 13.1821 6.57307 13.1821 6.27189Z" fill="#404040"/>\
                            </svg>';                                                                                      

///////////////////////////////////  SVG'S Ends ///////////////////////////////////////////

var is_web_worker_supported = typeof (Worker) !== "undefined";

var user_input_editable = true

var send_initial_message_list_to_livechat = "";

function set_url_parameter(parameter, parameter_value) {
    var final_query_param = "?";
    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
        final_query_param += key + "=" + (key == parameter ? parameter_value : value) + "&"
    });

    return window.location.origin + window.location.pathname + final_query_param;
}

function check_and_lower_string(input_string) {

    return input_string ? input_string.toLowerCase().trim() : "";
}

// Language Support data retrieval 

function update_csat_form_text() {

    csat_form_text = CSAT_FORM_TEXT.split(RESPONSE_SENTENCE_SEPARATOR)

    $("#csat-form-text-feedback-heading-1").html(csat_form_text[0])
    $("#csat-form-text-feedback-heading-2").html(csat_form_text[1])
    $("#csat-form-text-value-feedback-text").html(csat_form_text[2])
    $("#promoter-form-value-feedback-text").html(csat_form_text[2])
    $("#complete_form_text").html(csat_form_text[3])
    document.getElementById("demoter_feedback_text_area").placeholder = csat_form_text[4]
    $("#csat-form-text-contact-details-text").html(csat_form_text[5])

    if (document.getElementById("feedback_phone_number")) {
        document.getElementById("feedback_phone_number").placeholder = csat_form_text[6]
    }
    if (document.getElementById("feedback_email_id")) {
        document.getElementById("feedback_email_id").placeholder = csat_form_text[7]
    }

    document.getElementById("promoter_feedback_text_area").placeholder = csat_form_text[8]

    $("#promoter-form-no-feedback-cancel-button").html(CANCEL_TEXT)
    $("#no-feedback-given-cancel-button").html(CANCEL_TEXT)
    $("#save-demoter-form-submit-button").html(SUBMIT_TEXT)
    $("#promoter-form-feedback-submit-button").html(SUBMIT_TEXT)


}

function update_csat_emoji_text(){

    csat_emoji_text = CSAT_EMOJI_TEXT.split(RESPONSE_SENTENCE_SEPARATOR)

    $("#csat-angry-text").html(csat_emoji_text[0])
    $("#csat-sad-text").html(csat_emoji_text[1])
    $("#csat-neutral-text").html(csat_emoji_text[2])
    $("#csat-happy-text").html(csat_emoji_text[3])
    $("#csat-very-happy-text").html(csat_emoji_text[4])


}

function update_language_change_text(selected_language, active_class_name) {
    if (!active_class_name) {
        active_class_name = "selected"
    }
    $(".language-dropdown-items .dropdown-item." + active_class_name).removeClass(active_class_name)
    $(".language-dropdown-items #" + selected_language).addClass(active_class_name)
    let selected_language_element_text = $(".language-dropdown-items #" + selected_language).text()
    $("#bot-selected-language-animation-text").html(selected_language_element_text)
}

function update_speaker_tooltip_text() {
    if (document.getElementById('tooltiptext-speaker-welcome-screen')) {
        if (!is_mute()) {
            document.getElementById('tooltiptext-speaker-welcome-screen').innerHTML = UNMUTE_TEXT;
        } else {
            document.getElementById('tooltiptext-speaker-welcome-screen').innerHTML = MUTE_TEXT;
        }
    }

    if (document.getElementById('tooltiptext-speaker')) {
        if (!is_mute()) {
            document.getElementById('tooltiptext-speaker').innerHTML = UNMUTE_TEXT;
        } else {
            document.getElementById('tooltiptext-speaker').innerHTML = MUTE_TEXT;
        }
    }
}


function update_livechat_vc_related_language_objects(LIVECHAT_VC_NOTIFICATIONS) {
    LIVECHAT_VC_NOTIFICATIONS = LIVECHAT_VC_NOTIFICATIONS.split(RESPONSE_SENTENCE_SEPARATOR);
    try {

        $("#voice_call_initiated_modal .voice-call-modal-header span").html(LIVECHAT_VC_NOTIFICATIONS[6])
        $("#voice_call_initiated_modal .voice-call-modal-body span").html(LIVECHAT_VC_NOTIFICATIONS[8])
        $(".voice-call-reject-btn").html(LIVECHAT_VC_NOTIFICATIONS[15])
        $(".voice-call-accept-btn").html(LIVECHAT_VC_NOTIFICATIONS[16])

        $("#video_call_initiated_modal .voice-call-modal-header span").html(LIVECHAT_VC_NOTIFICATIONS[7])
        $("#video_call_initiated_modal .voice-call-modal-body span").html(LIVECHAT_VC_NOTIFICATIONS[9])

        $(".video-call-reject-btn").html(LIVECHAT_VC_NOTIFICATIONS[15])
        $(".video-call-accept-btn").html(LIVECHAT_VC_NOTIFICATIONS[16])

        $("#agent_cancelled_meet_popup .call-success-request-modal-body span").html(LIVECHAT_VC_NOTIFICATIONS[10])
        $("#success_request_popup .call-success-request-modal-body span").html(LIVECHAT_VC_NOTIFICATIONS[11])
        $("#end_ongoing_call_popup .call-success-request-modal-body span").html(LIVECHAT_VC_NOTIFICATIONS[12])

        $("#voice_call_connect_btn").html(LIVECHAT_VC_NOTIFICATIONS[17])

        $("#voice_call_connect_modal .voice-call-modal-header span").html(LIVECHAT_VC_NOTIFICATIONS[6])

        $("#voice_call_rejected_modal_header").html(LIVECHAT_VC_NOTIFICATIONS[6])

        $(".voice-call-ok-btn").html(LIVECHAT_VC_NOTIFICATIONS[18])
        $(".voice-call-resend-btn").html(LIVECHAT_VC_NOTIFICATIONS[19])

        $("#agent_accepted_vc_meet_popup span").html(LIVECHAT_VC_NOTIFICATIONS[20])



    } catch (err) {
        console.log(err)
    }
}

function update_attachment_related_language_objects(LIVECHAT_ATTACHMENT_TEXT) {
    LIVECHAT_ATTACHMENT_TEXT = LIVECHAT_ATTACHMENT_TEXT.split(RESPONSE_SENTENCE_SEPARATOR)

    $('#easychat-img-div span').html(LIVECHAT_ATTACHMENT_TEXT[0]);
    $('#easychat-img-div-previous span').html(LIVECHAT_ATTACHMENT_TEXT[1]);
}

function update_language_objects_in_bot(selected_language) {

    update_language_in_url_without_reload(selected_language)

    update_speaker_tooltip_text();

    update_csat_form_text();

    update_csat_emoji_text()

    $("#termination-confirmation-modal-end-chat").html(END_CHAT_ANDROID)
    $(".termination-yes-btn").html(TERMINATE_CHAT_ANDROID)
    $(".termination-no-btn").html(MINIMIZE_CHAT_ANDROID)
    $("#time-picker-container-custom-timepicker-heading-text").html(SELECT_VALUE_TEXT)
    $("#custom-timepicker-footer-cancel-button").html(CANCEL_TEXT)
    $("#custom-timepicker-footer-submit-button").html(SAVE_TEXT)
    $("#chat_with_text").html(CHAT_WITH_TEXT)

    if (EASYCHAT_BOT_THEME == "theme_1") {
        update_theme_1_specific_language_objects(selected_language);
    }

    if (EASYCHAT_BOT_THEME == "theme_2") {
        update_theme_2_specific_language_objects(selected_language);
    }

    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        update_theme_3_specific_language_objects(selected_language);
    }
}

function update_language_in_url_without_reload(selected_language) {

    updated_url = set_url_parameter("selected_language", selected_language)

    window.history.pushState({ path: updated_url }, '', updated_url);
}

function update_theme_1_specific_language_objects() {

    $("#tooltiptext-microphone").html(MIC_BUTTON_TOOLTIP)
    $("#tooltiptext-send").html(SEND_TEXT)
    $("#tooltiptext-home").html(HOME_BUTTON_TOOLTIP)
    $("#tooltiptext-language").html(CHOOSE_LANGUAGE)
    $("#tooltiptext-minimize").html(MINIMIZE_BUTTON_TOOLTIP)
    $("#tooltiptext-close").html(CLOSE_BUTTON_TOOLTIP)
    $("#easychat-theme1-bot-name").html(BOT_NAME)

    document.getElementById("user_input").placeholder = EASYCHAT_INPUT_QUERY_THEME_1_PLACEHOLDER

    update_language_change_text(selected_language, "selected")

}

function update_theme_2_specific_language_objects() {

    document.getElementById("user_input").placeholder = EASYCHAT_INPUT_QUERY_THEME_2_PLACEHOLDER

    $("#tooltiptext-mic").html(MIC_BUTTON_TOOLTIP)
    $("#tooltiptext-send").html(SEND_TEXT)
    $("#tooltiptext-home").html(HOME_BUTTON_TOOLTIP)
    $("#tooltiptext-language").html(CHOOSE_LANGUAGE)
    $("#tooltiptext-minimize").html(MINIMIZE_BUTTON_TOOLTIP)
    $("#powered-by-text").html(POWERED_BY_TEXT)
    $("#easychat-theme2-bot-name").html(BOT_NAME)

    update_language_change_text(selected_language, "selected")

}

function update_theme_3_specific_language_objects() {

    document.getElementById('user_input_placeholder_text').innerText = EASYCHAT_INPUT_QUERY_THEME_3_PLACEHOLDER
    document.getElementById("sticky-menu-header-text").innerText = MENU_TEXT
    document.getElementById("tooltip-mic-send-text").classList.remove("tooltip-send-only-text");
    document.getElementById("tooltip-mic-send-text").innerText = MIC_BUTTON_TOOLTIP

    $("#tooltip-home-text").html(HOME_BUTTON_TOOLTIP)
    $("#tooltip-language-text").html(CHOOSE_LANGUAGE)
    $("#tooltip-close-text").html(CLOSE_BUTTON_TOOLTIP)
    $("#sticky-menu-header-text").html(MENU_TEXT)
    $("#powered-by-text").html(POWERED_BY_TEXT)
    $("#easychat-theme3-bot-name").html(BOT_NAME)
    $(".easychat-bot-name-div").html(BOT_NAME)

    if(EASYCHAT_BOT_THEME == "theme_4") {
        $("#tooltip-menu-text").html(MENU_TEXT)
        $("#theme-4-cancel-button-text").html(CANCEL_TEXT)
        $("#theme_4_bot_name").html(" " + BOT_NAME)
    }

    update_language_change_text(selected_language, "active-language")

    $("#end_chat_btn").html(END_CHAT_TEXT)
}


function set_transilitration_for_phonetic_languages(lang_code) {

    if (IS_PHONETIC_TYPING_ENABLED != 'True') {
        return
    }
    try {
        
        if (GOOGLE_TRANSLITRATION_CONTROL) {
            GOOGLE_TRANSLITRATION_CONTROL.disableTransliteration()
        }

    } catch (err) {
        console.log(err)
    }

    if (list_of_phonetic_typing_enabled_languages.indexOf(lang_code) == -1) {
        return
    }

    var options = {
        //Source Language
        sourceLanguage: google.elements.transliteration.LanguageCode.ENGLISH,
        // Destination language to Transliterate
        destinationLanguage: [lang_code],
        shortcutKey: "ctrl+g",
        transliterationEnabled: true
    }


    GOOGLE_TRANSLITRATION_CONTROL = new google.elements.transliteration.TransliterationControl(options);
    GOOGLE_TRANSLITRATION_CONTROL.makeTransliteratable(["user_input"]);

}

function update_bot_language_details_without_refresh(selected_language, bot_id) {

    is_refresh_called = false

    get_language_templates_from_server(selected_language, bot_id, is_refresh_called);

    set_transilitration_for_phonetic_languages(selected_language);

    setTimeout(function () {
        get_language_bot_items_from_server(selected_language, bot_id);
    }, 100)
}

function update_bot_view_based_on_script_type(language_script_type) {
    if (language_script_type == "rtl") {
        document.getElementsByTagName("body")[0].classList.add("language-right-to-left-wrapper");
        document.getElementById("easychat-navbar").classList.add("language-right-to-left-wrapper");
        document.getElementById("easychat-chat-container").classList.add("language-right-to-left-wrapper");
        document.getElementById("easychat-footer").classList.add("language-right-to-left-wrapper");
    } else {
        document.getElementsByTagName("body")[0].classList.remove("language-right-to-left-wrapper");
        document.getElementById("easychat-navbar").classList.remove("language-right-to-left-wrapper");
        document.getElementById("easychat-chat-container").classList.remove("language-right-to-left-wrapper");
        document.getElementById("easychat-footer").classList.remove("language-right-to-left-wrapper");
    }
}


// is_refresh_called by default should be true
function get_language_templates_from_server(selected_language, bot_id, is_refresh_called) {

    var json_string = JSON.stringify({
        bot_id: bot_id,
        selected_language: selected_language,
    });
    json_string = encrypt_variable(json_string);
    json_string = encodeURIComponent(json_string);

    var xhttp = new XMLHttpRequest();
    var params = 'json_string=' + json_string
    xhttp.open("POST", "/chat/get-language-template/", true);
    xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            response = JSON.parse(this.responseText);
            response = custom_decrypt(response)
            response = JSON.parse(response);
            if (response['status'] == 200) {
                EASYCHAT_INPUT_QUERY_DEFAULT_PLACEHOLDER = response["placeholder"]
                EASYCHAT_INPUT_QUERY_THEME_1_PLACEHOLDER = response["placeholder"]
                EASYCHAT_INPUT_QUERY_THEME_2_PLACEHOLDER = response["placeholder"]
                EASYCHAT_INPUT_QUERY_THEME_3_PLACEHOLDER = response["placeholder"]
                WIDGETS_PLACEHOLDER_TEXT = response["widgets_placeholder_text"]
                RANGE_SLIDER_ERROR_MESSAGES = response["range_slider_error_messages"]
                TYPING_TEXT = response["typing_text"]
                CARDS_TEXT = response["cards_text"]
                MENU_TEXT = response["menu_text"]
                GO_BACK_TEXT = response["go_back_text"]
                BACK_TEXT = response["back_text"]
                DROPDOWN_TEXT = response["dropdown_text"]
                SEARCH_TEXT = response["search_text"]
                START_TEXT = response["start_text"]
                STOP_TEXT = response["stop_text"]
                SUBMIT_TEXT = response["submit_text"].split(RESPONSE_SENTENCE_SEPARATOR)[0]
                phone_widget_error_map = [response["invalid_number_text"], response["invalid_country_code"], response["phone_number_too_short_text"], response["phone_number_too_long_text"], response["invalid_number_text"]]
                UPLOAD_VIDEO_TEXT = response["uploading_video_text"]
                CANCEL_TEXT = response["cancel_text"]
                FILE_ATTACHEMENT_TEXT = response["file_attachment_text"]
                FILE_SIZE_LIMIT_TEXT = response["file_size_limit_text"]
                FEEDBACK_TEXT = response["feedback_text"]
                FEEDBACK_ERROR_TEXT = response["feedback_error_text"]
                SUCCESS_FEEDBACK_TEXT = response["success_feedback_text"]
                POSITIVE_FEEDBACK_1 = response["positive_feedback_options_text"].split(RESPONSE_SENTENCE_SEPARATOR)[0]
                POSITIVE_FEEDBACK_2 = response["positive_feedback_options_text"].split(RESPONSE_SENTENCE_SEPARATOR)[1]
                POSITIVE_FEEDBACK_3 = response["positive_feedback_options_text"].split(RESPONSE_SENTENCE_SEPARATOR)[2]
                POSITIVE_FEEDBACK_4 = response["positive_feedback_options_text"].split(RESPONSE_SENTENCE_SEPARATOR)[3]
                POSITIVE_FEEDBACK_5 = response["positive_feedback_options_text"].split(RESPONSE_SENTENCE_SEPARATOR)[4]
                NEGATIVE_FEEDBACK_1 = response["negative_feedback_options_text"].split(RESPONSE_SENTENCE_SEPARATOR)[0]
                NEGATIVE_FEEDBACK_2 = response["negative_feedback_options_text"].split(RESPONSE_SENTENCE_SEPARATOR)[1]
                NEGATIVE_FEEDBACK_3 = response["negative_feedback_options_text"].split(RESPONSE_SENTENCE_SEPARATOR)[2]
                NEGATIVE_FEEDBACK_4 = response["negative_feedback_options_text"].split(RESPONSE_SENTENCE_SEPARATOR)[3]
                NEGATIVE_FEEDBACK_5 = response["negative_feedback_options_text"].split(RESPONSE_SENTENCE_SEPARATOR)[4]
                CSAT_ALL_FIELD_ERROR = response["csat_form_error_mobile_email_text"].split(RESPONSE_SENTENCE_SEPARATOR)[0]
                INVALID_MOBILE_NUMBER = response["csat_form_error_mobile_email_text"].split(RESPONSE_SENTENCE_SEPARATOR)[1]
                INVALID_EMAIL_ID = response["csat_form_error_mobile_email_text"].split(RESPONSE_SENTENCE_SEPARATOR)[2]
                MIN_TEXT = response["date_range_picker_text"].split(RESPONSE_SENTENCE_SEPARATOR)[7]
                MAX_TEXT = response["date_range_picker_text"].split(RESPONSE_SENTENCE_SEPARATOR)[8]
                RANGE_TEXT = response["date_range_picker_text"].split(RESPONSE_SENTENCE_SEPARATOR)[9];
                SELECT_VALUE_TEXT = response["date_range_picker_text"].split(RESPONSE_SENTENCE_SEPARATOR)[10];
                SELECTED_VALUE_TEXT = response["date_range_picker_text"].split(RESPONSE_SENTENCE_SEPARATOR)[11];
                INVALID_SESSION_ID_RESPONSE_TEXT = response["invalid_session_id_response"];
                FILL_FORM_TEXT = response["form_widget_text"].split(RESPONSE_SENTENCE_SEPARATOR)[0]
                SUBMIT_FORM_TEXT = response["form_widget_text"].split(RESPONSE_SENTENCE_SEPARATOR)[1]
                YES = response["form_widget_text"].split(RESPONSE_SENTENCE_SEPARATOR)[2]
                NO = response["form_widget_text"].split(RESPONSE_SENTENCE_SEPARATOR)[3]
                READ_MORE = response["general_text"].split(RESPONSE_SENTENCE_SEPARATOR)[12]
                READ_LESS = response["general_text"].split(RESPONSE_SENTENCE_SEPARATOR)[13]
                SHOW_LESS = response["general_text"].split(RESPONSE_SENTENCE_SEPARATOR)[14]
                VIEW_MORE = response["general_text"].split(RESPONSE_SENTENCE_SEPARATOR)[15]
                SPEAK_NOW = response["general_text"].split(RESPONSE_SENTENCE_SEPARATOR)[16]
                UNABLE_TO_LOAD_TEXT = response["general_text"].split(RESPONSE_SENTENCE_SEPARATOR)[17]
                BOT_MINIMIZE_TEXT = response.minimize_text;
                BOT_MAXIMIZE_TEXT = response.maximize_text;
                POWERED_BY_TEXT = response["powered_by_text"]
                MUTE_TEXT = response["mute_text"]
                UNMUTE_TEXT = response["unmute_text"];
                NO_RESULT_FOUND = response["no_result_found"];
                OTP_SIX_DIGIT_ERROR_TEXT = response["form_widget_error_text"].split(RESPONSE_SENTENCE_SEPARATOR)[0]
                OTP_FOUR_DIGIT_ERROR_TEXT = response["form_widget_error_text"].split(RESPONSE_SENTENCE_SEPARATOR)[1]
                EMAIL_ERROR_TEXT = response["form_widget_error_text"].split(RESPONSE_SENTENCE_SEPARATOR)[2]
                PAN_ERROR_TEXT = response["form_widget_error_text"].split(RESPONSE_SENTENCE_SEPARATOR)[3]
                NAME_ERROR_TEXT = response["form_widget_error_text"].split(RESPONSE_SENTENCE_SEPARATOR)[4]
                SAVE_TEXT = response["form_widget_error_text"].split(RESPONSE_SENTENCE_SEPARATOR)[5]
                RESET_TEXT = response["form_widget_error_text"].split(RESPONSE_SENTENCE_SEPARATOR)[6]
                MOBILE_ERROR_TEXT = response["form_widget_error_text"].split(RESPONSE_SENTENCE_SEPARATOR)[7]
                FILE_UPLOADED_TEXT = response["widgets_response_text"].split(RESPONSE_SENTENCE_SEPARATOR)[0]
                LABEL_DATE = response["widgets_response_text"].split(RESPONSE_SENTENCE_SEPARATOR)[1]
                LABEL_TIME = response["widgets_response_text"].split(RESPONSE_SENTENCE_SEPARATOR)[2]
                LABEL_ADD = response["widgets_response_text"].split(RESPONSE_SENTENCE_SEPARATOR)[3]
                LABEL_FROM = response["widgets_response_text"].split(RESPONSE_SENTENCE_SEPARATOR)[4]
                LABEL_TO = response["widgets_response_text"].split(RESPONSE_SENTENCE_SEPARATOR)[5]
                THEME_3_GREETING_TEXT = response["greeting_and_welcome_text"].split(RESPONSE_SENTENCE_SEPARATOR)[0]
                THEME_3_WELCOME_TEXT = response["greeting_and_welcome_text"].split(RESPONSE_SENTENCE_SEPARATOR)[1]
                MIC_BUTTON_TOOLTIP = response["mic_button_tooltip"]
                HOME_BUTTON_TOOLTIP = response["home_button_tooltip"]
                CLOSE_BUTTON_TOOLTIP = response["close_button_tooltip"]
                SEND_TEXT = response["send_text"]
                CHOOSE_LANGUAGE = response["choose_language"].split(RESPONSE_SENTENCE_SEPARATOR)[0]
                bot_response_delay_message = response["bot_response_delay_message"]
                bot_inactivity_msg = response["bot_inactivity_msg"]
                MINIMIZE_BUTTON_TOOLTIP = response["minimize_button_tooltip"]
                CSAT_FORM_TEXT = response["csat_form_text"]
                CSAT_EMOJI_TEXT = response["csat_emoji_text"]
                CHAT_WITH_TEXT = response["chat_with_text"]
                END_CHAT_ANDROID = response["end_chat"].split(RESPONSE_SENTENCE_SEPARATOR)[0]
                MINIMIZE_CHAT_ANDROID = response["end_chat"].split(RESPONSE_SENTENCE_SEPARATOR)[1]
                TERMINATE_CHAT_ANDROID = response["end_chat"].split(RESPONSE_SENTENCE_SEPARATOR)[2]
                LIVECHAT_FORM_TEXT = response["livechat_form_text"]
                LIVECHAT_SYSTEM_NOTIFICATIONS = response["livechat_system_notifications"]
                LIVECHAT_SYSTEM_NOTIFICATIONS_IOS = response["livechat_system_notifications_ios"]
                LIVECHAT_FEEDBACK_TEXT = response["livechat_feedback_text"]
                LIVECHAT_VALIDATION_TEXT = response["livechat_validation_text"]
                LIVECHAT_VOICECALL_NOTIFICATIONS = response["livechat_voicecall_notifications"]
                LIVECHAT_VC_NOTIFICATIONS = response["livechat_vc_notifications"]
                LIVECHAT_ATTACHMENT_TEXT = response["attachment_tooltip_text"]
                CB_TEXT = response["cb_text"]
                DO_NOT_DISTURB_TEXT = response["do_not_disturb_text"].split(RESPONSE_SENTENCE_SEPARATOR)[0]
                DO_NOT_DISTURB_CONFIRMATION_TEXT = response["do_not_disturb_text"].split(RESPONSE_SENTENCE_SEPARATOR)[1]
                DO_NOT_DISTURB_DENIED_TEXT = response["do_not_disturb_text"].split(RESPONSE_SENTENCE_SEPARATOR)[2]
                PDF_SEARCH_CARDS_TEXT = response["pdf_view_document_text"]
                UPLOAD_TEXT = LIVECHAT_ATTACHMENT_TEXT.split(RESPONSE_SENTENCE_SEPARATOR)[2];
                language_script_type = response["language_script_type"]
                language_days_list = response["language_days_list"]
                language_months_list = response["language_months_list"]
                BOT_NAME = response["bot_name"]
                FAQ_TEXT = response["frequently_asked_questions_text"].split(RESPONSE_SENTENCE_SEPARATOR)[0]
                FAQ_TOOLTIP = response["frequently_asked_questions_text"].split(RESPONSE_SENTENCE_SEPARATOR)[1]
                SEARCH_HERE_TEXT = response["frequently_asked_questions_text"].split(RESPONSE_SENTENCE_SEPARATOR)[2]
                VIEW_ALL_TEXT = response["frequently_asked_questions_text"].split(RESPONSE_SENTENCE_SEPARATOR)[3]
                WAS_IT_HELPFUL_TEXT = response["frequently_asked_questions_text"].split(RESPONSE_SENTENCE_SEPARATOR)[4]
                SKIP_TEXT = response["frequently_asked_questions_text"].split(RESPONSE_SENTENCE_SEPARATOR)[5]
                ASK_YOUR_QUERY_TEXT = response["frequently_asked_questions_text"].split(RESPONSE_SENTENCE_SEPARATOR)[6]
                QUERY_API_FAILURE_TEXT = response["query_api_failure_text"]
                LIVECHAT_TRANSCRIPT_TEXT = response["livechat_transcript_text"]
                //  this is for theme 3 to update the minimze and maximize bot tooltip text according to particular language
                update_chatbot_minimize_maximize_text();
                update_bot_view_based_on_script_type(language_script_type);

                update_livechat_form_text(LIVECHAT_FORM_TEXT);
                update_livechat_system_notifications(LIVECHAT_SYSTEM_NOTIFICATIONS);
                update_livechat_system_notifications_ios(LIVECHAT_SYSTEM_NOTIFICATIONS_IOS);
                update_livechat_feedback_text(LIVECHAT_FEEDBACK_TEXT);
                update_livechat_validation_text(LIVECHAT_VALIDATION_TEXT);
                update_livechat_voicecall_notifications(LIVECHAT_VOICECALL_NOTIFICATIONS);
                update_livechat_vc_notifications(LIVECHAT_VC_NOTIFICATIONS);
                update_livechat_cb_notifications(CB_TEXT);

                update_livechat_transcript_text(LIVECHAT_TRANSCRIPT_TEXT);
                update_attachment_related_language_objects(LIVECHAT_ATTACHMENT_TEXT);

                if (!is_refresh_called) {
                    update_language_objects_in_bot(selected_language);

                    show_bot_language_animation(700)
                    update_livechat_vc_related_language_objects(LIVECHAT_VC_NOTIFICATIONS)
                }
                if (EASYCHAT_BOT_THEME == 'theme_4') {
                    $('#ask_your_query_placeholder').html(ASK_YOUR_QUERY_TEXT)
                }
            }
        }
    }
    xhttp.send(params);
}

function update_livechat_form_text(LIVECHAT_FORM_TEXT) {
    LIVECHAT_FORM_TEXT = LIVECHAT_FORM_TEXT.split(RESPONSE_SENTENCE_SEPARATOR);

    CONNECT_AGENT_TEXT = LIVECHAT_FORM_TEXT[0];
    FILL_DETAILS_TEXT = LIVECHAT_FORM_TEXT[1];
    ENTER_NAME_TEXT = LIVECHAT_FORM_TEXT[2];
    ENTER_EMAIL_TEXT = LIVECHAT_FORM_TEXT[3];
    ENTER_PHONE_TEXT = LIVECHAT_FORM_TEXT[4];
    CONTINUE_TEXT = LIVECHAT_FORM_TEXT[5];
    LIVECHAT_CONTINUE_TEXT = LIVECHAT_FORM_TEXT[6];
    CHOOSE_CATEGORY_TEXT = LIVECHAT_FORM_TEXT[7];
    CATEGORY_ERROR_TEXT = LIVECHAT_FORM_TEXT[8];
    CATEGORY_AUTHENTICATION_ERROR_TEXT = LIVECHAT_FORM_TEXT[9];
}

function update_livechat_system_notifications_ios(LIVECHAT_SYSTEM_NOTIFICATIONS_IOS) {
    LIVECHAT_SYSTEM_NOTIFICATIONS_IOS = LIVECHAT_SYSTEM_NOTIFICATIONS_IOS.split(RESPONSE_SENTENCE_SEPARATOR);

    AGENT_CONNECTED_TEXT = LIVECHAT_SYSTEM_NOTIFICATIONS_IOS[0];
    WEAK_INTERNET_OR_MINIMIZE_TEXT = LIVECHAT_SYSTEM_NOTIFICATIONS_IOS[1];
}

function update_livechat_system_notifications(LIVECHAT_SYSTEM_NOTIFICATIONS) {
    LIVECHAT_SYSTEM_NOTIFICATIONS = LIVECHAT_SYSTEM_NOTIFICATIONS.split(RESPONSE_SENTENCE_SEPARATOR);

    REQUEST_IN_PROCESS = LIVECHAT_SYSTEM_NOTIFICATIONS[0];
    JOINED_CHAT_TEXT = LIVECHAT_SYSTEM_NOTIFICATIONS[1];
    WEAK_INTERNET_TEXT = LIVECHAT_SYSTEM_NOTIFICATIONS[2];
    AGENT_UNAVAILABLE_TEXT = LIVECHAT_SYSTEM_NOTIFICATIONS[3];
    CHAT_ENDED_TEXT = LIVECHAT_SYSTEM_NOTIFICATIONS[4];
    AGENT_LEFT_TEXT = LIVECHAT_SYSTEM_NOTIFICATIONS[5];
    FEEDBACK_SUBMIT_TEXT = LIVECHAT_SYSTEM_NOTIFICATIONS[6];
    END_CHAT_TEXT = LIVECHAT_SYSTEM_NOTIFICATIONS[7];
}

function update_livechat_feedback_text(LIVECHAT_FEEDBACK_TEXT) {
    LIVECHAT_FEEDBACK_TEXT = LIVECHAT_FEEDBACK_TEXT.split(RESPONSE_SENTENCE_SEPARATOR);

    LIVECHAT_FEEDBACK_HEADER = LIVECHAT_FEEDBACK_TEXT[0];
    LIVECHAT_FEEDBACK_MAIN_TEXT = LIVECHAT_FEEDBACK_TEXT[1];
    LIVECHAT_FEEDBACK_CANCEL_TEXT = LIVECHAT_FEEDBACK_TEXT[2];
    LIVECHAT_ADD_COMMENT_TEXT = LIVECHAT_FEEDBACK_TEXT[3];
}

function update_livechat_validation_text(LIVECHAT_VALIDATION_TEXT) {
    LIVECHAT_VALIDATION_TEXT = LIVECHAT_VALIDATION_TEXT.split(RESPONSE_SENTENCE_SEPARATOR);

    LIVECHAT_MALICIOUS_FILE_TEXT = LIVECHAT_VALIDATION_TEXT[0];
    LIVECHAT_VALID_FILE_TEXT = LIVECHAT_VALIDATION_TEXT[1].replace('_' , ".jpg, .docx, .pdf");
    LIVECHAT_EXCEED_FILE_SIZE_TEXT = LIVECHAT_VALIDATION_TEXT[2];
    
}

function update_livechat_vc_notifications(LIVECHAT_VC_NOTIFICATIONS) {
    LIVECHAT_VC_NOTIFICATIONS = LIVECHAT_VC_NOTIFICATIONS.split(RESPONSE_SENTENCE_SEPARATOR);

    LIVECHAT_VC_REQUEST = LIVECHAT_VC_NOTIFICATIONS[0];
    LIVECHAT_VC_START = LIVECHAT_VC_NOTIFICATIONS[1];
    LIVECHAT_VC_END = LIVECHAT_VC_NOTIFICATIONS[2];
    LIVECHAT_VC_JOIN = LIVECHAT_VC_NOTIFICATIONS[3];
    LIVECHAT_VC_JOIN_ACCEPTED = LIVECHAT_VC_NOTIFICATIONS[4];
    LIVECHAT_VC_JOIN_NOW_TEXT = LIVECHAT_VC_NOTIFICATIONS[5];
    VIDEO_CALL_TEXT = LIVECHAT_VC_NOTIFICATIONS[7];
    AGENT_ACCEPTED_VOIP = LIVECHAT_VC_NOTIFICATIONS[13];
    AGENT_REJECTED_VOIP = LIVECHAT_VC_NOTIFICATIONS[14];
    AGENT_REJECTED_VC = LIVECHAT_VC_NOTIFICATIONS[21];
}

function update_livechat_voicecall_notifications(LIVECHAT_VOICECALL_NOTIFICATIONS) {
    LIVECHAT_VOICECALL_NOTIFICATIONS = LIVECHAT_VOICECALL_NOTIFICATIONS.split(RESPONSE_SENTENCE_SEPARATOR);
    
    LIVECHAT_VOICECALL_REQUEST = LIVECHAT_VOICECALL_NOTIFICATIONS[0];
    LIVECHAT_VOICECALL_START = LIVECHAT_VOICECALL_NOTIFICATIONS[1];
    LIVECHAT_VOICECALL_END = LIVECHAT_VOICECALL_NOTIFICATIONS[2];
}

function update_livechat_cb_notifications(CB_TEXT) {
    CB_TEXT = CB_TEXT.split(RESPONSE_SENTENCE_SEPARATOR);

    CB_START = CB_TEXT[1];
    CB_END = CB_TEXT[2];
}

function update_livechat_transcript_text(LIVECHAT_TRANSCRIPT_TEXT) {
    LIVECHAT_TRANSCRIPT_TEXT = LIVECHAT_TRANSCRIPT_TEXT.split(RESPONSE_SENTENCE_SEPARATOR);

    LIVECHAT_GOOD_BYE_TEXT = LIVECHAT_TRANSCRIPT_TEXT[0];
    LIVECHAT_CHAT_TRANSCRIPT_MAIL_TEXT = LIVECHAT_TRANSCRIPT_TEXT[1];
    LIVECHAT_CLICK_HERE_TEXT = LIVECHAT_TRANSCRIPT_TEXT[2];
    LIVECHAT_CONVERSATION_MAIL_TEXT = LIVECHAT_TRANSCRIPT_TEXT[3];
    LIVECHAT_TRANSCRIPT_SEND_TEXT = LIVECHAT_TRANSCRIPT_TEXT[4];
    LIVECHAT_CHECK_BOX_TRANSCRIPT_TEXT = LIVECHAT_TRANSCRIPT_TEXT[5];
}

function update_multilingual_csat_feedback_option(csat_required_checkboxes) {
    $("#csat_modal_feedback-checkbox-container").html("")
    let csat_html = ""
    for (let i = 0; i < csat_required_checkboxes.length; i++) {
        let csat_feedback_option = csat_required_checkboxes[i]
        if (i == csat_required_checkboxes.length - 1) {
            csat_html += '<label>\
            <input type="checkbox" class="filled-in" id="other-choice-opt" onclick="handle_csat_choices()" />\
            <span class="feedback_demoter_checkbox_value">' + csat_feedback_option + '</span>\
        </label>'
        }
        else {
            csat_html += '<label>\
            <input type="checkbox" class="filled-in" id="csat-choice-opt" onclick="handle_csat_choices()"  />\
            <span class="feedback_demoter_checkbox_value">' + csat_feedback_option + '</span>\
        </label>'
        }
    }

    $("#csat_modal_feedback-checkbox-container").html(csat_html)
}

//  this function gets language updated sticky items and translated csat options
function get_language_bot_items_from_server(selected_language, bot_id) {

    var channel_name = url_parameters["channel"]
    if (channel_name == undefined || channel_name == null)
        channel_name = "Web"

    var json_string = JSON.stringify({
        bot_id: bot_id,
        selected_language: selected_language,
        channel_name: channel_name
    });
    json_string = encrypt_variable(json_string);
    json_string = encodeURIComponent(json_string);

    var xhttp = new XMLHttpRequest();
    var params = 'json_string=' + json_string
    xhttp.open("POST", "/chat/get-language-updated-bot-items/", true);
    xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            response = JSON.parse(this.responseText);
            response = custom_decrypt(response)
            response = JSON.parse(response);
            if (response['status'] == 200) {


                sticky_intents_list = response["sticky_intents_list"]
                sticky_intents_list_menu = response["sticky_intents_list_menu"]
                sticky_button_display_format = response["sticky_button_display_format"]

                csat_required_checkboxes = response["csat_required_checkboxes"]

                if (sticky_button_display_format == 'Menu') {
                    append_sticky_intents_menu_based_on_theme(sticky_intents_list_menu)
                } else {
                    append_sticky_intent_based_on_theme(sticky_intents_list)
                }

                update_multilingual_csat_feedback_option(csat_required_checkboxes);

                default_response = response["welcome_message"]
            }
        }
    }
    xhttp.send(params);
}


function disable_language_change_options() {

    if (EASYCHAT_BOT_THEME == "theme_3") {

        disable_language_for_theme_three();

    } else if (EASYCHAT_BOT_THEME == "theme_4") {
        $('.bot-language-main-container').hide()
    } else {
        if (document.getElementsByClassName("language-dropdown-container").length) {

            document.getElementsByClassName("language-dropdown-container")[0].style.display = "none"
        }
    }

}

function close_language_disclaimer_modal() {

    document.getElementById('disclaimer_popup_modal').style.display = 'none';
    enable_sticky_div()
    enable_bot_footer()

}
function update_bot_selected_language(curr_language) {
    selected_language = curr_language
    parent.postMessage({
        event_id: 'set_local_storage',
        data: {
            var_value: selected_language,
        }
    }, "*")
    
    var url_parameters = get_url_vars();
    if(check_and_lower_string(url_parameters["channel"]) == "ios") {
        // Adding this in try catch so that it does not throw any error in normal browser when we open it via index page
        try {
            webkit.messageHandlers.setSelectedLanguage.postMessage({"selected_language": selected_language})
        } catch(err) {}
    }

    bot_id = url_parameters["id"];
    update_chatbot_form_assist_text(bot_id, selected_language)
    setTimeout(function () {
        var params = get_url_vars();
        params["selected_language"] = selected_language;
        params["trigger_intent_pk"] = "";
        params["easychat_intent_name"] = "";
        if ("is_first_time_amp_user" in params) {
            params["is_first_time_amp_user"] = "false"
        }
        var redirect_url = "?";
        for (param in params) {
            if (redirect_url != "?") {
                redirect_url += "&";
            }
            redirect_url += param + "=" + params[param];
        }
        // url = set_url_parameter("selected_language", selected_language);
        // window.location.href = url;
        window.location = redirect_url;
    }, 1500);
}

function confirm_update_language_selected_for_phonetic_languages() {
    update_bot_selected_language(temp_selected_language)
}

function update_disclaimer_modal_text_for_selected_language(lang) {
    try {
        $("#disclaimer-modal-popup-text").html(disclaimer_text_dict[lang]["disclaimer_text"])
        $("#disclaimer-modal-confirm-button").html(disclaimer_text_dict[lang]["confirm_text"])
        $("#disclaimer-modal-container-heading").html(disclaimer_text_dict[lang]["heading_text"])
        if (EASYCHAT_BOT_THEME == 'theme_4') {
            $("#disclaimer-modal-cancel-button").html(disclaimer_text_dict[lang]["cancel_text"])
            if (disclaimer_text_dict[lang]["language_script_type"] == "rtl") {
                $('#disclaimer_popup_modal .easychat-bot-custom-modal-footer').css('flex-direction', 'row-reverse')
            } else {
                $('#disclaimer_popup_modal .easychat-bot-custom-modal-footer').css('flex-direction', 'row')
            }
        }

        var cross_btn = document.getElementById("disclaimer_popup_modal").getElementsByClassName("popup-close")[0];
        if (disclaimer_text_dict[lang]["language_script_type"] == "rtl") {
            cross_btn.style.left = "15px";
            cross_btn.style.right = "unset";
        } else {
            cross_btn.style.left = "unset";
            cross_btn.style.right = "15px";
        }

    } catch (err) {
        console.log(err)
    }

}

function update_bot_based_on_selected_language(element) {

    if(!element.classList.contains("active-language") && !element.classList.contains("selected")){
        temp_selected_language = element.id;
    
        if (list_of_phonetic_typing_enabled_languages.indexOf(temp_selected_language) != -1 && IS_PHONETIC_TYPING_ENABLED == "True") {
    
            update_disclaimer_modal_text_for_selected_language(temp_selected_language)
    
            document.getElementById('disclaimer_popup_modal').style.display = 'block';
            disable_bot_footer();
            disable_sticky_div();
            return
        }
        selected_language = element.id;
        update_bot_selected_language(selected_language)
        if ("is_amp_page_request" in url_parameters && url_parameters["is_amp_page_request"] == "true"){
            let amp_page_history_number = (parseInt(get_cookie("amp_page_history_number")) + 1).toString();
            set_cookie("amp_page_history_number", amp_page_history_number);
        }
    }
}

function show_bot_language_animation(initial_delay_time) {
    fade_out_time = 2500
    if (EASYCHAT_BOT_THEME == "theme_3") {
        initial_delay_time += 2000
        fade_out_time += 2000
    }

    setTimeout(function () {
        // Display the div containing the class "bottomdiv"
        $(".easychat-bot-language-div.easychat-bot-language-div-active").css("pointerEvents", "none");
        $(".bot-selected-language-animation-text").show('slow');
        $('.easychat-bot-language-div').addClass('easychat-bot-language-div-active');
        $(".easychat-bot-language-div").css("pointerEvents", "none");
    }, initial_delay_time);
    setTimeout(function () {
        // Display the div containing the class "bottomdiv"
        $(".bot-selected-language-animation-text").hide('slow');
        $(".easychat-bot-language-div.easychat-bot-language-div-active").css("pointerEvents", "auto");
        $('.easychat-bot-language-div').removeClass('easychat-bot-language-div-active');
        $(".easychat-bot-language-div").css("pointerEvents", "auto");

    }, fade_out_time);
}
//       Session management

function update_last_seen(user_id) {

    if (is_user_authenticated == false) {

        return;
    }

    url_parameters = get_url_vars();
    bot_id = url_parameters["id"];

    var json_string = JSON.stringify({
        user_id: user_id,
        bot_id: bot_id,
    });
    json_string = encrypt_variable(json_string);
    json_string = encodeURIComponent(json_string);

    var xhttp = new XMLHttpRequest();
    var params = 'json_string=' + json_string
    xhttp.open("POST", "/chat/update-last-seen-chatbot/", true);
    xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            response = JSON.parse(this.responseText);
            response = custom_decrypt(response)
            response = JSON.parse(response);
            if (response['status'] == 200) {
                console.log("Success"); // debugging purpose
            }
        }
    }
    xhttp.send(params);
}

function start_authenticated_session(user_id, is_user_authenticated) {

    if (is_user_authenticated == true) {

        if (update_last_seen_chatbot == null) {

            update_last_seen_chatbot = setInterval(function () {
                update_last_seen(user_id);
            }, 15000);
        } else {

            clearInterval(update_last_seen_chatbot);
            update_last_seen_chatbot = setInterval(function () {
                update_last_seen(user_id);
            }, 15000);
        }
    }
}

function enable_language_for_theme_three() {

    if (document.getElementsByClassName("easychat-bot-language-div").length) {

        document.getElementsByClassName("easychat-bot-language-div")[0].style.display = "flex"

    }

}

function disable_language_for_theme_three() {

    if (document.getElementsByClassName("easychat-bot-language-div").length) {

        document.getElementsByClassName("easychat-bot-language-div")[0].style.display = "none"

    }

}

(function (exports) {
    is_text_to_speech_required = false;
    var is_bot_response_message_showed = false;
    var show_livechat_form_or_no = true;
    var is_abruptly_closed = false;
    var is_livechat = false;
    var is_livechat_msg = false;
    default_response = "Hi, I am your personal virtual assistant. How may I assist you further?";

    exports.is_text_to_speech_required = is_text_to_speech_required;
    exports.is_bot_response_message_showed = is_bot_response_message_showed;
    exports.show_livechat_form_or_no = show_livechat_form_or_no;
    exports.is_abruptly_closed = is_abruptly_closed;
    exports.is_livechat = is_livechat;
    exports.is_livechat_msg = is_livechat_msg;
    exports.window_location = window_location;

    function enable_language_change_options() {

        is_bot_response_message_showed = true;
        if (EASYCHAT_BOT_THEME == "theme_3") {
            enable_language_for_theme_three();
        } else if (EASYCHAT_BOT_THEME == "theme_4") {
            $('.bot-language-main-container').show()
        } else {
            if (document.getElementsByClassName("language-dropdown-container").length) {

                document.getElementsByClassName("language-dropdown-container")[0].style.display = "flex"
            }
        }

    }


    exports.enable_language_change_options = enable_language_change_options

    function is_sticky_menu_present() {
        return is_sticky_intent_menu_present;
    }

    exports.is_sticky_menu_present = is_sticky_menu_present

    function is_sticky_intents_present() {
        return is_sticky_intent_button_present;
    }

    exports.is_sticky_intents_present = is_sticky_intents_present;


    function toogle_sticky_menu_for_theme_three(display_prop) {

        if (enable_response_form_assist == 'false') return;

        if (is_sticky_menu_present()) {
            $(".easychat-bot-sticky-menu-wrapper").css("display", display_prop)
            if (EASYCHAT_BOT_THEME == 'theme_4') {
                if(display_prop == "block") {
                    $('#bot_menu_option_opner_div').attr('style', 'display: flex !important')
                    $('#easychat-restart-div').css('width', 'calc(100% - 56px)')
                    $("#img-scroll-to-bottom").css("bottom", "3.7em");
                } else {
                    $('#bot_menu_option_opner_div').attr('style', 'display: none !important')
                    $('#easychat-restart-div').css('width', '100%')
                    $("#img-scroll-to-bottom").css("bottom", "3.7em");
                }
            }
        }
        if (is_sticky_intents_present()) {
            if (display_prop == "block") {
                display_prop = "flex";
            }
            $(".easychat-bot-sticky-intent-wrapper").css("display", display_prop)
            if( display_prop == "none" ){
                $("#img-scroll-to-bottom").css("bottom", "3.7em");
                }
           else{
               $("#img-scroll-to-bottom").css("bottom", "6.7em");
               }
        }

    }

    exports.toogle_sticky_menu_for_theme_three = toogle_sticky_menu_for_theme_three;

    function disable_user_input() {
        var user_input_elem = document.getElementById("user_input");

        if (window.outerWidth < mobile_width) {
            // keyboard opens and closes on input
            // checks mobile and accordingly disables user input 
            user_input_elem.readOnly = true;
        } else {
            user_input_elem.disabled = true;
        }

        if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
            user_input_editable = false;
            user_input_elem.setAttribute("contenteditable", false);
        }


    }
    exports.disable_user_input = disable_user_input;

    function user_input_paste() {
        activate_query_submit_button()
    }

    exports.user_input_paste = user_input_paste;

    function enable_user_input() {
        if (check_element_exists("user_input")) {
            var user_input_elem = document.getElementById("user_input");
            if (window.outerWidth < mobile_width) {
                user_input_elem.readOnly = false;
            } else {
                user_input_elem.disabled = false;
            }

            if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
                user_input_editable = true;
                user_input_elem.setAttribute("contenteditable", true);
            }
        }

    }
    exports.enable_user_input = enable_user_input;

    function page_embed_in_iframe() {
        try {
            if (parent.location === self.location) {
                return false;
            } else {
                return true;
            }
        } catch (err) {
            return true;
        }
    }
    exports.page_embed_in_iframe = page_embed_in_iframe;

    function scroll_to_bottom() {
        var objDiv = document.getElementById("easychat-chat-container");
        objDiv.scrollTop = objDiv.scrollHeight;

    }
    exports.scroll_to_bottom = scroll_to_bottom;

    function resize_chabot_window() {
        hide_no_input_sticky_menu();

        var sticky_intent_height = 0;

        if (document.getElementById("easychat-sticky") != null && document.getElementById("easychat-sticky").style.display != "none") {
            sticky_intent_height = document.getElementById('easychat-sticky').clientHeight;
            $("#img-scroll-to-bottom").css("bottom", "6.7em");
        } else {
            if (document.getElementById("easychat-end-chat") != null && document.getElementById("easychat-end-chat").style.display != 'none') {
                sticky_intent_height = document.getElementById("easychat-end-chat").clientHeight;
                $("#img-scroll-to-bottom").css("bottom", "6.7em");
            } else {

                sticky_intent_height = document.getElementById("easychat-footer").clientHeight;
                $("#img-scroll-to-bottom").css("bottom", "3em");

            }
        }
        if (EASYCHAT_BOT_THEME == 'theme_3') {
            if( $(".easychat-bot-sticky-intent-wrapper").css("display") == "none" && $(".easychat-bot-sticky-menu-wrapper").css("display") == "none" && $(".easychat-bot-end-chat-button-div").css("display") == "none"){
              $("#img-scroll-to-bottom").css("bottom", "3.7em");
            }
            else{
              $("#img-scroll-to-bottom").css("bottom", "6.7em");
            } 
       }
       if (EASYCHAT_BOT_THEME == 'theme_4') {
        if(is_sticky_intents_present()){
                 $("#img-scroll-to-bottom").css("bottom", "6.7em");
            }
         else if(is_livechat){
                 $("#img-scroll-to-bottom").css("bottom", "6.7em");
             } 
          else {
              $("#img-scroll-to-bottom").css("bottom", "3.7em");
          }
         }
        var voice_call_div_height = 0;
        if (document.getElementById("voice_call_div") != null && document.getElementById("voice_call_div").style.display != "none") {
            voice_call_div_height = document.getElementById('voice_call_div').clientHeight;
        }

        document.getElementById('easychat-chat-container').style.height = (document.documentElement.clientHeight - (document.getElementById("easychat-navbar").clientHeight + sticky_intent_height) - 25).toString() + "px ";
        if (navigator.userAgent.indexOf("Firefox") != -1) {
            if (document.getElementById("easychat-sticky") == null) {
                document.getElementById('easychat-chat-container').style.height = parseInt(document.getElementById('easychat-chat-container').style.height.slice(0, -2)) - 15 + "px";
            }
            else if (document.getElementById("easychat-sticky") != null) {
                document.getElementById('easychat-chat-container').style.height = parseInt(document.getElementById('easychat-chat-container').style.height.slice(0, -2)) - 2 + "px";
            }
        }

        if (EASYCHAT_BOT_THEME == "theme_1") {
            document.getElementById('easychat-chat-container').style.height = (document.documentElement.clientHeight - (document.getElementById("easychat-navbar").clientHeight + sticky_intent_height)).toString() + "px ";
            if (navigator.userAgent.indexOf("Firefox") != -1) {
                if (document.getElementById("easychat-sticky") == null) {
                    document.getElementById('easychat-chat-container').style.height = parseInt(document.getElementById('easychat-chat-container').style.height.slice(0, -2)) - 10 + "px";
                }
                else if (document.getElementById("easychat-sticky") != null) {
                    document.getElementById('easychat-chat-container').style.height = parseInt(document.getElementById('easychat-chat-container').style.height.slice(0, -2)) - 2 + "px";
                }
            }

            document.getElementById('easychat-chat-container').style.top = document.getElementById("easychat-navbar").clientHeight + voice_call_div_height + 'px';
        }

        if (EASYCHAT_BOT_THEME == "theme_2") {

            if (window.innerHeight > 610) {

                document.getElementById('easychat-chat-container').style.height = (document.documentElement.clientHeight - document.getElementById("easychat-navbar").clientHeight - 40).toString() + "px ";

            } else {
                document.getElementById('easychat-chat-container').style.height = (document.documentElement.clientHeight - document.getElementById("easychat-navbar").clientHeight - 40).toString() + "px ";
            }
            document.getElementById('easychat-chat-container').style.height = (document.getElementById('easychat-chat-container').clientHeight - (sticky_intent_height - document.getElementById("easychat-footer").clientHeight)).toString() + "px ";

            if ((sticky_intent_height - document.getElementById("easychat-footer").clientHeight) == 0) {
                document.getElementById('easychat-chat-container').style.height = (document.getElementById('easychat-chat-container').clientHeight - document.getElementById("easychat-footer").clientHeight).toString() + "px ";

            }

            if (navigator.userAgent.indexOf("Firefox") != -1) {

                if (window.innerHeight > 610) {
                    document.getElementById('easychat-chat-container').style.height = (document.getElementById('easychat-chat-container').clientHeight - 10).toString() + "px ";
                }
            }
        }

        if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {

            // nav bar has fixed hieght of 64 (container height = total - (nav bar + footer))
            document.getElementById('easychat-chat-container').style.height = (document.getElementById('top-container').clientHeight - (document.getElementById('easychat-navbar').clientHeight + document.getElementById("easychat-footer").clientHeight)).toString() + "px ";

        }

        if (EASYCHAT_BOT_THEME == "") {

            if (navigator.userAgent.indexOf("Firefox") != -1 && navigator.userAgent.toLowerCase().indexOf("android") && window.outerWidth < 450) {
                if (document.getElementById("easychat-sticky") != null) {
                    document.getElementById('easychat-chat-container').style.height = parseInt(document.getElementById('easychat-chat-container').style.height.slice(0, -2)) - 17 + "px";
                }

            }
        }

        document.getElementById('easychat-chat-container').style.height = (document.getElementById('easychat-chat-container').clientHeight - voice_call_div_height).toString() + "px ";
    }
    exports.resize_chabot_window = resize_chabot_window;

    function encrypt_variable(data) {

        utf_data = EasyChatCryptoJS.enc.Utf8.parse(data);
        encoded_data = utf_data;
        random_key = generate_random_string(16);
        encrypted_data = custom_encrypt(encoded_data, random_key);

        return encrypted_data;
    }
    exports.encrypt_variable = encrypt_variable;

    function custom_decrypt(msg_string) {

        var payload = msg_string.split(".");
        var key = payload[0];
        var decrypted_data = payload[1];
        var decrypted = EasyChatCryptoJS.AES.decrypt(decrypted_data, EasyChatCryptoJS.enc.Utf8.parse(key), { iv: EasyChatCryptoJS.enc.Base64.parse(payload[2]) });
        return decrypted.toString(EasyChatCryptoJS.enc.Utf8);
    }
    exports.custom_decrypt = custom_decrypt;

    function changeMiddleContainer() {
        var sticky_intent_height = 0;
        try {
            sticky_intent_height = document.getElementById("easychat-sticky").offsetHeight;
        } catch (err) {
            sticky_intent_height = 0;
        }

        if (sticky_intent_height == null || sticky_intent_height == undefined) {
            sticky_intent_height = 0;
        }

        document.getElementById("easychat-chat-container").style.height = String(window.innerHeight - (document.getElementById("easychat-navbar").offsetHeight + document.getElementById("easychat-footer").offsetHeight + sticky_intent_height)) + "px";

    }
    exports.changeMiddleContainer = changeMiddleContainer;

    function handle_navbar_for_theme_three(is_welcome_response) {

        if ((EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") && (!is_welcome_response)) {
            try {
                remove_banner_and_fix_navbar();
            } catch (err) { }
            $('#botloader').hide();
        }
    }

    function append_bot_text_response(text_response, default_time, is_welcome_response, other_info) {

        if (typeof default_time === 'undefined') {
            default_time = return_time()
        }
        if (typeof is_welcome_response === "undefined") {
            is_welcome_response = false
        }
        is_livechat = is_livechat_enabled()
        if(is_livechat){
            text_response = text_response.replace("<p>", "");
            text_response = text_response.replace("</p>", "");
            text_response = text_response.replace("<strong>", "<b>");
            text_response = text_response.replace("</strong>", "</b>");
            text_response = text_response.replace("<em>", "<i>");
            text_response = text_response.replace("</em>", "</i>");
            text_response = text_response.replace( /(<([^>]+)>)/ig, '');
            text_response = sanitizeHTML(text_response);
        }
        text_response = easychat_linkify(text_response);
        text_response = text_response.replace(new RegExp('\r?\n', 'g'), '<br>');
        text_response = text_response.replace(new RegExp('\r?<table', 'g'), '<table class="easychat-bot-table" style="width:100%"');
        

        try {
            if (text_response.trim().length == 0) {
                return;
            }
        } catch (err) { }

        window.clearTimeout(bot_inactivity_timer);

        handle_navbar_for_theme_three(is_welcome_response);

        is_bot_inactivity_msg_present = false
        is_bot_response_message_showed = true
        var time = default_time;
        hide_bot_typing_loader();

        if (EASYCHAT_BOT_THEME == "theme_1") {

            var html = add_theme_one_bot_response(text_response, time, other_info);
        } else if (EASYCHAT_BOT_THEME == "theme_2") {

            var html = add_theme_two_bot_response(text_response, time, other_info);
        } else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
            var html = add_theme_three_and_four_bot_response(text_response, time, other_info);
        }
        else {

            if (text_response.match("http://") != null || text_response.match("https://") != null) {
                var html = '<div class="easychat-bot-message-div" ><div id="easychat-bot-message-' + bot_message_index + '" class="easychat-bot-message easychat-bot-message-line" style="color:' + BOT_MESSAGE_COLOR + '; word-break: break-word;" ><div class="easychat-show-less-text">' + text_response + '</div>'
            } else {
                var html = '<div class="easychat-bot-message-div" ><div id="easychat-bot-message-' + bot_message_index + '" class="easychat-bot-message easychat-bot-message-line" style="color:' + BOT_MESSAGE_COLOR + '; word-break: break-word;" ><div class="easychat-show-less-text">' + text_response + '</div>'
            }
            html += '<div class="view_more_wrapper" style="margin-right:5px;display:none "><div style="float:right;cursor: pointer;" onclick="viewMore(this)">' + VIEW_MORE + '<i class="fa fa-chevron-down" style="color:' + BOT_THEME_COLOR + ';margin-left:5px"></i></div></div>';

            if (is_livechat) {
                html += '</div><span class="message-time-bot" style="display:inline-block !important;">' + time + '</span></div>'
            } else {
                html += '<span class="message-time-bot">' + time + '</span></div></div>'
            }

            bot_message_index += 1;
        }


        // document.getElementById("easychat-chat-container").innerHTML += html;

        $("#easychat-chat-container").append(html)

        var latest_message_index = bot_message_index - 1;
        // $('#easychat-bot-message-' + latest_message_index + ' .easychat-show-less-text').addClass(class_rtl);
        // if (class_rtl != "") {
        //     text_direction = 'rtl'
        // } else {
        //     text_direction = 'ltr'
        // }
        $("#user_input").css('direction', pointer_direction)

        if (EASYCHAT_BOT_THEME == "theme_3") {
            $("#user_input_div #user_input_placeholder_text").css('direction', pointer_direction)
            if (pointer_direction == "rtl") {
                $("#user_input_div #user_input_placeholder_text").css('right', '0%')
            } else {
                $("#user_input_div #user_input_placeholder_text").css('right', 'revert')
            }
        }

        if (is_livechat) {

            const elem = document.getElementById('easychat-bot-message-' + (bot_message_index - 1));
            //message_time_position(elem)

        }
        // checks the total height of every bot response
        // adds it
        // then checks whether it's greater than container height
        // then scrolls to bottom

        element_response = document.querySelectorAll(".easychat-bot-message-div")
        element_response_previous_height += element_response[element_response.length - 1].clientHeight

        resize_chabot_window();

        setTimeout(function (e) { reset_size_of_text_field(1); }, 100);
        if (bot_inactivity_detection_enabled && bot_inactivity_detection_required) {
            reset_bot_inactivity_timer()
        }
        if (bot_response_delay_allowed && is_livechat_msg == false) {
            reset_bot_response_delay_timer();
        }
        set_target_blank();
        is_voice_based_form_assist_enabled = false;
    }
    exports.append_bot_text_response = append_bot_text_response;

    function text_to_speech(message_to_be_spoken, last_spoken_language) {
  
        if (is_mute()) return;
        if (cancel_text_to_speech_response) {
            cancel_text_to_speech();
        }
        else {
            cancel_text_to_speech_response = true
        }
        
        message_to_be_spoken = message_to_be_spoken.replace(/<[^>]*>?/gm, ' ');
        message_to_be_spoken = message_to_be_spoken.replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g, '');
        message_to_be_spoken = message_to_be_spoken.split("$$$").join(" ");
        message_to_be_spoken = message_to_be_spoken.split("@@@").join(" ");

        var channel_name = url_parameters["channel"]
        if (channel_name == undefined || channel_name == null)
            channel_name = "Web"
        if (check_and_lower_string(channel_name) != "android" && check_and_lower_string(channel_name) != "ios") {
            speech_synthesis_utterance_instance = new SpeechSynthesisUtterance(message_to_be_spoken);
            if (last_spoken_language != undefined) {
                speech_synthesis_utterance_instance.lang = last_spoken_language;
            }
            else {
                speech_synthesis_utterance_instance.lang = selected_language;
            }
            speech_synthesis_utterance_instance.rate = 0.95;
            speech_synthesis_utterance_instance.pitch = 1;
            speech_synthesis_utterance_instance.volume = 1;
            speech_synthesis_utterance_instance.onend = function (event) {
                try {
                    clearInterval(speech_pause_resume_interval);
                } catch (err) { }
            }
            voices = speech_synthesis_instance.getVoices();
            speech_synthesis_instance.speak(speech_synthesis_utterance_instance);
            speech_pause_resume_interval = setInterval(function () {
                speech_synthesis_instance.pause();
                speech_synthesis_instance.resume();
            }, 10000);
        } else {
            try {
                if (check_and_lower_string(channel_name) == "android") {

                    android.textToSpeech(message_to_be_spoken, selected_language)
                } else if (check_and_lower_string(channel_name) == "ios") {
                    webkit.messageHandlers.textToVoice.postMessage({"message_to_be_spoken": message_to_be_spoken, "selected_language": selected_language})
                }
            } catch(err) {}

        }

    }
    exports.text_to_speech = text_to_speech;

    function hide_bot_typing_loader() {

        var element = document.getElementById("div-bottyping-loader")
        if (element != null || element != undefined) {
            document.getElementById("div-bottyping-loader").remove();
        }
    }
    exports.hide_bot_typing_loader = hide_bot_typing_loader;

    function maximize_chatbot(count) {
        if (!count) {
            count = count_of_unread_message;
        }

        if (is_bot_minimized == true) {

            if (is_audio_notification_enabled) {
                play_notification_sound(STATIC_MP3_PATH + '/swiftly.mp3');
            }

            parent.postMessage({
                event_id: 'agent_unread_message',
                data: {
                    'message_count': count,
                }
            }, "*");
        } else {
            count_of_unread_message = 0;
        }

        setTimeout(function () {
            scroll_to_bottom();
        }, 500)
    }
    exports.maximize_chatbot = maximize_chatbot;

    function validate_phone_number(phone) {

        phone = phone.trim();
        var is_number = /^\d+$/.test(phone);
        var regex = /[6-9][0-9]{9}/;
        if (phone != "" && regex.test(phone) && phone.length == 10 && is_number) {
            return true;
        }

        return false;
    }

    function validate_name(name) {
        var regex = /^[a-zA-Z ]{2,30}$/;
        var name_list = name.trim().split(" ");
        for (var i = 0; i < name_list.length; i++) {
            if (name_list[i] == "" || !regex.test(name_list[i])) return false;
        }

        return true;
    }

    exports.validate_phone_number = validate_phone_number;

    function validate_email(email) {
        var email = email.trim();
        var regex = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
        if (email != "" && regex.test(email)) {
            return true;
        }

        return false;
    }
    exports.validate_email = validate_email;

    function clear_dealy_message_time_out() {
        window.clearTimeout(bot_message_delay_timer);
    }
    exports.clear_dealy_message_time_out = clear_dealy_message_time_out;

    function generate_random_string(length) {
        var result = '';
        var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        var charactersLength = characters.length;
        for (var i = 0; i < length; i++) {
            result += characters.charAt(Math.floor(Math.random() * charactersLength));
        }
        return result;
    }
    exports.generate_random_string = generate_random_string;

    function is_docs(attached_file_src) {
        var file_ext = attached_file_src.split(".");
        file_ext = attached_file_src.split(".")[file_ext.length - 1];
        file_ext = file_ext.toUpperCase();
    
        if (["DOCS", "DOCX", "DOC"].indexOf(file_ext) != -1) {
            return true;
        }
    
        return false;
    }
    exports.is_docs = is_docs;
    
    function is_pdf(attached_file_src) {
        var file_ext = attached_file_src.split(".");
        file_ext = attached_file_src.split(".")[file_ext.length - 1];
        file_ext = file_ext.toUpperCase();
    
        if (["PDF"].indexOf(file_ext) != -1) {
            return true;
        }
    
        return false;
    }
    exports.is_pdf = is_pdf;

    function is_text(attached_file_src) {
        var file_ext = attached_file_src.split(".");
        file_ext = attached_file_src.split(".")[file_ext.length - 1];
        file_ext = file_ext.toUpperCase();

        if (["TXT"].indexOf(file_ext) != -1) {
            return true;
        }

        return false;
    }
    exports.is_text = is_text;

    function send_to_livechat() {
        return send_initial_message_list_to_livechat;
    }
    exports.send_to_livechat = send_to_livechat;

})(window)

if (typeof String.prototype.trim !== 'function') {
    String.prototype.trim = function () {
        return this.replace(/^\s+|\s+$/g, '');
    }
}

// Create Element.remove() function if not exist
if (!('remove' in Element.prototype)) {
    Element.prototype.remove = function () {
        if (this.parentNode) {
            this.parentNode.removeChild(this);
        }
    };
}

/////////////////////////////// Encryption And Decription //////////////////////////

function custom_encrypt(msgString, key) {
    // msgString is expected to be Utf8 encoded
    var iv = EasyChatCryptoJS.lib.WordArray.random(16);
    var encrypted = EasyChatCryptoJS.AES.encrypt(msgString, EasyChatCryptoJS.enc.Utf8.parse(key), {
        iv: iv
    });
    var return_value = key;
    return_value += "." + encrypted.toString();
    return_value += "." + EasyChatCryptoJS.enc.Base64.stringify(iv);

    return return_value;
}

////////////////////////////////////////////////////////////////////////////////////

function un_entity(str) {
    return $("<textarea></textarea>").html(str).text();
}

function clear_modal_fields() {
    try {
        document.getElementById("new-issue-name").value = "";
        document.getElementById("new-issue-phone").value = "";
        document.getElementById("new-issue-issue").value = "";
        document.getElementById("create-issue-error-message").innerHTML = "";

        document.getElementById("new-meeting-name").value = "";
        document.getElementById("new-meeting-phone").value = "";
        document.getElementById("new-meeting-date").value = "";
        document.getElementById("new-meeting-time").value = "";
        document.getElementById("new-meeting-pincode").value = "";
        document.getElementById("new-meeting-issue").value = "";
        document.getElementById("schedule-error-message").innerHTML = "";

        document.getElementById("check-ticket-id").value = "";
        document.getElementById("ticket-status-error-message").innerHTML = "";

        document.getElementById("check-meeting-id").value = "";
        document.getElementById("meeting-status-error-message").innerHTML = "";
    } catch (err) { }
    enable_user_input();
}


function show_scroll_image() {
    var scrollHeight = document.getElementById("easychat-chat-container").scrollHeight;
    var scrollTop = document.getElementById("easychat-chat-container").scrollTop;
    var clientHeight = document.getElementById("easychat-chat-container").clientHeight;

    if (scrollHeight - (scrollTop + clientHeight) > 100) {
        document.getElementById("img-scroll-to-bottom").style.display = "block";
    } else {
        document.getElementById("img-scroll-to-bottom").style.display = "none";
    }
}

function get_url_vars() {
    var vars = {};
    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
        vars[key] = value;
    });
    return vars;
}

function delete_cookie(cookiename, path) {

    if (!path) {
        path = "/"
    }

    document.cookie = cookiename + '=;path=' + path + ';expires=Thu, 01 Jan 1970 00:00:01 GMT;';

}

function set_cookie(cookiename, cookievalue) {
    document.cookie = cookiename + "=" + cookievalue + ';SameSite=None; Secure';
}

function get_cookie(cookiename) {
    var cookie_name = cookiename + "=";
    var decodedCookie = decodeURIComponent(document.cookie);
    var cookie_array = decodedCookie.split(';');
    for (var i = 0; i < cookie_array.length; i++) {
        var c = cookie_array[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(cookie_name) == 0) {
            return c.substring(cookie_name.length, c.length);
        }
    }
    return "";
}

// send_form_assist_recommendation() if "do not distrub" is true
function send_form_assist_recommendation(bot_id, bot_name, form_assist_id) {
    append_bot_text_response("It looks like you are stuck here. Do you need any assistance");
    recommendations_list = ["Need Form Assistance", "Chat with the Bot"]
    // append_bot_recommendation(recommendations_list)
    append_bot_recommendations_based_on_theme(recommendations);
}

//show_form_assist_result()
function show_form_assist_result() {
    url_parameters = get_url_vars();
    bot_id = url_parameters["id"];
    bot_name = 'uat';
    form_assist_id = url_parameters["form_assist_id"];
    // session_id = get_cookie("easychat_session_id");
    //set_cookie("isFeedbackDone", "0");

    parent.postMessage({ event_id: 'isFeedBackDone', data: "0" }, "*")
    window_location = decodeURIComponent(url_parameters["easychat_window_location"])
    if (window_location == undefined) {
        window_location = 'localhost'
    }

    setTimeout(function (e) {
        if (form_assist_id != null && form_assist_id != undefined && form_assist_id != "") {
            form_assist_enabled = true;
            form_assist_id = decodeURI(form_assist_id);
            is_manually_typed_query = false;
            var server_text = send_message_to_server(form_assist_id, user_id, bot_id, bot_name, "None");
            scroll_to_bottom();
        } else {
            append_welcome_message(bot_id, bot_name);
            get_suggestion_list(bot_id, bot_name);
        }
    }, 1000);
}


function handle_chatbot_opened_event() {

    try {
        document.getElementById('tooltiptext-minimize').style.display = "block";
    } catch (err) { }

    show_bot_language_animation(1000)
    count_of_unread_message = 0;
    is_bot_minimized = false

}

window.onmessage = function (e) {
    try {
        
        var data = JSON.parse(e.data)
        if ('scope' in data) {
            return;
        }
    } catch (err) { }

    if (e.data.event_id == "isFeedBackDone") {
        isFeedBackDone = e.data.data
        if (!page_embed_in_iframe()) {
            set_cookie("isFeedBackDone", isFeedBackDone);
        }
    }
    if (e.data.event_id == "chatbot_minimized_state") {
        is_bot_minimized = e.data.data
        if (is_bot_minimized) {
            cancel_text_to_speech()
        }

    }
    if (e.data.event_id == "is_chatbot_opened") {
        handle_chatbot_opened_event()
    }
    if (e.data.event_id == "livechat_cookie_session_user_id") {
        if (page_embed_in_iframe()) {
            livechat_session_id = e.data.livechat_cookie_session_id;
            
        }
    }
    
    try {
        var url_parameters = get_url_vars();
        let channel_name = url_parameters["channel"];
        if (check_and_lower_string(channel_name) == "android" || check_and_lower_string(channel_name) == "ios") {
            if (url_parameters["livechat_session_id"]) {

                livechat_session_id = url_parameters["livechat_session_id"];
            }
        }
    } catch (err) {
        console.log(err);
    }

    if (e.data.event_id == "chatbot_opened") {

        handle_chatbot_opened_event()
    }
    // here post msg
    if (e.data.event_id == "close-chatbot") {
        is_nps_required = "False"
        if (e.data.data) {
            is_nps_required = "True"
        }
        close_chatbot(is_nps_required);
    }

    if (e.data.event_id == "collect_from_local_storage") {
        get_messages_from_local()
        word_mapper_list = JSON.parse(window.localStorage['word_mapper_list'])
        autocorrect_bot_replace = JSON.parse(window.localStorage['autocorrect_bot_replace'])
    }

    if (e.data.event_id == "trigger-external-intent") {
        trigger_external_intent(e.data.data);
    }

    if (e.data.event_id == "cobrowse-session-id") {
        cobrowse_session_id = e.data.data;

        var sentence = JSON.stringify({
            message: JSON.stringify({
                text_message: "",
                type: "text",
                channel: "Web",
                path: "",
                event_type: 'COBROWSE_SESSION_ID',
                session_id: e.data.data,
            }),
            sender: "System",
        });

        send_message_over_socket(sentence, 'COBROWSE_SESSION_ID');
    }

    if(e.data.event_id == "livechat_unload_event_flag") {
        livechat_unload_event_flag = e.data.data;
    }

    resize_chabot_window();
};

function setting_up_livechat() {

    try{
        let url_parameters = get_url_vars();
        let channel_name = url_parameters["channel"];
        if (check_and_lower_string(channel_name) == "android" || check_and_lower_string(channel_name) == "ios") {

            livechat_unload_event_flag = new Date().getTime();
        }
    } catch(err) {
        console.log(err);
    }

    setTimeout(function () {
        if (livechat_session_id != "" && livechat_unload_event_flag != "") {
            try {
                // var time_when_last_refresh_or_closing_of_tab_was_called = Number(window.localStorage['myUnloadEventFlag']);
                var time_when_last_refresh_or_closing_of_tab_was_called = livechat_unload_event_flag;
                if (isNaN(time_when_last_refresh_or_closing_of_tab_was_called)) {
                    time_when_last_refresh_or_closing_of_tab_was_called = 0
                };
                var current_time = new Date().getTime();
                var duration = current_time - time_when_last_refresh_or_closing_of_tab_was_called;
                // less than 5 minutes since the previous Unload event

                if (duration < 5 * 60 * 1000) {
                    refresh_was_called = true;
                } else {
                    refresh_was_called = false
                }
            } catch (err) {
                console.log(err)
            }
            
            if (refresh_was_called == true) {

                handle_refresh_of_chatbot_during_livechat();

            } else {

                unset_livechat_cookies();
            }
        }
    }, 1100);
}

function hide_mute_unmute_div() {

    var mute_unmute_div = document.getElementById('easychat-mute-unmute-div');

    if (mute_unmute_div) {
        mute_unmute_div.style.display = 'none';

        // if (speech_synthesis_instance) speech_synthesis_instance.cancel();
        cancel_text_to_speech()
    }

}

function handle_refresh_of_chatbot_during_livechat() {
    handle_refresh_of_chatbot_based_on_theme();
    hide_mute_unmute_div();
    livechat_previous_message_history(livechat_session_id);
    show_end_chat_button();
    resize_chabot_window();
    append_attachment_icon();
    disable_language_change_options(); 
}

function handle_refresh_of_chatbot_based_on_theme() {
    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        is_livechat = true;
        remove_banner_and_fix_navbar();
    }
}

function update_chatbot_minimize_maximize_text() {

    if (EASYCHAT_BOT_THEME != "theme_3") {
        return
    }
    parent.postMessage({
        event_id: 'update-minimize-maximize-text',
        data: {
            minimize_text: BOT_MINIMIZE_TEXT,
            maximize_text: BOT_MAXIMIZE_TEXT,
        }
    }, '*');
}

function update_chatbot_form_assist_text(bot_id, selected_language) {

    parent.postMessage({
        event_id: 'update-form-assist-language-objects',
        data: {
            bot_id: bot_id,
            selected_language: selected_language,
        }
    }, '*');
}


function handle_mute_unmute_for_internet_explorer_for_theme_three() {
    if (is_internet_explorer && EASYCHAT_BOT_THEME == "theme_3") {
        try {
            document.getElementById("easychat-mute-unmute-div").style.display = "none";
            document.getElementById("easychat-bot-mute-unmute-div-welcome-screen").style.display = "none";
        } catch (err) {
        }
    }
}

function trigger_welcome_banner_query_question() {
    var query_question_id = welcome_banner_query_question.replace(/_/g, " ");
    var query_question_name = "";

    for (var i = 0; i < welcome_banner_list.length; i++) {
        if (welcome_banner_list[i]["intent_pk"] == query_question_id) {
            query_question_name = welcome_banner_list[i]["intent_name"].replace(/_/g, " ");
            break;
        }
    }

    if (query_question_name != "") {
        entered_suggestion = true;
        is_manually_typed_query = false;
        send_user_input(query_question_name, query_question_id);
    }
}

function get_intent_details(bot_id, intent_pk) {
    var json_string = JSON.stringify({
        intent_pk: intent_pk,
        bot_id: bot_id,
    });

    json_string = encrypt_variable(json_string);
    json_string = encodeURIComponent(json_string);
    var params = 'json_string=' + json_string;
    var xhttp = new XMLHttpRequest();
    xhttp.open("POST", "/chat/get-intent-information/", true);
    xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            response = JSON.parse(this.responseText);
            response = custom_decrypt(response);
            response = JSON.parse(response);
            if (response["status"] == 200) {
                entered_suggestion = true;
                is_manually_typed_query = false;
                send_user_input(response["intent_name"], response["intent_pk"]);
            }
        }
    }
    xhttp.send(params);
}

function trigger_external_intent(intent_info) {
    var intent_id = custom_decrypt(intent_info);
    get_intent_details(bot_id, intent_id);
}


function get_easychat_prev_session_id_from_cookies() {
    let url_parameters = get_url_vars();
    let channel_name = url_parameters["channel"];
    if (check_and_lower_string(channel_name) == "android" || check_and_lower_string(channel_name) == "ios") {
        if (url_parameters["mobile_session_id"]) {

            return url_parameters["mobile_session_id"];
        }
    }
    return get_cookie("easychat_prev_session_id")
}

function get_easychat_user_id() {
    let url_parameters = get_url_vars();
    let channel_name = url_parameters["channel"];
    if (check_and_lower_string(channel_name) == "android" || check_and_lower_string(channel_name) == "ios") {

        if (url_parameters["mobile_session_id"]) {
            return url_parameters["mobile_session_id"];
        }
    }
    return get_cookie("easychat_user_id");
}

window.onload = function (e) {
    let url_parameters = get_url_vars();
    let is_geolocation_enabled = url_parameters["is_geolocation_enabled"];

    if (is_geolocation_enabled == "true" && client_location_city == null) {

        initialize_client_location();
    }
    if (!IS_TEXTFIELD_INPUT_ENABLED) {
        hide_input_field_footer() 

    } else {
        remove_button_only_class()
    }
    query_token_id = $('input[name="csrfquerytoken"]').val();
    changeMiddleContainer();
    url_parameters = get_url_vars();
    // to differentiate between refresh
    // and tab close
    if ("is_first_time_amp_user" in url_parameters && url_parameters["is_first_time_amp_user"] == "true"){
        set_cookie("amp_page_history_number", "1");
    }
    var refresh_was_called = false;

    parent.postMessage({
        event_id: 'send_livechat_session_id',
    }, "*")

    parent.postMessage({
        event_id: 'send_livechat_unload_event_flag',
    }, "*")

    // selected_language = window.localStorage['selected_language']
    get_language_templates_from_server(selected_language, url_parameters["id"], true);

    if (is_internet_explorer && document.getElementById("easychat-mute-unmute-div")) {
        if (EASYCHAT_BOT_THEME != "theme_3") {
            document.getElementById("easychat-mute-unmute-div").remove();
        }
    }
    handle_mute_unmute_for_internet_explorer_for_theme_three();
    
    setting_up_livechat()
    bot_id = url_parameters["id"];

    if (url_parameters["channel"] != null) {
        window.channel_name_iframe = url_parameters["channel"]
    } else {
        window.channel_name_iframe = "Web"
    }

    bot_name = 'uat';
    form_assist_id = url_parameters["form_assist_id"];
    do_not_disturb = url_parameters["do_not_disturb"];
    is_lead_generation = url_parameters["is_lead_generation"];
    lead_generation_intent_id = url_parameters["lead_generation_intent_id"];
    is_voice_based_form_assist_enabled = url_parameters["is_voice_based_form_assist_enabled"];
    enable_response_form_assist = url_parameters["enable_response_form_assist"]
    embed_cookies = ""
    embed_meta_data = url_parameters["meta_data"]
    // window_location = window.top.location.href;
    window_location = decodeURIComponent(url_parameters["easychat_window_location"])

    is_web_landing_allowed = url_parameters["is_web_landing_allowed"]
    if (is_web_landing_allowed == null || is_web_landing_allowed == undefined) {
        is_web_landing_allowed = "false";
    }

    trigger_intent_pk_from_url = decodeURIComponent(url_parameters["trigger_intent_pk"]);
    easychat_intent_name = decodeURIComponent(url_parameters["easychat_intent_name"]);

    if (trigger_intent_pk_from_url !== ""){
        trigger_intent_pk = parseInt(trigger_intent_pk_from_url);
    }
 
    campaign_link_query_id = url_parameters["campaign_link_query_id"]

    is_initial_trigger_intent = url_parameters["is_initial_trigger_intent"]

    external_trigger_intent_info = url_parameters["external_trigger_info"];

    if (is_initial_trigger_intent == null || is_initial_trigger_intent == undefined) {
        is_initial_trigger_intent = false;
    }

    if (campaign_link_query_id != 'INTENT_ID' && campaign_link_query_id != undefined && campaign_link_query_id != null && campaign_link_query_id != "") {

        is_campaign_link = true;
        is_manually_typed_query = false;
        setTimeout(function () {
            send_message_to_server(campaign_link_query_id, user_id, bot_id, bot_name, "None");
        }, 2000)

    } else {
        is_campaign_link = false
    }

    if (window_location == undefined) {
        window_location = 'localhost'
    }
    if (embed_cookies != "" && embed_cookies != null && embed_cookies != undefined) {
        embed_cookies_decrypted = custom_decrypt(embed_cookies)
        embed_cookies_decrypted = JSON.parse(embed_cookies_decrypted)
        if ("easychat_user_id" in embed_cookies_decrypted) {
            if (embed_cookies_decrypted["easychat_user_id"] != "") {
                user_id = embed_cookies_decrypted["easychat_user_id"]
            }
        }
        if ("easychat_prev_session_id" in embed_cookies_decrypted) {

            easychat_prev_session_id = embed_cookies_decrypted["easychat_prev_session_id"]
        }
    }

    if (EASYCHAT_BOT_THEME != "theme_3" && EASYCHAT_BOT_THEME != "theme_4") {
        
        if (check_element_exists("easychat-query-submit-div")) {
            document.getElementById("easychat-query-submit-div").addEventListener('touchend', function (event) {
                event.preventDefault()
                if (document.getElementById("easychat-query-submit-div").style.pointerEvents == "auto") {
                    send_message()
                }

            }, false);
        }

    } else {
        if (check_element_exists("easychat-query-send-icon")) {
            document.getElementById("easychat-query-send-icon").addEventListener('touchend', function (event) {
                event.preventDefault()
                if (document.getElementById("easychat-query-mic-send-icon-wrapper").style.pointerEvents == "auto") {
                    send_message()
                }
            }, false);
        }   

    }

    if (is_web_landing_allowed == 'true') {
        handle_web_landing_intent_or_form_assist_for_theme_three();
        web_landing_intent = true
        is_manually_typed_query = false
        setTimeout(function () {
            entered_suggestion = true;
            send_message_to_server(trigger_intent_pk, user_id, bot_id, bot_name, "None");
        }, 200);

    }

    if (is_lead_generation == "true") {
        // modal_lead_generation.style.display="block";
        append_welcome_message(bot_id, bot_name);
        setTimeout(function () {
            entered_suggestion = true;
            var server_text = send_message_to_server(lead_generation_intent_id, user_id, bot_id, bot_name, "None");
        }, 2000);
    } else if (is_lead_generation != 'true') {
        if (form_assist_id != null && form_assist_id != undefined && form_assist_id != "" && do_not_disturb != "true") {
            form_assist_enabled = true;
            is_initial_form_assist_auto_popup = true;
            form_assist_id = decodeURI(form_assist_id);
            handle_web_landing_intent_or_form_assist_for_theme_three();
            is_manually_typed_query = false;
            var server_text = send_message_to_server(form_assist_id, user_id, bot_id, bot_name, "None");
            scroll_to_bottom();
        } else {
            append_welcome_message(bot_id, bot_name);
        }

        load_feedback_images();
       
        setTimeout(function(){
            // loading suggestions after a bit delay such that index db is loaded properly in our bot
            get_suggestion_list(bot_id, bot_name);
        }, 1000);
        



    }

    scroll_to_bottom()

    function load_feedback_images() {
        document.getElementById('angry-emoji-div').src = EASYCHAT_IMG_PATH + 'angry-emoji.svg';
        document.getElementById('sad-emoji-div').src = EASYCHAT_IMG_PATH + 'sad-emoji.svg';
        if (document.getElementById('unhappy-emoji-div')) {
            document.getElementById('unhappy-emoji-div').src = EASYCHAT_IMG_PATH + 'unhappy-emoji.svg';
        }
        document.getElementById('happy-emoji-div').src = EASYCHAT_IMG_PATH + 'happy-emoji.svg';
        document.getElementById('inlove-emoji-div').src = EASYCHAT_IMG_PATH + 'in-love-emoji.svg';
    }

    if (get_url_vars()["easychat_window_location"] == undefined) {
        // $("#easychat-navbar-wrapper").find("i").css("visibility", "hidden");
        $("#easychat-navbar-wrapper").find("i:eq(0)").css("visibility", "hidden");
        $("#user_input").parent().css("width", "90%");
    }
    detectmob();
    resize_chabot_window();

    if (EASYCHAT_BOT_THEME != "theme_3" && EASYCHAT_BOT_THEME != "theme_4") {
        $('#botloader').hide();
    }

    show_bot_language_animation(500);
    handle_enable_response_form_assist();

}

function close_feedback_modal() {
    document.getElementById("feedback_modal").style.display = "none";
    document.getElementById("feedback_form_demoter").style.display = "none";
}
function restart_chatbot(el) {
    if(livechat_queue_timer){
        clearInterval(livechat_queue_timer);
    }
    remove_queue_timer();
    is_bot_started = false
    if(EASYCHAT_BOT_THEME == 'theme_4') {
        if(is_text_to_speech_required) cancel_text_to_speech()
        $('#botloader').show()
    }
    list_banner_img_clicked = []
    try {
        if (is_livechat == true && livechat_session_id != "") {
            is_abruptly_closed = true;
            unset_livechat_cookies();
            enable_user_input();
        }
    } catch (err) { }

    try {
        enable_user_input();
        is_livechat = false;
        enable_language_change_options();
        document.getElementById("easychat-mic-div").style.pointerEvents = "all";
        document.getElementById("easychat-mic-div").style.paddingRight = "10px";
        document.getElementById("easychat-img-div").style.display = "none";
    } catch (err) { }

    enable_sticky_div();
    display_sticky_div();
    enable_sticky_intents();
    deactivate_mic();
    document.getElementById("easychat-chat-container").style.overflow = "auto";
    el.style.pointerEvents = 'none';
    el.style.color = BOT_THEME_COLOR;
    clear_userData();
    save_time_spent();
    bot_restarted = true
    welcome_message_appended = false
    is_first_query = true
    if(EASYCHAT_BOT_THEME == 'theme_3' || EASYCHAT_BOT_THEME == 'theme_4') {
        mute_unmute_speech_for_welcome_screen(true)
        is_first_query = false
    }
    var myNode = document.querySelectorAll("#easychat-chat-container div");
    for (i = 0; i < myNode.length; i++) {
        if (EASYCHAT_BOT_THEME == "theme_4" && (myNode[i].id == "easychat-bot-welcome-banner-parent")){
            continue;
        }
        myNode[i].remove();
    }
    url_parameters = get_url_vars();
    bot_id = url_parameters["id"];
    bot_name = 'uat';

    set_easychat_prev_session_id_cookie("")

    easychat_session_id = ""
    easychat_prev_session_id = ""

    window_location = url_parameters["easychat_window_location"]

    if (window_location == undefined) {
        window_location = 'localhost'
    }

    change_is_flow_ended_variable = true

    cancel_text_to_speech_response = true

    empty_user_input_based_on_theme()
    document.getElementById("easychat-footer").style.pointerEvents = "auto";

    var container_html = '<div id="sound"></div>';

    if (EASYCHAT_BOT_THEME == 'theme_1' || EASYCHAT_BOT_THEME == "theme_2") {
        container_html += '<div class="easychat-bot-welcome-banner-parent" id="easychat-bot-welcome-banner-parent" style="display: none;"></div>';
    }

    $("#easychat-chat-container").append(container_html);

    show_scroll_image();
    check_and_add_welcome_screen();

    append_welcome_message(bot_id, bot_name);

    get_suggestion_list(bot_id, bot_name);

    setTimeout(function () {
        el.style.pointerEvents = 'auto';
        el.style.color = "#808080";
    }, 1000);

    is_flow_ended = true
    handle_mute_unmute_for_welcome_screen_theme_three();
    deactivate_mic();
    deactivate_query_submit_button();

    let channel_name = url_parameters["channel"]
    try {
        if (check_and_lower_string(channel_name) == "android") {

            android.reload_chatbot();
        }
        if (check_and_lower_string(channel_name) == "ios") {

            webkit.messageHandlers.reloadChatbot.postMessage('reload_chatbot');
        }
    } catch(err) {}
}

function handle_mute_unmute_for_welcome_screen_theme_three() {

    if (EASYCHAT_BOT_THEME != "theme_3") {
        return
    }

    if (document.getElementById("easychat-mute-unmute-div")) {
        var unmute_icon = document.getElementById('easychat-unmute-icon');
        var mute_icon = document.getElementById('easychat-mute-icon');
        mute_icon.style.display = "none";
        unmute_icon.style.display = "block";
    }

}
function handle_web_landing_intent_or_form_assist_for_theme_three() {
    if (EASYCHAT_BOT_THEME != "theme_3" && EASYCHAT_BOT_THEME != "theme_4") {
        return;
    }
    remove_banner_and_fix_navbar();
    $('#botloader').hide();
}

function open_chat_termination_modal() {
    var channel_name = url_parameters["channel"]

    if (check_and_lower_string(channel_name) == "android" || check_and_lower_string(channel_name) == "ios") {
        if (check_if_display_none("feedback_modal") && check_if_display_none("feedback_form_promoter") && check_if_display_none("feedback_form_demoter")) {
            $('.termination-confirmation-modal').show();
            $('#easychat-chat-container').addClass('backdrop');
        }    
    }
}

function close_termination_modal(is_minimize=false) {

    var channel_name = url_parameters["channel"]
    if (check_and_lower_string(channel_name) == "android" || check_and_lower_string(channel_name) == "ios") {

        if(assigned_agent_username == "" && is_minimize && is_livechat) {

            $("#termination-confirmation-modal-end-chat").html("Please wait while we assign an agent or click on end chat to exit.")
            return;
        }
        $("#termination-confirmation-modal-end-chat").html(END_CHAT_ANDROID)
        if(is_minimize) {
            try {
                if(check_and_lower_string(channel_name) == "android") {

                    android.minimize()
                } else if(check_and_lower_string(channel_name) == "ios") {

                    webkit.messageHandlers.close.postMessage('close');
                }
            } catch(err) {}
        }
        $('.termination-confirmation-modal').hide();
        $('#easychat-chat-container').removeClass('backdrop');
    }
}


function check_if_display_none(id) {
    if (check_element_exists(id)) {
        return $("#"+id).css('display') == "none" ? true: false
    }
    else {
        return true
    }
}

function check_and_add_welcome_screen() {
    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        // $(".easychat-bot-welcome-banner-wrapper").css("display", "");
        // this will be handled in append welcome response
        document.getElementById("easychat-bot-welcome-banner-parent").innerHTML = ""
        $(".easychat-bot-message-section-area-div").css("padding", "24px");
        $(".easychat-bot-message-div").css("display", "none")
        $(".easychat-bot-navbar").addClass("easychat-welcome-home-navbar-div");
        $(".easychat-bot-sticky-intent-wrapper").css("display", "none")
        $(".easychat-bot-sticky-menu-wrapper").css("display", "none")
        $("#img-scroll-to-bottom").css("bottom", "3.7em");
        if (BOT_THEME_COLOR.toLowerCase() == "#ffffff") {
            $(".easychat-bot-restart-div svg").css("fill", WHITE_THEME_COLOR);
        } else {
            $(".easychat-bot-restart-div svg").css("fill", BOT_THEME_COLOR);
        }
        $(".easychat-slider-wrapper").css("display", "none")
        $("#top-container").css("background-color", "#ffffff")
        $(".easychat-bot-welcome-banner-parent").css("display", "flex")

        if (is_text_to_speech_required) {
            if (document.getElementById("easychat-bot-mute-unmute-div-welcome-screen")) {
                document.getElementById("easychat-bot-mute-unmute-div-welcome-screen").style.display = "flex"
            }
        }

        if (!is_sticky_menu_closed()) {
            close_sticky_menu();
        }

        setTimeout(function () {
            $(".easychat-bot-sticky-intent-wrapper").css("display", "none")
            $(".easychat-bot-sticky-menu-wrapper").css("display", "none")
            $("#img-scroll-to-bottom").css("bottom", "3.7em");
            resize_chabot_window();
        }, 300)

        remove_scroll_bar_in_welcome_screen();
        if (EASYCHAT_BOT_THEME == "theme_4") {
            $('.easychat-bot-ask-query-btn-wrapper').show()
            $('.easychat-bot-footer-input-wrapper').hide()
            $('#easychat-bot-welcome-banner-parent').css('display', 'flex')
            $('#easychat-chat-container').css('overflow', '')
            $('#easychat-chat-container').addClass('hide-container-elements')
            $(".easychat-bot-restart-div svg").css("fill", "#fff");
            $("#bot_menu_option_items_wrapper").removeClass("easychat-sticky-menu-option-show")
            $("#bot_menu_option_opner_div").removeClass("bot-menu-opner-active");
            $(".easychat-bot-restart-div svg").css("fill", "transparent");
        }
    }
}


function minimize_chatbot() {

    var is_amp_page_request = url_parameters["is_amp_page_request"]
    if (is_amp_page_request == "true") {
        let amp_page_history_number = parseInt(get_cookie("amp_page_history_number"))
        history.go((0 - amp_page_history_number));
        return;
    }

    try {
        document.getElementById('tooltiptext-minimize').style.display = 'none';
    } catch (err) { }
    cancel_text_to_speech();
    parent.postMessage({
        event_id: 'minimize-chatbot',
        data: {
            minimize_text: BOT_MINIMIZE_TEXT,
            maximize_text: BOT_MAXIMIZE_TEXT,
        }
    }, '*');

    if (parent.document.getElementById('allincall-minimize-popup-tooltip'))
        parent.document.getElementById('allincall-minimize-popup-tooltip').innerHTML = BOT_MINIMIZE_TEXT;
    if (parent.document.getElementById('allincall-maximize-popup-tooltip'))
        parent.document.getElementById('allincall-maximize-popup-tooltip').innerHTML = BOT_MAXIMIZE_TEXT;

}


function enable_bot_footer() {
    document.getElementById("easychat-footer").style.pointerEvents = "auto";
}

function disable_bot_footer() {
    document.getElementById("easychat-footer").style.pointerEvents = "none";
    document.getElementById("easychat-restart-div").style.pointerEvents = "none";
}

function load_initial_feedback_settings() {
    if(document.getElementById("feedback_form_promoter").style.display == "block" || document.getElementById("feedback_modal").style.display == "block" || document.getElementById("feedback_form_demoter").style.display == "block") {
        return;
    }
    if (document.getElementById("feedback_modal").style.display = "none") {
        document.getElementById("feedback_modal").style.display = "block"
    }
    else {
        document.getElementById("feedback_modal").style.display = "none";
    }

    // document.getElementById("feedback_form_demoter").style.display = "block";
    if (EASYCHAT_BOT_THEME != "theme_3" && EASYCHAT_BOT_THEME != "theme_4" && EASYCHAT_BOT_THEME != "theme_1") {
        document.getElementById("easychat-chat-container").style.backgroundColor = 'rgba(0, 0, 0, 0.4)';
    }
    document.getElementById("easychat-chat-container").style.opacity = "0.5";
    document.getElementById("easychat-chat-container").style.pointerEvents = "none";
    document.getElementsByClassName('bot-language-icon')[0].style.pointerEvents = "none";
    document.getElementById("easychat-footer").style.opacity = "0.5";
    document.getElementById('angry-emoji-div').src = EASYCHAT_IMG_PATH + 'angry-emoji.svg';
    document.getElementById('sad-emoji-div').src = EASYCHAT_IMG_PATH + 'sad-emoji.svg';
    document.getElementById('happy-emoji-div').src = EASYCHAT_IMG_PATH + 'happy-emoji.svg';
    if (document.getElementById('unhappy-emoji-div')) {
        document.getElementById('unhappy-emoji-div').src = EASYCHAT_IMG_PATH + 'unhappy-emoji.svg';
    }
    document.getElementById('inlove-emoji-div').src = EASYCHAT_IMG_PATH + 'in-love-emoji.svg';
    document.getElementById('angry-emoji-div').style.width = '45px';
    document.getElementById('angry-emoji-div').style.height = '45px';
    disable_sticky_div();
    disable_bot_footer();
}

function close_chatbot(is_nps_required) {
    if(document.getElementById('language_dropdown_content')){
        document.getElementById('language_dropdown_content').classList.remove('is-active')
    }

    var channel_name = url_parameters["channel"]
    if (channel_name == undefined || channel_name == null)
        channel_name = "Web"
    if (check_and_lower_string(channel_name) == "android" || check_and_lower_string(channel_name) == "ios")
        isFeedBackDone = "0"

    try {
        document.getElementById('tooltiptext-close').style.display = "none";
        modal_create_issue.style.display = "none";
        modal_check_ticket_status.style.display = "none";
        modal_check_meeting_status.style.display = "none";
        modal_schedule_meeting.style.display = "none";
    } catch (err) {
        console.log(err)
    }
    cancel_text_to_speech();

    if (is_nps_required == "True" && user_id != "" && isFeedBackDone == "0" && is_conversaion_started && window.is_csat_form_required_for_channel == "True") {
        load_initial_feedback_settings()
    } else {

        if (is_livechat) {
            try {
                if (!something_assigned_livechat) {
                    is_abruptly_closed = true
                }
                close_livechat();
            } catch (err) {
                console.log(err)
            }

        } else {
            clear_userData();
            save_time_spent();

            set_easychat_prev_session_id_cookie("")
            set_easychat_user_id_cookie("")
        }


        set_easychat_prev_session_id_cookie("")
        if (EASYCHAT_BOT_THEME != "theme_1") {
            parent.postMessage({
                event_id: 'auto_pop_up_denied',
                data: {
                    cookie_value: "true",
                    cookie_name: "auto_pop_up_denied",
                    expiration: "",
                    path: "/",
                }
            }, "*")
        }

        parent.postMessage('close-bot', '*');
        try {
            if (check_and_lower_string(channel_name) == "android") {

                android.close()
            }
            else if (check_and_lower_string(channel_name) == "ios") {

                webkit.messageHandlers.close.postMessage('close')
            }
        } catch(err) {}
        
        var is_amp_page_request = url_parameters["is_amp_page_request"]
        if (is_amp_page_request == "true") {
            let amp_page_history_number = parseInt(get_cookie("amp_page_history_number"))
            history.go((0 - amp_page_history_number));
            return;
        }
    }
    
    if(is_transcript_sent == true)
    {
        document.getElementById("transcript-checkbox-hide").style.display = "none";
    }
}

function save_time_spent() {
    var json_string = JSON.stringify({
        session_id: session_id,
        user_id: user_id,
    });

    json_string = encrypt_variable(json_string);
    json_string = encodeURIComponent(json_string);
    var params = 'json_string=' + json_string;
    var xhttp = new XMLHttpRequest();
    xhttp.open("POST", "/chat/save-time-spent/", true);
    xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            console.log("Session Time saved!!!");
            let channel_name = url_parameters["channel"]
            if (channel_name == undefined || channel_name == null)
                channel_name = "Web"

            //     if (!page_embed_in_iframe() && channel_name == "Web") {
            //     window.close();
            // }
        }
    }
    xhttp.send(params);
}

// ##############   FeedBack #######################


function no_feedback_given(e) {
    document.getElementById("feedback_modal").style.display = "none";
    if (something_assigned_livechat == false) {
        is_abruptly_closed = true
    }
    clear_userData();

    set_easychat_prev_session_id_cookie("")
    set_easychat_user_id_cookie("")
    parent.postMessage('close-bot', '*');
    document.getElementById("feedback_modal").style.display = "none";
    document.getElementById("feedback_form_demoter").style.display = "none";
    document.getElementById("feedback_form_promoter").style.display = "none";
    document.getElementById("easychat-chat-container").style.backgroundColor = "unset";
    document.getElementById("easychat-chat-container").style.opacity = "1";
    document.getElementById("easychat-chat-container").style.pointerEvents = "auto";
    document.getElementsByClassName('bot-language-icon')[0].style.pointerEvents = "auto";
    document.getElementById("easychat-footer").style.opacity = "1";
    enable_sticky_div();
    save_time_spent();
    var is_amp_page_request = url_parameters["is_amp_page_request"]
    if (is_amp_page_request == "true") {
        let amp_page_history_number = parseInt(get_cookie("amp_page_history_number"))
        history.go((0 - amp_page_history_number));
        history.back();
        return;
    }

}

function submit_feedback() {
    document.getElementById("feedback_modal").style.display = "none";
    
    if (contentvalue <= 2 && csat_feedback_form_enabled == true && window.is_csat_form_required_for_channel == "True") {
        document.getElementById("feedback_form_demoter").style.display = "block";
        initialize_phone_number_selector_csat('easychat-customer-phone-csat-form','in', 'easychat-customer-phone-csat-form-phone-error-div');
    }
    else {
        document.getElementById("feedback_form_promoter").style.display = "block";
    }
}

function handle_csat_choices() {
    let other_checked = document.getElementById("other-choice-opt").checked
    let btnSubmit = document.getElementById("save-demoter-form-submit-button");
    let checkbox_csat_clicked = document.querySelectorAll('.filled-in');
    btnSubmit.disabled = true;
    btnSubmit.style.opacity = 0.6;
    btnSubmit.style.cursor = "not-allowed";
    for (var i = 0; i < checkbox_csat_clicked.length; i++) {
        if (checkbox_csat_clicked[i].checked) {
            btnSubmit.disabled = false;
            btnSubmit.style.opacity = 1;
            btnSubmit.style.cursor = "pointer";
            break;
        }
    }
    if (other_checked == true) {
        document.getElementById("other-text-area").style.display = "block";
    } else {
        document.getElementById("other-text-area").style.display = "none";
    }

}

function save_demoter_form() {

    if (something_assigned_livechat == false) {
        is_abruptly_closed = true
    }
    save_feedback(contentvalue, "")
}

function save_promoter_form() {
    if (something_assigned_livechat == false) {
        is_abruptly_closed = true
    }
    var text_value = document.getElementById("promoter_feedback_text_area").value;
    text_value = stripHTML(text_value);
    text_value = strip_unwanted_characters(text_value);
    save_feedback(contentvalue, text_value)
}

function save_feedback(contentvalue, text_value) {
    var checkbox_csat_clicked_list = []
    var feedback_country_code = ""
    var feedback_phone_number = ""
    var feedback_email_id = ""
    var call_save_feedback_api = true
    
    if (csat_feedback_form_enabled == true && window.is_csat_form_required_for_channel == "True") {
        var checkbox_csat_clicked = document.querySelectorAll('.filled-in');
        var checkbox_csat_clicked_list = ""
        let checkbox_length = checkbox_csat_clicked.length
        for (var i = 0; i < checkbox_length - 1; i++) {
            if (checkbox_csat_clicked[i].checked) {
                checkbox_csat_clicked_list += strip_unwanted_characters(document.getElementsByClassName('feedback_demoter_checkbox_value')[i].innerHTML) + ","
            }
        }
        // For Other value
        if (checkbox_csat_clicked[checkbox_length - 1].checked && text_value == "") {
            checkbox_csat_clicked_list += strip_unwanted_characters(document.getElementsByClassName('feedback_demoter_checkbox_value')[i].innerHTML) + ": "
            let text_value_demoter = document.getElementById("demoter_feedback_text_area").value
            text_value_demoter = stripHTML(text_value_demoter);
            text_value_demoter = strip_unwanted_characters(text_value_demoter);
            checkbox_csat_clicked_list += text_value_demoter
        }

        if (mark_all_fields_csat_compulsory == true && contentvalue <= 2) {
            if (checkbox_csat_clicked_list.length == 0) {
                document.getElementById('complete_form_text').innerHTML = CSAT_ALL_FIELD_ERROR
                document.getElementById('complete_form_text').style.display = 'block';
                document.getElementById('complete_form_text').style.color = "red";
                call_save_feedback_api = false;
            } else {
                document.getElementById('complete_form_text').style.display = 'none';
            }

            if (collect_phone_number) {
                var phone_no = document.getElementById('easychat-customer-phone-csat-form').value;
                if (validate_phone_number(phone_no) == false) {
                    call_save_feedback_api = false;
                    if (document.getElementById('incorrect_phone_number_nps') == null) {
                        document.getElementsByClassName('contact-details-text')[0].innerHTML += "<p id='incorrect_phone_number_nps' style='color:red'>" + INVALID_MOBILE_NUMBER + "</p>"
                    }
                    else {
                        document.getElementById('incorrect_phone_number_nps').style.display = "";
                    }
                } else {
                    if (document.getElementById('incorrect_phone_number_nps') != null) {
                        document.getElementById('incorrect_phone_number_nps').style.display = "none";
                    }
                }
            }

            if (collect_email_id) {
                var email_id = document.getElementById('feedback_email_id').value;
                if (validate_email(email_id) == false) {
                    call_save_feedback_api = false;
                    if (document.getElementById('incorrect_email_id_nps') == null) {
                        document.getElementsByClassName('contact-details-text')[0].innerHTML += "<p id='incorrect_email_id_nps' style='color:red'>" + INVALID_EMAIL_ID + "</p>"
                    } else {
                        document.getElementById('incorrect_email_id_nps').style.display = "";
                    }
                } else {
                    if (document.getElementById('incorrect_email_id_nps') != null) {
                        document.getElementById('incorrect_email_id_nps').style.display = "none";
                    }
                }
            }

            if (text_value == true) {
                document.getElementById('complete_form_text').innerHTML = CSAT_ALL_FIELD_ERROR
                document.getElementById('complete_form_text').style.color = "red";
                call_save_feedback_api = false;
            }

        }
        if (collect_phone_number == true && call_save_feedback_api == true && contentvalue <= 2) {
            feedback_phone_number = document.getElementById('easychat-customer-phone-csat-form').value
        }
        if (collect_email_id == true && call_save_feedback_api == true && contentvalue <= 2) {
            feedback_email_id = document.getElementById('feedback_email_id').value
        }
        checkbox_csat_clicked_list = checkbox_csat_clicked_list

    }
    feedback_country_code = "+" + $("#easychat-customer-phone-csat-form").intlTelInput("getSelectedCountryData").dialCode
    var channel_name = url_parameters["channel"]
    if (channel_name == undefined || channel_name == null)
        channel_name = "Web"

    if (call_save_feedback_api == true) {
        var json_string = JSON.stringify({
            session_id: session_id,
            user_id: user_id,
            bot_id: bot_id,
            rating: contentvalue,
            comments: text_value,
            feedback_country_code: feedback_country_code,
            feedback_phone_number: feedback_phone_number,
            feedback_email_id: feedback_email_id,
            checkbox_csat_clicked_list: checkbox_csat_clicked_list,
            channel_name: channel_name
        });
        // set_cookie("isFeedbackDone", "1")
        json_string = encrypt_variable(json_string);
        json_string = encodeURIComponent(json_string);

        var xhttp = new XMLHttpRequest();
        var params = 'json_string=' + json_string
        xhttp.open("POST", "/chat/save-feedback/", true);
        xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                console.log("Feedback saved!!!");
                parent.postMessage({
                    event_id: 'isFeedBackDone',
                    data: "1"
                }, "*")

                setTimeout(function () {
                    close_chatbot('False');
                }, 1000);
                document.getElementById("feedback_modal").style.display = "none";
                document.getElementById("feedback_form_demoter").style.display = "none";
                document.getElementById("feedback_form_promoter").style.display = "none";
                document.getElementById("easychat-chat-container").style.backgroundColor = "unset";
                document.getElementById("easychat-chat-container").style.opacity = "1";
                document.getElementById("easychat-chat-container").style.pointerEvents = "auto";
                document.getElementById("easychat-footer").style.opacity = "1";
                enable_sticky_div();
                try {
                    if (check_and_lower_string(channel_name) == "android") {

                        android.close()
                    } else if (check_and_lower_string(channel_name) == "ios") {

                        webkit.messageHandlers.close.postMessage('close')
                    }
                } catch(err) {}
            }
        }
        xhttp.onerror = function () {
            close_chatbot('False');
        }
        xhttp.send(params);
    }
}

// ######################################################

function focus_user_input() {
    var field = document.getElementById("user_input");
    field.focus();

}

function hide_mic_icon() {
    if (EASYCHAT_BOT_THEME != 'theme_1' || !mic_access) {
        try {
            check_and_disable_mic_state_for_theme_three();
            if (EASYCHAT_BOT_THEME == "theme_4") {
                $("#easychat-mic-icon, #tooltip-mic-send-text").hide()
            }
            $("#easychat-mic-div").hide();
            // document.getElementById("easychat-mic-div").style.display = "none";
        } catch (err) {
            console.log(err);
        }

        try {
            document.getElementById("easychat-mic-div-not-allowed").style.display = "flex";
        } catch (err) {
            console.log(err);
        }
    }
}

function enable_mic_state_for_theme_three() {
    if (EASYCHAT_BOT_THEME == "theme_3") {
        $("#easychat-query-mic-send-icon-wrapper").css("opacity", "1");
        document.getElementById("easychat-query-mic-send-icon-wrapper").classList.remove("red_dnd_cursor");
        document.getElementById("tooltip-mic-send-text").style.display = "block";
        $("#easychat-mic-icon").css("pointer-events", "auto")
    }
}

function check_and_disable_mic_state_for_theme_three() {
    if (EASYCHAT_BOT_THEME == "theme_3" && !mic_access) {
        let mic_element = document.getElementById("easychat-mic-icon")
        if (mic_element.style.display == "flex" || mic_element.style.display == "block" ) {
            $("#easychat-query-mic-send-icon-wrapper").css("opacity", ".5");
            document.getElementById("easychat-query-mic-send-icon-wrapper").classList.add("red_dnd_cursor");
            document.getElementById("tooltip-mic-send-text").style.display = "none";
            $("#easychat-mic-icon").css("pointer-events", "none")
        }
    }
}

function show_mic() {
    try {
        if (EASYCHAT_BOT_THEME != 'theme_1' || mic_access) {
            document.getElementById("easychat-mic-div").style.display = "flex";

            try {
                document.getElementById("easychat-mic-div-not-allowed").style.display = "none";
            } catch (err) {
                console.log(err);
            }
        }
    } catch (err) { }

}

function activate_mic_for_theme_three_and_four() {

    // $('#easychat-mic-icon-active').css("display", "flex")
    $('#easychat-mic-icon').hide()
    $('#mic-speak-animation-div').css("display", "inline-flex")

    document.getElementById('user_input_placeholder_text').innerText = SPEAK_NOW

    handle_mic_recognition_for_activate_mic()

}

function deactivate_mic_for_theme_three_and_four() {
    // $('#easychat-mic-icon-active').hide()
    $('#mic-speak-animation-div').css("display", "none")
    $('#easychat-mic-icon').css("display", "flex")

    document.getElementById('user_input_placeholder_text').innerText = EASYCHAT_INPUT_QUERY_THEME_3_PLACEHOLDER

    handle_mic_recognition_for_deactivate_mic()
}

function handle_mic_recognition_for_activate_mic() {

    disable_user_input();
    if (recognition != null) {
        recognition.start();
    } else {
        mic_access = false;
        hide_mic_icon();
    }
}

function handle_mic_recognition_for_deactivate_mic() {

    enable_user_input();

    if (recognition != null) {
        recognition.abort();
        empty_user_input_based_on_theme();

    } else {
        mic_access = false;
        hide_mic_icon();
    }
}

function activate_mic_android() {

    if (EASYCHAT_BOT_THEME == "theme_1") {

        document.getElementById('easychat-mic-div').style.display = 'flex';
        document.getElementById('easychat-mic-div-not-allowed').style.display = 'none';
        document.getElementById("img-mic-up").style.fill = BOT_THEME_COLOR;
        document.getElementById("img-mic-down").style.fill = BOT_THEME_COLOR;
        document.getElementById("easychat-mic-div").style.pointerEvents = "none"
        document.getElementById('user_input').placeholder = SPEAK_NOW


    } else if (EASYCHAT_BOT_THEME == "theme_2") {
        document.getElementById("easychat-mic-div").style.color = BOT_THEME_COLOR;
        document.getElementById("easychat-mic-div").style.opacity = "0.5";
        document.getElementById("easychat-mic-div").style.pointerEvents = "none"
        document.getElementById('user_input').placeholder = SPEAK_NOW

    } else {
        document.getElementById('user_input_placeholder_text').innerText = SPEAK_NOW  
    }

}

function deactivate_mic_android() {

    if (EASYCHAT_BOT_THEME == "theme_1") {
        try {
            document.getElementById("img-mic-up").style.fill = DEFAULT_ICON_COLOR;
            document.getElementById("img-mic-down").style.fill = DEFAULT_ICON_COLOR;
            document.getElementById("easychat-mic-div").style.pointerEvents = "auto"
        } catch (err) {
            console.log(err);
        }
        document.getElementById("user_input").placeholder = EASYCHAT_INPUT_QUERY_THEME_1_PLACEHOLDER;
    } else if (EASYCHAT_BOT_THEME == "theme_2") {
        try {
            document.getElementById("easychat-mic-div").style.opacity = "1";
            document.getElementById("easychat-mic-div").style.pointerEvents = "auto"
        } catch (err) {
            console.log(err)
        }
        document.getElementById("user_input").placeholder = EASYCHAT_INPUT_QUERY_THEME_2_PLACEHOLDER;
    } else {
        document.getElementById('user_input_placeholder_text').innerText = EASYCHAT_INPUT_QUERY_THEME_3_PLACEHOLDER
    }
}

function activate_mic() {

    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        // handling activate mice for theme 3 & 4 in a seprate function
        activate_mic_for_theme_three_and_four()
        return;
    }

    if (EASYCHAT_BOT_THEME == "theme_1") {

        document.getElementById('easychat-mic-div').style.display = 'none';
        document.getElementById('easychat-mic-div-not-allowed').style.display = 'none';
        // document.getElementById("img-mic-up").style.fill = BOT_THEME_COLOR;
        // document.getElementById("img-mic-down").style.fill = BOT_THEME_COLOR;
        document.getElementById("mic-speak-animation-div").style.display = "inline-flex";

    } else if (EASYCHAT_BOT_THEME == "theme_2") {
        // document.getElementById("easychat-mic-div").style.color = BOT_THEME_COLOR;
        // document.getElementById("easychat-mic-div").style.opacity = "0.5";
        document.getElementById("easychat-mic-div").style.display = "none";
        document.getElementById("mic-speak-animation-div").style.display = "inline-flex";
    }
    else {
        document.getElementById("img-mic").style.color = BOT_THEME_COLOR;
    }
    document.getElementById("user_input").placeholder = SPEAK_NOW;
    document.getElementById("easychat-query-submit-div").style.display = "none";
    document.getElementById("easychat-mic-disable").style.display = "inline-block";
    document.getElementById("easychat-mic-disable").style.marginLeft = "14px";

    handle_mic_recognition_for_activate_mic();

}

function deactivate_mic() {

    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        deactivate_mic_for_theme_three_and_four();
        return;
    }
    if (EASYCHAT_BOT_THEME == "theme_1") {
        try {
            document.getElementById("mic-speak-animation-div").style.display = "none";
            document.getElementById("mic-speak-animation-div").classList.remove("animate-span");
            // document.getElementById("img-mic-up").style.fill = DEFAULT_ICON_COLOR;
            // document.getElementById("img-mic-down").style.fill = DEFAULT_ICON_COLOR;
        } catch (err) {
            console.log(err);
        }
        document.getElementById("user_input").placeholder = EASYCHAT_INPUT_QUERY_THEME_1_PLACEHOLDER;
    } else if (EASYCHAT_BOT_THEME == "theme_2") {
        try {
            document.getElementById("mic-speak-animation-div").style.display = "none";
            document.getElementById("mic-speak-animation-div").classList.remove("animate-span");
            document.getElementById("easychat-mic-div").style.opacity = "1";
            document.getElementById("user_input").placeholder = EASYCHAT_INPUT_QUERY_THEME_2_PLACEHOLDER;
        } catch (err) {
            console.log(err)
        }
    } else {
        try {
            document.getElementById("img-mic").style.color = DEFAULT_ICON_COLOR;
            document.getElementById("user_input").placeholder = EASYCHAT_INPUT_QUERY_DEFAULT_PLACEHOLDER;
        } catch (err) {
            console.log(err);
        }
    }

    try {
        show_mic();
        document.getElementById("easychat-query-submit-div").style.display = "flex";
        document.getElementById("easychat-mic-disable").style.display = "none";
    } catch (err) { }

    handle_mic_recognition_for_deactivate_mic();

}
function is_user_input_disabled() {
    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        // return document.getElementById('user_input').style.pointerEvents == "none";
        if (window.outerWidth < mobile_width) {
            return !user_input_editable
        } else {
            return document.getElementById("user_input").getAttribute("contenteditable") == "false"
        }
    } else {

        if (window.outerWidth < mobile_width) {
            user_input_disabled = document.getElementById('user_input').readOnly
        } else {
            user_input_disabled = document.getElementById('user_input').disabled
        }
        return user_input_disabled
    }
}

function speech_intent_for_android(user_input) {
    // document.getElementById('user_input').value = event.results[0][0].transcript;
    if (user_input != null && user_input != undefined && user_input.trim() != "") {

        edit_user_input_based_on_theme_android(user_input)

        send_typing_message_to_agent();
    }
}

function speech_intent_for_ios(user_input) {
    // document.getElementById('user_input').value = event.results[0][0].transcript;
    if (user_input != null && user_input != undefined && user_input.trim() != "") {

        edit_user_input_based_on_theme_android(user_input)

        send_typing_message_to_agent();
    }
}

function remove_speak_mic_animation() {
    document.getElementById("mic-speak-animation-div").classList.remove("animate-span");
}

function check_mic_access() {

    var url_parameters = get_url_vars();
    var channel_name = url_parameters["channel"]

    if (channel_name == undefined || channel_name == null) {
        channel_name = "Web"
    }
    if (check_and_lower_string(channel_name) == "android" || check_and_lower_string(channel_name) == "ios") {

        var user_input_disabled = false
        if (window.outerWidth < mobile_width) {
            user_input_disabled = document.getElementById('user_input').readOnly
        } else {
            user_input_disabled = document.getElementById('user_input').disabled
        }
        if (!user_input_disabled) {
            activate_mic_android()
            try {
                if (check_and_lower_string(channel_name) == "android") {
                    
                    android.start_recording();
                } else {

                    webkit.messageHandlers.speechToText.postMessage("speechToText")
                }
            } catch(err) {}
        }
    } else {

        if (!is_mute()) {
            cancel_text_to_speech();
        }

        try {
            var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = true;
            var user_input_disabled = false
    
            user_input_disabled = is_user_input_disabled();
            if (!user_input_disabled) {
                recognition.onstart = function () {
                    recognizing = true;
                };
    
                recognition.onerror = function (event) {
                    document.getElementById("mic-speak-animation-div").style.display = "none";
                    document.getElementById("mic-speak-animation-div").classList.remove("animate-span");
                    if (event.error == 'no-speech') {
                        ignore_onend = true;
                        console.log('mic error: no speech');
                    }
                    if (event.error == 'audio-capture') {
                        ignore_onend = true;
                        console.log('mic error: audio capture');
                    }
                    if (event.error == 'not-allowed') {
                        ignore_onend = true;
                        recognition = null;
                        deactivate_mic();
                        alert("Please allow microphone access for this webpage to use voicebot feature");
                    }
                    deactivate_mic();
                };
    
                recognition.onend = function () {
                    document.getElementById("mic-speak-animation-div").style.display = "none"
                    document.getElementById("mic-speak-animation-div").classList.remove("animate-span");
                    deactivate_mic();
                    recognizing = false;
                    if (ignore_onend) {
                        return;
                    }
                    if (!final_transcript) {
                        return;
                    }
                };
    
                recognition.onresult = function (event) {
                    // document.getElementById('user_input').value = event.results[0][0].transcript;
                    document.getElementById("mic-speak-animation-div").style.display = "inline-flex";
                    document.getElementById("mic-speak-animation-div").classList.add("animate-span");
    
                    try {
                        clearTimeout(speak_mic_animation_timeout);
                        speak_mic_animation_timeout = setTimeout(remove_speak_mic_animation, 200);
                    } catch {
                        speak_mic_animation_timeout = setTimeout(remove_speak_mic_animation, 200);
                    }
    
                    edit_user_input_based_on_theme(event.results[0][0].transcript)
    
                    send_typing_message_to_agent();
                    if (event.results[0].isFinal) {
                        document.getElementById("mic-speak-animation-div").classList.remove("animate-span");
                        document.getElementById("mic-speak-animation-div").style.display = "none";
                        user_input = get_user_input_based_on_theme()
                        if (user_input.trim() != '' && user_input.length < 300) {
                            send_user_input(user_input);
                        }
                        recognition.stop();
                        empty_user_input_based_on_theme()
                    }
                };
    
                if (get_browser_name() == "safari") {
                    recognition = null;
                }
    
                if (recognition != null) {
                    activate_mic();
                } else {
                    mic_access = false;
                    hide_mic_icon();
                }
            }
        } catch (err) {
            console.log(err)
            recognition = null;
            mic_access = false;
            hide_mic_icon();
        }

    }
}

function display_query_send_button_for_theme_three() {
    var url_parameters = get_url_vars();
    var channel_name = url_parameters["channel"]

    if (channel_name == undefined || channel_name == null) {
        channel_name = "Web"
    }

    if (check_and_lower_string(channel_name) != "android" && check_and_lower_string(channel_name) != "ios") {

        if (document.getElementById("easychat-mic-icon-active").style.display == "block" || document.getElementById("easychat-mic-icon-active").style.display == "flex") {
            return;
            // this means mic is activated so no need to show send icon for theme 3
        }

    }
    if (document.getElementById("mic-speak-animation-div").style.display == "none") {
        document.getElementById("easychat-query-send-icon").style.display = "flex"
    }
    document.getElementById("easychat-mic-icon").style.display = "none"
    if (is_widgets) {
        document.getElementById("tooltip-mic-send-text").style.display = "flex";
        document.getElementById("easychat-query-mic-send-icon-wrapper").classList.remove("red_dnd_cursor");
    }
    document.getElementById("tooltip-mic-send-text").classList.add("tooltip-send-only-text");
    document.getElementById("tooltip-mic-send-text").innerHTML = SEND_TEXT
    document.getElementById("user_input_placeholder_text").style.visibility = "hidden";
}

function show_query_send_button() {
    if (!user_input_editable) {
        return;
    }
    display_query_send_button_for_theme_three();
}

function hide_query_send_button() {

    document.getElementById("easychat-query-send-icon").style.display = "none"
    document.getElementById("easychat-mic-icon").style.display = "flex"
    document.getElementById("tooltip-mic-send-text").classList.remove("tooltip-send-only-text");
    document.getElementById("tooltip-mic-send-text").innerText = MIC_BUTTON_TOOLTIP
    if (EASYCHAT_BOT_THEME == "theme_4" && !mic_access) {
        $("#easychat-mic-icon, #tooltip-mic-send-text").hide()
    }

}

function activate_query_submit_button_theme_three_and_four() {
    show_query_send_button();
    document.getElementById("easychat-query-mic-send-icon-wrapper").style.pointerEvents = "auto"
    if (EASYCHAT_BOT_THEME == "theme_3" && is_widgets) {
        $("#easychat-query-mic-send-icon-wrapper").css("opacity", "1");
    }
}

function deactivate_query_submit_button_theme_three_and_four() {
    hide_query_send_button();
    if (!((EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") && is_widgets)) {
        document.getElementById("easychat-query-mic-send-icon-wrapper").style.pointerEvents = "none"
    }
}

function activate_query_submit_button() {

    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {

        activate_query_submit_button_theme_three_and_four();
        return;
    }

    var elem = document.getElementById("img-submit-query");
    elem.style.setProperty('cursor', 'pointer', 'important');
    document.getElementById("easychat-query-submit-div").style.pointerEvents = "auto";
    $("#tooltiptext-send").css('display', 'flex');

    if (EASYCHAT_BOT_THEME == "theme_1" || EASYCHAT_BOT_THEME == "theme_2") {

        elem.style.opacity = '1';
    } else {
        elem.style.color = BOT_THEME_COLOR;
    }

}

function deactivate_query_submit_button() {
    try {

        if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
            deactivate_query_submit_button_theme_three_and_four();
            return;
        }
        var elem = document.getElementById("img-submit-query");
        document.getElementById("img-submit-query").style.cursor = "default";
        if(!is_widgets){
            document.getElementById("easychat-query-submit-div").style.pointerEvents = "none";
        }

        if (EASYCHAT_BOT_THEME == "theme_1" || EASYCHAT_BOT_THEME == "theme_2") {
            elem.style.opacity = '0.5';
            document.getElementById("tooltiptext-send").style.display = "none";
        } else {
            elem.style.color = DEFAULT_ICON_COLOR;
        }
    } catch (err) { }
}

function return_time() {
    var d = new Date();
    var hours = d.getHours().toString();
    var minutes = d.getMinutes().toString();
    var flagg = "AM";
    if (parseInt(hours) == 12) {
        hours = 12;
        flagg = "PM";
    }
    if (parseInt(hours) > 12) {
        hours = hours - 12;
        flagg = "PM";
    }
    if (hours.length == 1) {
        hours = "0" + hours;
    }
    if (minutes.length == 1) {
        minutes = "0" + minutes;
    }

    var time = hours + ":" + minutes + " " + flagg;
    return time;
}

function viewMore(element) {
    element.parentNode.previousElementSibling.classList.add("easychat-expand-text");
    element.setAttribute("onclick", "showLess(this)")

    if (EASYCHAT_BOT_THEME == "theme_1" || EASYCHAT_BOT_THEME == "theme_2" || EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        element.innerHTML = READ_LESS + '</div>'
    } else {
        element.innerHTML = SHOW_LESS + '<i class="fa fa-chevron-up" style="color:' + BOT_THEME_COLOR + ';margin-left:5px"></i></div>'
    }
}

function showLess(element) {
    element.parentNode.previousElementSibling.classList.remove("easychat-expand-text");
    element.setAttribute("onclick", "viewMore(this)")
    if (EASYCHAT_BOT_THEME == "theme_1" || EASYCHAT_BOT_THEME == "theme_2" || EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        element.innerHTML = READ_MORE + '</div>'
    } else {
        element.innerHTML = VIEW_MORE + '<i class="fa fa-chevron-down" style="color:' + BOT_THEME_COLOR + ';margin-left:5px"></i></div>'
    }
}


function scroll_to_element() {
    objDiv = document.getElementById("easychat-chat-container")
    objDiv.scrollTop = objDiv.scrollTop + 10
}

function easychat_linkify(inputText) {
    //inputText.replace(/&nbsp;/g, '');
    var replacedText, replacePattern1, replacePattern2, replacePattern3, replacePattern4;

    var anchor_tag_pattern = /<a[\s]+([^>]+)>((?:.(?!\<\/a\>))*.)<\/a>/gim;

    var is_matched = anchor_tag_pattern.test(inputText);

    replacedText = inputText;
    if (!is_matched) {
        //URLs starting with http://, https://, or ftp://
        replacePattern1 = /(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=_|!:,.;]*[-A-Z0-9+&@#\/%=_|])/gim;
        replacedText = replacedText.replace(replacePattern1, '<a href="$1" target="_blank">$1</a>');

        //URLs starting with "www." (without // before it, or it'd re-link the ones done above).
        replacePattern2 = /(^|[^\/])(www\.[\S]+(\b|$))/gim;
        replacedText = replacedText.replace(replacePattern2, '$1<a href="http://$2" target="_blank">$2</a>');
    }

    // Change email addresses to mailto:: links.
    replacePattern3 = /(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim;
    replacedText = replacedText.replace(replacePattern3, '<a href="mailto:$1">$1</a>');

    // Change mobile numbers to tel:: links.
    replacePattern4 = /(^[6-9][0-9]{9}(\s)*(?!.))/g;
    replacedText = replacedText.replace(replacePattern4, function (number) {
        return '<a href="tel:' + number + '">' + number + '</a>';
    });

    return replacedText;
}

function reset_size_of_text_field(no_of_elem) {
    var elements = document.getElementsByClassName('easychat-show-less-text');

    var len = elements.length;
    if (len > 0) {
        for (el_index = len - no_of_elem; el_index < len; ++el_index) {
            var el = elements[el_index];
            var el_style = window.getComputedStyle ? getComputedStyle(el, null) : el.currentStyle;
            var viewmore_height = parseInt(el_style.height)

            if (EASYCHAT_BOT_THEME == 'theme_1' || EASYCHAT_BOT_THEME == 'theme_2' || EASYCHAT_BOT_THEME == 'theme_3') {
                if (viewmore_height >= 290) {
                    el.nextElementSibling.style.display = 'block';
                }
            } else {
                if (viewmore_height > 295 + 20) {
                    el.style.maxHeight = '295px';
                    el.nextElementSibling.style.display = 'block';
                }
            }
        }
    }
}

function stripHTML(text) {
    return text.replace(/(<([^>]+)[><])/ig, ' ');
}

function strip_malicious_chars(text) {
    return text.replace(/[<*?>]/g, '');
}

function strip_unwanted_characters(text) {
    var characters_to_remove = autocorrect_bot_replace

    for (var i = 0; i < characters_to_remove.length; i++) {
        try {
            text = text.split(characters_to_remove[i]).join(' ');
        } catch (err) {
            text = text.split(characters_to_remove[i]).join(' ');
        }

    }
    return text
}

function sanitizeHTML(unsafe) {
    return unsafe.split('&').join('&amp;').split('<').join('&lt;').split('>').join('&gt;').split('"').join('&quot;').split("'").join('&#039;');
}

function extract_emails(text) {
    return text.match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi);
}
function extract_pan_nos(text) {
    return text.match(/([a-zA-Z]{3}[pP][a-zA-Z][1-9][0-9]{3}[a-zA-Z])/gi);
}

function extract_ddmmyyyy(text) {
    return text.match(/(\d{1,2}\/\d{1,2}\/\d{2,4})/gi);
}
function extract_date_format_ddmmyyyy_two(text) {
    return text.match(/(\d{1,2}-\d{1,2}-\d{2,4})/gi);
}
function extract_date_format_ddmonthnameyyyy(text) {
    return text.match(/([\d]{1,2} [ADFJMNOS]\w* [\d]{2,4})/gi);
}
function extract_date_format_monthnameddyyyy(text) {
    return text.match(/([ADFJMNOS]\w* [\d]{1,2} [\d]{2,4})/gi);
}
function extract_mobile_pattern(text) {
    return text.match(/(\b[0-9]{10,12}\b)/gi);
}
function extract_age_pattern(text) {
    return text.match(/(\b[0-9]{1,3}\b)/gi);
}
function extract_id_pattern(text) {
    return text.match(/(\b[A-Za-z0-9]*\d[A-Za-z0-9]*\b)/gi);
}

function mask_user_input(message) {

    final_string = message

    pan_list = extract_pan_nos(message)
    if (pan_list != null) {
        for (var i = 0; i < pan_list.length; i++) {
            pan = pan_list[i]
            message = message.replace(pan, "X".repeat(pan.length))
        }
    }

    email_list = extract_emails(message)
    if (email_list != null) {
        for (var i = 0; i < email_list.length; i++) {
            email = email_list[i]
            message = message.replace(email, "X".repeat(email.length))
        }
    }
    // Regex date format: dd/mm/yyyy
    ddmmyyyy_list = extract_ddmmyyyy(message)
    if (ddmmyyyy_list != null) {
        for (var i = 0; i < ddmmyyyy_list.length; i++) {
            date = ddmmyyyy_list[i]
            message = message.replace(date, "X".repeat(date.length))
        }
    }
    // Regex date format: dd-mm-yy
    ddmmyyyy_list_two = extract_date_format_ddmmyyyy_two(message)
    if (ddmmyyyy_list_two != null) {
        for (var i = 0; i < ddmmyyyy_list_two.length; i++) {
            date = ddmmyyyy_list_two[i]
            message = message.replace(date, "X".repeat(date.length))
        }
    }
    //  Regex date format: dd AUG YYYY
    ddmonthnameyyyy_list = extract_date_format_ddmonthnameyyyy(message)
    if (ddmonthnameyyyy_list != null) {
        for (var i = 0; i < ddmonthnameyyyy_list.length; i++) {
            date = ddmonthnameyyyy_list[i]
            message = message.replace(date, "X".repeat(date.length))
        }
    }
    // Regex date format:  AUG dd YYYY
    monthnameddyyyy_list = extract_date_format_monthnameddyyyy(message)
    if (monthnameddyyyy_list != null) {
        for (var i = 0; i < monthnameddyyyy_list.length; i++) {
            date = monthnameddyyyy_list[i]
            message = message.replace(date, "X".repeat(date.length))
        }
    }
    // mobile number, account number, aadhar number (10-12 digits number
    //      should have space before and after)
    mobile_pattern_list = extract_mobile_pattern(message)
    if (mobile_pattern_list != null) {
        for (var i = 0; i < mobile_pattern_list.length; i++) {
            item = mobile_pattern_list[i]
            message = message.replace(item, "X".repeat(item.length))
        }
    }
    //  age and address (1-3 digits number
    //  should have space before and after)
    age_list = extract_age_pattern(message)
    if (age_list != null) {
        for (var i = 0; i < age_list.length; i++) {
            age = age_list[i]
            message = message.replace(age, "X".repeat(age.length))
        }
    }
    // customer_id (any string that contains atleast 1 digit)
    id_list = extract_id_pattern(message)
    if (id_list != null) {
        for (var i = 0; i < id_list.length; i++) {
            id = id_list[i]
            message = message.replace(id, "X".repeat(id.length))
        }
    }

    final_string = message
    return final_string
}
function close_preview_image(event) {
    event.preventDefault();
    event.stopPropagation();
    if (event.target.tagName == "IMG") {
        return;
    }
    document.getElementById("preview-big-image-modal").style.display = "none";

}
function preview_big_image(elem) {
    image_src = elem.src
    document.getElementById("preview-big-image-modal").style.display = "block";
    document.getElementById("preview-big-image").src = image_src;
}
function get_image_html_based_on_file(file_name, attached_file_path) {

    var livechat_class = "";
    if (is_livechat) {
        livechat_class = " livechat-user-message-image-div";
    }
    return "<div class='easychat-user-message-image-container" + livechat_class + "'><img onclick='preview_big_image(this)' src='" + attached_file_path + "'><div class='attachment-preview-action-div-wrapper'><div style='display:flex;align-items:center; width:calc(100% - 30px);'><div class='easychat-customer-attchment-file-name-icon-div'>" + image_file_icon_html + "</div><div class='easychat-customer-attchment-file-name-div'>" + file_name + "</div></div><a href='" + attached_file_path + "' target='_blank'>" + download_button_html + "</a></div></div>"
}
function get_vedio_preview_html(file_name, attached_file_path, thumbnail_url) {
    return "<div class='easychat-user-message-video-container' ><video style='width:100%;height: 100%;' controls><source src='" + attached_file_path + "' type='video/mp4'></video><div class='attachment-preview-action-div-wrapper'><div style='display:flex;align-items:center; width:calc(100% - 30px);'><div class='easychat-customer-attchment-file-name-icon-div'>" + video_file_icon_html + "</div><div class='easychat-customer-attchment-file-name-div'>" + file_name + "</div></div><a href='" + attached_file_path + "' target='_blank'>" + download_button_html + "</a></div></div>"
}
function get_document_preview_html(file_name, attached_file_path) {

    var file_ext = file_name.split(".")[file_name.split(".").length - 1];

    var icon_html = doc_file_icon_html;
    if (file_ext.indexOf("zip") != -1 || file_ext.indexOf("rar") != -1 || file_ext.indexOf("rpm") != -1 || file_ext.indexOf("z") != -1 || file_ext.indexOf("tar.gz") != -1 || file_ext.indexOf("pkg") != -1) {
        icon_html = zip_file_icon_html;
    }

    return "<div class='easychat-user-message-doc-container'><div style='display:flex;align-items:center; width:calc(100% - 30px);'><div class='easychat-customer-attchment-file-name-icon-div'>" + icon_html + "</div><div class='easychat-customer-attchment-file-name-div'>" + file_name + "</div></div><a href='" + attached_file_path + "' target='_blank'>" + download_button_html + "</a></div>"
}

function get_document_preview_html_livechat(file_name, attached_file_path) {
    var html = '<div class="easychat-user-message-doc-container livechat-user-document-preview-div"><a href="' + attached_file_path + '" target="_blank">';
    if (is_docs(file_name)) {
        html += '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 100%;object-fit:contain;height: 100px;margin: 0 auto;">\
        <path d="M18.5 20C18.5 20.275 18.276 20.5 18 20.5H6C5.724 20.5 5.5 20.275 5.5 20V4C5.5 3.725 5.724 3.5 6 3.5H12V8C12 9.104 12.896 10 14 10H18.5V20ZM13.5 4.621L17.378 8.5H14C13.724 8.5 13.5 8.275 13.5 8V4.621ZM19.414 8.414L13.585 2.586C13.559 2.56 13.527 2.54 13.5 2.516C13.429 2.452 13.359 2.389 13.281 2.336C13.241 2.309 13.195 2.291 13.153 2.268C13.082 2.228 13.012 2.184 12.937 2.152C12.74 2.07 12.528 2.029 12.313 2.014C12.266 2.011 12.22 2 12.172 2H12.171H12H6C4.896 2 4 2.896 4 4V20C4 21.104 4.896 22 6 22H18C19.104 22 20 21.104 20 20V10V9.828C20 9.298 19.789 8.789 19.414 8.414Z" fill="#212121"/>\
        <path fill-rule="evenodd" clip-rule="evenodd" d="M10.5556 14C10.2487 14 10 14.2487 10 14.5556V18.4444C10 18.7513 10.2487 19 10.5556 19H19.4444C19.7513 19 20 18.7513 20 18.4444V14.5556C20 14.2487 19.7513 14 19.4444 14H10.5556ZM10.755 15.375V18H11.6513C11.9588 18 12.2113 17.9462 12.4088 17.8387C12.6088 17.7287 12.7563 17.5763 12.8513 17.3812C12.9488 17.1837 12.9975 16.9525 12.9975 16.6875C12.9975 16.4225 12.9488 16.1925 12.8513 15.9975C12.7563 15.8 12.6088 15.6475 12.4088 15.54C12.2113 15.43 11.9588 15.375 11.6513 15.375H10.755ZM11.6288 17.5875H11.235V15.7837H11.6288C11.8488 15.7837 12.0225 15.82 12.15 15.8925C12.2775 15.965 12.3688 16.0687 12.4237 16.2037C12.4787 16.3387 12.5063 16.5 12.5063 16.6875C12.5063 16.8775 12.4787 17.04 12.4237 17.175C12.3688 17.3075 12.2775 17.41 12.15 17.4825C12.0225 17.5525 11.8488 17.5875 11.6288 17.5875ZM13.9235 17.8725C14.121 17.9875 14.351 18.045 14.6135 18.045C14.8735 18.045 15.1023 17.9875 15.2998 17.8725C15.4973 17.7575 15.651 17.5987 15.761 17.3963C15.871 17.1912 15.926 16.955 15.926 16.6875C15.926 16.42 15.871 16.185 15.761 15.9825C15.651 15.7775 15.4973 15.6175 15.2998 15.5025C15.1023 15.3875 14.8735 15.33 14.6135 15.33C14.351 15.33 14.121 15.3875 13.9235 15.5025C13.7285 15.6175 13.5748 15.7775 13.4623 15.9825C13.3523 16.185 13.2973 16.42 13.2973 16.6875C13.2973 16.955 13.3523 17.1912 13.4623 17.3963C13.5748 17.5987 13.7285 17.7575 13.9235 17.8725ZM15.2098 17.3663C15.0623 17.5312 14.8635 17.6137 14.6135 17.6137C14.3635 17.6137 14.1635 17.5312 14.0135 17.3663C13.8635 17.2012 13.7885 16.975 13.7885 16.6875C13.7885 16.4 13.8635 16.1737 14.0135 16.0087C14.1635 15.8438 14.3635 15.7613 14.6135 15.7613C14.8635 15.7613 15.0623 15.8438 15.2098 16.0087C15.3598 16.1737 15.4348 16.4 15.4348 16.6875C15.4348 16.975 15.3598 17.2012 15.2098 17.3663ZM16.8186 17.8763C17.0086 17.9887 17.2361 18.045 17.5011 18.045C17.8161 18.045 18.0736 17.9688 18.2736 17.8163C18.4761 17.6637 18.6023 17.4525 18.6523 17.1825H18.1236C18.0911 17.3175 18.0211 17.4237 17.9136 17.5013C17.8086 17.5763 17.6686 17.6137 17.4936 17.6137C17.2511 17.6137 17.0611 17.5325 16.9236 17.37C16.7861 17.205 16.7173 16.9787 16.7173 16.6913C16.7173 16.4037 16.7861 16.1775 16.9236 16.0125C17.0611 15.8475 17.2511 15.765 17.4936 15.765C17.6686 15.765 17.8086 15.8062 17.9136 15.8887C18.0211 15.9687 18.0911 16.08 18.1236 16.2225H18.6523C18.6023 15.94 18.4761 15.7212 18.2736 15.5662C18.0736 15.4087 17.8161 15.33 17.5011 15.33C17.2361 15.33 17.0086 15.3875 16.8186 15.5025C16.6286 15.6175 16.4823 15.7775 16.3798 15.9825C16.2773 16.1875 16.2261 16.4237 16.2261 16.6913C16.2261 16.9588 16.2773 17.195 16.3798 17.4C16.4823 17.6025 16.6286 17.7613 16.8186 17.8763Z" fill="#212121"/>\
        <path d="M7 7H10" stroke="black" stroke-linecap="round"/>\
        <path d="M7 9H10" stroke="black" stroke-linecap="round"/>\
        </svg>';
    } else if (is_pdf(file_name)) {
        html += '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 100%;object-fit:contain;height: 100px;margin: 0 auto;">\
        <path d="M18.5 20C18.5 20.275 18.276 20.5 18 20.5H6C5.724 20.5 5.5 20.275 5.5 20V4C5.5 3.725 5.724 3.5 6 3.5H12V8C12 9.104 12.896 10 14 10H18.5V20ZM13.5 4.621L17.378 8.5H14C13.724 8.5 13.5 8.275 13.5 8V4.621ZM19.414 8.414L13.585 2.586C13.559 2.56 13.527 2.54 13.5 2.516C13.429 2.452 13.359 2.389 13.281 2.336C13.241 2.309 13.195 2.291 13.153 2.268C13.082 2.228 13.012 2.184 12.937 2.152C12.74 2.07 12.528 2.029 12.313 2.014C12.266 2.011 12.22 2 12.172 2H12.171H12H6C4.896 2 4 2.896 4 4V20C4 21.104 4.896 22 6 22H18C19.104 22 20 21.104 20 20V10V9.828C20 9.298 19.789 8.789 19.414 8.414Z" fill="#212121"/>\
        <path fill-rule="evenodd" clip-rule="evenodd" d="M10.5556 14C10.2487 14 10 14.2487 10 14.5556V18.4444C10 18.7513 10.2487 19 10.5556 19H19.4444C19.7513 19 20 18.7513 20 18.4444V14.5556C20 14.2487 19.7513 14 19.4444 14H10.5556ZM11.4043 14.9822V18H11.9561V16.8317H12.5208C12.768 16.8317 12.9706 16.79 13.1287 16.7067C13.2868 16.6204 13.4032 16.5084 13.4779 16.3704C13.5526 16.2296 13.59 16.0758 13.59 15.9091C13.59 15.7338 13.5512 15.5757 13.4736 15.4349C13.396 15.2941 13.2782 15.1834 13.1201 15.1029C12.962 15.0225 12.7623 14.9822 12.5208 14.9822H11.4043ZM12.4864 16.3833H11.9561V15.4306H12.4864C12.6789 15.4306 12.8169 15.4737 12.9002 15.5599C12.9864 15.6433 13.0296 15.7597 13.0296 15.9091C13.0296 16.0557 12.9864 16.1721 12.9002 16.2583C12.8169 16.3417 12.6789 16.3833 12.4864 16.3833ZM14.0229 14.9822V18H15.0533C15.4068 18 15.6971 17.9382 15.9241 17.8146C16.1541 17.6882 16.3236 17.5128 16.4328 17.2887C16.5449 17.0616 16.601 16.7958 16.601 16.4911C16.601 16.1865 16.5449 15.922 16.4328 15.6979C16.3236 15.4708 16.1541 15.2955 15.9241 15.1719C15.6971 15.0455 15.4068 14.9822 15.0533 14.9822H14.0229ZM15.0274 17.5258H14.5748V15.4521H15.0274C15.2803 15.4521 15.4801 15.4938 15.6267 15.5772C15.7732 15.6605 15.8781 15.7798 15.9414 15.935C16.0046 16.0902 16.0362 16.2756 16.0362 16.4911C16.0362 16.7095 16.0046 16.8964 15.9414 17.0516C15.8781 17.2039 15.7732 17.3217 15.6267 17.4051C15.4801 17.4855 15.2803 17.5258 15.0274 17.5258ZM19.0365 14.9822H17.0879V18H17.6397V16.7067H18.7692V16.2712H17.6397V15.4263H19.0365V14.9822Z" fill="#212121"/>\
        <path d="M7 7H10" stroke="black" stroke-linecap="round"/>\
        <path d="M7 9H10" stroke="black" stroke-linecap="round"/>\
        </svg>'; 
    } else {
        html += '<img src="/static/LiveChatApp/img/document.png" style="width:60%;margin-left:35px;object-fit:contain;"></img>'
    }
    html += '<div class="easychat-customer-attchment-file-name-div" style="color:gray;padding-left:10px;">' + file_name + '</div>' + download_button_html_livechat + '</a></div>'
    return html
}

function append_user_attachment_preview(file_name, attached_file_path, thumbnail_url, default_time) {

    if (typeof default_time === 'undefined') {
        default_time = return_time()
    }
    time = default_time

    let html = ""

    if (is_image(file_name)) {
        html = get_image_html_based_on_file(file_name, attached_file_path)
    }
    else if (is_video(file_name)) {
        html = get_vedio_preview_html(file_name, attached_file_path, thumbnail_url)
    } else {
        if (is_livechat) {
            html = get_document_preview_html_livechat(file_name, attached_file_path)
        } else {
            html = get_document_preview_html(file_name, attached_file_path)
        }
    }

    if (is_livechat) {
        html += get_livechat_time_html_based_on_theme(time)
    }

    $("#easychat-chat-container").append('<div class="easychat-user-message-div">' + html + '</div>');

    setTimeout(function () {
        scroll_to_bottom();
    }, 500)
}

function get_livechat_time_html_based_on_theme(time) {
    if (EASYCHAT_BOT_THEME == "theme_3") {
        return '<div class="easychat-user-message-time-div"><span>' + time + '<span><span class="easychat-bot-message-status-tick-div" ><img  style="width:14px;margin-bottom: -2px;" class="doubletick_livechat" src="' + EASYCHAT_IMG_PATH + 'doubletick_black.svg"></span></div>'
    } else if (EASYCHAT_BOT_THEME == "theme_2") {
        return '<span class="livechat-doubletick">' + time + '&nbsp;&nbsp;&nbsp;<img class="doubletick_livechat" src="' + EASYCHAT_IMG_PATH + 'doubletick_black.svg" style="height:1em;margin: 3px 0px -3px -2px;"></span>'
    } else {
        return '<span class="livechat-doubletick">' + time + '&nbsp;&nbsp;&nbsp;<img class="doubletick_livechat" src="' + EASYCHAT_IMG_PATH + 'doubletick_black.svg" style="height:1em;"></span>'
    }
}

function append_user_input(user_input, default_time) {

    if (typeof default_time === 'undefined') {
        default_time = return_time()
    }

    user_input = sanitizeHTML(user_input)

    user_input = easychat_linkify(user_input);
    var time = default_time;
    var regex = /^[A-Za-z0-9 `!@#$ %^&*()_+\-=\[\]{};':"\\|,.<>\/? ~]*$/;
    var emoji_filtered_text_response = user_input.replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g, '');
    emoji_filtered_text_response = stripHTML(emoji_filtered_text_response).replace(/\s\s+/g, ' ');

    if (EASYCHAT_BOT_THEME == "theme_1") {
        if (is_livechat) {
            hide_bot_typing_loader();
            $("#easychat-chat-container").append('<div class="easychat-user-message-div"><div id="easychat-user-message-' + user_message_index + '" class="easychat-message-animation easychat-user-message easychat-user-message-line" style="background-color:' + BOT_THEME_COLOR + ';color: ' + USER_MESSAGE_COLOR + '">' + user_input + '</div><span class="livechat-doubletick">' + time + '&nbsp;&nbsp;&nbsp;<img class="doubletick_livechat" src="' + EASYCHAT_IMG_PATH + 'doubletick_black.svg" style="height:1em;"></span></div>');
            return;
        }
        if (show_user_input){
            if (regex.test(emoji_filtered_text_response)){
                $("#easychat-chat-container").append('<div class="easychat-user-message-div"><div id="easychat-user-message-' + user_message_index + '" class="easychat-message-animation easychat-user-message easychat-user-message-line" style="direction: ltr !important;background-color:' + BOT_THEME_COLOR + ';color: ' + USER_MESSAGE_COLOR + '">' + user_input + '</div></div>');
            } else {
                $("#easychat-chat-container").append('<div class="easychat-user-message-div"><div id="easychat-user-message-' + user_message_index + '" class="easychat-message-animation easychat-user-message easychat-user-message-line" style="background-color:' + BOT_THEME_COLOR + ';color: ' + USER_MESSAGE_COLOR + '">' + user_input + '</div></div>');
            }
        } else {
            show_user_input = true
        }
        user_message_index += 1;

        setTimeout(function () {
            const elem = document.getElementById('easychat-user-message-' + (user_message_index - 1));
            $(elem).removeClass('easychat-message-animation')
        }, 300)
    } else if (EASYCHAT_BOT_THEME == "theme_2") {

        if (is_livechat) {
            hide_bot_typing_loader();
            $("#easychat-chat-container").append('<div class="easychat-user-message-div"><div id="easychat-user-message-' + user_message_index + '" class="easychat-message-animation easychat-user-message easychat-user-message-line" style="background-color:' + BOT_THEME_COLOR + ';color: ' + USER_MESSAGE_COLOR + '">' + user_input + '</div><span class="livechat-doubletick">' + time + '&nbsp;&nbsp;&nbsp;<img class="doubletick_livechat" src="' + EASYCHAT_IMG_PATH + 'doubletick_black.svg" style="height:1em;margin: 3px 0px -3px -2px;"></span></div>');
            return;
        }
        if (show_user_input) {
            if (regex.test(emoji_filtered_text_response)) {
                $("#easychat-chat-container").append('<div class="easychat-user-message-div"><div id="easychat-user-message-' + user_message_index + '" class="easychat-message-animation easychat-user-message easychat-user-message-line" style="direction: ltr !important;background-color:' + BOT_THEME_COLOR + ';color: ' + USER_MESSAGE_COLOR + '">' + user_input + '</div></div>');
            } else {
                $("#easychat-chat-container").append('<div class="easychat-user-message-div"><div id="easychat-user-message-' + user_message_index + '" class="easychat-message-animation easychat-user-message easychat-user-message-line" style="background-color:' + BOT_THEME_COLOR + ';color: ' + USER_MESSAGE_COLOR + '">' + user_input + '</div></div>');
            }
        } else {
            show_user_input = true
        }
        user_message_index += 1;

        setTimeout(function () {
            const elem = document.getElementById('easychat-user-message-' + (user_message_index - 1));
            $(elem).removeClass('easychat-message-animation')
        }, 300)
    } else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        add_theme_three_and_four_user_input(user_input, time);
    }
    else {
        if (is_livechat) {
            hide_bot_typing_loader();
            $("#easychat-chat-container").append('<div class="easychat-user-message-div"><div class="easychat-user-message easychat-user-message-line" style="background-color:' + BOT_THEME_COLOR + ';color: ' + USER_MESSAGE_COLOR + '">' + user_input + '</div><span class="livechat-doubletick">' + time + '&nbsp;&nbsp;&nbsp;<img class="doubletick_livechat" src="' + EASYCHAT_IMG_PATH + 'doubletick_black.svg" style="height:1em;"></span></div>');
            return;
        }
        if (show_user_input)
            $("#easychat-chat-container").append('<div class="easychat-user-message-div"><div class="easychat-user-message easychat-user-message-line" style="background-color:' + BOT_THEME_COLOR + ';color: ' + USER_MESSAGE_COLOR + '">' + user_input + '<span class="message-time-user">' + time + '&nbsp;&nbsp;<div style="display:inline-block;" ><img class="doubletick_easychat" src="' + EASYCHAT_IMG_PATH + 'doubletick_black.svg" style="height:1.5em;"></div></span></div></div>');
        else
            show_user_input = true
    }

    if (!is_livechat) {
        disable_footer_except_home();
        disable_sticky_div();
    }

    // try {
    //     if_datepicker_not_closed_class = document.getElementsByClassName("datepicker")
    //     for (i = 0; i < if_datepicker_not_closed_class.length; i++) {
    //         if_datepicker_not_closed_class[i].remove()
    //     }
    // } catch (err) { }

    var calendar_divs = document.getElementsByClassName("easychat-calendar-div")
    var div_length = calendar_divs.length
    if (div_length > 0) {
        calendar_divs[div_length - 1].style.opacity = "0.9"
        calendar_divs[div_length - 1].style.pointerEvents = "none"
    }
    element_response_previous_height = 0
}

function get_feedback_wrapper_div_html(feedback_id) {

    let thumbs_up_svg_path = '<path d="M4 12.5C4 12.303 4.0399 12.108 4.11741 11.926C4.19493 11.744 4.30854 11.5786 4.45177 11.4393C4.595 11.3001 4.76503 11.1896 4.95217 11.1142C5.13931 11.0388 5.33988 11 5.54244 11C5.74499 11 5.94557 11.0388 6.1327 11.1142C6.31984 11.1896 6.48988 11.3001 6.63311 11.4393C6.77633 11.5786 6.88995 11.744 6.96746 11.926C7.04498 12.108 7.08487 12.303 7.08487 12.5V18.5C7.08487 18.8978 6.92237 19.2794 6.63311 19.5607C6.34384 19.842 5.95152 20 5.54244 20C5.13336 20 4.74103 19.842 4.45177 19.5607C4.16251 19.2794 4 18.8978 4 18.5V12.5ZM8.11317 12.333V17.763C8.11299 18.1347 8.21931 18.499 8.42019 18.8152C8.62108 19.1314 8.90858 19.3869 9.25046 19.553L9.30187 19.578C9.87246 19.8553 10.5015 19.9998 11.1394 20H16.7087C17.1843 20.0002 17.6452 19.84 18.0131 19.5469C18.381 19.2537 18.6329 18.8456 18.7262 18.392L19.9601 12.392C20.0197 12.1019 20.0124 11.8025 19.9387 11.5154C19.865 11.2284 19.7267 10.9608 19.5339 10.732C19.341 10.5032 19.0983 10.3189 18.8233 10.1923C18.5483 10.0657 18.2479 10 17.9436 10H14.2829V6C14.2829 5.46957 14.0662 4.96086 13.6806 4.58579C13.2949 4.21071 12.7718 4 12.2263 4C11.9536 4 11.6921 4.10536 11.4992 4.29289C11.3064 4.48043 11.198 4.73478 11.198 5V5.667C11.198 6.53248 10.9094 7.37462 10.3754 8.067L8.9358 9.933C8.40182 10.6254 8.11317 11.4675 8.11317 12.333Z"></path>'
    let thumbs_down_svg_path = '<path d="M20 11.5C20 11.8978 19.8375 12.2794 19.5483 12.5607C19.259 12.842 18.8667 13 18.4577 13C18.0486 13 17.6563 12.842 17.3671 12.5607C17.0778 12.2794 16.9153 11.8978 16.9153 11.5V5.5C16.9153 5.10218 17.0778 4.72064 17.3671 4.43934C17.6563 4.15804 18.0486 4 18.4577 4C18.8667 4 19.259 4.15804 19.5483 4.43934C19.8375 4.72064 20 5.10218 20 5.5V11.5ZM15.8871 11.667V6.237C15.8874 5.86544 15.7812 5.50116 15.5805 5.18499C15.3798 4.86882 15.0926 4.61327 14.7509 4.447L14.6995 4.422C14.128 4.14422 13.4979 3.99973 12.859 4H7.29114C6.81555 3.99982 6.35461 4.15995 5.98678 4.45314C5.61894 4.74633 5.36697 5.15444 5.27376 5.608L4.03989 11.608C3.98024 11.8982 3.98757 12.1977 4.06133 12.4848C4.1351 12.7719 4.27346 13.0396 4.46645 13.2684C4.65943 13.4972 4.90223 13.6815 5.17733 13.808C5.45242 13.9346 5.75296 14.0001 6.05727 14H9.71775V18C9.71775 18.5304 9.93441 19.0391 10.3201 19.4142C10.7057 19.7893 11.2288 20 11.7742 20C12.0469 20 12.3084 19.8946 12.5013 19.7071C12.6941 19.5196 12.8024 19.2652 12.8024 19V18.333C12.8024 17.4675 13.0911 16.6254 13.625 15.933L15.0645 14.067C15.5985 13.3746 15.8871 12.5325 15.8871 11.667Z"></path>'
    if (EASYCHAT_BOT_THEME == 'theme_4') {
        thumbs_up_svg_path = '<path d="M4 12.5C4 12.303 4.0399 12.108 4.11741 11.926C4.19493 11.744 4.30854 11.5786 4.45177 11.4393C4.595 11.3001 4.76503 11.1896 4.95217 11.1142C5.13931 11.0388 5.33988 11 5.54244 11C5.74499 11 5.94557 11.0388 6.1327 11.1142C6.31984 11.1896 6.48988 11.3001 6.63311 11.4393C6.77633 11.5786 6.88995 11.744 6.96746 11.926C7.04498 12.108 7.08487 12.303 7.08487 12.5V18.5C7.08487 18.8978 6.92237 19.2794 6.63311 19.5607C6.34384 19.842 5.95152 20 5.54244 20C5.13336 20 4.74103 19.842 4.45177 19.5607C4.16251 19.2794 4 18.8978 4 18.5V12.5ZM8.11317 12.333V17.763C8.11299 18.1347 8.21931 18.499 8.42019 18.8152C8.62108 19.1314 8.90858 19.3869 9.25046 19.553L9.30187 19.578C9.87246 19.8553 10.5015 19.9998 11.1394 20H16.7087C17.1843 20.0002 17.6452 19.84 18.0131 19.5469C18.381 19.2537 18.6329 18.8456 18.7262 18.392L19.9601 12.392C20.0197 12.1019 20.0124 11.8025 19.9387 11.5154C19.865 11.2284 19.7267 10.9608 19.5339 10.732C19.341 10.5032 19.0983 10.3189 18.8233 10.1923C18.5483 10.0657 18.2479 10 17.9436 10H14.2829V6C14.2829 5.46957 14.0662 4.96086 13.6806 4.58579C13.2949 4.21071 12.7718 4 12.2263 4C11.9536 4 11.6921 4.10536 11.4992 4.29289C11.3064 4.48043 11.198 4.73478 11.198 5V5.667C11.198 6.53248 10.9094 7.37462 10.3754 8.067L8.9358 9.933C8.40182 10.6254 8.11317 11.4675 8.11317 12.333Z" />'
        thumbs_down_svg_path = '<path d="M20 11.5C20 11.8978 19.8375 12.2794 19.5483 12.5607C19.259 12.842 18.8667 13 18.4577 13C18.0486 13 17.6563 12.842 17.3671 12.5607C17.0778 12.2794 16.9153 11.8978 16.9153 11.5V5.5C16.9153 5.10218 17.0778 4.72064 17.3671 4.43934C17.6563 4.15804 18.0486 4 18.4577 4C18.8667 4 19.259 4.15804 19.5483 4.43934C19.8375 4.72064 20 5.10218 20 5.5V11.5ZM15.8871 11.667V6.237C15.8874 5.86544 15.7812 5.50116 15.5805 5.18499C15.3798 4.86882 15.0926 4.61327 14.7509 4.447L14.6995 4.422C14.128 4.14422 13.4979 3.99973 12.859 4H7.29114C6.81555 3.99982 6.35461 4.15995 5.98678 4.45314C5.61894 4.74633 5.36697 5.15444 5.27376 5.608L4.03989 11.608C3.98024 11.8982 3.98757 12.1977 4.06133 12.4848C4.1351 12.7719 4.27346 13.0396 4.46645 13.2684C4.65943 13.4972 4.90223 13.6815 5.17733 13.808C5.45242 13.9346 5.75296 14.0001 6.05727 14H9.71775V18C9.71775 18.5304 9.93441 19.0391 10.3201 19.4142C10.7057 19.7893 11.2288 20 11.7742 20C12.0469 20 12.3084 19.8946 12.5013 19.7071C12.6941 19.5196 12.8024 19.2652 12.8024 19V18.333C12.8024 17.4675 13.0911 16.6254 13.625 15.933L15.0645 14.067C15.5985 13.3746 15.8871 12.5325 15.8871 11.667Z" />'
    }

    let feedback_html = '<div class="easychat-bot-feedback-wrapper">\
                            <svg id="easychat-feedback-thumbs-up" onclick="easychat_send_feedback_msg_for_theme_three(this,' + feedback_id + ',1,\'\')" width="24" height="24" fill="#CBCACA" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\
                                ' + thumbs_up_svg_path + '\
                            </svg>\
                            <svg id="easychat-feedback-thumbs-down" onclick="easychat_send_feedback_msg_for_theme_three(this,' + feedback_id + ',-1,\'\')" width="24" fill="#CBCACA" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\
                                ' + thumbs_down_svg_path + '\
                            </svg>\
                        </div>'

    return feedback_html
}

function get_user_initial(user_name) {
    try {
        return user_name.trim()[0].toUpperCase();
    } catch (err) {
        return "N";
    }
}

function add_theme_one_bot_response(text_response, time, other_info) {

    var html = '';
    var regex = /^[A-Za-z0-9 `!@#$ %^&*()_+\-=\[\]{};':"\\|,.<>\/? ~]*$/;
    var emoji_filtered_text_response = text_response.replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g, '');
    emoji_filtered_text_response = stripHTML(emoji_filtered_text_response).replace(/\s\s+/g, ' ');

    if (is_livechat && typeof other_info !== 'undefined') {
        html = '<div class="easychat-bot-message-div">\
                    <div class="easychat-bot-message-wrapper easychat-active-agent-div">\
                        <div class="active-agent-profile-image">\
                            '+ get_user_initial(other_info.agent_name) + '\
                        </div>\
                        <div class="active-agent-name">\
                            <span>' + other_info.agent_name + '</span>\
                        </div>\
                        <div id="easychat-bot-message-' + bot_message_index + '" class="easychat-bot-message easychat-bot-message-line easychat-livechat-text-message" style="color:; word-break: break-word;">\
                        <div class="easychat-bot-message-text-div"><div class="easychat-show-less-text">'+ text_response + '</div>\
                            <div class="view_more_wrapper" style="display:none ">\
                                <div style="text-align:right;padding: 8px 16px 10px 0px;cursor: pointer; color:' + BOT_THEME_COLOR + '; " onclick="viewMore(this)">' + READ_MORE + '</div>\
                            </div></div>\
                        </div>\
                    <div class="message-time-bot">' + time + '</div>\
                    </div>\
                </div>';
    } else {
        html = '<div class="easychat-bot-message-div" ><div class = "easychat-bot-message-wrapper"><div id="easychat-bot-message-' + bot_message_index + '" class="easychat-message-animation easychat-bot-message easychat-bot-message-line" style="color:' + BOT_MESSAGE_COLOR + '; word-break: break-word;" >'
        if (regex.test(emoji_filtered_text_response)){
            html += '<div class="easychat-show-less-text" style="direction: ltr !important;">' + text_response + '</div>';
        } else {
            html += '<div class="easychat-show-less-text">' + text_response + '</div>';
        }

        html += '<div class=view_more_wrapper style="margin-right:5px;display:none "><div style="float:right;cursor: pointer; color:' + BOT_THEME_COLOR + '; padding-bottom:10px; margin-right: 23px;" onclick="viewMore(this)">' + READ_MORE + '</div></div>';

        html += '</div></div>'

    }

    if (is_text_to_speech_required) {
        var is_speech_muted = is_mute();
        try {
            document.getElementsByClassName("mic-icon")[0].remove();
        } catch (err) { }
        if (!is_speech_muted) {
            html += '<div class="mic-icon" style="margin-left: 4px;position: relative;">\
                <div class="mic-icon-on" style="cursor: pointer;" onclick="handleMicIconOn(this)">\
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <path d="M5.92608 10.6668H3.33341C3.1566 10.6668 2.98703 10.5965 2.86201 10.4715C2.73699 10.3465 2.66675 10.1769 2.66675 10.0001V6.0001C2.66675 5.82329 2.73699 5.65372 2.86201 5.52869C2.98703 5.40367 3.1566 5.33343 3.33341 5.33343H5.92608L9.45541 2.44543C9.50425 2.40539 9.56345 2.38005 9.62613 2.37236C9.6888 2.36466 9.75238 2.37493 9.80944 2.40196C9.86651 2.42899 9.91473 2.47168 9.94848 2.52505C9.98223 2.57842 10.0001 2.64028 10.0001 2.70343V13.2968C10.0001 13.3599 9.98223 13.4218 9.94848 13.4751C9.91473 13.5285 9.86651 13.5712 9.80944 13.5982C9.75238 13.6253 9.6888 13.6355 9.62613 13.6278C9.56345 13.6201 9.50425 13.5948 9.45541 13.5548L5.92608 10.6668ZM12.5754 11.0608L11.6274 10.1128C11.9511 9.8639 12.2131 9.54392 12.3934 9.17758C12.5736 8.81125 12.6671 8.40836 12.6667 8.0001C12.6667 7.04676 12.1667 6.2101 11.4134 5.73876L12.3727 4.77943C12.8777 5.15089 13.2882 5.636 13.5709 6.19551C13.8536 6.75502 14.0006 7.37322 14.0001 8.0001C14.0001 9.2281 13.4467 10.3268 12.5754 11.0608Z" fill="'+ BOT_THEME_COLOR + '"/>\
                    </svg>\
                </div>\
                <div class="mic-icon-off" style="cursor: pointer;display: none;" onclick="handleMicIconOff(this)">\
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <path d="M2.7682 2.13181C2.59247 1.95607 2.30754 1.95606 2.13181 2.1318C1.95607 2.30753 1.95606 2.59246 2.1318 2.76819L4.6627 5.29915H3.35C2.60442 5.29915 2 5.90356 2 6.64914V9.34788C2 10.0935 2.60442 10.6979 3.35 10.6979H5.55773C5.66797 10.6979 5.77437 10.7383 5.85675 10.8116L8.55163 13.2078C9.03528 13.6379 9.79999 13.2945 9.79999 12.6474V10.4365L13.2317 13.8683C13.4074 14.044 13.6923 14.044 13.8681 13.8683C14.0438 13.6925 14.0438 13.4076 13.8681 13.2319L2.7682 2.13181Z" fill="#CBCACA"/>\
                        <path d="M11.0846 9.17554L11.7674 9.85837C12.0445 9.29768 12.2 8.66643 12.2 7.99999C12.2 7.27808 12.0175 6.59746 11.6957 6.0031C11.5774 5.78454 11.3043 5.70327 11.0858 5.82159C10.8672 5.9399 10.7859 6.21299 10.9043 6.43155C11.1566 6.89761 11.3 7.43138 11.3 7.99999C11.3 8.41462 11.2237 8.81071 11.0846 9.17554Z" fill="#CBCACA"/>\
                        <path d="M12.4328 10.5238L13.0889 11.1799C13.6662 10.2578 14 9.16741 14 8C14 6.66433 13.563 5.42941 12.8244 4.43217C12.6765 4.23245 12.3947 4.19047 12.1949 4.33839C11.9952 4.48631 11.9532 4.76813 12.1012 4.96784C12.7289 5.81537 13.1 6.8637 13.1 8C13.1 8.91865 12.8575 9.77979 12.4328 10.5238Z" fill="#CBCACA"/>\
                        <path d="M6.51202 4.60288L9.79999 7.89092V3.35C9.79999 2.70282 9.03532 2.35948 8.55166 2.78949L6.51202 4.60288Z" fill="#CBCACA"/>\
                    </svg>\
                </div>\
            </div>';
        } else {
            html += '<div class="mic-icon" style="margin-left: 4px;position: relative;">\
                <div class="mic-icon-on" style="cursor: pointer; display: none;" onclick="handleMicIconOn(this)">\
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <path d="M5.92608 10.6668H3.33341C3.1566 10.6668 2.98703 10.5965 2.86201 10.4715C2.73699 10.3465 2.66675 10.1769 2.66675 10.0001V6.0001C2.66675 5.82329 2.73699 5.65372 2.86201 5.52869C2.98703 5.40367 3.1566 5.33343 3.33341 5.33343H5.92608L9.45541 2.44543C9.50425 2.40539 9.56345 2.38005 9.62613 2.37236C9.6888 2.36466 9.75238 2.37493 9.80944 2.40196C9.86651 2.42899 9.91473 2.47168 9.94848 2.52505C9.98223 2.57842 10.0001 2.64028 10.0001 2.70343V13.2968C10.0001 13.3599 9.98223 13.4218 9.94848 13.4751C9.91473 13.5285 9.86651 13.5712 9.80944 13.5982C9.75238 13.6253 9.6888 13.6355 9.62613 13.6278C9.56345 13.6201 9.50425 13.5948 9.45541 13.5548L5.92608 10.6668ZM12.5754 11.0608L11.6274 10.1128C11.9511 9.8639 12.2131 9.54392 12.3934 9.17758C12.5736 8.81125 12.6671 8.40836 12.6667 8.0001C12.6667 7.04676 12.1667 6.2101 11.4134 5.73876L12.3727 4.77943C12.8777 5.15089 13.2882 5.636 13.5709 6.19551C13.8536 6.75502 14.0006 7.37322 14.0001 8.0001C14.0001 9.2281 13.4467 10.3268 12.5754 11.0608Z" fill="'+ BOT_THEME_COLOR + '"/>\
                    </svg>\
                </div>\
                <div class="mic-icon-off" style="cursor: pointer;display: block;" onclick="handleMicIconOff(this)">\
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <path d="M2.7682 2.13181C2.59247 1.95607 2.30754 1.95606 2.13181 2.1318C1.95607 2.30753 1.95606 2.59246 2.1318 2.76819L4.6627 5.29915H3.35C2.60442 5.29915 2 5.90356 2 6.64914V9.34788C2 10.0935 2.60442 10.6979 3.35 10.6979H5.55773C5.66797 10.6979 5.77437 10.7383 5.85675 10.8116L8.55163 13.2078C9.03528 13.6379 9.79999 13.2945 9.79999 12.6474V10.4365L13.2317 13.8683C13.4074 14.044 13.6923 14.044 13.8681 13.8683C14.0438 13.6925 14.0438 13.4076 13.8681 13.2319L2.7682 2.13181Z" fill="#CBCACA"/>\
                        <path d="M11.0846 9.17554L11.7674 9.85837C12.0445 9.29768 12.2 8.66643 12.2 7.99999C12.2 7.27808 12.0175 6.59746 11.6957 6.0031C11.5774 5.78454 11.3043 5.70327 11.0858 5.82159C10.8672 5.9399 10.7859 6.21299 10.9043 6.43155C11.1566 6.89761 11.3 7.43138 11.3 7.99999C11.3 8.41462 11.2237 8.81071 11.0846 9.17554Z" fill="#CBCACA"/>\
                        <path d="M12.4328 10.5238L13.0889 11.1799C13.6662 10.2578 14 9.16741 14 8C14 6.66433 13.563 5.42941 12.8244 4.43217C12.6765 4.23245 12.3947 4.19047 12.1949 4.33839C11.9952 4.48631 11.9532 4.76813 12.1012 4.96784C12.7289 5.81537 13.1 6.8637 13.1 8C13.1 8.91865 12.8575 9.77979 12.4328 10.5238Z" fill="#CBCACA"/>\
                        <path d="M6.51202 4.60288L9.79999 7.89092V3.35C9.79999 2.70282 9.03532 2.35948 8.55166 2.78949L6.51202 4.60288Z" fill="#CBCACA"/>\
                    </svg>\
                </div>\
            </div>';
        }
    }
    html += '</div>';
    bot_message_index += 1;

    setTimeout(function () {
        const elem = document.getElementById('easychat-bot-message-' + (bot_message_index - 1));
        $(elem).removeClass('easychat-message-animation')
    }, 300);

    return html;
}

function add_theme_two_bot_response(text_response, time, other_info) {
    var html = '';
    var regex = /^[A-Za-z0-9 `!@#$ %^&*()_+\-=\[\]{};':"\\|,.<>\/? ~]*$/;
    var emoji_filtered_text_response = text_response.replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g, '');
    emoji_filtered_text_response = stripHTML(emoji_filtered_text_response).replace(/\s\s+/g, ' ');

    if (is_livechat && typeof other_info !== 'undefined') {
        html = '<div class="easychat-bot-message-div">\
                    <div class="easychat-bot-message-wrapper easychat-active-agent-div">\
                        <div class="active-agent-profile-image">\
                            '+ get_user_initial(other_info.agent_name) + '\
                        </div>\
                        <div class="active-agent-name">\
                            <span>' + other_info.agent_name + '</span>\
                        </div>\
                        <div id="easychat-bot-message-' + bot_message_index + '" class="easychat-bot-message easychat-bot-message-line" style="color:; word-break: break-word;">\
                        <div class="easychat-bot-message-text-div"><div class="easychat-show-less-text">'+ text_response + '</div>\
                            <div class="view_more_wrapper" style="display:none ">\
                                <div style="float:right;cursor: pointer; color:' + BOT_THEME_COLOR + '; " onclick="viewMore(this)">' + READ_MORE + '</div>\
                            </div></div>\
                        </div>\
                    <div class="message-time-bot" style=" margin-top: -5px;">' + time + '</div>\
                    </div>\
                </div>';
    } else {
        html = '<div class="easychat-bot-message-div" ><div class = "easychat-bot-message-wrapper"><div id="easychat-bot-message-' + bot_message_index + '" class="easychat-message-animation easychat-bot-message easychat-bot-message-line" style="color:' + BOT_MESSAGE_COLOR + '; word-break: break-word;" >'
        if (regex.test(emoji_filtered_text_response)){
            html += '<div class="easychat-show-less-text" style="direction: ltr !important;">' + text_response + '</div>'
        } else {
            html += '<div class="easychat-show-less-text">' + text_response + '</div>'
        }

        html += '<div class=view_more_wrapper style="display:none "><div style="float:right;cursor: pointer; color:' + BOT_THEME_COLOR + '; " onclick="viewMore(this)">' + READ_MORE + '</div></div>';

        html += '</div></div>';
    }

    if (is_text_to_speech_required) {
        var is_speech_muted = is_mute();
        try {
            document.getElementsByClassName("mic-icon")[0].remove();
        } catch (err) { }
        if (!is_speech_muted) {
            html += '<div class="mic-icon" style="margin-left: 4px;position: relative; top: 10px;">\
                <div class="mic-icon-on" style="cursor: pointer;" onclick="handleMicIconOn(this)">\
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <path d="M5.92608 10.6668H3.33341C3.1566 10.6668 2.98703 10.5965 2.86201 10.4715C2.73699 10.3465 2.66675 10.1769 2.66675 10.0001V6.0001C2.66675 5.82329 2.73699 5.65372 2.86201 5.52869C2.98703 5.40367 3.1566 5.33343 3.33341 5.33343H5.92608L9.45541 2.44543C9.50425 2.40539 9.56345 2.38005 9.62613 2.37236C9.6888 2.36466 9.75238 2.37493 9.80944 2.40196C9.86651 2.42899 9.91473 2.47168 9.94848 2.52505C9.98223 2.57842 10.0001 2.64028 10.0001 2.70343V13.2968C10.0001 13.3599 9.98223 13.4218 9.94848 13.4751C9.91473 13.5285 9.86651 13.5712 9.80944 13.5982C9.75238 13.6253 9.6888 13.6355 9.62613 13.6278C9.56345 13.6201 9.50425 13.5948 9.45541 13.5548L5.92608 10.6668ZM12.5754 11.0608L11.6274 10.1128C11.9511 9.8639 12.2131 9.54392 12.3934 9.17758C12.5736 8.81125 12.6671 8.40836 12.6667 8.0001C12.6667 7.04676 12.1667 6.2101 11.4134 5.73876L12.3727 4.77943C12.8777 5.15089 13.2882 5.636 13.5709 6.19551C13.8536 6.75502 14.0006 7.37322 14.0001 8.0001C14.0001 9.2281 13.4467 10.3268 12.5754 11.0608Z" fill="'+ BOT_THEME_COLOR + '"/>\
                    </svg>\
                </div>\
                <div class="mic-icon-off" style="cursor: pointer;display: none;" onclick="handleMicIconOff(this)">\
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <path d="M2.7682 2.13181C2.59247 1.95607 2.30754 1.95606 2.13181 2.1318C1.95607 2.30753 1.95606 2.59246 2.1318 2.76819L4.6627 5.29915H3.35C2.60442 5.29915 2 5.90356 2 6.64914V9.34788C2 10.0935 2.60442 10.6979 3.35 10.6979H5.55773C5.66797 10.6979 5.77437 10.7383 5.85675 10.8116L8.55163 13.2078C9.03528 13.6379 9.79999 13.2945 9.79999 12.6474V10.4365L13.2317 13.8683C13.4074 14.044 13.6923 14.044 13.8681 13.8683C14.0438 13.6925 14.0438 13.4076 13.8681 13.2319L2.7682 2.13181Z" fill="#CBCACA"/>\
                        <path d="M11.0846 9.17554L11.7674 9.85837C12.0445 9.29768 12.2 8.66643 12.2 7.99999C12.2 7.27808 12.0175 6.59746 11.6957 6.0031C11.5774 5.78454 11.3043 5.70327 11.0858 5.82159C10.8672 5.9399 10.7859 6.21299 10.9043 6.43155C11.1566 6.89761 11.3 7.43138 11.3 7.99999C11.3 8.41462 11.2237 8.81071 11.0846 9.17554Z" fill="#CBCACA"/>\
                        <path d="M12.4328 10.5238L13.0889 11.1799C13.6662 10.2578 14 9.16741 14 8C14 6.66433 13.563 5.42941 12.8244 4.43217C12.6765 4.23245 12.3947 4.19047 12.1949 4.33839C11.9952 4.48631 11.9532 4.76813 12.1012 4.96784C12.7289 5.81537 13.1 6.8637 13.1 8C13.1 8.91865 12.8575 9.77979 12.4328 10.5238Z" fill="#CBCACA"/>\
                        <path d="M6.51202 4.60288L9.79999 7.89092V3.35C9.79999 2.70282 9.03532 2.35948 8.55166 2.78949L6.51202 4.60288Z" fill="#CBCACA"/>\
                    </svg>\
                </div>\
            </div>';
        } else {
            html += '<div class="mic-icon" style="margin-left: 4px;position: relative; top: 10px;">\
                <div class="mic-icon-on" style="cursor: pointer; display: none;" onclick="handleMicIconOn(this)">\
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <path d="M5.92608 10.6668H3.33341C3.1566 10.6668 2.98703 10.5965 2.86201 10.4715C2.73699 10.3465 2.66675 10.1769 2.66675 10.0001V6.0001C2.66675 5.82329 2.73699 5.65372 2.86201 5.52869C2.98703 5.40367 3.1566 5.33343 3.33341 5.33343H5.92608L9.45541 2.44543C9.50425 2.40539 9.56345 2.38005 9.62613 2.37236C9.6888 2.36466 9.75238 2.37493 9.80944 2.40196C9.86651 2.42899 9.91473 2.47168 9.94848 2.52505C9.98223 2.57842 10.0001 2.64028 10.0001 2.70343V13.2968C10.0001 13.3599 9.98223 13.4218 9.94848 13.4751C9.91473 13.5285 9.86651 13.5712 9.80944 13.5982C9.75238 13.6253 9.6888 13.6355 9.62613 13.6278C9.56345 13.6201 9.50425 13.5948 9.45541 13.5548L5.92608 10.6668ZM12.5754 11.0608L11.6274 10.1128C11.9511 9.8639 12.2131 9.54392 12.3934 9.17758C12.5736 8.81125 12.6671 8.40836 12.6667 8.0001C12.6667 7.04676 12.1667 6.2101 11.4134 5.73876L12.3727 4.77943C12.8777 5.15089 13.2882 5.636 13.5709 6.19551C13.8536 6.75502 14.0006 7.37322 14.0001 8.0001C14.0001 9.2281 13.4467 10.3268 12.5754 11.0608Z" fill="'+ BOT_THEME_COLOR + '"/>\
                    </svg>\
                </div>\
                <div class="mic-icon-off" style="cursor: pointer;display: block;" onclick="handleMicIconOff(this)">\
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <path d="M2.7682 2.13181C2.59247 1.95607 2.30754 1.95606 2.13181 2.1318C1.95607 2.30753 1.95606 2.59246 2.1318 2.76819L4.6627 5.29915H3.35C2.60442 5.29915 2 5.90356 2 6.64914V9.34788C2 10.0935 2.60442 10.6979 3.35 10.6979H5.55773C5.66797 10.6979 5.77437 10.7383 5.85675 10.8116L8.55163 13.2078C9.03528 13.6379 9.79999 13.2945 9.79999 12.6474V10.4365L13.2317 13.8683C13.4074 14.044 13.6923 14.044 13.8681 13.8683C14.0438 13.6925 14.0438 13.4076 13.8681 13.2319L2.7682 2.13181Z" fill="#CBCACA"/>\
                        <path d="M11.0846 9.17554L11.7674 9.85837C12.0445 9.29768 12.2 8.66643 12.2 7.99999C12.2 7.27808 12.0175 6.59746 11.6957 6.0031C11.5774 5.78454 11.3043 5.70327 11.0858 5.82159C10.8672 5.9399 10.7859 6.21299 10.9043 6.43155C11.1566 6.89761 11.3 7.43138 11.3 7.99999C11.3 8.41462 11.2237 8.81071 11.0846 9.17554Z" fill="#CBCACA"/>\
                        <path d="M12.4328 10.5238L13.0889 11.1799C13.6662 10.2578 14 9.16741 14 8C14 6.66433 13.563 5.42941 12.8244 4.43217C12.6765 4.23245 12.3947 4.19047 12.1949 4.33839C11.9952 4.48631 11.9532 4.76813 12.1012 4.96784C12.7289 5.81537 13.1 6.8637 13.1 8C13.1 8.91865 12.8575 9.77979 12.4328 10.5238Z" fill="#CBCACA"/>\
                        <path d="M6.51202 4.60288L9.79999 7.89092V3.35C9.79999 2.70282 9.03532 2.35948 8.55166 2.78949L6.51202 4.60288Z" fill="#CBCACA"/>\
                    </svg>\
                </div>\
            </div>';
        }
    }
    html += '</div>';
    bot_message_index += 1;

    setTimeout(function () {
        const elem = document.getElementById('easychat-bot-message-' + (bot_message_index - 1));
        $(elem).removeClass('easychat-message-animation')
    }, 300)

    return html;
}

function add_theme_three_and_four_bot_response(text_response, time, other_info) {

    var html = '';
    var regex = /^[A-Za-z0-9 `!@#$ %^&*()_+\-=\[\]{};':"\\|,.<>\/? ~]*$/;
    var emoji_filtered_text_response = text_response.replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g, '');
    emoji_filtered_text_response = stripHTML(emoji_filtered_text_response).replace(/\s\s+/g, ' ');

    if (is_livechat && typeof other_info !== 'undefined') {
        if (EASYCHAT_BOT_THEME == 'theme_4') {
            html = get_livechat_bot_response_theme_four(text_response, time, other_info)
        } else {
            html = '<div class="easychat-bot-message-div">\
                        <div class="easychat-bot-message-wrapper easychat-active-agent-div">\
                            <div class="active-agent-profile-image">\
                                '+ get_user_initial(other_info.agent_name) + '\
                            </div>\
                            <div class="active-agent-name">\
                                <span>' + other_info.agent_name + '</span>\
                            </div>\
                            <div id="easychat-bot-message-' + bot_message_index + '" class="easychat-bot-message easychat-bot-message-line" style="color:; word-break: break-word;">\
                            <div class="easychat-bot-message-text-div"><div class="easychat-show-less-text">'+ text_response + '</div>\
                                <div class="view_more_wrapper" style="display:none ">\
                                    <div class="read-more-less-btn" style="text-align: right;padding-top: 8px;cursor: pointer; color:' + BOT_THEME_COLOR + '; " onclick="viewMore(this)">' + READ_MORE + '</div>\
                                </div></div>\
                            </div>\
                        <div class="message-time-bot" style=" margin-top: -5px;">' + time + '</div>\
                        </div>\
                    </div>';
        }

    } else {
        html = '<div class="easychat-bot-message-div" >\
                    <div class = "easychat-bot-message-wrapper">\
                        <div class="easychat-bot-message-icon-div"><img src=' + MESSAGE_IMG + '></div>\
                        <div id="easychat-bot-message-' + bot_message_index + '" class="easychat-bot-message-text-container">\
                            <div class="easychat-bot-message-text-div">'
        
        if (regex.test(emoji_filtered_text_response)){
            html += '<div class="easychat-show-less-text" style="direction: ltr !important;">'+ text_response + '</div>';
        } else {
            html += '<div class="easychat-show-less-text">'+ text_response + '</div>';
        }

        html += '<div class=view_more_wrapper style="display:none "><div style="float:right;cursor: pointer; color:' + BOT_THEME_COLOR + '; " onclick="viewMore(this)">' + READ_MORE + '</div></div></div>';
        if (EASYCHAT_BOT_THEME == 'theme_4' && is_text_to_speech_required) {
            html += get_mic_icon_html_theme_four()
        }
        html += '</div>';// closing easychat-bot-message-text-container
        html += '</div>';// closing easychat-bot-message-wrapper
        html += '</div>';// closing easychat-bot-message-div
    }

    bot_message_index += 1;

    setTimeout(function () {
        const elem = document.getElementById('easychat-bot-message-' + (bot_message_index - 1));
        $(elem).removeClass('easychat-message-animation')
    }, 300)
    return html
}

function add_theme_three_and_four_user_input(user_input, time) {

    var regex = /^[A-Za-z0-9 `!@#$ %^&*()_+\-=\[\]{};':"\\|,.<>\/? ~]*$/;
    var emoji_filtered_text_response = user_input.replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g, '');
    emoji_filtered_text_response = stripHTML(emoji_filtered_text_response).replace(/\s\s+/g, ' ');

    if (is_livechat) {
        hide_bot_typing_loader();
        $("#easychat-chat-container").append('<div class="easychat-user-message-div"><div id="easychat-user-message-' + user_message_index + '" class="easychat-user-message-text-div" style="background:' + BOT_THEME_COLOR + ';color: ' + USER_MESSAGE_COLOR + '">' + user_input + '</div><div class="easychat-user-message-time-div"><span>' + time + '<span><span class="easychat-bot-message-status-tick-div" ><img  style="width:14px;margin-bottom: -2px;" class="doubletick_livechat" src="' + EASYCHAT_IMG_PATH + 'doubletick_black.svg"></span></div></div>');
        return;
    }

    if (show_user_input) {
        if (regex.test(emoji_filtered_text_response)) {
            $("#easychat-chat-container").append('<div class="easychat-user-message-div"><div id="easychat-user-message-' + user_message_index + '" class="easychat-user-message-text-div" style="direction: ltr !important;background-color:' + BOT_THEME_COLOR + ';color: ' + USER_MESSAGE_COLOR + '">' + user_input + '</div></div>');
        } else {
            $("#easychat-chat-container").append('<div class="easychat-user-message-div"><div id="easychat-user-message-' + user_message_index + '" class="easychat-user-message-text-div" style="background-color:' + BOT_THEME_COLOR + ';color: ' + USER_MESSAGE_COLOR + '">' + user_input + '</div></div>');
        }

    } else {

        show_user_input = true

    }


    user_message_index += 1;

    setTimeout(function () {
        const elem = document.getElementById('easychat-user-message-' + (user_message_index - 1));
        $(elem).removeClass('easychat-message-animation')
    }, 300)
}

function playSound(filename) {

    if (EASYCHAT_BOT_THEME != 'theme_1' || !is_bot_notification_sound_enabled) return;
    var mp3Source = '<source src="' + filename + '" type="audio/mpeg">';
    document.getElementById("sound").innerHTML = '<audio autoplay>' + mp3Source + '</audio>';

}

function play_notification_sound(filename) {

    var mp3Source = '<source src="' + filename + '" type="audio/mpeg">';
    document.getElementById("sound").innerHTML = '<audio autoplay>' + mp3Source + '</audio>';

    setTimeout(function () {
        document.getElementById("sound").innerHTML = '';
    }, 1000);

}

function isValidURL(url) {
    var https_pattern = /^https:\/\/?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$/;
    var http_pattern = /^http:\/\/?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$/;
    if (https_pattern.test(url) || http_pattern.test(url)) {
        return true;
    }
    // files stored in data drive have the url of the form :
    // /chat/download-file
    if (url.indexOf('download-file') != -1) {
        return true;
    }
    return false;
}


function send_user_input(user_input, intent_id) {

    window.clearTimeout(bot_inactivity_timer);
    remove_banner_based_on_theme();
    remove_feedback_div();

    // user_input = stripHTML(user_input);
    user_input = strip_malicious_chars(user_input);

    if (!is_livechat) {

        if (user_input.indexOf('http') == -1 && user_input.indexOf('https') == -1) {
            user_input = strip_unwanted_characters(user_input);
        } else {
            if (!isValidURL(user_input)) {
                user_input = strip_unwanted_characters(user_input);
            }
        }
    
        if (user_input.trim() == "") {
            return;
        }
    }
    
    if (is_captcha == true) {
        verify_captcha(user_input);
        return;
    }

    var temp_user_input = user_input

    if (is_livechat) {
        if (!isValidURL(user_input)) {
            if (!window.IS_LIVECHAT_SPECIAL_CHARACTER_ALLOW_IN_CHAT) {
                user_input = remove_special_characters_from_str(user_input);
            }
        }
        user_input = user_input.trim();
        if(user_input == '') {
            return;
        }
        temp_user_input = user_input;
    }

    user_input = !is_livechat && mask_confidential_info == true ? mask_user_input(user_input) : user_input
    playSound(STATIC_MP3_PATH + '/juntos1.mov');
    append_user_input(user_input)
    user_input = temp_user_input
    livechat_trigger_message = user_input;

    if (!isNaN(intent_id)) user_input = intent_id;
    var server_text = send_message_to_server(user_input, user_id, bot_id, bot_name, "None");

    deactivate_mic()
    empty_user_input_based_on_theme()
    setTimeout(function () {
        scroll_to_bottom();
    }, 200)

    is_bot_inactivity_msg_present = false

    if (EASYCHAT_BOT_THEME != 'theme_1') {
        is_doubletick = true;
    }
    is_conversaion_started = true;
}

function append_captcha(url) {
    captcha_element = document.getElementById("recaptcha-div");
    if (captcha_element != null || captcha_element != undefined) {
        captcha_element.remove();
    }
    captcha_html = '<div class="easychat-captcha-div" id="recaptcha-div" align="center">\
        <img src="/' + url + '" id="img-captcha">\
        </div>';
    $("#easychat-chat-container").append(captcha_html);
    scroll_to_bottom();
    scroll_to_bottom();
}


function create_captcha() {
    var xhttp = new XMLHttpRequest();
    var params = '';
    xhttp.open("POST", "/chat/get_captcha/", true);
    xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            response = JSON.parse(this.responseText);
            if (response["status"] == 200) {
                captcha_id = response["random"];
                append_captcha(response["url"]);
                scroll_to_bottom();
            }
        }
    }
    xhttp.send(params);
}

function get_quotes_suggestions(query_code) {
    if (custom_quote_list_flag != query_code) {
        var json_string = JSON.stringify({
            query_code: query_code
        });
        // json_string = encrypt_variable(json_string);
        // json_string = encodeURIComponent(json_string);

        var xhttp = new XMLHttpRequest();
        // var params = 'json_string='+json_string
        var params = 'query_code=' + query_code
        xhttp.open("POST", "/chat/get-quote-codes/", true);
        xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                response = JSON.parse(this.responseText);
                if (response["status"] == 200) {
                    code_list = response["code_list"];
                    custom_quote_list_flag = query_code
                    //custom_autocomplete(document.getElementById("user_input"), code_list)
                }
            }
        }
        xhttp.send(params);
    }
}

function verify_captcha(user_input) {
    var xhttp = new XMLHttpRequest();
    var params = 'random=' + captcha_id;
    xhttp.open("POST", "/chat/get_captcha_value/", true);
    xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            response = JSON.parse(this.responseText);
            if (response["status"] == 200) {
                // console.log(String(user_input), String(response['value']));
                if (String(user_input) == String(response['value'])) {
                    is_captcha = null;
                    send_message_to_server("correct", user_id, bot_id, bot_name, "None")
                } else {
                    create_captcha();
                    scroll_to_bottom();
                }
            }
        }
    }
    xhttp.send(params);
}

function append_recaptcha() {
    create_captcha();
}

function handle_input_type(modes, modes_param) {
    var input_maxlength = "5000000";
    var is_numeric = '';
    if ('is_numeric_input' in modes) {

        is_numeric = modes['is_numeric_input'];
    }

    if ('input_maxlength' in modes_param) {
        input_maxlength = modes_param['input_maxlength'];
    }

    if (is_numeric == "true") {
        document.getElementById("user_input").type = "number";
        hide_mic = true;
    } else {
        document.getElementById("user_input").type = "text";
    }

    document.getElementById("user_input").maxlength = input_maxlength;
}


function append_google_map_location() {
    map_element = document.getElementById("google-map");
    if (map_element != null || map_element != undefined) {
        map_element.remove();
    }

    location_html = '<div class="easychat-gmap-wrapper" id="google-map">\
        <div id="map" class="easychat-gmap-div"></div>\
    </div>';
    $("#easychat-chat-container").append(location_html);

    element_response = document.querySelectorAll(".easychat-gmap-wrapper")
    element_response_previous_height += element_response[element_response.length - 1].clientHeight


    var script = document.createElement("script");
    script.src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyBAHTtk1lkVvIl1X_i7_1aIK9RCrhqGEpQ&libraries=places&callback=initMap";
    document.getElementById("google-map").appendChild(script);
    is_map_js_loaded = true;
}


function get_message_list(message, separator) {
    message_list = message.split(separator);
    return message_list;
}

var speech_synthesis_utterance_instance = null;
var speech_synthesis_instance = window.speechSynthesis;
var voices = null;

function cancel_text_to_speech() {

    var channel_name = url_parameters["channel"]
    if (channel_name == undefined || channel_name == null)
        channel_name = "Web"
    if (check_and_lower_string(channel_name) != "android" && check_and_lower_string(channel_name) != "ios") {
        if (speech_synthesis_instance != null) {
            speech_synthesis_instance.cancel();
        }
    } else {
        try {
            if (check_and_lower_string(channel_name) == "android") {

                android.terminateTextToSpeech()
            }
            else if (check_and_lower_string(channel_name) == "ios") {

                webkit.messageHandlers.terminateTextToVoice.postMessage('terminateTextToVoice')
            }
        } catch(err) {}
    }
}

function detectmob() {
    if (window.outerWidth < 450) {
        focus_user_input();
    } else {
        enable_user_input();
        focus_user_input();
    }
}

function mobile_and_tablet_check() {
    let check = false;
    (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
    return check;
};

function append_bot_recommendations_based_on_theme(recommendations) {

    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {

        append_bot_recommendations_for_theme_three_and_four(recommendations)

    } else {

        append_bot_recommendation(recommendations)

    }
}

function append_prev_session_response(response) {
    var server_reply = response.response.text_response.text;
    if (is_doubletick) {
        easychat_doubletick_list = document.getElementsByClassName("doubletick_easychat");
        easychat_doubletick_list[easychat_doubletick_list.length - 1].src = EASYCHAT_IMG_PATH + 'doubletick_blue.svg';
    }
    var recommendations = response.response.recommendations;
    var choices = response.response.choices;
    var cards = response.response.cards;
    var videos = response.response.videos;
    var images = response.response.images;
    var tables = response.response.tables;

    var easy_search_results = response.response.easy_search_results;

    var google_search_results = response.response.google_search_results;
    var pdf_search_results = response.response.pdf_search_results;

    var modes = response.response.text_response.modes;
    var modes_param = response.response.text_response.modes_param;
    if ("is_recommendation_menu" in modes && modes["is_recommendation_menu"] == "true") {
        set_cookie("is_recommendation_menu", "true")
    } else {
        set_cookie("is_recommendation_menu", "false")
    }
    is_tms_intent = false
    if (("raise_service_request" in modes && modes["raise_service_request"] == "true") || ("schedule_meeting" in modes && modes["schedule_meeting"] == "true") || ("check_meeting_status" in modes && modes["check_meeting_status"] == "true") || ("check_ticket_status" in modes && modes["check_ticket_status"] == "true")) {
        is_tms_intent = true
    }

    if (is_tms_intent == false) {
        message_list = get_message_list(server_reply, RESPONSE_SENTENCE_SEPARATOR);
        for (var i = 0; i < message_list.length; i++) {
            append_bot_text_response(message_list[i]);
        }
        reset_size_of_text_field(message_list.length);
    }

    if (cards.length > 0) {
        append_bot_slider_cards(cards);
    }

    if (easy_search_results != null && easy_search_results != undefined && easy_search_results.length > 0) {

        append_bot_slider_cards(easy_search_results);
    }
    if (google_search_results != null && google_search_results != undefined && google_search_results.length > 0) {

        // append_google_search_result(google_search_results);
        append_bot_slider_cards(google_search_results);
    }

    if (pdf_search_results != null && pdf_search_results != undefined && pdf_search_results.length > 0) {

        append_pdf_search_bot_slider_cards(pdf_search_results);
    }
    if (tables != undefined && tables != null && tables.length > 0) {
        append_bot_tables(tables);
    }

    if (images.length > 0) {
        append_bot_slider_images(images);
    }

    if (videos.length > 0) {
        append_bot_slider_videos(videos);
    }

    if (choices.length > 0) {
        append_bot_choices(choices);
    }

    if (recommendations.length > 0) {

        append_bot_recommendations_based_on_theme(recommendations);
        // append_bot_recommendation(recommendations);
    }
    enable_user_input();
    setTimeout(function (e) {
        scroll_to_bottom();
    }, 500);
}
function disable_previous_attahments() {
    try {
        // var attachment_selector = document.querySelectorAll(".easychat-dragdropContainer__XPS")
        // attachment_selector = attachment_selector[attachment_selector.length - 1]
        // attachment_selector.style.display = "none"
        // attachment_selector.style.pointerEvents = "none"
        // attachment_selector.style.opacity = "0.5"
        // attachment_selector.style.background = "#CCC"
        var previous_attachments = document.querySelectorAll(".easychat-upload-file-container")
        previous_attachments[previous_attachments.length - 1].style.display = "none";

    } catch (err) {

    }

}

function append_bot_response(response) {
    var url_parameters = get_url_vars();
    var channel_name = url_parameters["channel"]
    if (channel_name == undefined || channel_name == null)
        channel_name = "Web"

    disable_previous_attahments()
    hide_mic = false;
    var server_reply = response.response.text_response.text;
    var speech_response = response.response.speech_response.text;
    is_text_to_speech_required = response.response.is_text_to_speech_required;
    if (is_internet_explorer) {
        is_text_to_speech_required = false;
    }
    if (String(is_voice_based_form_assist_enabled) == "true") {
        is_text_to_speech_required = true;
    }
    var is_custom_order_selected = response.response.is_custom_order_selected
    var order_of_response = response.response.order_of_response;
    is_widgets = false;
    disable_user_input();

    if (is_doubletick) {

        easychat_doubletick_list = document.getElementsByClassName("doubletick_easychat");
        if (easychat_doubletick_list.length >= 1) {

            easychat_doubletick_list[easychat_doubletick_list.length - 1].src = EASYCHAT_IMG_PATH + 'doubletick_blue.svg';

        }
    }
    is_feedback_required = false
    // by default it should be false
    if ("is_feedback_required" in response["response"]) {

        try {
            is_feedback_required = response["response"]["is_feedback_required"]
            easychat_intent_feedback_id = response["response"]["feedback_id"]

        } catch (err) {
            console.log(err)
        }
    }

    var recommendations = response.response.recommendations;
    var choices = response.response.choices;
    var cards = response.response.cards;
    var videos = response.response.videos;
    var images = response.response.images;
    var tables = response.response.tables;

    var easy_search_results = response.response.easy_search_results;

    var google_search_results = response.response.google_search_results;
    var pdf_search_results = response.response.pdf_search_results;

    if (change_is_flow_ended_variable == true) {
        is_flow_ended = response.response.is_flow_ended;
    }



    if (is_flow_ended) {
        if (check_element_exists("user_input")) {
            autocomplete(document.getElementById("user_input"), suggestion_list, []);
        }
        bot_inactivity_detection_required = bot_inactivity_detection_enabled;
    } else {
        disable_bot_inactivity_detection();
    }

    var modes = response.response.text_response.modes;
    var modes_param = response.response.text_response.modes_param;

    if ("is_livechat" in modes && modes["is_livechat"] == "true") {
        if (window.hasOwnProperty("WebSocket") == false) {
            return;
        }
    }

    if ("mask_next_input" in modes && modes["mask_next_input"] == "true") {

        mask_next_input = true
    }

    if ("enable_screenshare" in modes && modes["enable_screenshare"] == "true") {
        show_connect_with_agent_modal();
        return;
    }

    is_quote_response = false;
    if ("is_quote_response" in modes && modes["is_quote_response"] == "true") {
        is_quote_response = true
    }

    is_tms_intent = false
    if (("raise_service_request" in modes && modes["raise_service_request"] == "true") || ("schedule_meeting" in modes && modes["schedule_meeting"] == "true") || ("check_meeting_status" in modes && modes["check_meeting_status"] == "true") || ("check_ticket_status" in modes && modes["check_ticket_status"] == "true")) {
        is_tms_intent = true
    }

    if ("form_assist_disable" in modes && modes["form_assist_disable"] == "true") {
        parent.postMessage('disable-form-assist', '*');
        return;
    }

    if ("check_ticket_status" in modes && modes["check_ticket_status"] == "true") {
        is_bot_response_message_showed = true;
        html = '<center><button onclick="check_ticket_status(this)" style="padding: 0.4em 1em 0.4em 1em;border-radius: 0.5em;background-color:' + BOT_THEME_COLOR + ';color:white;font-size:15px;">Check Status</button></center>'
        document.getElementById("check_ticket_status_submit_button").innerHTML = html;
        modal_check_ticket_status.style.display = "block";
        disable_user_input();
        return;
    }

    if ("check_meeting_status" in modes && modes["check_meeting_status"] == "true") {
        is_bot_response_message_showed = true;
        html = '<center><button onclick="check_meeting_status(this)" style="padding: 0.4em 1em 0.4em 1em;border-radius: 0.5em;background-color:' + BOT_THEME_COLOR + ';color:white;font-size:15px;">Check Status</button></center>'
        document.getElementById("check_meeting_status_submit_button").innerHTML = html;
        modal_check_meeting_status.style.display = "block";
        disable_user_input();
        return;
    }

    if ("raise_service_request" in modes && modes["raise_service_request"] == "true") {
        is_bot_response_message_showed = true;
        html = '<center><button onclick="create_issue(this)" style="padding: 0.4em 1em 0.4em 1em;border-radius: 0.5em;background-color:' + BOT_THEME_COLOR + ';color:white;font-size:15px;">Submit</button></center>'
        document.getElementById("create_issue_submit_button").innerHTML = html;
        modal_create_issue.style.display = "block";
        disable_user_input();
        return;
    }

    if ("schedule_meeting" in modes && modes["schedule_meeting"] == "true") {
        is_bot_response_message_showed = true;
        html = '<center><button onclick="schedule_meeting(this)" style="padding: 0.4em 1em 0.4em 1em;border-radius: 0.5em;background-color:' + BOT_THEME_COLOR + ';color:white;font-size:15px;">Submit</button></center>'
        document.getElementById("schedule_meeting_submit_button").innerHTML = html;
        $(".easychat-modal-content").css('margin', '');
        $(".easychat-modal-content").css('height', '');
        modal_schedule_meeting.style.display = "block";
        disable_user_input();
        return;
    }

    if ("is_livechat" in modes && modes["is_livechat"] == "true") {
        if (window.hasOwnProperty("WebSocket") == true) {
            message_list = get_message_list(server_reply, RESPONSE_SENTENCE_SEPARATOR);
            send_initial_message_list_to_livechat = message_list;
            if (false) {
                is_livechat = false;
                append_bot_text_response("Chat with an Expert is not supported on Internet Explorer. Please use Google Chrome, Mozilla Firefox, Microsoft Edge, or Safari for a better experience. Sorry for the inconvenience.")
                scroll_to_bottom()
                enable_user_input();
                return;
            }
            disable_language_change_options();
            if (!is_livechat_enabled() && livechat_session_id === "") {
                append_livechat_response(is_text_to_speech_required, speech_response);
            } else {
                enable_user_input()
            }
            is_bot_response_message_showed = true;
        }
        return;
    }

    if (is_text_to_speech_required == true && speech_response != "") {
        speech_response = speech_response.split("$$$").join(" ");
        speech_response = speech_response.split("@@@").join(" ");
        text_to_speech(speech_response);
    }

    if ("is_typable" in modes) {
        if (modes["is_typable"] == "true") {
            // enable_user_input();
            // focus_user_input();
            handle_input_type(modes, modes_param);
            //focus_user_input();
        } else {
            disable_user_input();
        }
    }

    if (easy_search_results != null && easy_search_results != undefined && easy_search_results.length > 0) {

        append_bot_slider_cards(easy_search_results);
    }

    if (google_search_results != null && google_search_results != undefined && google_search_results.length > 0) {

        // append_google_search_result(google_search_results);
        append_bot_slider_cards(google_search_results)
    }

    if (pdf_search_results != null && pdf_search_results != undefined && pdf_search_results.length > 0) {

        append_pdf_search_bot_slider_cards(pdf_search_results)
    }

    if ("is_recaptcha" in modes && modes["is_recaptcha"] == "true") {
        append_recaptcha();
        is_captcha = true;
        hide_mic = true;
        handle_input_type(modes, modes_param);
    }

    if ("is_recommendation_menu" in modes && modes["is_recommendation_menu"] == "true") {
        set_cookie("is_recommendation_menu", "true");
    } else {
        set_cookie("is_recommendation_menu", "false")
    }

    if ("is_location_required" in modes && modes["is_location_required"] == "true") {
        append_google_map_location();
    }

    is_custom_complete = false
    if ("is_custom_complete" in modes && modes["is_custom_complete"] == "true") {
        start_custom_complete();
        is_custom_complete = true
    }

    try {
        if (!is_custom_order_selected || order_of_response.length == 0) {
            order_of_response = default_order_of_response

            if (order_of_response.length == 0) {
                order_of_response = ['text', 'image', 'table', 'video', 'link_cards', 'intent_level_feedback', 'quick_recommendations', 'drop_down', 'date_picker', 'checkbox', 'radio_button', 'range_slider', 'form', 'time_picker', 'calendar_picker', 'file_attach', 'video_record', 'phone_number'];
            }
        }
    } catch (err) {
        order_of_response = ['text', 'image', 'table', 'video', 'link_cards', 'intent_level_feedback', 'quick_recommendations', 'drop_down', 'date_picker', 'checkbox', 'radio_button', 'range_slider', 'form', 'time_picker', 'calendar_picker', 'file_attach', 'video_record', 'phone_number'];
    }


    for (let j = 0; j < order_of_response.length; ++j) {
        let element = order_of_response[j];
        element = element.toLowerCase().replace(" ", "_");

        if (initial_intent_in_welcome_message == false && web_landing_intent == false && is_initial_trigger_intent == false)
            is_bot_response_appended = true;
        if (element == "text" && is_tms_intent == false) {
            message_list = get_message_list(server_reply, RESPONSE_SENTENCE_SEPARATOR);
            for (var i = 0; i < message_list.length; i++) {
                append_bot_text_response(message_list[i]);
            }

            reset_size_of_text_field(message_list.length);
        }

        if (element == "file_attach" && response.is_attachment_required == true) {
            is_widgets = true;
            disable_user_input();
            var choosen_file_type = response.choosen_file_type;
            choosen_file_type = choosen_file_type.replace(/"/g, '');
            choosen_file_ext = file_type_ext[choosen_file_type];
            if ("is_save_attachment_required" in modes && modes["is_save_attachment_required"] == "true") {
                is_save_attachment_required = true;
            } else {
                is_save_attachment_required = false;
            }
            append_attachment(choosen_file_ext, is_flow_ended);

            if (EASYCHAT_BOT_THEME == "theme_1") {
                disable_footer_widget_response_theme_1()
            }
            else if (EASYCHAT_BOT_THEME == "theme_2") {
                disable_footer_widget_response_theme_2()
            }
            else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
                disable_footer_widget_response_theme3_and_theme4()
            }
            continue;
        }

        if (element == "link_cards" && cards.length > 0) {
            append_bot_slider_cards(cards);
            continue;
        }

        if (element == "date_picker" && "is_datepicker" in modes && modes["is_datepicker"] == "true") {
            is_widgets = true;
            disable_user_input();
            // DatePicker input format [{"placeholder":"From Date"}, {"placeholder":"To Date"}]

            append_datepicker(modes_param["datepicker_list"]);
            if (EASYCHAT_BOT_THEME == "theme_1") {
                disable_footer_widget_response_theme_1()
            }
            else if (EASYCHAT_BOT_THEME == "theme_2") {
                disable_footer_widget_response_theme_2()
            }
            else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
                disable_footer_widget_response_theme3_and_theme4()
            }
            continue;
        }

        if (element == "time_picker" && "is_timepicker" in modes && modes["is_timepicker"] == "true") {
            is_widgets = true;
            disable_user_input();
            // DatePicker input format [{"placeholder":"From Time"}, {"placeholder":"To Time"}]
            append_timepicker(modes_param["timepicker_list"])
            if (EASYCHAT_BOT_THEME == "theme_1") {
                disable_footer_widget_response_theme_1()
            }
            else if (EASYCHAT_BOT_THEME == "theme_2") {
                disable_footer_widget_response_theme_2()
            }
            else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
                disable_footer_widget_response_theme3_and_theme4()
            }
            continue;
        }

        if (element == "calendar_picker" && "is_calender" in modes && modes["is_calender"] == "true") {
            is_widgets = true;
            disable_user_input();
            show_user_input = false
            append_calender_date_time(modes_param["datepicker_list"], modes_param["timepicker_list"])

            if (EASYCHAT_BOT_THEME == "theme_1") {
                disable_footer_widget_response_theme_1()
            }
            else if (EASYCHAT_BOT_THEME == "theme_2") {
                disable_footer_widget_response_theme_2()
            }
            else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
                disable_footer_widget_response_theme3_and_theme4()
            }
            continue;
        }

        if (element == "range_slider" && "is_range_slider" in modes && modes["is_range_slider"] == "true") {
            is_widgets = true;
            disable_user_input();
            // Input Range Slider list format [{"placeholder":"Loan Amount", "min":50000, "max":640000}]
            if (modes_param["range_slider_list"][0]["range_type"] == "single-range-slider")
                append_single_bot_range_slider(modes_param["range_slider_list"]);
            else if (modes_param["range_slider_list"][0]["range_type"] == "multi-range-slider")
                append_multi_bot_range_slider(modes_param["range_slider_list"]);

            if (EASYCHAT_BOT_THEME == "theme_1") {
                disable_footer_widget_response_theme_1()
            }
            else if (EASYCHAT_BOT_THEME == "theme_2") {
                disable_footer_widget_response_theme_2()
            }
            else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
                disable_footer_widget_response_theme3_and_theme4()
            }
            continue;
        }
        if (element == "phone_number" && "is_phone_widget_enabled" in modes && modes["is_phone_widget_enabled"] == "true") {
            is_widgets = true;
            disable_user_input();
            append_phone_number_widget(modes_param["country_code"]);

            if (EASYCHAT_BOT_THEME == "theme_1") {
                disable_footer_widget_response_theme_1()
            }
            else if (EASYCHAT_BOT_THEME == "theme_2") {
                disable_footer_widget_response_theme_2()
            }
            else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
                disable_footer_widget_response_theme3_and_theme4()
            }
            continue;
        }

        if (element == "form" && "is_create_form_allowed" in modes && modes["is_create_form_allowed"] == "true") {
            is_widgets = true;
            disable_user_input();
            append_create_form_modal(modes_param["form_name"], modes_param["form_fields_list"]);

            if (EASYCHAT_BOT_THEME == "theme_1") {
                disable_footer_widget_response_theme_1()
            }
            else if (EASYCHAT_BOT_THEME == "theme_2") {
                disable_footer_widget_response_theme_2()
            }
            else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
                disable_footer_widget_response_theme3_and_theme4()
            }
            continue;
        }

        if (element == "radio_button" && "is_radio_button" in modes && modes["is_radio_button"] == "true") {
            is_widgets = true;
            disable_user_input();
            append_radio_buttons(modes_param["radio_button_choices"]);

            if (EASYCHAT_BOT_THEME == "theme_1") {
                disable_footer_widget_response_theme_1()
            }
            else if (EASYCHAT_BOT_THEME == "theme_2") {
                disable_footer_widget_response_theme_2()
            }
            else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
                disable_footer_widget_response_theme3_and_theme4()
            }
            continue;
        }

        if (element == "checkbox" && "is_check_box" in modes && modes["is_check_box"] == "true") {
            is_widgets = true;
            disable_user_input();
            append_checkbox(modes_param["check_box_choices"]);

            if (EASYCHAT_BOT_THEME == "theme_1") {
                disable_footer_widget_response_theme_1()
            }
            else if (EASYCHAT_BOT_THEME == "theme_2") {
                disable_footer_widget_response_theme_2()
            }
            else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
                disable_footer_widget_response_theme3_and_theme4()
            }
            continue;
        }

        if (element == "drop_down" && "is_drop_down" in modes && modes["is_drop_down"] == "true") {
            is_widgets = true;
            disable_user_input();
            append_dropdown(modes_param["drop_down_choices"]);

            if (EASYCHAT_BOT_THEME == "theme_1") {
                disable_footer_widget_response_theme_1()
            }
            else if (EASYCHAT_BOT_THEME == "theme_2") {
                disable_footer_widget_response_theme_2()
            }
            else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
                disable_footer_widget_response_theme3_and_theme4()
            }
            continue;
        }

        if (element == "video_record" && "is_video_recorder_allowed" in modes && modes["is_video_recorder_allowed"] == "true") {
            is_widgets = true;
            disable_user_input();
            if ("is_save_video_attachment" in modes && modes["is_save_video_attachment"] == "true") {
                is_save_attachment_required = true;
            } else {
                is_save_attachment_required = false;
            }
            append_video_recorder();

            if (EASYCHAT_BOT_THEME == "theme_1") {
                disable_footer_widget_response_theme_1()
            }
            else if (EASYCHAT_BOT_THEME == "theme_2") {
                disable_footer_widget_response_theme_2()
            }
            else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
                disable_footer_widget_response_theme3_and_theme4()
            }
            continue;
        }

        if (element == "table" && tables != undefined && tables != null && tables.length > 0) {
            append_bot_tables(tables);
            continue;
        }

        if (element == "image" && images.length > 0) {
            append_bot_slider_images(images);
            continue;
        }

        if (element == "video" && videos.length > 0) {
            append_bot_slider_videos(videos);
            continue;
        }

        if (element == "intent_level_feedback" && is_feedback_required && !is_initial_form_assist_auto_popup) {
            append_feedback_btns(easychat_intent_feedback_id);
            continue;
        }

        if (element == "quick_recommendations") {
            if (recommendations.length > 0) {
                append_bot_recommendations_based_on_theme(recommendations);
            }
        }
    }

    if (choices.length > 0) {
        append_bot_choices(choices);
    }

    if ("auto_trigger_last_intent" in modes && modes["auto_trigger_last_intent"] == "true") {
        last_identified_intent = response.response.last_identified_intent_name
        send_message_to_server(last_identified_intent, user_id, bot_id, bot_name, "None");
        return;
    }

    //scroll_to_bottom();
    if (is_widgets == false) {
        deactivate_mic();
    }
    deactivate_query_submit_button();

    if (is_widgets) {
        disable_bot_inactivity_detection();
    } else {
        bot_inactivity_detection_required = bot_inactivity_detection_enabled;
    }

    if (recognition != null) {
        if (hide_mic == true) {
            hide_mic_icon();
        } else {
            show_mic();
        }
    } else {
        hide_mic_icon();
    }
     
    if (initial_intent_in_welcome_message == false && web_landing_intent == false) {
        objDiv = document.getElementById("easychat-chat-container")
        element_user_response_list = document.querySelectorAll(".easychat-user-message-div")

        element_user_response = element_user_response_list[element_user_response_list.length - 1]
        let prevValue = 0,
            currValue = 0;
        var interval_scroll = setInterval(function () {
            scroll_to_element();

            try {
                if (element_user_response == undefined) {
                    clearInterval(interval_scroll);
                    scroll_to_bottom();
                    is_bot_response_appended = false;
                }
                if (currValue == 0) {
                    currValue = element_user_response.getBoundingClientRect().top
                } else {
                    prevValue = currValue;
                    currValue = element_user_response.getBoundingClientRect().top
                }
                if (EASYCHAT_BOT_THEME == "theme_1") {
                    if (element_user_response.getBoundingClientRect().top <= 90 || currValue - prevValue == 0) {
                        clearInterval(interval_scroll)
                        is_bot_response_appended = false;
                    }
                } else {

                    if (element_user_response.getBoundingClientRect().top <= 80 || currValue - prevValue == 0) {
                        clearInterval(interval_scroll)
                        is_bot_response_appended = false;
                    }
                }
            } catch (err) { }
        }, 10);
    }
    web_landing_intent = false

    is_bot_inactivity_msg_present = false
    is_initial_trigger_intent = false
    if (bot_inactivity_detection_enabled && bot_inactivity_detection_required) {
        reset_bot_inactivity_timer()
    }

    if (EASYCHAT_BOT_THEME == "theme_1") {
        playSound(STATIC_MP3_PATH + '/juntos3.mov');
    }

    is_bot_response_message_showed = true;
    if (bot_response_delay_allowed) {
        reset_bot_response_delay_timer();
    }
    is_initial_form_assist_auto_popup = false;
}

function start_custom_complete() {
    if (true && check_element_exists("user_input")) {
        custom_autocomplete(document.getElementById("user_input"), [])
    }
}

function get_embed_video_url(url) {
    var regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
    var match = url.match(regExp);

    if (match && match[2].length == 11) {
        return "https://www.youtube.com/embed/" + match[2];
    } else {
        return url;
    }
}

function handle_video_unload(ele) {
    ele.parentElement.style.display = "none";
    ele.parentElement.nextElementSibling.style.display = "flex";
}

function append_bot_slider_videos(video_url_list, append_in_faq=false) {
    if (video_url_list.length > 0) {
        slider_main_container = document.getElementById("easychat-slideshow-container-main-div");
        if (slider_main_container != undefined && slider_main_container != null) {
            slider_main_container.remove();
        }

        video_html = '<div class="easychat-slider-wrapper">'
        var margin = "margin:auto;";
      
        if (EASYCHAT_BOT_THEME == "theme_2") {
            if (video_url_list.length != 1) {
                margin = "margin:0px 2px;";
            }
            else {
                margin = "margin:1px;";
            }
        }
       else if (EASYCHAT_BOT_THEME == 'theme_4') {
            margin = "margin: 0px;";
        }
        video_html += '<div class="video-slider-wrapper-div" style="color:' + BOT_THEME_COLOR + ';' + margin + ' width: 80%;"><div class="slideshow-container"  value=1 >';
        total_video = video_url_list.length;

        for (var i = 0; i < video_url_list.length; i++) {
            video_url_list[i] = get_embed_video_url(video_url_list[i]);
            current_video_no = i + 1;
            if (i == 0) {
                video_html += '<div class="mySlides fade" >'
                if (video_url_list[i].indexOf("embed") != -1) {
                    video_html += '<div class="video-container">\
                      <iframe class="easychat-video-iframe" src="' + video_url_list[i] + '" frameborder="1" allowfullscreen></iframe>\
                    </div>';
                } else {
                    video_html += '<video height="174" style="width:100%;" controls>\
                      <source onerror="handle_video_unload(this)" src="' + video_url_list[i] + '" type="video/mp4">\
                    </video>\
                    <div style="display: none; padding-bottom:4px; width: 100%;"><div class="easychat-unable-to-load-content-wrapper" >\
                    <svg width="52" height="53" viewBox="0 0 52 53" fill="none" xmlns="http://www.w3.org/2000/svg">\
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M50.3928 0.0548387C50.2099 0.110774 48.9261 1.326 46.7228 3.52873C44.8589 5.39206 43.3175 6.89711 43.2975 6.87341C43.2775 6.84961 43.0868 6.57012 42.8736 6.25233C41.6225 4.38645 39.6289 2.99279 37.2852 2.34574L36.3582 2.08986H24.0334C12.3622 2.08986 11.6784 2.09905 11.1398 2.26326C9.71253 2.69851 8.44602 3.74413 7.82997 4.99615C7.17011 6.3369 7.20879 5.09456 7.2069 25.0335L7.20529 43.0472L3.73869 46.5071C1.83204 48.4101 0.210849 50.0823 0.136047 50.2231C0.0612447 50.3639 0 50.6569 0 50.8742C0 51.2067 0.0583063 51.3276 0.368039 51.6374C0.677866 51.9471 0.798744 52.0054 1.13123 52.0054C1.34853 52.0054 1.64148 51.9442 1.78236 51.8694C1.92315 51.7946 13.2643 40.4995 26.9849 26.7694C47.1745 6.56576 51.9419 1.74884 51.9856 1.50841C52.0152 1.34506 51.9977 1.05979 51.9465 0.874535C51.856 0.54641 51.3876 0.0528478 51.1644 0.0501932C51.1033 0.0495296 50.9679 0.0308527 50.8636 0.00885763C50.7593 -0.0132323 50.5474 0.0074355 50.3928 0.0548387ZM33.7527 6.23764C33.7547 8.14761 33.8801 8.88947 34.3691 9.88342C34.9289 11.0208 36.024 12.0438 37.1149 12.4481C37.3505 12.5354 37.5433 12.6297 37.5433 12.6576C37.5433 12.6856 31.2714 18.9798 23.6057 26.6448L9.66817 40.5812L9.69291 23.7057L9.71766 6.83018L9.9632 6.30874C10.3121 5.56802 10.637 5.22387 11.3009 4.89214L11.881 4.60223H22.8161H33.7511L33.7527 6.23764ZM36.9808 4.84986C38.7019 5.36096 40.4164 6.74409 41.2114 8.26242L41.4772 8.7701L40.6717 9.58639L39.8661 10.4027L39.1262 10.3553C38.2055 10.2962 37.5151 9.98154 36.985 9.37933C36.3831 8.69549 36.2865 8.30707 36.239 6.37985C36.1923 4.4823 36.1357 4.599 36.9808 4.84986ZM42.6415 18.0229C42.4994 18.1 42.3288 18.2583 42.2623 18.3747C42.1666 18.5423 42.1316 21.3716 42.094 32.0013L42.0466 45.4164L41.8011 45.9378C41.4453 46.6932 41.1206 47.0294 40.4074 47.3806L39.7754 47.6917L26.3583 47.7391C15.702 47.7768 12.8974 47.8115 12.7287 47.9079C12.2354 48.1897 12.08 49.0562 12.4221 49.6172C12.8061 50.2471 11.8966 50.2112 26.7139 50.1822C39.4461 50.1573 40.1778 50.1467 40.6719 49.9822C42.1016 49.506 43.3309 48.4767 43.9343 47.2504C44.5848 45.9286 44.5555 46.6419 44.5574 32.0693C44.5591 17.7767 44.5866 18.5135 44.0362 18.0807C43.725 17.8359 43.0387 17.8074 42.6415 18.0229Z" fill="#7B7A7B"/>\
                    </svg>\
                    <div class="unable-to-load-content-text-div">' + UNABLE_TO_LOAD_TEXT + '</div></div>\
                    </div>'
                }
            } else {
                video_html += '<div class="mySlides fade" style="display: none;">'
                if (video_url_list[i].indexOf("embed") != -1) {
                    video_html += '<div class="video-container">\
                      <iframe class="easychat-video-iframe" src="' + video_url_list[i] + '" frameborder="1" allowfullscreen></iframe>\
                    </div>';
                } else {
                    video_html += '<video  height="170" style="width:100%;" controls>\
                      <source onerror="handle_video_unload(this)" src="' + video_url_list[i] + '" type="video/mp4">\
                    </video>\
                   <div style="display: none; padding-bottom:4px; width: 100%;"><div class="easychat-unable-to-load-content-wrapper" >\
                    <svg width="52" height="53" viewBox="0 0 52 53" fill="none" xmlns="http://www.w3.org/2000/svg">\
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M50.3928 0.0548387C50.2099 0.110774 48.9261 1.326 46.7228 3.52873C44.8589 5.39206 43.3175 6.89711 43.2975 6.87341C43.2775 6.84961 43.0868 6.57012 42.8736 6.25233C41.6225 4.38645 39.6289 2.99279 37.2852 2.34574L36.3582 2.08986H24.0334C12.3622 2.08986 11.6784 2.09905 11.1398 2.26326C9.71253 2.69851 8.44602 3.74413 7.82997 4.99615C7.17011 6.3369 7.20879 5.09456 7.2069 25.0335L7.20529 43.0472L3.73869 46.5071C1.83204 48.4101 0.210849 50.0823 0.136047 50.2231C0.0612447 50.3639 0 50.6569 0 50.8742C0 51.2067 0.0583063 51.3276 0.368039 51.6374C0.677866 51.9471 0.798744 52.0054 1.13123 52.0054C1.34853 52.0054 1.64148 51.9442 1.78236 51.8694C1.92315 51.7946 13.2643 40.4995 26.9849 26.7694C47.1745 6.56576 51.9419 1.74884 51.9856 1.50841C52.0152 1.34506 51.9977 1.05979 51.9465 0.874535C51.856 0.54641 51.3876 0.0528478 51.1644 0.0501932C51.1033 0.0495296 50.9679 0.0308527 50.8636 0.00885763C50.7593 -0.0132323 50.5474 0.0074355 50.3928 0.0548387ZM33.7527 6.23764C33.7547 8.14761 33.8801 8.88947 34.3691 9.88342C34.9289 11.0208 36.024 12.0438 37.1149 12.4481C37.3505 12.5354 37.5433 12.6297 37.5433 12.6576C37.5433 12.6856 31.2714 18.9798 23.6057 26.6448L9.66817 40.5812L9.69291 23.7057L9.71766 6.83018L9.9632 6.30874C10.3121 5.56802 10.637 5.22387 11.3009 4.89214L11.881 4.60223H22.8161H33.7511L33.7527 6.23764ZM36.9808 4.84986C38.7019 5.36096 40.4164 6.74409 41.2114 8.26242L41.4772 8.7701L40.6717 9.58639L39.8661 10.4027L39.1262 10.3553C38.2055 10.2962 37.5151 9.98154 36.985 9.37933C36.3831 8.69549 36.2865 8.30707 36.239 6.37985C36.1923 4.4823 36.1357 4.599 36.9808 4.84986ZM42.6415 18.0229C42.4994 18.1 42.3288 18.2583 42.2623 18.3747C42.1666 18.5423 42.1316 21.3716 42.094 32.0013L42.0466 45.4164L41.8011 45.9378C41.4453 46.6932 41.1206 47.0294 40.4074 47.3806L39.7754 47.6917L26.3583 47.7391C15.702 47.7768 12.8974 47.8115 12.7287 47.9079C12.2354 48.1897 12.08 49.0562 12.4221 49.6172C12.8061 50.2471 11.8966 50.2112 26.7139 50.1822C39.4461 50.1573 40.1778 50.1467 40.6719 49.9822C42.1016 49.506 43.3309 48.4767 43.9343 47.2504C44.5848 45.9286 44.5555 46.6419 44.5574 32.0693C44.5591 17.7767 44.5866 18.5135 44.0362 18.0807C43.725 17.8359 43.0387 17.8074 42.6415 18.0229Z" fill="#7B7A7B"/>\
                    </svg>\
                    <div class="unable-to-load-content-text-div">' + UNABLE_TO_LOAD_TEXT + '</div></div> \
                    </div>'
                }
            }
            if (video_url_list.length != 1) {
                video_html += '<div class="pageno-co">' + current_video_no + ' / ' + total_video + '</div></div>';
            } else {
                video_html += '</div>'
            }

        }
        if (video_url_list.length != 1) {
                    video_html += '<div style ="width: 28px;height: 28px;background-color: #fff;border-radius: 50%;left: -13px;top:55%;" class="prev-image-video" onclick="plusImageSlides(-1,this)"><a class="video-slider-left">&#10094;</a></div>\
                <div style ="width: 28px;height: 28px;background-color: #fff;border-radius: 50%;right: -13px;top: 55%;" class="next-image-video" onclick="plusImageSlides(1,this)" ><a class="video-slider-right">&#10095;</a></div>\
                </div><script>showSlides(1,this);</script><br><div style="text-align:center"></div>';
                
        }
        video_html += '</div></div>';

        if(append_in_faq) {
            $("#faq_media_response").append(video_html)
        } else {
            $("#easychat-chat-container").append(video_html)
        }

        element_response = document.querySelectorAll(".easychat-slider-wrapper")
        element_response_previous_height += element_response[element_response.length - 1].clientHeight
        resize_chabot_window();

    }
}

function handle_image_unload(ele) {
    ele.nextElementSibling.style.display = "flex";
    ele.style.display = "none";
}

function append_bot_slider_images(image_url_list, compressed_img_url_list, append_in_faq=false) {

    slider_main_container = document.getElementById("easychat-slideshow-container-main-div");
    if (slider_main_container != undefined && slider_main_container != null) {
        slider_main_container.remove();
    }
    
    image_slidershow_html = '<div class="easychat-slider-wrapper">'
    var margin = "margin:auto;";
    if (EASYCHAT_BOT_THEME == "theme_2") { 
        if (image_url_list.length != 1) {
            margin = "margin:0px 2px;";
        }
        else{
            margin = "margin:1px;";

        }
        
    }
    else if (EASYCHAT_BOT_THEME == 'theme_4') {
        margin = "margin: 0px;";
    }
    image_slidershow_html += '<div class="image-slider-wrapper-div"style="color:' + BOT_THEME_COLOR + ';' + margin + ' width: 80%; "> <div class="slideshow-container"  value=1 >';
    total_images = image_url_list.length;

    for (var i = 0; i < image_url_list.length; i++) {
        current_image_no = i + 1;
        if (i == 0) {
            image_slidershow_html += '<div class="mySlides fade" >'
        } else {
            image_slidershow_html += '<div class="mySlides fade" style="display: none;">'
        }
        if (image_url_list.length != 1) {

            image_slidershow_html += '<div class="pageno-co">' + current_image_no + ' / ' + total_images + '</div>\
                    <img src="' + image_url_list[i] + '" class="easychat-image-el" onerror="handle_image_unload(this)" onclick = "open_link_image(this)" style = "cursor:pointer;">\
                    <div style="display: none; padding-bottom:4px; width: 100%;"><div class="easychat-unable-to-load-content-wrapper" >\
                    <svg width="52" height="53" viewBox="0 0 52 53" fill="none" xmlns="http://www.w3.org/2000/svg">\
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M50.3928 0.0548387C50.2099 0.110774 48.9261 1.326 46.7228 3.52873C44.8589 5.39206 43.3175 6.89711 43.2975 6.87341C43.2775 6.84961 43.0868 6.57012 42.8736 6.25233C41.6225 4.38645 39.6289 2.99279 37.2852 2.34574L36.3582 2.08986H24.0334C12.3622 2.08986 11.6784 2.09905 11.1398 2.26326C9.71253 2.69851 8.44602 3.74413 7.82997 4.99615C7.17011 6.3369 7.20879 5.09456 7.2069 25.0335L7.20529 43.0472L3.73869 46.5071C1.83204 48.4101 0.210849 50.0823 0.136047 50.2231C0.0612447 50.3639 0 50.6569 0 50.8742C0 51.2067 0.0583063 51.3276 0.368039 51.6374C0.677866 51.9471 0.798744 52.0054 1.13123 52.0054C1.34853 52.0054 1.64148 51.9442 1.78236 51.8694C1.92315 51.7946 13.2643 40.4995 26.9849 26.7694C47.1745 6.56576 51.9419 1.74884 51.9856 1.50841C52.0152 1.34506 51.9977 1.05979 51.9465 0.874535C51.856 0.54641 51.3876 0.0528478 51.1644 0.0501932C51.1033 0.0495296 50.9679 0.0308527 50.8636 0.00885763C50.7593 -0.0132323 50.5474 0.0074355 50.3928 0.0548387ZM33.7527 6.23764C33.7547 8.14761 33.8801 8.88947 34.3691 9.88342C34.9289 11.0208 36.024 12.0438 37.1149 12.4481C37.3505 12.5354 37.5433 12.6297 37.5433 12.6576C37.5433 12.6856 31.2714 18.9798 23.6057 26.6448L9.66817 40.5812L9.69291 23.7057L9.71766 6.83018L9.9632 6.30874C10.3121 5.56802 10.637 5.22387 11.3009 4.89214L11.881 4.60223H22.8161H33.7511L33.7527 6.23764ZM36.9808 4.84986C38.7019 5.36096 40.4164 6.74409 41.2114 8.26242L41.4772 8.7701L40.6717 9.58639L39.8661 10.4027L39.1262 10.3553C38.2055 10.2962 37.5151 9.98154 36.985 9.37933C36.3831 8.69549 36.2865 8.30707 36.239 6.37985C36.1923 4.4823 36.1357 4.599 36.9808 4.84986ZM42.6415 18.0229C42.4994 18.1 42.3288 18.2583 42.2623 18.3747C42.1666 18.5423 42.1316 21.3716 42.094 32.0013L42.0466 45.4164L41.8011 45.9378C41.4453 46.6932 41.1206 47.0294 40.4074 47.3806L39.7754 47.6917L26.3583 47.7391C15.702 47.7768 12.8974 47.8115 12.7287 47.9079C12.2354 48.1897 12.08 49.0562 12.4221 49.6172C12.8061 50.2471 11.8966 50.2112 26.7139 50.1822C39.4461 50.1573 40.1778 50.1467 40.6719 49.9822C42.1016 49.506 43.3309 48.4767 43.9343 47.2504C44.5848 45.9286 44.5555 46.6419 44.5574 32.0693C44.5591 17.7767 44.5866 18.5135 44.0362 18.0807C43.725 17.8359 43.0387 17.8074 42.6415 18.0229Z" fill="#7B7A7B"/>\
                    </svg>\
                    <div class="unable-to-load-content-text-div">' + UNABLE_TO_LOAD_TEXT + '</div></div>\
                    </div>\
                </div>';
        } else {
            try {
                var img = image_url_list[i];

                if (compressed_img_url_list && compressed_img_url_list[i]) img = compressed_img_url_list[i];

                image_slidershow_html += '<img src="' + img + '"  onerror="handle_image_unload(this)" class="easychat-image-el" onclick = "open_link_image(this,\'' + image_url_list[i] + '\')" style = "cursor:pointer;" >\
                <div style="display: none; padding-bottom:4px; width: 100%;"><div class="easychat-unable-to-load-content-wrapper" >\
                <svg width="52" height="53" viewBox="0 0 52 53" fill="none" xmlns="http://www.w3.org/2000/svg">\
                <path fill-rule="evenodd" clip-rule="evenodd" d="M50.3928 0.0548387C50.2099 0.110774 48.9261 1.326 46.7228 3.52873C44.8589 5.39206 43.3175 6.89711 43.2975 6.87341C43.2775 6.84961 43.0868 6.57012 42.8736 6.25233C41.6225 4.38645 39.6289 2.99279 37.2852 2.34574L36.3582 2.08986H24.0334C12.3622 2.08986 11.6784 2.09905 11.1398 2.26326C9.71253 2.69851 8.44602 3.74413 7.82997 4.99615C7.17011 6.3369 7.20879 5.09456 7.2069 25.0335L7.20529 43.0472L3.73869 46.5071C1.83204 48.4101 0.210849 50.0823 0.136047 50.2231C0.0612447 50.3639 0 50.6569 0 50.8742C0 51.2067 0.0583063 51.3276 0.368039 51.6374C0.677866 51.9471 0.798744 52.0054 1.13123 52.0054C1.34853 52.0054 1.64148 51.9442 1.78236 51.8694C1.92315 51.7946 13.2643 40.4995 26.9849 26.7694C47.1745 6.56576 51.9419 1.74884 51.9856 1.50841C52.0152 1.34506 51.9977 1.05979 51.9465 0.874535C51.856 0.54641 51.3876 0.0528478 51.1644 0.0501932C51.1033 0.0495296 50.9679 0.0308527 50.8636 0.00885763C50.7593 -0.0132323 50.5474 0.0074355 50.3928 0.0548387ZM33.7527 6.23764C33.7547 8.14761 33.8801 8.88947 34.3691 9.88342C34.9289 11.0208 36.024 12.0438 37.1149 12.4481C37.3505 12.5354 37.5433 12.6297 37.5433 12.6576C37.5433 12.6856 31.2714 18.9798 23.6057 26.6448L9.66817 40.5812L9.69291 23.7057L9.71766 6.83018L9.9632 6.30874C10.3121 5.56802 10.637 5.22387 11.3009 4.89214L11.881 4.60223H22.8161H33.7511L33.7527 6.23764ZM36.9808 4.84986C38.7019 5.36096 40.4164 6.74409 41.2114 8.26242L41.4772 8.7701L40.6717 9.58639L39.8661 10.4027L39.1262 10.3553C38.2055 10.2962 37.5151 9.98154 36.985 9.37933C36.3831 8.69549 36.2865 8.30707 36.239 6.37985C36.1923 4.4823 36.1357 4.599 36.9808 4.84986ZM42.6415 18.0229C42.4994 18.1 42.3288 18.2583 42.2623 18.3747C42.1666 18.5423 42.1316 21.3716 42.094 32.0013L42.0466 45.4164L41.8011 45.9378C41.4453 46.6932 41.1206 47.0294 40.4074 47.3806L39.7754 47.6917L26.3583 47.7391C15.702 47.7768 12.8974 47.8115 12.7287 47.9079C12.2354 48.1897 12.08 49.0562 12.4221 49.6172C12.8061 50.2471 11.8966 50.2112 26.7139 50.1822C39.4461 50.1573 40.1778 50.1467 40.6719 49.9822C42.1016 49.506 43.3309 48.4767 43.9343 47.2504C44.5848 45.9286 44.5555 46.6419 44.5574 32.0693C44.5591 17.7767 44.5866 18.5135 44.0362 18.0807C43.725 17.8359 43.0387 17.8074 42.6415 18.0229Z" fill="#7B7A7B"/>\
                </svg>\
                <div class="unable-to-load-content-text-div">' + UNABLE_TO_LOAD_TEXT + '</div></div>\
                </div>\
                </div>';
            } catch (err) {
                console.log(err)
            }
        }
    }
    if (image_url_list.length != 1) {
    
            image_slidershow_html += '<div style ="width: 28px;height: 28px;background-color: #fff;border-radius: 50%;left: -13px;top:55%;" class="prev-image-video" onclick="plusImageSlides(-1,this)"><a class="video-slider-left">&#10094;</a></div>\
                <div style ="width: 28px;height: 28px;background-color: #fff;border-radius: 50%;right: -13px;top: 55%;" class="next-image-video" onclick="plusImageSlides(1,this)" ><a class="video-slider-right">&#10095;</a></div>\
                </div><script>showSlides(1,this);</script><br><div style="text-align:center"></div>';
    
    }
    image_slidershow_html += '</div></div>';


  
    if(append_in_faq) {
        $("#faq_media_response").append(image_slidershow_html)
    } else {
        $("#easychat-chat-container").append(image_slidershow_html)
    }

    element_response = document.querySelectorAll(".easychat-slider-wrapper")
    const el = element_response[element_response.length - 1]
    el_style = window.getComputedStyle ? getComputedStyle(el, null) : el.currentStyle;
    //element_response_previous_height += element_response[element_response.length-1].clientHeight
    element_response_previous_height += parseInt(el_style.height);

    resize_chabot_window();
}
function update_card_status(slide_show_container) {
    scroll_left = Math.abs(parseInt(slide_show_container.scrollLeft));

    cards = slide_show_container.childNodes;

    var card_style = cards[0].currentStyle || window.getComputedStyle(cards[0]);
    margin_left = parseInt(card_style.marginLeft)
    margin_right = parseInt(card_style.marginRight)

    container_width = slide_show_container.offsetWidth;

    card_length = cards[0].offsetWidth + margin_left + margin_right;
    card_count = cards.length;

    if (language_script_type == "ltr") {
        right_button = slide_show_container.parentNode.querySelector(".next-image-video-card")
        left_button = slide_show_container.parentNode.querySelector(".prev-image-video-card")
    } else {
        left_button = slide_show_container.parentNode.querySelector(".next-image-video-card")
        right_button = slide_show_container.parentNode.querySelector(".prev-image-video-card")
    }

    var maxScrollLeft = slide_show_container.scrollWidth - slide_show_container.clientWidth;
    slide_show_container.addEventListener('scroll', function() {
        touch_scroll_left = (Math.abs(parseInt(slide_show_container.scrollLeft)));
        if (touch_scroll_left >= maxScrollLeft - 1){
            right_button.style.display = "none";
            left_button.style.display = "flex";
        }
        if(touch_scroll_left > 1){
            left_button.style.display = "flex";
            if(touch_scroll_left < maxScrollLeft - 1){
                right_button.style.display = "flex";
            }
        }
        else if (touch_scroll_left <= 1){
            right_button.style.display = "flex";
            left_button.style.display = "none";
        }
    });
    
    if (scroll_left == 0 || scroll_left == 1) {
        left_button.style.display = "none";
    } else {
        left_button.style.display = "flex";
    }
    if (Math.abs((card_length) * card_count - container_width - scroll_left) <= 5) {
        right_button.style.display = "none";
    } else {
        right_button.style.display = "flex";
    }
    if (((card_length) * card_count - container_width) < 0) {
        right_button.style.display = "none";
    }
}
function card_move_forward(elem) {
    slide_show_container = elem.parentElement.querySelector(".slideshow-container")

    slide_show_container.scrollBy(200, 0);
    update_card_status(slide_show_container)
}
function card_move_backward(elem) {
    slide_show_container = elem.parentElement.querySelector(".slideshow-container");

    slide_show_container.scrollBy(-200, 0);
    update_card_status(slide_show_container)
}
function append_bot_slider_cards(cards, append_in_faq=false) {
    if (is_welcome_screen_present() && !append_in_faq) {
        return;
    }

    if (EASYCHAT_BOT_THEME == "theme_1" || EASYCHAT_BOT_THEME == "theme_2" || EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        total_images = cards.length;
        let first_card_style = ""
        if(total_images == 1) {
            first_card_style = 'easychat-slider-first-card'
        }
        cards_html = '<div id ="easychat-card-slides-wrapper" style="color:' + BOT_THEME_COLOR + ';" class="easychat-slides-wrapper '+first_card_style+'" ><div id="easychat-card-left-button-div" class="prev-image-video-card" onclick="card_move_backward(this)" style="width:30px;height:30px;background-color:#fff;border-radius:50%;"><a id="easychat-card-left-button"  >&#10094;</a></div>\
            <div id= "easychat-card-right-button-div" class="next-image-video-card" onclick="card_move_forward(this)"style="width:30px;height:30px;background-color:#fff;border-radius:50%;"><a id="easychat-card-right-button"  >&#10095;</a></div><div id="easychat-cards-slideshow-container" class="slideshow-container"  value=1 >';
        
        for (var i = 0; i < cards.length; i++) {
            current_image_no = i + 1;
            if (i == 0) {
                // cards_html += '<div onclick="'
                // cards_html += "window.open('" + cards[i]["link"] + "');"
                cards_html += '<div onclick="'
                cards_html += "window.open('" + cards[i]["link"] + "');"
                if (cards[i]["img_url"] != "" && cards[i]["img_url"] != undefined) {
                    cards_html += '"  class="mySlides fade easychat-slider-card">'
                } else {
                    cards_html += '"  class="mySlides fade easychat-slider-card" style = "box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.1);">'
                }
            } else {
                // cards_html += '<div onclick="'
                // cards_html += "window.open('" + cards[i]["link"] + "');"
                cards_html += '<div onclick="'
                cards_html += "window.open('" + cards[i]["link"] + "');"
                if (cards[i]["img_url"] != "" && cards[i]["img_url"] != undefined) {
                    cards_html += '"  class="mySlides fade easychat-slider-card" style="display: none;">';
                } else {
                    cards_html += '"  class="mySlides fade easychat-slider-card" style="display: none; box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.1);">';
                }
            }
            if (cards.length != 1) {
                // cards_html += '<div class="pageno-co">' + current_image_no + ' / ' + total_images + '</div>'

                if (cards[i]["img_url"] != "" && cards[i]["img_url"] != undefined) {
                    cards_html += '<img src="' + cards[i]["img_url"] + '"><div>'
                } else {
                    cards_html += '<div class = "card-background">\
                    <svg width="78" height="69" viewBox="0 0 78 69" fill="none" xmlns="http://www.w3.org/2000/svg">\
                    <path d="M72.9762 0H4.86508C3.57478 0 2.33733 0.512569 1.42495 1.42495C0.512569 2.33733 0 3.57478 0 4.86508V63.246C0 64.5363 0.512569 65.7738 1.42495 66.6862C2.33733 67.5985 3.57478 68.1111 4.86508 68.1111H72.9762C74.2665 68.1111 75.5039 67.5985 76.4163 66.6862C77.3287 65.7738 77.8413 64.5363 77.8413 63.246V4.86508C77.8413 3.57478 77.3287 2.33733 76.4163 1.42495C75.5039 0.512569 74.2665 0 72.9762 0V0ZM4.86508 63.246V4.86508H72.9762V63.246H4.86508Z" fill="black" fill-opacity="0.05"/>\
                    <path d="M16.8333 24.3255C18.2766 24.3255 19.6875 23.8975 20.8876 23.0956C22.0877 22.2937 23.023 21.154 23.5754 19.8205C24.1277 18.4871 24.2722 17.0198 23.9907 15.6042C23.7091 14.1886 23.0141 12.8882 21.9935 11.8677C20.9729 10.8471 19.6726 10.152 18.257 9.87045C16.8414 9.58887 15.3741 9.73339 14.0406 10.2857C12.7071 10.8381 11.5674 11.7734 10.7655 12.9735C9.96364 14.1736 9.53564 15.5845 9.53564 17.0278C9.53564 18.9633 10.3045 20.8195 11.6731 22.188C13.0416 23.5566 14.8978 24.3255 16.8333 24.3255V24.3255ZM16.8333 13.1358C17.6041 13.131 18.3589 13.3551 19.0022 13.7799C19.6454 14.2046 20.148 14.8107 20.4464 15.5215C20.7447 16.2322 20.8252 17.0155 20.6778 17.7721C20.5304 18.5287 20.1616 19.2245 19.6183 19.7712C19.075 20.318 18.3815 20.6911 17.6259 20.8432C16.8702 20.9954 16.0864 20.9198 15.3738 20.6259C14.6612 20.3321 14.0519 19.8332 13.6232 19.1927C13.1944 18.5521 12.9655 17.7987 12.9655 17.0278C12.9719 16.004 13.3814 15.024 14.1054 14.3C14.8294 13.576 15.8094 13.1665 16.8333 13.1601V13.1358Z" fill="black" fill-opacity="0.05"/>\
                    <path d="M50.5483 27.658L37.4126 40.7938L27.6824 31.0636C27.2266 30.6105 26.6101 30.3562 25.9675 30.3562C25.3248 30.3562 24.7083 30.6105 24.2525 31.0636L9.53564 45.9751V52.8592L26.0526 36.3422L34.0556 44.2236L24.9336 53.3457H31.6231L52.1781 32.7907L68.1112 48.6509V41.7911L53.9782 27.658C53.5224 27.205 52.9059 26.9507 52.2632 26.9507C51.6206 26.9507 51.004 27.205 50.5483 27.658Z" fill="black" fill-opacity="0.05"/>\
                    </svg>\
                    </div><div>'
                }
                cards_html += '<div class="tooltip" style="min-height:70px;max-height:70px;word-break:break-word;">'
                if (cards[i]["title"].length > 18) {
                    var cards_title = cards[i]["title"].slice(0, 18) + " ..."
                    cards_html += '<div class="easychat-single-card-heading">' + cards_title + '</div>'
                } else {
                    cards_html += '<div class="easychat-single-card-heading">' + cards[i]["title"] + '</div>'
                }
                if (cards[i]["content"].length > 0) {

                    if (cards[i]["content"].length > 48) {
                        cards_html += '<p class="tooltip" style = " padding: 0px 16px 8px 16px; margin: 0;">' + (cards[i]["content"].slice(0, 45) + " . . . ") + '</p><span class="tooltiptext" id="tooltiptext-card-content">' + cards[i]["content"].slice(0, 48) + '...</span>'
                    } else {
                        cards_html += '<p style = " padding: 0px 16px 8px 16px; margin: 0;" class="tooltip">' + cards[i]["content"] + '</p>'
                    }
                }
                cards_html += '</div><div style ="text-align: center; cursor: pointer;" ><h5 class="easychat-card-view-more" onclick='
                cards_html += "window.open('" + cards[i]["link"] + "');"
                cards_html += ' style = "padding: 10px; margin: 0;color: ' + BOT_THEME_COLOR + ';">' + CARDS_TEXT + '</h5></div>'

                cards_html += '</div></div>';
            } else {


                if (cards[i]["img_url"] != "" && cards[i]["img_url"] != undefined) {
                    cards_html += '<img src="' + cards[i]["img_url"] + '"><div>'
                } else {
                    cards_html += '<div class = "card-background">\
                    <svg width="78" height="69" viewBox="0 0 78 69" fill="none" xmlns="http://www.w3.org/2000/svg">\
                    <path d="M72.9762 0H4.86508C3.57478 0 2.33733 0.512569 1.42495 1.42495C0.512569 2.33733 0 3.57478 0 4.86508V63.246C0 64.5363 0.512569 65.7738 1.42495 66.6862C2.33733 67.5985 3.57478 68.1111 4.86508 68.1111H72.9762C74.2665 68.1111 75.5039 67.5985 76.4163 66.6862C77.3287 65.7738 77.8413 64.5363 77.8413 63.246V4.86508C77.8413 3.57478 77.3287 2.33733 76.4163 1.42495C75.5039 0.512569 74.2665 0 72.9762 0V0ZM4.86508 63.246V4.86508H72.9762V63.246H4.86508Z" fill="black" fill-opacity="0.05"/>\
                    <path d="M16.8333 24.3255C18.2766 24.3255 19.6875 23.8975 20.8876 23.0956C22.0877 22.2937 23.023 21.154 23.5754 19.8205C24.1277 18.4871 24.2722 17.0198 23.9907 15.6042C23.7091 14.1886 23.0141 12.8882 21.9935 11.8677C20.9729 10.8471 19.6726 10.152 18.257 9.87045C16.8414 9.58887 15.3741 9.73339 14.0406 10.2857C12.7071 10.8381 11.5674 11.7734 10.7655 12.9735C9.96364 14.1736 9.53564 15.5845 9.53564 17.0278C9.53564 18.9633 10.3045 20.8195 11.6731 22.188C13.0416 23.5566 14.8978 24.3255 16.8333 24.3255V24.3255ZM16.8333 13.1358C17.6041 13.131 18.3589 13.3551 19.0022 13.7799C19.6454 14.2046 20.148 14.8107 20.4464 15.5215C20.7447 16.2322 20.8252 17.0155 20.6778 17.7721C20.5304 18.5287 20.1616 19.2245 19.6183 19.7712C19.075 20.318 18.3815 20.6911 17.6259 20.8432C16.8702 20.9954 16.0864 20.9198 15.3738 20.6259C14.6612 20.3321 14.0519 19.8332 13.6232 19.1927C13.1944 18.5521 12.9655 17.7987 12.9655 17.0278C12.9719 16.004 13.3814 15.024 14.1054 14.3C14.8294 13.576 15.8094 13.1665 16.8333 13.1601V13.1358Z" fill="black" fill-opacity="0.05"/>\
                    <path d="M50.5483 27.658L37.4126 40.7938L27.6824 31.0636C27.2266 30.6105 26.6101 30.3562 25.9675 30.3562C25.3248 30.3562 24.7083 30.6105 24.2525 31.0636L9.53564 45.9751V52.8592L26.0526 36.3422L34.0556 44.2236L24.9336 53.3457H31.6231L52.1781 32.7907L68.1112 48.6509V41.7911L53.9782 27.658C53.5224 27.205 52.9059 26.9507 52.2632 26.9507C51.6206 26.9507 51.004 27.205 50.5483 27.658Z" fill="black" fill-opacity="0.05"/>\
                    </svg>\
                    </div><div>'
                }

                cards_html += '<div class="easychat-single-card-heading">' + cards[i]["title"] + '</div>';

                if (cards[i]["content"].length > 0) {
                    cards_html += '<p style="overflow-wrap: break-word; padding: 0px 16px 8px 16px; margin: 0;">' + cards[i]["content"] + '</p>';
                }
                cards_html += '<div style ="text-align: center; cursor: pointer;" ><h5 class="easychat-card-view-more" onclick='
                cards_html += "window.open('" + cards[i]["link"] + "');"
                cards_html += ' style = "padding: 10px; margin: 0;color: ' + BOT_THEME_COLOR + '; ">' + CARDS_TEXT + '</h5></div>'

            }
        }
        if (cards.length != 1) {

            cards_html += '</div><script>showSlides(1,this);</script><br><div style="text-align:center"></div>';
        }
        cards_html += '</div>';
        cards_html += '</div></div>'
    }
   else {
        var cards_html = '<div class="easychat-card-slider-wrapper"><div>'
        if (cards[0]["content"] == "" && (cards[0]["img_url"] == "" || cards[0]["img_url"] == undefined)) {
            for (var i = 0; i < cards.length; i++) {
                cards_html += '<a href="' + cards[i]["link"] + '" target="_blank" style="color:black;"><div class="easychat-card">\
                <div class="container" onmouseover="custom_button_change_card(this)" onmouseout="custom_button_change_normal_card(this)">\
                    <b>' + cards[i]["title"] + '</b>\
                </div>\
                </div></a>';
            }
        } else if (cards[0]["img_url"] == "" || cards[0]["img_url"] == undefined) {
            cards_html = '<div style="color:' + BOT_THEME_COLOR + ';" class="easychat-slides-wrapper"><div class="slideshow-container"  value=1 >';
            total_images = cards.length;

            for (var i = 0; i < cards.length; i++) {
                current_image_no = i + 1;

                if (i == 0) {
                    cards_html += '<div onclick="'
                    cards_html += "window.open('" + cards[i]["link"] + "');"
                    cards_html += '"  class="mySlides fade easychat-slider-card" styles="border: 2px solid ' + BOT_THEME_COLOR + ';">'
                } else {
                    cards_html += '<div onclick="'
                    cards_html += "window.open('" + cards[i]["link"] + "');"
                    cards_html += '"  class="mySlides fade easychat-slider-card" style="display: none; border: 2px solid ' + BOT_THEME_COLOR + ';">'
                }

                if (cards.length != 1) {
                    cards_html += '<div class="pageno-co">' + current_image_no + ' / ' + total_images + '</div>'
                    if (cards[i]["title"].length > 25) {
                        var cards_title = cards[i]["title"].slice(0, 25) + " ..."
                        cards_html += '<h5>' + cards_title + '</h5>'
                    } else {
                        cards_html += '<h5>' + cards[i]["title"] + '</h5>'
                    }
                    if (cards[i]["content"].length > 300) {
                        cards_html += '<p>' + (cards[i]["content"].slice(0, 300) + " ... ") + '</p></div>'
                    } else {
                        cards_html += '<p>' + cards[i]["content"] + '</p></div>'
                    }


                } else {
                    cards_html += '<h5 style="overflow-wrap: break-word">' + cards[i]["title"] + '</h5>';
                    cards_html += '<p style="overflow-wrap: break-word">' + cards[i]["content"] + '</p></div>';
                }
            }
            if (cards.length != 1) {
                cards_html += '<a class="prev-image-video" onclick="plusImageSlides(-1,this)">&#10094;</a>\
                <a class="next-image-video" onclick="plusImageSlides(1,this)">&#10095;</a>\
                </div><script>showSlides(1,this);</script><br><div style="text-align:center"></div>';
            }
            cards_html += '</div>';
        } else {
            cards_html = '<div style="color:' + BOT_THEME_COLOR + ';" class="easychat-slides-wrapper" ><div class="slideshow-container"  value=1 >';
            total_images = cards.length;

            for (var i = 0; i < cards.length; i++) {
                current_image_no = i + 1;
                if (i == 0) {
                    cards_html += '<div onclick="'
                    cards_html += "window.open('" + cards[i]["link"] + "');"
                    cards_html += '"  class="mySlides fade easychat-slider-card" style="border: 2px solid ' + BOT_THEME_COLOR + ';" >'
                } else {
                    cards_html += '<div onclick="'
                    cards_html += "window.open('" + cards[i]["link"] + "');"
                    cards_html += '"  class="mySlides fade easychat-slider-card" style="display: none; border: 2px solid ' + BOT_THEME_COLOR + ';">'
                }
                if (cards.length != 1) {
                    cards_html += '<div class="pageno-co">' + current_image_no + ' / ' + total_images + '</div>'
                    if (cards[i]["title"].length > 25) {
                        var cards_title = cards[i]["title"].slice(0, 25) + " ..."
                        cards_html += '<h5>' + cards_title + '</h5>'
                    } else {
                        cards_html += '<h5>' + cards[i]["title"] + '</h5>'
                    }
                    if (cards[i]["content"].length > 300) {
                        cards_html += '<p>' + (cards[i]["content"].slice(0, 300) + " ... ") + '</p>'
                    } else {
                        cards_html += '<p>' + cards[i]["content"] + '</p>'
                    }
                    cards_html += '<img src="' + cards[i]["img_url"] + '"> </div>'
                } else {
                    cards_html += '<h5 style="overflow-wrap: break-word">' + cards[i]["title"] + '</h5>';
                    cards_html += '<p style="overflow-wrap: break-word">' + cards[i]["content"] + '</p>';
                    cards_html += '<img src="' + cards[i]["img_url"] + '"> </div>'
                }
            }
            if (cards.length != 1) {
                cards_html += '<a class="prev-image-video" onclick="plusImageSlides(-1,this)">&#10094;</a>\
            <a class="next-image-video" onclick="plusImageSlides(1,this)">&#10095;</a>\
            </div><script>showSlides(1,this);</script><br><div style="text-align:center"></div>';
            }
            cards_html += '</div>';
        }
        cards_html += '</div></div>'
    }
    if(append_in_faq) {
        $("#faq_media_response").append(cards_html)
    } else {
        $("#easychat-chat-container").append(cards_html)
    }

    if (cards.length == 1 && (EASYCHAT_BOT_THEME == "theme_1" || EASYCHAT_BOT_THEME == "theme_2" || EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4")) {

        //setTimeout(function () {

        prev_image_video = document.querySelectorAll(".prev-image-video-card")
        prev_image_video[prev_image_video.length - 1].style.display = "none";

        next_image_video = document.querySelectorAll(".next-image-video-card")
        next_image_video[next_image_video.length - 1].style.display = "none";

        if(EASYCHAT_BOT_THEME == 'theme_4') {
            $('.easychat-slider-card:last').attr('style', 'width: 80% !important')
        }

        feedback_wrapper = document.querySelectorAll(".easychat-feedback-wrapper")
        if (feedback_wrapper.length != 0) {
            feedback_wrapper[feedback_wrapper.length - 1].style.width = "60%";
        }

        //}, 300);

    } else if (cards.length != 1 && (EASYCHAT_BOT_THEME == "theme_1" || EASYCHAT_BOT_THEME == "theme_2" || EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4")) {
        slide_show_container = document.querySelectorAll(".slideshow-container")
        slide_show_container = slide_show_container[slide_show_container.length - 1]
        update_card_status(slide_show_container)
    }
    try {
        element_response = document.querySelectorAll(".easychat-card-slider-wrapper")
        element_response_previous_height += element_response[element_response.length - 1].clientHeight
    } catch (err) {
        element_response = document.querySelectorAll(".easychat-slides-wrapper")
        element_response_previous_height += element_response[element_response.length - 1].clientHeight

    }
    resize_chabot_window();
}

function append_pdf_search_bot_slider_cards(cards) {

    function escapeHTML(text) {
        var fn = function (tag) {
            var charsToReplace = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&#34;'
            };
            return charsToReplace[tag] || tag;
        }
        return text.replace(/[&<>"]/g, fn);
    }

    function get_saturated_text(text, text_pattern) {
        try {
            text = escapeHTML(text);
            var pattern = "(" + text_pattern + ")";
            var regex_obj = new RegExp(pattern, 'gi');

            var replaced_pattern = "<b>$1</b>";
            text = text.replace(regex_obj, replaced_pattern);
            return text;

        } catch (err) {
            return text;
        }
    }

    var cards_html = "";
    if (EASYCHAT_BOT_THEME == "theme_1" || EASYCHAT_BOT_THEME == "theme_2" || EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        
        total_images = cards.length;
        let first_card_style = ""
        if(total_images == 1) {
            first_card_style = 'easychat-slider-first-card'
        }
           let pdf_svg = '<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\
                            <rect width="40" height="40" fill="url(#pattern0)"/>\
                            <defs>\
                            <pattern id="pattern0" patternContentUnits="objectBoundingBox" width="1" height="1">\
                            <use xlink:href="#image0_683_33306" transform="scale(0.00444444)"/>\
                            </pattern>\
                            <image id="image0_683_33306" width="225" height="225" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAmVBMVEWzCwD////19fWyAACvAAD3+vr5///07u33+/verqu4Kye1GhazAADhtrS6KiTXmpfv3t3BSEO/UE7s1dP78O/ly8v25OP99/bgq6m2FAz88/LFV1Puzs3qxMLv0dDfpqTThYLIY2C7NTHXjYrOdHG/Qz+5IxzYk5DQe3jy6OfYnpzMbGm7KyXnxcS5HhW4FQm9OzfGXVm/UVDPdotwAAAJwElEQVR4nO2da3eiOhSG0R3wUlRUCtZ616LW6tjz/3/cgSTATgjqtOMtK++3jp01PCbZ9zCWZWRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZPRAAiBUAPd+kiuJWPPWZDIZteZvREdGgJlf4RpOI3Lv5/nngkO/gjTc6YYIL35F1FIzRBJUZOmFSDoFwErlXSNzA29DBWGgESFZcqiWRb5GOu5T4Ha0FftBIF5K6Lu6rCIsOFKUEME8W8SVNoQ7BjSmuxLc7FCOdNmmZMCAZmzJyCRbRF3WkIwZzxcn3GeE35ogpovG92S6pLE+NdmmPKAJU8JpRjjWhZDFpNsioa8X4SQlzM9h6N73yf6VZMI8qqkc9DA1EiHk3qLS1IowPXRuoB+hh20pHCr6EY6wP8yiVJ0Ix9ispFGqVoTcAbKknnwiwj96EMKK4azpNk1XVCd/CF3GM2CEqOoWahLTQDOkPB7lcdEm7WtCmHpAuidRiq9P5J1Foj2QCotTbQh5rS0prqEMX6NqG3wzoH0M5OLSaVcPZ5EXn/w/AO8IsKKJs7DyrfkOWXGYEuuySWPCdWpZhGO414cwjbYDcsBdNm1MqZUHMu0ePoZzXQyNlVcQOzjs1iWzoEpD0wD3ugN9TGksKDaB9YnZqFCRNNNGK0L4KBJqE9Ewkb4M6OsFaJGZTNjSapPGckOJcKbZGuKmGtObboQQiYCBbpvUAksk1CkoZZLnoj5026TyaJtGuSFXGpmm0itkSySHbTplTkzuVgAcRroRpuW2THqF3bFISyIMtRnbY4JCzMb7NNoobbBhHbVaRKGIyKVN4ymRMJ2QSZuuhVUyyV4JNaq1wVZFmM0QPb+ErijWTBdEPJwgSpMEA9qSM1xlPwd6+H2ho5ZgoaqUHn5fvvTUIfmdi4oOl9jkzLDyBfCV71sNkgzZziQ+Au1T7+mPYiGe2SVECPvpK8NphztVKN+c4fNuzys5nuF3LPDpfG5rI4yTJkqTJry278+MiCfzUzvDP8mPYvjEuSIcpSXMb+QB6gsr0wyguuXT/kSyq/BR7x7a+Z8PLYYC6MULb1QuPPR7GMAVAcVuBUEFuOBAQdq91Ww9bXle4AU+VeB5o8Zy03XJQ76JQRjqTvQiPCVumwabzng7LBSs8o3cn34/HiRY0hPLtXx18l+u8Ts8ltmVvb0wnBCfL/c4l9+1cE791SOtI1jS82euIqaD3nKsLm6cYzw+zjKSjfRwtB2T2MZjpzTtv0Crh0GUA7Z+4gvcj+Ve/eC5wnA4pHZ05Pm+wvo8SiRbXEISrVqK8S/8JbQ6m1VvEbncLcZyo+5qORb/2oOsIpFOoT/rlzsDrlHi9qRIhkYB7goPiD9GX6ewhBcpnJfYShI93PCtahxRLb8/RW6l4aqfHkdAlfAB1vCyJRxOBqskICPv+Qbe7tTLSPBfvH+XHM4v4XC87L6kQTVZoN8fHVSMQs3u/uZULpIW6SIxZQChTTyIiozCGt79IAKU0/mTZQ8UQTTZIFMbDhbSb4iXUe5MGB+rkczFFTS+o7IUgRyFIdTxHP8igIc/vOcrNYDAsuQMTtZNOJXMghSq+9MjYf4RSCS2ke/XtgKymCr9ejiZ/Tmf35G2tPj+eNM9Nj/m8izH4k62FEhPGVIP96vDZekrkF1xAxS/sjsNAQD5VkwkJE94/ItCC7iz80njXV72FvMVptW5/tJ5EXKOsXGHJQQyL+P7wbvnCFmpdwPT+PYrGJ+/MvdQ+VnVHsjHZ1lUNL19bZFYp1L2H760LPYrx0/FSo66N9+i4IpeLJRwfz42k6TB751WEHJjGg5Ha2XIelXJ5t1fu+IX3/ndV55QQnTsxUri9NtX2shBWDF/9ibdjvkn4xYA92piAFlhbxzO4sPzJfrn535NKbh4AcN1UpCW2mn38Fz/TqSLy4UD+oJnaY8+9wU1gsdiR0dqA6Ap2tGnfjMizuL9tEIGYmDzzCNPgO+iZeUx6VbF9iHKmj8UqqpkC2iRubhHe88MmBvRcVbflDu+P6iHwf08nyjU2ZxlUQZIh1A9Apw3JArdeXCtlzbTQVXtgMIF/qt9EfluDNEojHRL1G+r/n3YNQb7V6r956aLW7rwMvG2NaZtfz87ysW2l8CTdC1LBtmrD4eoWynfZf5W/uuk4dip6k7VW+fGCJo1u5oq/rT6+i0wui9OVZTtXYkwq4j5aHRStjIldw1IwxYesl6bZ8e4WZMAnDHeh0XCavVaa8gbXXiUiUhTpGUThzJhteqkBqlAGPNv0SS4ivA6JzEbVUNnEBbiq/P7Zf8yJ6zXHafOWZ0dCIRbz9vWHfahXcuzS05oO0jXubKRegq0TBCJpSO/9OWynHA9m686rfisJaq5iNBugeu+NHd7xoiOGiO0B8durusY07RDkn9/JBIzplBpRhFhLc7Uk8ZugyLWWZKcEiZvBIs//fAoopPV7xlh/MsAV3abruzuSE/63x1OXKPghOwrADKlFB5IhPRHq08/zPZpRngdLCROmL3HSugZlfsJ/suYMA4StnSffrC8RCC04E+tipFuR8gbZwHh6yC3FE4BSoT8R2ZrZMI4PaOmxeOhzO0I017slAZeO7k8fXrgVyKEZb2c0CJ0hR3ulG5ImKZIo9lmKldtwzPVTJlw55wipMe0Prs1oZzHYwXnHJS8Szun1hDeHfQntyMsvoglU+us/ZYJW3SVvksIF8mn9l4ivLazwJG3tEMvuGQv2VJmLtmPCsIDPYgeJrQH3R7Xf9e73Adt1dzkaHHB/pH8IV1C+1X2+Jk8GsZhQhy1lcaGvxe4hVZTeNloax7TxIY42tOYxtmoPD6VgjCXfUXCpNgtLGMwI5cZgDQu3ayWAyn0fCzC+FFh1wqSYCYMJuvehXw4t6jbPLewjzi3wISu4hwmyXGaQV+XMFlHt9ntdZt/dU+gkB/a1bRqrLA0zWrBlla3/Uyt6xes/t5kS4S208/mRhSEPaU/vL63+I04Ia/T1PDovSKmWSeWqL6+ucf/jTghrbV1VsLsmoKQ5k9O99ZR26/EvYWlqJcWCKHNDh7/8bkIVUWAYvbE4oG0BakfIZmzI5t2P7QjJN0a9hW6EQKQOauA25k30YgQwI3mryyAcfJ8RRfCau01jlZqvCJcR9PO2hDSaICHPA4edtaHMBPq2iTSjdB2tp/iGMBzEX6pCKNalr1XvfFK/k/mY8JE979LclqkkTylre4PNxcL1nZZtF1Fl9uNP18c327wlL/S4SNWyaT9uZbLw2ZMop7kMY2MjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjE7of3Y/mjIKuPIVAAAAAElFTkSuQmCC"/>\
                            </defs>\
                        </svg>'
        
        cards_html = [
            '<div id="easychat-card-slides-wrapper" style="color:' + BOT_THEME_COLOR + '; " class="easychat-slides-wrapper ' + first_card_style + ' ">',
            '<div class="prev-image-video-card" onclick="card_move_backward(this)" style="width:30px;height:30px;background-color:#fff;border-radius:50%;">',
            '<a id="easychat-card-left-button">&#10094;</a>',
            '</div>',
            '<div class="next-image-video-card" onclick="card_move_forward(this)"style="width:30px;height:30px;background-color:#fff;border-radius:50%;">',
            '<a id="easychat-card-right-button">&#10095;</a>',
            '</div>',
            '<div id="easychat-cards-slideshow-container" class="slideshow-container" value=1>',
        ].join('');

        for (var i = 0; i < cards.length; i++) {
            current_image_no = i + 1;
            if (i == 0) {
                cards_html += '<div class="mySlides fade easychat-slider-card easychat-pdf-search-card" style = "box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.1);">'
            } else {
                cards_html += '<div class="mySlides fade easychat-slider-card easychat-pdf-search-card" style="display: none; box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.1);">';
            }

            cards_html += [
                '<div class="easychat-pdf-searcher-header-wrapper" style="overflow-wrap: break-word; padding: 16px 24px; margin: 0; display: flex; justify-content: space-between;">',
                '<div style="display: flex; gap: 0.5em;" class="easychat-pdf-searcher-header-div">',
                pdf_svg,
                '<span>' + cards[i]["title"] + '</span>',
                '</div>',
                '<div class="easychat-pdf-searcher-page-div">',
                '<span>Page : </span>',
                '<span>' + cards[i]["page_number"] + '</span>',
                '</div>',
                '</div>'
            ].join('');

            if (cards[i]["content"].length > 0) {
                var text_content = cards[i]["content"];
                var text_pattern = cards[i]["pattern"];
                if (text_content.length > 135) {
                    text_content = cards[i]["content"].slice(0, 135) + "...";
                }

                text_content = get_saturated_text(text_content, text_pattern);

                cards_html += '<p class="pdf-search-card-desc-div" style="overflow-wrap: break-word; padding:0px 16px; margin: 0; line-height: 20px; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; max-height: 64px;">' + text_content + '</p>';
            }
            cards_html += [
                '<div style ="text-align: center; cursor: pointer;">',
                '<div class="pdf-search-card-doc-open-btn" onclick="' + "window.open('" + cards[i]["link"] + "');" + '" style="padding:11px 15px; margin: 0;color: ' + BOT_THEME_COLOR + '; background-color: #FAFAFA;">',
                PDF_SEARCH_CARDS_TEXT,
                '</div>',
                '</div>',
                '</div>'
            ].join('');
        }

        if (cards.length != 1) {
            cards_html += '</div><script>showSlides(1,this);</script><br><div style="text-align:center"></div>';
        } else {
            cards_html += '</div>';
        }
        cards_html += '</div>';

    }  else {
        var cards_html = [
            '<div class="easychat-card-slider-wrapper">',
            '<div>',
            '<div style="color:' + BOT_THEME_COLOR + '; overflow: hidden;" class="easychat-slides-wrapper">',
            '<div class="slideshow-container"  value=1 >'
        ].join('');

        total_images = cards.length;

        for (var i = 0; i < cards.length; i++) {
            current_image_no = i + 1;

            if (i == 0) {
                cards_html += '<div onclick="'
                cards_html += "window.open('" + cards[i]["link"] + "');"
                cards_html += '"  class="mySlides fade easychat-slider-card easychat-pdf-search-card" style="border: 2px solid ' + BOT_THEME_COLOR + ';">'
            } else {
                cards_html += '<div onclick="'
                cards_html += "window.open('" + cards[i]["link"] + "');"
                cards_html += '"  class="mySlides fade easychat-slider-card easychat-pdf-search-card" style="display: none; border: 2px solid ' + BOT_THEME_COLOR + ';">'
            }

            if (cards.length != 1) {
                cards_html += '<div class="pageno-co">' + current_image_no + ' / ' + total_images + '</div>'

                cards_html += [
                    '<div style="overflow-wrap: break-word; padding: 15px; margin: 0; display: flex; justify-content: space-between; border-bottom: 1px solid #E6E6E6">',
                    '<div style="display: flex; gap: 0.5em;">',
                    '<svg width="13" height="14" viewBox="0 0 13 14" fill="none" xmlns="http://www.w3.org/2000/svg">',
                    '<path d="M11.8076 7.96217H10.8848V2.62453C10.8848 2.48643 10.8258 2.35405 10.7205 2.25649L8.49471 0.189521C8.38946 0.0919995 8.24709 0.0372009 8.09836 0.0372009H1.39986C0.792976 0.0372009 0.299316 0.495634 0.299316 1.05917V12.0152C0.299316 12.5788 0.793014 13.0372 1.39986 13.0372H9.78417C10.391 13.0372 10.8847 12.5787 10.8847 12.0152V10.9604H11.8075C12.2872 10.9604 12.676 10.5993 12.676 10.1539V8.7686C12.6761 8.32326 12.2872 7.96217 11.8076 7.96217ZM9.68958 11.8993H1.49445V1.17509H7.31977V2.70481C7.31977 3.07534 7.64315 3.37556 8.04204 3.37556H9.68958V7.96217H6.88527C6.4056 7.96217 6.01678 8.32326 6.01678 8.76864V10.1539C6.01678 10.5993 6.4056 10.9604 6.88527 10.9604H9.68958V11.8993ZM8.50458 9.1828C8.50458 9.54933 8.23148 9.77705 7.79195 9.77705H7.50021V10.0922C7.50021 10.1735 7.42925 10.2395 7.34162 10.2395H7.30015C7.21248 10.2395 7.14148 10.1735 7.14148 10.0922V8.74536C7.14148 8.66406 7.21248 8.59803 7.30015 8.59803H7.79195C8.23151 8.59799 8.50458 8.82203 8.50458 9.1828ZM9.40415 10.2395H8.83349C8.74582 10.2395 8.67482 10.1735 8.67482 10.0922V8.74536C8.67482 8.66406 8.74578 8.59803 8.83349 8.59803H9.40415C9.90122 8.59803 10.3056 8.96663 10.3056 9.41979C10.3056 9.8718 9.90125 10.2395 9.40415 10.2395ZM11.6781 8.78377C11.6781 8.86521 11.6071 8.9311 11.5195 8.9311H10.8751V9.28401H11.424C11.5116 9.28401 11.5827 9.34983 11.5827 9.43127V9.46985C11.5827 9.55116 11.5116 9.61719 11.424 9.61719H10.8751V10.0922C10.8751 10.1735 10.8041 10.2395 10.7164 10.2395H10.675C10.5873 10.2395 10.5163 10.1735 10.5163 10.0922V8.74533C10.5163 8.66402 10.5873 8.59799 10.675 8.59799H11.5195C11.6071 8.59799 11.6781 8.66402 11.6781 8.74533V8.78377Z" fill="#020202"/>',
                    '</svg>',
                    '<span>' + cards[i]["title"] + '</span>',
                    '</div>',
                    '<div>',
                    '<span>Page : </span>',
                    '<span>' + cards[i]["page_number"] + '</span>',
                    '</div>',
                    '</div>'
                ].join('');

                if (cards[i]["content"].length > 0) {
                    var text_content = cards[i]["content"];
                    var text_pattern = cards[i]["pattern"];
                    if (text_content.length > 300) {
                        text_content = cards[i]["content"].slice(0, 300) + "...";
                    }

                    text_content = get_saturated_text(text_content, text_pattern);

                    cards_html += '<p style = "padding: 15px; margin: 0; line-height: 20px; overflow-wrap: break-word;">' + text_content + '</p>'
                }
            } else {
                cards_html += [
                    '<div style="overflow-wrap: break-word; padding: 15px; margin: 0; display: flex; justify-content: space-between; border-bottom: 1px solid #E6E6E6">',
                    '<div style="display: flex; gap: 0.5em;">',
                    '<svg width="13" height="14" viewBox="0 0 13 14" fill="none" xmlns="http://www.w3.org/2000/svg">',
                    '<path d="M11.8076 7.96217H10.8848V2.62453C10.8848 2.48643 10.8258 2.35405 10.7205 2.25649L8.49471 0.189521C8.38946 0.0919995 8.24709 0.0372009 8.09836 0.0372009H1.39986C0.792976 0.0372009 0.299316 0.495634 0.299316 1.05917V12.0152C0.299316 12.5788 0.793014 13.0372 1.39986 13.0372H9.78417C10.391 13.0372 10.8847 12.5787 10.8847 12.0152V10.9604H11.8075C12.2872 10.9604 12.676 10.5993 12.676 10.1539V8.7686C12.6761 8.32326 12.2872 7.96217 11.8076 7.96217ZM9.68958 11.8993H1.49445V1.17509H7.31977V2.70481C7.31977 3.07534 7.64315 3.37556 8.04204 3.37556H9.68958V7.96217H6.88527C6.4056 7.96217 6.01678 8.32326 6.01678 8.76864V10.1539C6.01678 10.5993 6.4056 10.9604 6.88527 10.9604H9.68958V11.8993ZM8.50458 9.1828C8.50458 9.54933 8.23148 9.77705 7.79195 9.77705H7.50021V10.0922C7.50021 10.1735 7.42925 10.2395 7.34162 10.2395H7.30015C7.21248 10.2395 7.14148 10.1735 7.14148 10.0922V8.74536C7.14148 8.66406 7.21248 8.59803 7.30015 8.59803H7.79195C8.23151 8.59799 8.50458 8.82203 8.50458 9.1828ZM9.40415 10.2395H8.83349C8.74582 10.2395 8.67482 10.1735 8.67482 10.0922V8.74536C8.67482 8.66406 8.74578 8.59803 8.83349 8.59803H9.40415C9.90122 8.59803 10.3056 8.96663 10.3056 9.41979C10.3056 9.8718 9.90125 10.2395 9.40415 10.2395ZM11.6781 8.78377C11.6781 8.86521 11.6071 8.9311 11.5195 8.9311H10.8751V9.28401H11.424C11.5116 9.28401 11.5827 9.34983 11.5827 9.43127V9.46985C11.5827 9.55116 11.5116 9.61719 11.424 9.61719H10.8751V10.0922C10.8751 10.1735 10.8041 10.2395 10.7164 10.2395H10.675C10.5873 10.2395 10.5163 10.1735 10.5163 10.0922V8.74533C10.5163 8.66402 10.5873 8.59799 10.675 8.59799H11.5195C11.6071 8.59799 11.6781 8.66402 11.6781 8.74533V8.78377Z" fill="#020202"/>',
                    '</svg>',
                    '<span>' + cards[i]["title"] + '</span>',
                    '</div>',
                    '<div>',
                    '<span>Page : </span>',
                    '<span>' + cards[i]["page_number"] + '</span>',
                    '</div>',
                    '</div>'
                ].join('');

                if (cards[i]["content"].length > 0) {
                    var text_content = cards[i]["content"];
                    var text_pattern = cards[i]["pattern"];
                    if (text_content.length > 300) {
                        text_content = cards[i]["content"].slice(0, 300) + "...";
                    }

                    text_content = get_saturated_text(text_content, text_pattern);

                    cards_html += '<p style = "padding: 15px; margin: 0; line-height: 20px; overflow-wrap: break-word;">' + text_content + '</p>';
                }
            }
            cards_html += "</div>";
        }
        if (cards.length != 1) {
            cards_html += '<a class="prev-image-video" onclick="plusImageSlides(-1,this)" style="box-shadow: none!important;">&#10094;</a>\
            <a class="next-image-video" onclick="plusImageSlides(1,this)" style="box-shadow: none!important;">&#10095;</a>\
            </div><script>showSlides(1,this);</script><br><div style="text-align:center"></div>';
        } else {
            cards_html += "</div>";
        }
        cards_html += '</div>';
        cards_html += '</div></div>'
    }
    $("#easychat-chat-container").append(cards_html)

    if (cards.length == 1 && (EASYCHAT_BOT_THEME == "theme_1" ||EASYCHAT_BOT_THEME == "theme_2" || EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4")) {

        //setTimeout(function () {

        prev_image_video = document.querySelectorAll(".prev-image-video-card")
        prev_image_video[prev_image_video.length - 1].style.display = "none";

        next_image_video = document.querySelectorAll(".next-image-video-card")
        next_image_video[next_image_video.length - 1].style.display = "none";

        feedback_wrapper = document.querySelectorAll(".easychat-feedback-wrapper")
        if (feedback_wrapper.length != 0) {
            feedback_wrapper[feedback_wrapper.length - 1].style.width = "60%";
        }

        if(EASYCHAT_BOT_THEME == 'theme_4') {
            $('.easychat-pdf-search-card:last').attr('style', 'width: 81% !important');
        }
        
        //}, 300);

    } else if (cards.length != 1 && (EASYCHAT_BOT_THEME == "theme_1" || EASYCHAT_BOT_THEME == "theme_2" || EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4")) {
        slide_show_container = document.querySelectorAll(".slideshow-container")
        slide_show_container = slide_show_container[slide_show_container.length - 1]
        update_card_status(slide_show_container)
    }
    try {
        element_response = document.querySelectorAll(".easychat-card-slider-wrapper")
        element_response_previous_height += element_response[element_response.length - 1].clientHeight
    } catch (err) {
        element_response = document.querySelectorAll(".easychat-slides-wrapper")
        element_response_previous_height += element_response[element_response.length - 1].clientHeight

    }
    resize_chabot_window();
}


function append_google_search_result(cards) {
    cards_html = '<div style="color:' + BOT_THEME_COLOR + ';" class="easychat-slides-wrapper" ><div class="slideshow-container"  value=1 >';
    total_images = cards.length;

    for (var i = 0; i < cards.length; i++) {
        current_image_no = i + 1;
        if (i == 0) {
            cards_html += '<div onclick="'
            cards_html += "window.open('" + cards[i]["google_search_link"] + "');"
            cards_html += '"  class="mySlides fade easychat-slider-card" >'
        } else {
            cards_html += '<div onclick="'
            cards_html += "window.open('" + cards[i]["google_search_link"] + "');"
            cards_html += '"  class="mySlides fade easychat-slider-card" style="display: none;">'
        }
        if (cards.length != 1) {
            cards_html += '<div class="pageno-co">' + current_image_no + ' / ' + total_images + '</div>'
            if (cards[i]["google_search_title"].length > 25) {
                var cards_title = cards[i]["google_search_title"].slice(0, 25) + " ..."
                cards_html += '<h5>' + cards_title + '</h5>'
            } else {
                cards_html += '<h5>' + cards[i]["google_search_title"] + '</h5>'
            }
            if (cards[i]["google_search_descrptn"].length > 300) {
                cards_html += '<p>' + (cards[i]["google_search_descrptn"].slice(0, 300) + " ... ") + '</p></div>'
            } else {
                cards_html += '<p>' + cards[i]["google_search_descrptn"] + '</p></div>'
            }
        } else {
            cards_html += '<h5>' + cards[i]["google_search_title"] + '</h5><p>' + cards[i]["google_search_descrptn"] + '</p></div>';
        }
    }
    if (cards.length != 1) {
        cards_html += '<a class="prev-image-video" onclick="plusImageSlides(-1,this)">&#10094;</a>\
            <a class="next-image-video" onclick="plusImageSlides(1,this)">&#10095;</a>\
            </div><script>showSlides(1,this);</script><br><div style="text-align:center"></div>';
    }
    cards_html += '</div>';
    cards_html += '</div></div>'
    $("#easychat-chat-container").append(cards_html)

    element_response = document.querySelectorAll(".easychat-slides-wrapper")
    element_response_previous_height += element_response[element_response.length - 1].clientHeight

}

var inputDiv = ""
var previewImg = ""
var previewImgSubmitBtnDiv = ""
var outputImage = ""
var successfulMessage = ""

function get_attachment_succesful_submission_html() {
    html = '<div class="attachment-successful-text-wrapper"><div class="successful-submission-text" style="display:block;">\
                <svg width="19" height="18" viewBox="0 0 19 18" fill="none" xmlns="http://www.w3.org/2000/svg">\
                    <path d="M9.54961 1.80591C5.57521 1.80591 2.34961 5.03151 2.34961 9.00591C2.34961 12.9803 5.57521 16.2059 9.54961 16.2059C13.524 16.2059 16.7496 12.9803 16.7496 9.00591C16.7496 5.03151 13.524 1.80591 9.54961 1.80591ZM8.10961 12.6059L4.50961 9.00591L5.52481 7.99071L8.10961 10.5683L13.5744 5.10351L14.5896 6.12591L8.10961 12.6059Z" fill="#25B139"/>\
                </svg>\
                <span>'
        + FILE_UPLOADED_TEXT +
        '</span>\
            </div></div>'

    return html
}

function get_video_recorder_upload_successfull_html() {
    html = '<div class="attachment-successful-text-wrapper"><div class="successful-submission-text" style="display:block;">\
                <svg width="19" height="18" viewBox="0 0 19 18" fill="none" xmlns="http://www.w3.org/2000/svg">\
                    <path d="M9.54961 1.80591C5.57521 1.80591 2.34961 5.03151 2.34961 9.00591C2.34961 12.9803 5.57521 16.2059 9.54961 16.2059C13.524 16.2059 16.7496 12.9803 16.7496 9.00591C16.7496 5.03151 13.524 1.80591 9.54961 1.80591ZM8.10961 12.6059L4.50961 9.00591L5.52481 7.99071L8.10961 10.5683L13.5744 5.10351L14.5896 6.12591L8.10961 12.6059Z" fill="#25B139"/>\
                </svg>\
                <span>'
        + UPLOAD_VIDEO_TEXT +
        '</span>\
    </div></div>'

    return html
}

function append_attachment(choosen_file_type, is_flow_ended) {
    var drag_drop_cointainer_count = document.getElementsByClassName("easychat-dragdropContainer__XPS").length;
    var html = '<div class="easychat-dragdropContainer__XPS" id="easychat-dragdropContainer__XPS-' + drag_drop_cointainer_count + '">\
                 <div class="easychat-attachment-dragdrop-wrapper">\
                <span class="easychat-dragdropMsg__XPS" style="color:'+ BOT_THEME_COLOR + ';height:80%;flex-direction: column;">\
                    <svg width="48" height="48" viewBox="0 0 78 78" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\
                        <rect width="78" height="78" fill="url(#pattern0)"/>\
                        <defs>\
                        <pattern id="pattern0" patternContentUnits="objectBoundingBox" width="1" height="1">\
                        <use xlink:href="#image0" transform="scale(0.00195312)"/>\
                        </pattern>\
                        <image id="image0" width="512" height="512" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAACAASURBVHic7d1rkFxnfefx39Onu6fnKll32VZsXWxJlrls4uDFgC3J9tpJ1oQFQgi7IUC2sikW2M0LMMtShMAmRZZsKLLspWIo2HJIsWQrgMOaYCyNjcFeiEmBQdaMJFsGgdHV1mVGM9N9+jz74misizWjnpnT5znPeb6fqi4blzX9p7vdz3fO1QiltP+wXWVN+xVJYjcaYzZK9lpJKyX1n3ksdjshyiqxkqyUSLJWShIpPvNoJ1IrkVrt9O8vpmJsksjERpqSNUcT2UkjHZP0nGSOGdljidWhSsUcUDv5sWztmW1bzMEc/y8CpWBcD4Bs7N1rezTYvrNS0e2ydpuMrnM9EzCbdiJNxWcfzViy8/9xk5KekbTLGP3QJuZHkY2fOLS55+k3GdPOaGSgVAgAz+0/2PynSVR5qxL7mzJa4noeYL4SK0220sfp1sxbCObotJG+Z6XHJPNoqxo9dscGcziTnwx4jgDwkLXW7D/avsvKfkBWN7qeB8iclSZiabwpnZ5a0JaBFzNmnxINS/q6aUQ7tq01x7P88YAvCADPPH0kfq219j9JeonrWYA8JFY63ZTGptJdBRmLJX1H0tcTJV+5bVPPE5k/A1BQBIAnRo/aK6pJ/AlJv+F6FsCVqVg6MSlNNLv1DPYZydxnjP5m67XVbxtjMt34ABQJAVBw1lrz9JHWeyTzJ5L6XM8DFMFULJ2YkCZaXXwSY/ZJ9t4oqn72lg3mQBefCXCCACiwp56zixTH94jf+oGLaral50+nBw52USLpG1bmM1NRdN+vXmOmuvpsQE4IgILaf7j58sToy7LmKtezAEU31pSOn87szIHZHJXRX1bb1U/dfJ35edefDegiAqCA9h5pba1YfVnSItezAL5IrHR8QhqbzPisgYtrGukrSuyfb7uu/v+6/3RA9giAgtl3KP4Xxti/ltRwPQvgo6lYOjqWXnkwD0YatlZ/tH1z7eF8nhHIBgFQIE8diX9N1n5ZUtX1LIDPrJWOjqenD+bo2zL6w+0baztyfVZgngiAgth/sHljUjE7lF6nH0AGTk1Jz4/nskvgXDsTqw/etrn2WL5PC8wNAVAATx+Z3GiT6FEu5Qtkr9WWDp/Kb5fAGdZa+79la++/9Trz41yfGegQAeDY/v22kfTHj0l6uetZgLJqJ9LhsfSGQzlrSvqf7Vr1Q7evNydyf3ZgFhXXA4Su3d/+r2LxB7oqqkgrB6VGLfenrkt6T9SKR4ZH4zfn/uzALNgC4NDTh+M3Wtm/cT0HEApHBwe+wEhfk43fuW1z7zNuJgDOIgAcGTliB2s23i3pCtezACGxSg8MPOXuen7jMvrQ0Wurn3yTMW1nUyB47AJwpGbjj4jFH8idkbSkXxqoOxuhX1b/Zdlo/OjDT05e42wKBI8tAA7s/fnUlkpU+b443x9wx6YHBnb1hkKXdtrIfmDbpvonnU6BIBEADjx1qPl5GfMW13MAobNWOnjKydkB5zFWX1Kl+nvbNpqjbidBSAiAnO05NLkuMtGo+O0fKIS2lQ6elGL3e+N/ahL7G9xbAHnhGICcVVW9Wyz+QGFERloxIFXc/zp0pa2YR4ZHWne7HgRhcP+RD8jBg7Z/vBIflDTgehYA5xubko6Nu55imv3r1lTt9+54mSnMRCgftgDkaMy03yAWf6CQBnqkfndnBlzAvKXWE3/74X12jetJUF4EQI5Mxf626xkAzGxJv1SLXE/xgpe14/g7wyPNG1wPgnIiAHJy4IRdIqttrucAMLOKkZYNqEg7R1dbmeEdu+O7XA+C8iEActKcbG+VVJzfLQBcVD2ShnpcT3GeAWPsl4ZHm//W9SAoFwIgJ9bw2z/gi0W9UrViXY9xrsha86kdI62PuR4E5UEA5MQYSwAAnqgY6bK+4uwHmGaku3eOtP7UWlu84eAdAiAHu6yty2qj6zkAdK6vLvXmf/vgTrzvodH2f/+wtXx/Y0H4AOWg/lxzg7j4D+CdJX0q0gGBL7Cyv3/zaPseIgALwYcnB5U42uR6BgBzV42k/mJuBZBk3/GaPe3PEAGYLz44OTCy61zPAGB+FvUWciOAJMlY+zYiAPPFhyYHidFi1zMAmJ9alB4PUFREAOaLD0wODJf/Bbw21Ot6gtkRAZgPPiy5MIOuJwAwf/WosGcEvMBY+7abR9ufJgLQKT4oebBJwX9/AHApgw3XE3TCvp0tAegUHxIA6EBvNb1AUNGxOwCd4gMCAJ0wRbpd8OyIAHSCDwcAdKjfi90AKSIAl8IHAwA61BOlpwX6ggjAbPhQAMAcFPmaABfD2QGYCR8IAJiDhpd39eDsALwYHwYAmIOeWnEvDTwbdgfgQnwQAGAOjNII8BERgHPxIQCAOfJzN0CKCMA0H7dk5W541C6zNt5orNlgK0m/sWbQGi2ytrOAWj2ku3qquq7bcwLIx1QsHTzpeoqFscZ87pFro9/9sDGJ61ngBgFwgfv32p4eG9+otrYbo62Srpe0dCE/c1m/1N+TyXgACsBa6cDx9K8+IwLCRgBIevxxWzvR375Txr7VSL8mKdNr9xMAQPk8e0JqtV1PsXBEQLiCDoAHRuzlNcV/YKXfkbS8W89DAADlc3RcGp9yPUVWzGe/uTH610RAWIIMgIdHJta2Vbtbsm+T1PWlmQAAyuf4hHRiwvUU2WFLQHiCCoBHD9jeibH4bmP0fuWw8E8jAIDyGZ9KtwKUCREQlmBOAxneHf/zyfHWk8boD5Xj4g+gnCKP7gnQKS4bHJbSv8n377U9O0dan7TG3ieZqx2PA6AkqqXdfsplg0NR6jd4eNfkhkY7flTSexTY7g4A3VUp8TcKFwsKQ2nf3AdHm79so+gxSb/oehYA5VOpqNS/VhAB5VfKN3Z4T+u2ijU7JC1zPQuA8irlF+g5iIByK92bunN3/Hqb6H5Jg65nAQDfEQHlVao3dHh3a6uM/bwkT+/VBcAnpsS7AM5FBJRTad7MB0emXmqNviSp4XoWAGEIZP2XxCmCZVSKN/Lvd9klFZn7JC12PQsAlBenCJaJ92+itdbUo/izkrnK9SwAUHbsDigP79/A4dH4vZJe63oOAAgFEVAOXr95Dz85eY2kj7ieAwBCQwT4z+s3rl2J/kJc1x8AnCAC/ObtmzY8Gr9Z0p2u5wCAkBEB/vLyDfuitZGVPup6DgAApwj6yss3a/lo+7dk7QbXcwAAptm3EwF+8e6NstYaK3u36zkAABciAnzi3Zv00Gh8h6TrXc8BALgYIsAX3r1B1ti3up4BADAbIsAHXr059++1Q7Lm113PAQC4FCKg6Lx6Y3rj1usl9bmeAwDQCSKgyLx6UxLpDtczAADmgggoKm/eEGutMcZsdT0HAGCuiIAi8ubNGH6yeZ2kVa7nAADMBxFQNN68EaZqXul6BgDAQhABReLNm5DIbHI9AwBgoYiAovDpDdjoegAAQBaIgCLw5sU3Vte6ngEAkBUiwDWfXngOAASAUiECXPLiRbfWGkn9rucAAGSNCHDFixf8gSfUJylyPQcAoBuIABe8eLGjigZczwAA6CYiIG9evNBJjd/+AaD8iIA88SIDAAqECMgLLzAAoGCIgDzw4gIACogI6DZeWABAQREB3cSLCgAoMCKgW3hBAQAFRwR0Ay8mAMADREDWeCEBAJ4gArLEiwgA8AgRkBVeQACAZ4iALPDiAQA8ZN9+82j7HiJg/njhAGCejHE9QejsO9gSMH+8aAAwT3yBFgG7A+aLFwwA5oktAEVBBMwHLxYAzFOFb9AC4ZiAueKFAoB5qvINWjAcEzAXvEgAME/1yPUEeLF0S4C1lh00l0AAAMA8VQmAgrLvGB5tf8r1FEVHAADAPNUiSfyeWVD2nTtHWn/qeooiIwAAYJ4qRurhW7TI3rdjpPVB10MUFR9dAFiARt31BJiNkT66Y3fz3a7nKCICAAAWoFFzPQEuxRjziZ0j8Wtdz1E0BAAALEAjkiK+SYsukuwXdu5p3uh6kCLhYwsAC2GkPnYD+KBXifnSjiftVa4HKQoCAAAWaIAA8MVqVeK/G95lB1wPUgQEAAAsUL2aPlB8RnpJUmnd43qOIiAAACADixquJ0CnjDFv3jHS/Peu53CNAACADPTVz1wYCF4wMh/fsad1s+s5XCIAACAji3tdT4A5qJpEX3jwh3al60FcIQAAICN9da4L4JnVlVr8v0K9cRABAAAZWtLH7QE8c8fO0dbvux7CBQIAADJUi6QhdgV4xcj82c6RyY2u58gbAQAAGVvckHo4LdAnfVL0V48/boPagUMAAEDWjLR8IL1bILxxw8n++L2uh8gTAQAAXRBVpGUD4oAAnxh9cHjX5AbXY+SFAACALumtScs4KNAnvTaK7gnlrAACAAC6qL9HWtznegrMwdaHRtpvdT1EHggAAOiyoYZ0GRHgDWvsnz3yhL3M9RzdRgAAQA6GGtJSjgnwxbK4Hn/I9RDdRgAAQE4G6tKKAanCN2/hWemdD+6evNb1HN3ExxAActRbk1YPcp0AD9QrJvq46yG6iQAAgJxVI2nl4JlbCLNLoMheu2Oktd31EN1CAACAA8akZwesHmJrQJEZ6T+X9bRAAgAAHKpH0qohaWm/VOUbuYh+aXhP+1dcD9ENfNwAoAAGeqTLF6dXD6xFrqfBeaz9SBm3AhAAAFAQRlJ/XVq9SFo5lF5EyJRu2fHSLw3vbf+q6yGyRgAAQMEYSY2qtKxfuvLMVoGBBlsGnEps6a4LQAAAQIFVTLpVYGmfdPmiNAiWD6RXFhzoSUOhHqXHD1Qq4qyC7nnFjj2tm10PkSWOPQUAj0QVqa/ueor5sZKsldqJlJz5a9yW4iR9NNvpPyusRH8g6Zuux8gKAQAAyIVRekxDZZZdGYmVpuJzHq00HIrASK/dsXdy/a3XNJ5yPUsW2AUAACiMikmvlri4N71Y0pol6V8HG+nWD+fjJdV/53qIrLh/OQEAmIGR1KhJS/qkKxZLKwbTeypUXB3rYO3bvzViBx09e6YIAACAF4zSrQNLB86eHdHIf0f2QMu0fjP3Z+0CAgAA4B1z5uyIlUPplRR78zww0pp35PhsXUMAAAC81lNNb7O8elG6e6Dbewes9MoH905d1+Wn6ToCAABQCvUo3T2welF63EA3maTi/VYAAgAAUCq1M7dbXtbfvTMHjNW//KK1Xl+bkQAAAJRSf0969cShhrqxX2DV8pH4NZn/1BwRAACA0qqY9LLJqwelasa/r1uZN2b7E/NFAAAASq9elS4/c4fFzBj7Bp93AxAAAIAgGJMeF7BsILMLCa1aujd+VSY/yQECAAAQlOnrB1QzWAFNW69b+E9xgwAAAASnHqUXEKov/EqCd2QwjhMEAAAgSFFFWjWYXl543oyu+8Yu+wuZDZUjAgAAECxjpOUDUt8CLiVcjVq3ZzdRfggAAEDQjEkPDBxozO/PJzJ3ZjtRPvK/jxJQIhMt6ecnpWNj0qkpabIlWddDoZCqlfQ69Yv70gPQlvalCw+KwSi95bBNpPHmnP/sNmutMcZ49Z8/AQDMkbXSgePS6CHp0Kn0fwOdOCxJx9K/76tL65dJm1Z2/7r16IxReppgYtO4n4OlD+1pbpQ00pXBuoQAAObg0Cnpu89IxydcTwLfnW5KP3xWevKgtGW1dP3lUsQWAffOHBNw8JTUjDv/Y9aam+RZAHAMANABa6V//In0wG4Wf2SrnUhP/Ez6vz+STvDZKgRjpBVzvHSwVeWV3ZuoOwgA4BLiRNq5R9p10PUkKLMTE9L9T0rPnnA9CaR0a8yKOVwx0Fh7U3cnyh4BAMwiSaSH9/KljHzEbWl4b3pgKdyrRemNhDpitPn+vXaoqwNljAAAZvHYfhZ/5CtJpG/uk8amXE8CSRroSc/e6ICpx/GWLo+TKQIAmMHTx9IHkLdmLD3yFGeYFMWS/nRrwKVUZF/S/WmyQwAAFzEVS4//2PUUCNnRMWnPEddTQDp7oSBd6niASuX6PObJCgEAXMTug2kEAC498bP0IFS4V4+kRT2z/zvGWgIA8FnbSqOHXU8BpFeW3H/U9RSYtqg3vYHQTKzEMQCAz376/NwuAAJ001MEQGEYc8mzAlZ8a8QO5jTOghEAwAV+etz1BMBZR8fZHVUk/fXZbx/cbDe9uTUwAQBc4PAp1xMAZ1nLZ7JoLuub5XjAWnR1jqMsCAEAnKM9jzuBAd12ctL1BDhXLZL6Zjgg0Njk6lyHWQACADjHRItzr1E8RGnxLGrMsBXAmqvznWT+CADgHJxyhSJqtV1PgAvVIqn3IlcItNauyH+a+SEAAKDguEtwMS3qvdg/NUvznmO+CADgHFX+i0ABzeW2tMhPPZIaF54RUBEBAPior56e6wsUycAlrkAHdwYveG+sJQAAL1UMX7YonqGG6wkwk95a+r0xzYgAALy10pvreCEExkgrBlxPgZkY86JTAr15twgA4AJXLnY9AXDWikGpXnU9BWYzcP7ZAHVrrRc7EgkA4AJXLJJ6+MJFQazzZoNyuHqq5x9A/LV9usgJgsVDAAAXqFSkzStdTwGk+5fXLnM9BTrRd/6S78WRRAQAcBGbVs1+ww8gDy+/Uoq82JiMc08HXGa0yN0knSMAgIuoRdIvX+V6CoRs5aC0nt/+vdFTPXsKca3hx5kABAAwg6uWSNd4c1FPlElPVXr1eq5J4ZOKkXrOXLDJGD8u3kgAALO48SrpCs4KQI6qFWn7tS/apwwP9Hi225AAAGZhjLT1mnRrANBt9ap060ZpmTdnkuNcDc/OHvJsXCB/FSO9Zr20uFd64lluF4zuWNov3byBK1H6rKfm142bCACgA8ZIL70ivUjQd5+Rjoy7nghlUYukl14ubV7FPn/fGfl14yYCAJiDJf3SnVukZ09Iew5LPz3OFgHMz1AjPcr/2hVc6a9MagQAUG6XL0ofzVg6dEo6Oi6dnJCm2lKr7Xo6FE3FpLeOHeiRFvdJqwZnupc8fEcAAIGoV6U1l6UPAIg8OrTeo1EBACg2n7YAEAAAAGTEp0s3EwAAAGSkQgAAABCeyEg1Ky/ODSIAAADIipGm2mq6HqMTBAAAABnqqRAAAAAEpxERAAAABKdWU+x6hk4QAAAABIgAAAAgQAQAAAABIgAAAAgQAQAAQIAIAAAAAkQAAAAQIAIAAIAAEQAAAASIAAAAIEAEAAAAASIAAAAIEAEAAECACAAAAAJEAAAAEKCq6wEA+C9JpGOnpaNj0qlJaTKWmrEUVaR6JA00pMW90opBqbfmeloAEgEAYAEOnpT2HZUOPC/F7c7+zNIBae0SacNyqRZ1dz4AMyMAAMzZwZPS9w5Iz43P/c8eG0sfP/iZtGmVdP1qqcrOSCB3BACAjrXa0neekfYfy+Zn/fBn0tNHpZvWSquGFv4zAXSO7gbQkeMT0ld/lM3if67xKenB0TQGAOSHLQAALunImLRzT3pgXzdYK33/Z9J4S7rxKsmY7jwPgLPYAgBgVkfG0t/Qu7X4n2vvYelbT6dBAKC7CAAAM5pe/Ds9wj8LzxwjAoA8EAAALsrF4j+NCAC6jwAA8CIuF/9pRADQXQQAgPMUYfGfRgQA3UMAAHhBkRb/aUQA0B0EAABJxVz8pxEBQPYIAACFXvynEQFAtggAIHA+LP7TiAAgOwQAEDCfFv9pRACQDQIACJSPi/80IgBYOAIACJDPi/80IgBYGAIACEwZFv9pRAAwfwQAEJAyLf7TiABgfggAIBBlXPynEQHA3BEAQADKvPhPIwKAuSEAgJILYfGfRgQAnSMAgBILafGfRgQAnSEAgJIKcfGfRgQAl0YAACUU8uI/jQgAZkcAACXD4n8WEQDMjAAASoTF/8WIAODiCACgJFj8Z0YEAC9GAAAlwOJ/aUQAcD4CAPAci3/niADgLAIA8BiL/9wRAUCKAAA8xeI/f0QAQAAAXmLxXzgiAKEjAADPsPhnhwhAyAgAwCMs/tkjAhAqAgDwBIt/9xABCBEBAHiAxb/7iACEhgAACo7FPz9EAEJCAAAFxuKfPyIAoSAAgIJi8XeHCEAICACggFj83SMCUHYEAFAwLP7FQQSgzAgAoEBY/IuHCEBZEQBAQbD4FxcRgDIiAIACYPEvPiIAZUMAAI6x+PuDCECZEACAQyz+/iECUBYEAOAIi7+/iACUAQEAOMDi7z8iAL4jAICcsfiXBxEAnxEAQI5Y/MuHCICvCAAgJyz+5UUEwEcEAJADFv/yIwLgGwIA6DIW/3AQAfAJAQB0EYt/eIgA+IIAALqExT9cRAB8QAAAXcDiDyIARUcAABlj8cc0IgBFRgAAGWLxx4WIABQVAQBk5PiEtIPFHxfxzDHp8Z+4ngI4HwEAZKBtpYf2Si0Wf8xg5JD0k+ddTwGcRQAAGdhzSDo16XoKFN33fsKuABQHAQBkYO8R1xPAB2NT0sFTrqcAUgQAsEBTsXRiwvUU8MWhk64nAFIEALBA41OuJ4BP+LygKAgAAMiTcT0AkCIAgAUa6HE9AXzSz+cFBUEAAAtUr0qLel1PAV+sGHA9AZAiAIAMrF/megL4oK9HWj3kegogRQAAGdi4Quqru54CRfdPrpAMxwCgIAgAIAPVSHr1OqnCf1GYwdVLpXVsKUKB8HUFZGTlkHTLhjQGgHNdvVR61VrXUwDnIwCADF25WLrreukXLmNTL9IzRF61Xnr1erYOoXiqrgcAymagR7rlGul0M73s66lJqZ109zmfPy09e6K7z1EGPVVpw/LuP09fTVo6IC3rJwRRXAQA0CV9dWnd0nyea98RAqATjZr0i2tcTwEUAxulAAAIEAEAAECACAAAAAJEAAAAECACAACAABEAAAAEiAAAACBABAAAAAEiAAAACBABAABAgAgAAAACRAAAABAgAgAAgAARAAAABIgAAAAgQAQAAAABIgAAAAgQAQAAQIAIAAAAAkQAAAAQIAIAAIAAEQAAAASIAAAAIEAEAAAAASIAAAAIEAEAAECACAAAAAJEAAAAECACAACAABEAAAAEiAAAACBABAAAAAEiAAAACBABAABAgAgAAAACRAAAABAgAgAAgAARAAAABIgAAAAgQAQAAAABIgAAAAgQAQAAQIAIAAAAAkQAAAAQIAIAAIAAEQAAAASIAAAAIEAEAAAAASIAAAAIEAEAAECACAAAAAJEAAAAECACAACAABEAAAAEiAAAACBABAAAAAEiAAAACBABAABAgAgAAAACRAAAABAgAgAAgAARAAAABIgAAAAgQAQAAAABIgAAAAgQAQAAQIAIAAAAAkQAAAAQIAIAAIAAEQAAAASIAAAAIEAEAAAAASIAAAAIEAEAAECACAAAAAJEAAAAECACAACAABEAAAAEiAAAACBABAAAAAEiAAAACBABAABAgAgAAAACRAAAABAgAgAAgAARAAAABIgAAAAgQAQAAAABIgAAAAgQAQAAQIAIAAAAAkQAAAAQIAIAAIAAEQAAAASIAAAAIEAEAAAAASIAAAAIEAEAAECACAAAAAJEAAAAECACAACAABEAAAAEiAAAACBABAAAAAEiAAAACBABAABAgAgAAAACRAAAJVAxrifwA68TcBYBAJRAo+Z6Aj80qq4nAIqDAABKYKjhegI/DPW6ngAoDgIAKIGBHmkxi9slrbnM9QRAcRAAQElsWe16gmJb0ietGnQ9BVAcBABQEmuXSiuHXE9RTBUj3bhWMhwECLyAAABKwhhp6wZ2BVzIGOmmtdKyfteTAMVCAAAlUq9Kv3JdujUA0kDd6vaN0tplricBioeTYoCSqUbSq9dLm1dK+45Kz56QxpuSta4ny0dPNd3ff9USaf1yw7n/wAwIAKCklg6kD0myklqx03FyEUVSxIIPdIQAAAJglO4eAIBpHAMAAECACAAAAAJEAAAAECACAACAABEAAAAEiAAAACBABAAAAAEiAAAACBABAABAgAgAAAACRAAAABAgAgAAgAARAAAABIgAAAAgQAQAAAABIgAAAAgQAQAAQIAIAAAAAkQAAAAQIAIAAIAAEQAAAASIAAAAIEAEAAAAASIA8mBcDwAAyEucqO16hk4QADlIrOsJAAB5qTV10vUMnSAAckAAAEAw4jVrzITrITpBAOTAEgAAEIox1wN0igDIQZsAAIBQHHQ9QKcIgBy0vDgcBACwYEYjrkfoFAGQg5gAAIAwWI26HqFTBEAO2gkHAgJAGCwBgPNNxa4nAAB0mzHJo65n6BQBkJPJlusJAADdZKVn1y1vsAUA55tkCwAAlJuxO1yPMBcEQE5acXosAACgnIwqX3c9w1wQADmxksabrqcAAHTJ+KSNvuJ6iLkgAHJEAABAOVlj/3bLCuPNVQAlAiBXzZiLAgFAGVUSc6/rGeaKAMjZyUnXEwAAMmW0a+2KqlcHAEoEQO7GmlLMwYAAUBrWmo8aY7z7ZicA8malU2wFAICSMPvWL4/+j+sp5oMAcODUJPcHAIAysFbvNcZ4+Y1OADhgJT132vUUAICFsNLXN6ysftn1HPNFADgy0eK0QADw2JQx7fe4HmIhCACHnj/N1QEBwEvGvn/98sYe12MsBAHgUDuRjo6nuwQAAN746rpltU+6HmKhCADHJlvSyQnXUwAAOmMPNJvVtxljvP/djQAogBMTHA8AAB44Yazu2nylOeZ6kCwQAAVgJR0bTw8MBAAU0qSR7lq3sv4D14NkhQAoCGulo2PSVOx6EgDAeaya1prfWrei9ojrUbJEABRIYqXDp9LjAgAAhTBujXmdz+f7z4QAKJjESofHpNMcEwAAThnpWGJ1+4YV1a+5nqUbCIACslY6MnbmaoHeH2cKAF56PLbtV1yzsvaY60G6hQAosFOT0qFTXCwIAHJkjfQXk8urr7p2ZeNp18N0U9X1AJjdZCw9e0Ja0if197ieBgBKba+xete6lbUHXA+SB7YAeCCx6RUDD56Uml7ecwoABUSl6AAABSJJREFUCm1CVn9UGa++NJTFX2ILgFemYunnJ6WBmjTUK9Ui1xMBgNcmjMynkyj6+Ial5oDrYfJGAPjGSmPN9MqBvXVpqCH18C4CwFwckvQ5Y6ufWLfSHHI9jCssHZ6ySk8VPN2UqpX0+ID+OlsFAGAGY7L2PpnK53+yPHpgmzHBX3aNACiBOEnvJ3BiQqpG6RaB3ppUj6RaRZJxPSEA5O6IjJ6w0sNKtPPAiup3WPTPRwCUTNxOH+NTZ/6BSSOgFkmVSnrUpzFShSgAUFDVSE/21fR3nfy7Vmob6aSsPWFUGTM22Vftre1Zs8g81+05fUcAlJ2VWu30AQBeMPYH2zfW3+96jLLjNEAAAAJEAAAAECACAACAABEAAAAEiAAAACBABAAAAAEiAAAACBABAABAgLwIgEYi63oGAADKxIsAaPdqwvUMAICc2Mpp1yOEwIsA0DMacz0CACAfRvaU6xlC4EUAbNtmYkmTrucAAHSftTrpeoYQeBEAZxx3PQAAIAcVnXA9Qgh8CoCnXA8AAMiBNftcjxACjwLAjLqeAACQh5jv+xx4FACWDwQAlF88NNbztOshQuBPAFj9wPUIAICue/KGG0zL9RAh8CYAxserj0hqup4DANA9RtrpeoZQeBMAd91gTkv6rus5AADdk1hDAOTEmwCQJFnKEABKLE7q0TddDxEKvwIgSb7oegQAQHcY6Ru3rzdcAyAnXgXA9i09uyR93/UcAIDsJdbc63qGkHgVAJIkIz4gAFA+Y3Ezus/1ECHxLgCqleq9krhTFACUirn3jpeZcddThMS7ALj5GnNE0qddzwEAyEwrUuvjrocIjXcBIEkmqn5cXBMAAErC/NUtm3r3u54iNF4GwLZrzE8l8xnXcwAAFqyZ2PhjrocIkZcBIEnNdvRBSUdczwEAmD9j9ee3bW7scT1HiLwNgDu3mOeMsR9wPQcAYL7sASXVP3Y9Rai8DQBJ2npt7TNGesT1HACA+ai8a9sWM+Z6ilB5HQDGGKuo+hZJR13PAgDonDHmU9s3VTnv3yGvA0A6c0CgMb8jybqeBQDQkSd6+qL3uR4idN4HgCRt31i930p/4noOAMAlHbFR+/U3rTETrgcJnXE9QFastWZ4tH2PZH/X9SwAgIs6nVjddtvm2mOuB0FJtgBI6fEARzdG/0ZGf+t6FgDAi7SM9AYW/+IoTQBI0puMaTf6qv9KEgeWAEBxTEjmjds21f7e9SA4q1QBIEk3rTETRzdWXy9j/tL1LAAAHU+M7uCI/+IpzTEAF7LWmof2xB+yVh9SCUMHAArPmH2K26/bvqVnl+tR8GKlDYBpD460tlWkz0ta7XoWAAiFsfqSGtV3bFtrjrueBRdX+gCQpG8+aVfHlfhzkv6Z61kAoOTGrOz7bt1U/x+uB8HsggiAaTt2x3cZk/w3yaxxPQsAlI01+qra1Xfdep35setZcGlBBYAk3b/XDjXa8X+U9E5JA67nAYAS+Edr9R9u3Vx7wPUg6FxwATDtwd12qVH8bmP0bklLXM8DAB561Frzse2boq8aY7gcu2eCDYBp3xqxgy3beoM15rclbRVnDADAbI7ImC8kSu69bWP9H1wPg/kLPgDO9fA+uyZutX69IrPdGt0itgwAgLXSjyTtlDFfX3QqevCGG0zL9VBYOAJgBh+2trJtX+tl7aTyEslulNVGSVdL5jLJDio9fqDX7ZQAkInnJY1LGpN0SNbsMbKjNjIjrUr0D3dsMIcdz4cu+P/SjihghBhptgAAAABJRU5ErkJggg=="/>\
                        </defs>\
                    </svg>\
                    <p class="attachment-click-here-text-div" style="width:90%;margin-bottom: 0;">'
        + FILE_ATTACHEMENT_TEXT + '<br><span style="position: relative;top: 2px;">' + choosen_file_type + '</span>\
                    </p>\
                    <p id="max-file-size-allowed-message" style="color:#E10E00;font-size:12px; padding-left: 10px; padding-right: 10px;">*'
        + FILE_SIZE_LIMIT_TEXT + ' ' + max_file_size_allowed + ' MB\
                    </p>\
                    <span id="easychat-dragdropAlertMsg__XPS" style="color:#E10E00;font-size:12px; width: 100%; justify-content: center;"></span>\
                </span>\
                <div class="easychat-dragdrop__XPS" style="margin-top: 0;">\
                    <input onchange="change_span_name_to_file_name(this,\''+ choosen_file_type + '\', ' + drag_drop_cointainer_count + ')" style="font-size: 0px !important; cursor: pointer;" id="easychat-uploadfile__XPS-' + drag_drop_cointainer_count + '" type="file" accept="' + choosen_file_type + '">\
                </div>\
                </div>\
            <div class="easychat-upload-file-container" id="easychat-upload-file-container-' + drag_drop_cointainer_count + '" style="display: none">\
            </div>\
            <div class="preview-img form-preview-img" id="preview-img-' + drag_drop_cointainer_count + '">'
    if (choosen_file_type.indexOf("mp4") == -1) {
        html += '<img id="output-image-' + drag_drop_cointainer_count + '" class="output-image" src="" alt="preview-img"/>'
    } else {
        html += '<video id="output-image-' + drag_drop_cointainer_count + '" style="border-radius:4px; width:100%; margin-bottom: 8px;position: relative;" class="output-image" alt="preview-img" controls>\
                 </video>'

        // html += '<video  style="border-radius:4px; width:100%; margin-bottom: 8px;position: relative;" class="output-image" alt="preview-img" controls>\
        //          <source src="" type="video/mp4" id="output-image-' + drag_drop_cointainer_count + '">\
        //          </video>'
    }

    html += '</div><div class="bot-widget-submit-reset-btn-wrapper widget-cancel-reset-wrapper-div" id="submit-cancel-btns-wrapper-' + drag_drop_cointainer_count + '" >\
      <button class="easychat-bot-widget-reset-btn easychat-widget-disabled" onclick="reset_file_attachment_btn(\'' + choosen_file_type + '\', ' + is_flow_ended + ', ' + drag_drop_cointainer_count + ')" style="padding: 0px 4px;">' + RESET_TEXT + '</button>\
        <div style="display: flex;"><button class="easychat-bot-widget-cancel-btn" type="submit" onclick="handleCancelClick(' + drag_drop_cointainer_count + ')">'+ CANCEL_TEXT + '</button>\
        <button class="easychat-bot-widget-submit-btn easychat-widget-disabled" type="submit" onclick="save_attachment_to_data_models(this,' + is_flow_ended + ',\'' + choosen_file_type + '\', '+ drag_drop_cointainer_count + ')">' + SUBMIT_TEXT + '</button>\
    </div>\
</div></div>'

    $("#easychat-chat-container").append(html);

    element_response = document.querySelectorAll(".easychat-dragdropContainer__XPS")
    element_response_previous_height += element_response[element_response.length - 1].clientHeight
    scroll_to_bottom();
    disable_user_input();

    inputDiv = document.querySelector("#easychat-dragdropContainer__XPS-" + drag_drop_cointainer_count);
    
    previewImg = document.querySelector("#output-image-" + drag_drop_cointainer_count);

    previewImgSubmitBtnDiv = document.querySelector("#submit-cancel-btns-wrapper-" + drag_drop_cointainer_count);

    successfulMessage = document.querySelectorAll(".successful-submission-text");
    successfulMessage = successfulMessage[successfulMessage.length - 1]

    update_input_placeholder_based_on_theme(WIDGETS_PLACEHOLDER_TEXT.split("$$$")[1]);
}

function handleCancelClick(input_id) {
    try {
        if (is_widgets) {
            if(EASYCHAT_BOT_THEME  ==  "theme_1") {
                enable_footer_widget_response_theme_1()
                $("#tooltiptext-send").css('display', 'none');
            }
            else if (EASYCHAT_BOT_THEME == "theme_2") {
                enable_footer_widget_response_theme_2()
                $("#tooltiptext-send").css('display', 'none');
            }
            else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
                enable_footer_widget_response_theme3_and_theme4()
            }
            
        }
        global_file_name = ""

        var file_extension = document.getElementById("easychat-uploadfile__XPS-" + input_id).value.split(".")[document.getElementById("easychat-uploadfile__XPS-" + input_id).value.split(".").length - 1].toLowerCase();

        if (file_extension) {

            if (file_extension.indexOf("png") != -1 || file_extension.indexOf("mp4") != -1 || file_extension.indexOf("jpeg") != -1 || file_extension.indexOf("jpg") != -1 || file_extension.indexOf("gif") != -1) {
                document.getElementById("easychat-uploadfile__XPS-" + input_id).value = "";
                document.querySelector("#easychat-dragdropContainer__XPS-" + input_id + " .easychat-attachment-dragdrop-wrapper").style.display = "flex";
                inputDiv.classList.add("easychat-widget-disabled");
                document.getElementById("preview-img-" + input_id).classList.add("easychat-widget-disabled");
                previewImg.style.display = "none";

                if (file_extension.indexOf("mp4") != -1) {
                    previewImg.parentElement.style.display = "none";
                }

            } else {
                document.querySelector("#easychat-upload-file-container-" + input_id).style.display = "none";
                document.getElementById("easychat-uploadfile__XPS-" + input_id).value = "";
                document.querySelector("#easychat-dragdropContainer__XPS-" + input_id + " .easychat-attachment-dragdrop-wrapper").style.display = "flex";
                inputDiv.classList.add("easychat-widget-disabled");
                document.getElementById("preview-img-" + input_id).classList.add("easychat-widget-disabled");

            }
        } else {
            inputDiv.classList.add("easychat-widget-disabled");
            document.getElementById("preview-img-" + input_id).classList.add("easychat-widget-disabled");
        }

        update_input_placeholder_based_on_theme(get_placeholder_text_based_on_theme());

        scroll_to_bottom();
        successfulMessage.remove()
        enable_user_input()
    } catch (err) { enable_user_input() }

}

function capturing_video_start(video_recorder_id) {

    var video = document.getElementById(video_element_id + video_recorder_id);
    var canvas = document.getElementById(video_captured_canvas + video_recorder_id);

    global_file_name = "";

    var start_stop_btn = document.getElementById(start_button_id + video_recorder_id);
    start_stop_btn.innerText = STOP_TEXT;
    start_stop_btn.setAttribute("onclick", "capturing_video_stop(" + video_recorder_id + ")");

    // Request access to the media devices
    navigator.mediaDevices.getUserMedia({
        audio: true,
        video: true
    }).then(function (stream) {
        // Display a live preview on the video element of the page
        setSrcObject(stream, video);

        // Start to display the preview on the video element
        // and mute the video to disable the echo issue !
        video.play();
        video.muted = true;

        // Initialize the recorder
        recorder = new RecordRTCPromisesHandler(stream, {
            mimeType: 'video/webm',
            bitsPerSecond: 128000
        });

        // Start recording the video
        recorder.startRecording().then(function () { }).catch(function (error) {
            console.error('Cannot start video recording: ', error);
        });

        // release stream on stopRecording
        recorder.stream = stream;
        videoStarted = true;

        document.getElementById(reset_button_id + video_recorder_id).classList.add("easychat-widget-disabled");
        document.getElementById(submit_button_id + video_recorder_id).classList.add("easychat-widget-disabled");

        // document.getElementById(preview_button_id).disabled = true;
    }).catch(function (error) {
        alert("Please allow access to webcam.");
        console.error("Cannot access media devices: ", error);
    });
}

function capturing_video_stop(video_recorder_id) {
    var video = document.getElementById(video_element_id + video_recorder_id);
    var canvas = document.getElementById(video_captured_canvas + video_recorder_id);

    global_file_name = "video_recorder.mp4";    

    recorder.stopRecording().then(function () {
        if (document.pictureInPictureElement) {
            document.exitPictureInPicture();
        }

        // Retrieve recorded video as blob and display in the preview element
        videoBlob = recorder.blob;
        recorder.getDataURL().then(function (result) {
            recorded_video_data_url = result;
        });

        video.srcObject = null;

        video.src = URL.createObjectURL(videoBlob);
        video.play();

        // Unmute video on preview
        video.muted = false;

        // Stop the device streaming
        recorder.stream.stop();
        videoStopped = true;
        document.getElementById(reset_button_id + video_recorder_id).classList.remove("easychat-widget-disabled");
        document.getElementById(submit_button_id + video_recorder_id).classList.remove("easychat-widget-disabled");
        document.getElementById(start_button_id + video_recorder_id).classList.add("easychat-widget-disabled");

    }).catch(function (error) {
        console.error('stopRecording failure', error);
    });
}


function capturing_video_submit(video_recorder_id) {
    var video = document.getElementById(video_element_id + video_recorder_id);
    var canvas = document.getElementById(video_captured_canvas + video_recorder_id);
    
    document.getElementById("easychat-video-recorder-div-" + video_recorder_id).querySelector(".easychat-video-recorder-preview-wrapper").style.display = "none";
    document.getElementById("easychat-video-recorder-div-" + video_recorder_id).querySelector(".easychat-video-recorder-wrapper").style.display = "none";
    document.getElementById("easychat-video-upload-container-" + video_recorder_id).style.display = "flex";

    // append_bot_text_response(UPLOAD_VIDEO_TEXT);
    // document.getElementById("global-canvas-video-capture").remove();
    // document.getElementById("global-video-captured-response").remove();
    // document.getElementById(stop_button_id).remove();
    // document.getElementById(start_button_id).remove();
    // document.getElementById(submit_button_id).remove();

    // document.getElementById("easychat-video-recorder-div-" + video_recorder_id).remove();

    // document.getElementById(preview_button_id).style.display = 'none';
    attached_file_src = recorded_video_data_url
    file_extension = "mp4"
    is_widget_data = true;
    send_message_to_server("attachment", user_id, bot_id, bot_name, "");
    recorded_video_data_url = null;
    is_recorded_video_uploaded = true;
}

function capturing_video_reset(video_recorder_id) {
    recorded_video_data_url = null;
    attached_file_src = "";
    var video = document.getElementById(video_element_id + video_recorder_id)
    video.srcObject = null;
    video.src = "";
    document.getElementById(reset_button_id + video_recorder_id).classList.add("easychat-widget-disabled");
    document.getElementById(submit_button_id + video_recorder_id).classList.add("easychat-widget-disabled");

    var start_stop_btn = document.getElementById(start_button_id + video_recorder_id);
    start_stop_btn.innerText = START_TEXT;
    start_stop_btn.setAttribute("onclick", "capturing_video_start(" + video_recorder_id + ")");
    start_stop_btn.classList.remove("easychat-widget-disabled");
}

function capturing_video_cancel(video_recorder_id) {
    capturing_video_reset(video_recorder_id)
    document.getElementById("easychat-video-recorder-div-" + video_recorder_id).classList.add("easychat-widget-disabled");
    update_input_placeholder_based_on_theme(get_placeholder_text_based_on_theme());
    enable_user_input();
    empty_user_input_based_on_theme();
}

function add_video_recorder_loader_html() {
    return '<div class="upload-file-icon-div ">\
    <svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">\
    <path d="M13.5 6.5C13.5 5.11929 12.3807 4 11 4H5C3.61929 4 2.5 5.11929 2.5 6.5V13.5C2.5 14.8807 3.61929 16 5 16H11C12.3807 16 13.5 14.8807 13.5 13.5V6.5Z" fill="#3884FD"/>\
    <path d="M14.5 7.93082V12.0815L17.2642 14.4319C17.7512 14.8461 18.5 14.4999 18.5 13.8606V6.19315C18.5 5.55685 17.7575 5.20962 17.2692 5.61756L14.5 7.93082Z" fill="#3884FD"/>\
    </svg></div>\
    <div class="upload-file-name-div">\
        Your video is being uploaded\
    </div>\
    <div class="upload-file-loader">\
        <div class="progressbar" data-animate="false">\
            <button class="delete-choose-file" onclick="stop_uploading_attachment()">\
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">\
                    <g clip-path="url(#clip0)">\
                    <g filter="url(#filter0_d)">\
                    <path d="M9.23483 3.47016C9.38128 3.32372 9.38128 3.08628 9.23483 2.93983L9.06016 2.76516C8.91372 2.61872 8.67628 2.61872 8.52983 2.76516L6.26516 5.02983C6.11872 5.17628 5.88128 5.17628 5.73483 5.02983L3.47016 2.76516C3.32372 2.61872 3.08628 2.61872 2.93983 2.76517L2.76516 2.93983C2.61872 3.08628 2.61872 3.32372 2.76517 3.47016L5.02983 5.73483C5.17628 5.88128 5.17628 6.11872 5.02983 6.26516L2.76516 8.52983C2.61872 8.67628 2.61872 8.91372 2.76516 9.06016L2.93983 9.23483C3.08628 9.38128 3.32372 9.38128 3.47017 9.23483L5.73483 6.97016C5.88128 6.82372 6.11872 6.82372 6.26516 6.97016L8.52983 9.23483C8.67628 9.38128 8.91372 9.38128 9.06016 9.23483L9.23483 9.06016C9.38128 8.91372 9.38128 8.67628 9.23483 8.52983L6.97016 6.26516C6.82372 6.11872 6.82372 5.88128 6.97016 5.73483L9.23483 3.47016Z" fill="#979797"/>\
                    </g>\
                    </g>\
                    <defs>\
                    <filter id="filter0_d" x="-5.34473" y="-5.34473" width="30.6893" height="30.6893" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\
                    <feFlood flood-opacity="0" result="BackgroundImageFix"/>\
                    <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"/>\
                    <feOffset dx="4" dy="4"/>\
                    <feGaussianBlur stdDeviation="6"/>\
                    <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.12 0"/>\
                    <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>\
                    <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/>\
                    </filter>\
                    <clipPath id="clip0">\
                    <rect width="12" height="12" fill="white"/>\
                    </clipPath>\
                    </defs>\
                    </svg>\
            </button>\
            <div class="circle" style="display: none" data-percent="0">\
                    <div style="color:'+ BOT_THEME_COLOR + '" class="circle-progress-value"></div>\
            </div>\
        </div>\
    </div>';
}

function append_video_recorder() {
    // try {
    //     document.getElementById("global-canvas-video-capture").remove();
    //     document.getElementById("global-video-captured-response").remove();
    //     document.getElementById("btn-start-recording").remove();
    //     document.getElementById("btn-stop-recording").remove();
    //     document.getElementById("btn-submit-recording").remove();
    // } catch (err) { }
    is_video_recorder_allowed = true
    var video_recorder_count = document.getElementsByClassName("easychat-video-recorder-div").length;
    var html = '<div class="easychat-video-recorder-div" id="easychat-video-recorder-div-' + video_recorder_count + '">\
    <div class="easychat-upload-file-container video-recorder-upload-wrapper-div" style="display: none;" id="easychat-video-upload-container-' + video_recorder_count + '"> ' + add_video_recorder_loader_html() + '</div>\
        <div class="easychat-video-recorder-preview-wrapper">\
          <video class="responsive-video" id="global-video-captured-response-' + video_recorder_count + '" controls autoplay style="height:14em;width: 100%;object-fit: cover;" type="video/webm"></video>\
    </div>\
      <div class="easychat-video-recorder-wrapper video-recorder-btns-wrapper">\
        <button id="btn-start-recording-' + video_recorder_count + '" class="btn-start-stop-recording" onclick="capturing_video_start(' + video_recorder_count + ')" style="background-color:' + BOT_THEME_COLOR + ';">' + START_TEXT + '</button>\
        <button id="btn-cancel-recording-' + video_recorder_count + '" class="easychat-bot-widget-cancel-btn btn-cancel-recording" onclick="capturing_video_cancel(' + video_recorder_count + ')">' + CANCEL_TEXT + '</button>\
        <button id="btn-reset-recording-' + video_recorder_count + '" class="easychat-bot-widget-reset-btn easychat-widget-disabled" onclick="capturing_video_reset(' + video_recorder_count + ')">' + RESET_TEXT + '</button>\
        <button id="btn-submit-recording-' + video_recorder_count + '" class="easychat-bot-widget-submit-btn easychat-widget-disabled" class="btn-submit-recording" onclick="capturing_video_submit(' + video_recorder_count + ')">' + SUBMIT_TEXT + '</button>\
      </div>\
      <canvas style="display:none;" id="global-canvas-video-capture-' + video_recorder_count + '"></canvas>\
    </div>'
    $("#easychat-chat-container").append(html);

    function animateElements() {
        $('.progressbar').each(function () {
            var elementPos = $(this).offset().top;
            var topOfWindow = $(window).scrollTop();
            var percent = $(this).find('.circle').attr('data-percent');
            var percentage = parseInt(percent, 10) / parseInt(100, 10);
            var animate = $(this).data('animate');
            if (elementPos < topOfWindow + $(window).height() - 30 && !animate) {
                $(this).data('animate', true);
                $(this).find('.circle').circleProgress({
                    startAngle: -Math.PI / 2,
                    value: percent / 100,
                    size: 40,
                    thickness: 4,
                    emptyFill: "#eeeaef",
                    fill: {
                        color: '#1E9DF7'
                    }
                }).on('circle-animation-progress', function (event, progress, stepValue) {
                    $(this).find('div').text((stepValue * 100).toFixed(0) + "%");
                }).stop();
            }
        });
    }

    // Show animated elements
    animateElements();
    $(window).scroll(animateElements);

    element_response = document.querySelectorAll(".responsive-video")
    element_response_previous_height += element_response[element_response.length - 1].clientHeight

    change_is_flow_ended_variable = false
    update_input_placeholder_based_on_theme(WIDGETS_PLACEHOLDER_TEXT.split("$$$")[4]);
}

function change_span_name_to_file_name(el, choosen_file_type, input_id) {
    if (el.files[0] != undefined || el.files[0] != null) {
        var file_ext = el.files[0].name.split(".");
        file_ext = el.files[0].name.split(".")[file_ext.length - 1];
        if (el.getAttribute("accept").toString().indexOf(file_ext.toLowerCase()) !== -1) {
            if (el.files[0].size <= (max_file_size_allowed) * 1024 * 1024) {
                document.getElementById('easychat-upload-file-container-' + input_id).innerHTML = add_attachment_loader_html(choosen_file_type)

                file_name = el.files[0].name.split(".")
                global_file_name = file_name
                file_length = file_name.length
                file_ext = parseInt(parseInt(file_length) - 1)

                if (el.files[0].name.length >= 15) {
                    file_name_mod = file_name[0].slice(0, 10) + "... ." + file_name[file_name.length - 1]
                } else {
                    file_name_mod = el.files[0].name
                }
                var name_div_length = document.getElementsByClassName('upload-file-name-div').length
                document.getElementsByClassName('upload-file-name-div')[name_div_length - 1].innerHTML = file_name_mod
                
                $('#easychat-chat-container').animate({ scrollTop: $('#easychat-chat-container').prop('scrollHeight') }, 400);

                function animateElements() {
                    $('.progressbar').each(function () {
                        var elementPos = $(this).offset().top;
                        var topOfWindow = $(window).scrollTop();
                        var percent = $(this).find('.circle').attr('data-percent');
                        var percentage = parseInt(percent, 10) / parseInt(100, 10);
                        var animate = $(this).data('animate');
                        if (elementPos < topOfWindow + $(window).height() - 30 && !animate) {
                            $(this).data('animate', true);
                            $(this).find('.circle').circleProgress({
                                startAngle: -Math.PI / 2,
                                value: percent / 100,
                                size: 40,
                                thickness: 4,
                                emptyFill: "#eeeaef",
                                fill: {
                                    color: '#1E9DF7'
                                }
                            }).on('circle-animation-progress', function (event, progress, stepValue) {
                                $(this).find('div').text((stepValue * 100).toFixed(0) + "%");
                            }).stop();
                        }
                    });
                }

                // Show animated elements
                animateElements();
                $(window).scroll(animateElements);
                var reader = new FileReader()
                reader.onload = function () {
                    if (choosen_file_type.indexOf("png") != -1 || choosen_file_type.indexOf("jpeg") != -1 || choosen_file_type.indexOf("jpg") != -1 || choosen_file_type.indexOf("gif") != -1 || choosen_file_type.indexOf("mp4") != -1) {
                        document.querySelector("#output-image-" + input_id).style.display = "block";
                        document.querySelector("#output-image-" + input_id).setAttribute("src", reader.result);

                        if (choosen_file_type.indexOf("mp4") != -1) {
                            document.querySelector("#output-image-" + input_id).parentElement.style.display = "block";
                        }
                    } else {
                        document.getElementById('easychat-upload-file-container-' + input_id).style.display = "inline-flex"
                    }
                };


                reader.readAsDataURL(el.files[0]);

                document.querySelector("#easychat-dragdropContainer__XPS-" + input_id + " .easychat-attachment-dragdrop-wrapper").style.display = "none"
                document.querySelector("#submit-cancel-btns-wrapper-" + input_id + " .easychat-bot-widget-submit-btn").classList.remove("easychat-widget-disabled");
                document.querySelector("#submit-cancel-btns-wrapper-" + input_id + " .easychat-bot-widget-reset-btn").classList.remove("easychat-widget-disabled");
                scroll_to_bottom()
            } else {

                document.getElementById("easychat-dragdropAlertMsg__XPS").style.display = "inline-flex"
                document.getElementById("easychat-dragdropAlertMsg__XPS").style.fontSize = "12px"
                document.getElementById("easychat-dragdropAlertMsg__XPS").style.color = "#E10E00"
                document.getElementById("easychat-dragdropAlertMsg__XPS").textContent = "Please Select file < " + max_file_size_allowed + "MB*"
                scroll_to_bottom()
            }
        } else {
            document.getElementById("easychat-dragdropAlertMsg__XPS").style.display = "inline-block"
            document.getElementById("easychat-dragdropAlertMsg__XPS").style.fontSize = "12px"
            document.getElementById("easychat-dragdropAlertMsg__XPS").style.color = "#E10E00"
            document.getElementById("easychat-dragdropAlertMsg__XPS").textContent = "Please Select Correct File Type*"
        }
    } else {
        document.getElementById("easychat-dragdropAlertMsg__XPS").style.display = "inline-flex"
        document.getElementById("easychat-dragdropAlertMsg__XPS").style.fontSize = "12px"
        document.getElementById("easychat-dragdropAlertMsg__XPS").style.color = "#E10E00"
        document.getElementById("easychat-dragdropAlertMsg__XPS").textContent = "No File Selected*"
        document.getElementById("easychat-dragdropUploadBTN__XPS").style.display = "none"
    }
}
function stop_uploading_attachment() {
    if (current_request_xhttp != null && current_request_xhttp != undefined)
        current_request_xhttp.abort();
    handleCancelClick()
    current_request_xhttp = null
}

function add_attachment_loader_html(choosen_file_type) {

    var html = '<div class="upload-file-icon-div">'

    if (choosen_file_type.indexOf("png") != -1 || choosen_file_type.indexOf("jpeg") != -1 || choosen_file_type.indexOf("jpg") != -1 || choosen_file_type.indexOf("gif") != -1){
        html += '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\
                <path fill-rule="evenodd" clip-rule="evenodd" d="M14.5714 7.14286C14.5714 8.08963 13.8039 8.85714 12.8571 8.85714C11.9104 8.85714 11.1429 8.08963 11.1429 7.14286C11.1429 6.19608 11.9104 5.42857 12.8571 5.42857C13.8039 5.42857 14.5714 6.19608 14.5714 7.14286ZM13.4286 7.14286C13.4286 7.45845 13.1727 7.71429 12.8571 7.71429C12.5416 7.71429 12.2857 7.45845 12.2857 7.14286C12.2857 6.82727 12.5416 6.57143 12.8571 6.57143C13.1727 6.57143 13.4286 6.82727 13.4286 7.14286Z" fill="#4D4D4D"/>\
                <path fill-rule="evenodd" clip-rule="evenodd" d="M2 5.42857C2 3.53502 3.53502 2 5.42857 2H14.5714C16.465 2 18 3.53502 18 5.42857V14.5714C18 16.465 16.465 18 14.5714 18H5.42857C3.53502 18 2 16.465 2 14.5714V5.42857ZM5.42857 3.14286C4.16621 3.14286 3.14286 4.16621 3.14286 5.42857V14.5714C3.14286 14.9973 3.25932 15.396 3.46214 15.7373L8.79849 10.4937C9.46545 9.83839 10.5345 9.83839 11.2015 10.4938L16.5379 15.7373C16.7407 15.396 16.8571 14.9973 16.8571 14.5714V5.42857C16.8571 4.16621 15.8338 3.14286 14.5714 3.14286H5.42857ZM5.42857 16.8571C5.00668 16.8571 4.61149 16.7428 4.27227 16.5435L9.5995 11.3089C9.82181 11.0905 10.1782 11.0905 10.4005 11.3089L15.7277 16.5435C15.3885 16.7428 14.9933 16.8571 14.5714 16.8571H5.42857Z" fill="#4D4D4D"/>\
                </svg>\
        </div>';
    } else if (choosen_file_type.indexOf("doc") != -1 || choosen_file_type.indexOf("docx") != -1 || choosen_file_type.indexOf("odt") != -1 || choosen_file_type.indexOf("pdf") != -1 || choosen_file_type.indexOf("rtf") != -1 || choosen_file_type.indexOf("tex") != -1 || choosen_file_type.indexOf("wks") != -1 || choosen_file_type.indexOf("wkp") != -1) {
        html += '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\
            <path fill-rule="evenodd" clip-rule="evenodd" d="M6 2C4.89543 2 4 2.89543 4 4V16C4 17.1046 4.89543 18 6 18H14C15.1046 18 16 17.1046 16 16V7.41421C16 7.01639 15.842 6.63486 15.5607 6.35355L11.6464 2.43934C11.3651 2.15804 10.9836 2 10.5858 2H6ZM5 4C5 3.44772 5.44772 3 6 3H10V6.5C10 7.32843 10.6716 8 11.5 8H15V16C15 16.5523 14.5523 17 14 17H6C5.44772 17 5 16.5523 5 16V4ZM14.7929 7L11 3.20711V6.5C11 6.77614 11.2239 7 11.5 7H14.7929Z" fill="#4D4D4D"/>\
        </svg></div>';
    } else if (choosen_file_type.indexOf("zip") != -1 || choosen_file_type.indexOf("rar") != -1 || choosen_file_type.indexOf("rpm") != -1 || choosen_file_type.indexOf("z") != -1 || choosen_file_type.indexOf("tar.gz") != -1 || choosen_file_type.indexOf("pkg") != -1) {
        html += '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\
            <path d="M8.12501 9.375C8.12501 9.04348 8.25671 8.72554 8.49113 8.49112C8.72555 8.2567 9.04349 8.125 9.37501 8.125H10.625C10.9565 8.125 11.2745 8.2567 11.5089 8.49112C11.7433 8.72554 11.875 9.04348 11.875 9.375V10.5475L12.375 12.5462C12.4373 12.7963 12.4208 13.0596 12.3277 13.2999C12.2346 13.5402 12.0695 13.7459 11.855 13.8888L10.6925 14.6638C10.4872 14.8005 10.2461 14.8735 9.99939 14.8735C9.75271 14.8735 9.51155 14.8005 9.30626 14.6638L8.14376 13.8888C7.92949 13.7457 7.76465 13.54 7.67179 13.2997C7.57893 13.0593 7.56259 12.7962 7.62501 12.5462L8.12501 10.5475V9.375ZM10.625 9.375H9.37501V10.5475C9.375 10.6499 9.36241 10.7519 9.33751 10.8512L8.83751 12.8488L10 13.6238L11.1625 12.8488L10.6625 10.8512C10.6376 10.7519 10.625 10.6499 10.625 10.5475V9.375Z" fill="#4D4D4D"/>\
            <path d="M2.5 2.5C2.5 1.83696 2.76339 1.20107 3.23223 0.732233C3.70107 0.263392 4.33696 0 5 0L15 0C15.663 0 16.2989 0.263392 16.7678 0.732233C17.2366 1.20107 17.5 1.83696 17.5 2.5V17.5C17.5 18.163 17.2366 18.7989 16.7678 19.2678C16.2989 19.7366 15.663 20 15 20H5C4.33696 20 3.70107 19.7366 3.23223 19.2678C2.76339 18.7989 2.5 18.163 2.5 17.5V2.5ZM9.375 1.25H5C4.66848 1.25 4.35054 1.3817 4.11612 1.61612C3.8817 1.85054 3.75 2.16848 3.75 2.5V17.5C3.75 17.8315 3.8817 18.1495 4.11612 18.3839C4.35054 18.6183 4.66848 18.75 5 18.75H15C15.3315 18.75 15.6495 18.6183 15.8839 18.3839C16.1183 18.1495 16.25 17.8315 16.25 17.5V2.5C16.25 2.16848 16.1183 1.85054 15.8839 1.61612C15.6495 1.3817 15.3315 1.25 15 1.25H11.25V2.5H10V3.75H11.25V5H10V6.25H11.25V7.5H9.375V6.25H8.125V5H9.375V3.75H8.125V2.5H9.375V1.25Z" fill="#4D4D4D"/>\
        </svg></div>'
    } else {
        html += '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\
            <path fill-rule="evenodd" clip-rule="evenodd" d="M4.17045 3.09066C3.5741 3.09066 3.09066 3.5741 3.09066 4.17045V15.8296C3.09066 16.4259 3.5741 16.9093 4.17045 16.9093H15.8296C16.4259 16.9093 16.9093 16.4259 16.9093 15.8296V4.17045C16.9093 3.5741 16.4259 3.09066 15.8296 3.09066H4.17045ZM2 4.17045C2 2.97174 2.97174 2 4.17045 2H15.8296C17.0283 2 18 2.97174 18 4.17045V15.8296C18 17.0283 17.0283 18 15.8296 18H4.17045C2.97174 18 2 17.0283 2 15.8296V4.17045Z" fill="#404040"/>\
            <path fill-rule="evenodd" clip-rule="evenodd" d="M6.27311 2C6.57429 2 6.81844 2.24415 6.81844 2.54533V17.4547C6.81844 17.7558 6.57429 18 6.27311 18C5.97194 18 5.72778 17.7558 5.72778 17.4547V2.54533C5.72778 2.24415 5.97194 2 6.27311 2Z" fill="#404040"/>\
            <path fill-rule="evenodd" clip-rule="evenodd" d="M13.7272 2C14.0284 2 14.2725 2.24415 14.2725 2.54533V17.4547C14.2725 17.7558 14.0284 18 13.7272 18C13.426 18 13.1819 17.7558 13.1819 17.4547V2.54533C13.1819 2.24415 13.426 2 13.7272 2Z" fill="#404040"/>\
            <path fill-rule="evenodd" clip-rule="evenodd" d="M2 10.0004C2 9.69923 2.24415 9.45508 2.54533 9.45508H17.4547C17.7558 9.45508 18 9.69923 18 10.0004C18 10.3016 17.7558 10.5457 17.4547 10.5457H2.54533C2.24415 10.5457 2 10.3016 2 10.0004Z" fill="#404040"/>\
            <path fill-rule="evenodd" clip-rule="evenodd" d="M2 6.27189C2 5.97072 2.24415 5.72656 2.54533 5.72656H6.27267C6.57384 5.72656 6.818 5.97072 6.818 6.27189C6.818 6.57307 6.57384 6.81722 6.27267 6.81722H2.54533C2.24415 6.81722 2 6.57307 2 6.27189Z" fill="#404040"/>\
            <path fill-rule="evenodd" clip-rule="evenodd" d="M2 13.7279C2 13.4268 2.24415 13.1826 2.54533 13.1826H6.27267C6.57384 13.1826 6.818 13.4268 6.818 13.7279C6.818 14.0291 6.57384 14.2733 6.27267 14.2733H2.54533C2.24415 14.2733 2 14.0291 2 13.7279Z" fill="#404040"/>\
            <path fill-rule="evenodd" clip-rule="evenodd" d="M13.1819 13.7279C13.1819 13.4268 13.426 13.1826 13.7272 13.1826H17.4546C17.7557 13.1826 17.9999 13.4268 17.9999 13.7279C17.9999 14.0291 17.7557 14.2733 17.4546 14.2733H13.7272C13.426 14.2733 13.1819 14.0291 13.1819 13.7279Z" fill="#404040"/>\
            <path fill-rule="evenodd" clip-rule="evenodd" d="M13.1819 6.27189C13.1819 5.97072 13.426 5.72656 13.7272 5.72656H17.4546C17.7557 5.72656 17.9999 5.97072 17.9999 6.27189C17.9999 6.57307 17.7557 6.81722 17.4546 6.81722H13.7272C13.426 6.81722 13.1819 6.57307 13.1819 6.27189Z" fill="#404040"/>\
        </svg></div>'
    }

    html += '<div class="upload-file-name-div">\
            adli-wahid-3-QB... .jpg\
        </div>\
        <div class="upload-file-loader">\
            <div class="progressbar" data-animate="false">\
                <button class="delete-choose-file" onclick="stop_uploading_attachment()">\
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <g clip-path="url(#clip0)">\
                        <g filter="url(#filter0_d)">\
                        <path d="M9.23483 3.47016C9.38128 3.32372 9.38128 3.08628 9.23483 2.93983L9.06016 2.76516C8.91372 2.61872 8.67628 2.61872 8.52983 2.76516L6.26516 5.02983C6.11872 5.17628 5.88128 5.17628 5.73483 5.02983L3.47016 2.76516C3.32372 2.61872 3.08628 2.61872 2.93983 2.76517L2.76516 2.93983C2.61872 3.08628 2.61872 3.32372 2.76517 3.47016L5.02983 5.73483C5.17628 5.88128 5.17628 6.11872 5.02983 6.26516L2.76516 8.52983C2.61872 8.67628 2.61872 8.91372 2.76516 9.06016L2.93983 9.23483C3.08628 9.38128 3.32372 9.38128 3.47017 9.23483L5.73483 6.97016C5.88128 6.82372 6.11872 6.82372 6.26516 6.97016L8.52983 9.23483C8.67628 9.38128 8.91372 9.38128 9.06016 9.23483L9.23483 9.06016C9.38128 8.91372 9.38128 8.67628 9.23483 8.52983L6.97016 6.26516C6.82372 6.11872 6.82372 5.88128 6.97016 5.73483L9.23483 3.47016Z" fill="#979797"/>\
                        </g>\
                        </g>\
                        <defs>\
                        <filter id="filter0_d" x="-5.34473" y="-5.34473" width="30.6893" height="30.6893" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\
                        <feFlood flood-opacity="0" result="BackgroundImageFix"/>\
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"/>\
                        <feOffset dx="4" dy="4"/>\
                        <feGaussianBlur stdDeviation="6"/>\
                        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.12 0"/>\
                        <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>\
                        <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/>\
                        </filter>\
                        <clipPath id="clip0">\
                        <rect width="12" height="12" fill="white"/>\
                        </clipPath>\
                        </defs>\
                        </svg>\
                </button>\
                <div class="circle" style="display: none" data-percent="0">\
                     <div style="color:'+ BOT_THEME_COLOR + '" class="circle-progress-value"></div>\
                </div>\
            </div>\
        </div>\
'
    return html
}

function disable_previous_recomendations() {
    let list_of_el = document.getElementsByClassName("easychat-recommendation-wrapper");
    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        list_of_el = document.getElementsByClassName("easychat-bot-quick-recommendation-wrapper");
    }
    var last_recomendation_wrapper = list_of_el[list_of_el.length - 1]
    if ((typeof last_recomendation_wrapper !== 'undefined')) {
        for (var i = 0; i < last_recomendation_wrapper.children.length; i++) {
            if (last_recomendation_wrapper.children[i].hasAttribute("onclick")) { last_recomendation_wrapper.children[i].removeAttribute("onclick") }
            if (last_recomendation_wrapper.children[i].hasAttribute("onmouseout")) { last_recomendation_wrapper.children[i].removeAttribute("onmouseout") }
            if (last_recomendation_wrapper.children[i].hasAttribute("onmouseover")) { last_recomendation_wrapper.children[i].removeAttribute("onmouseover") }
            last_recomendation_wrapper.children[i].style.opacity = 0.5;
            last_recomendation_wrapper.children[i].style.cursor = "default";
        }
    }
}
function save_attachment_to_data_models(el, is_flow_ended, choosen_file_type, input_id) {
    var attachment_data = document.querySelector('#easychat-uploadfile__XPS-' + input_id).files

    if (!attachment_data.length) {
        return;
    }

    attachment_data = attachment_data[0];

    disable_user_input();

    document.querySelector('#easychat-upload-file-container-' + input_id).style.display = "inline-flex"

    previewImg.style.display = "none"
    last_chosen_file_type = choosen_file_type
    reader = new FileReader();
    reader.onloadend = function () {
        var b64 = reader.result.split(",")[1];
        var file_name = global_file_name[0]
        var file_ext = global_file_name.pop()
        setTimeout(function () {

            // document.getElementsByClassName("easychat-dragdropContainer__XPS")[0].remove()
            // append_bot_text_response("Uploading " + file_name)
            attached_file_src = b64
            file_extension = file_ext
            is_widget_data = true;
            // if(!is_flow_ended){
            send_message_to_server("attachment", user_id, bot_id, bot_name, "");
            // }

            disable_previous_recomendations()

        }, 1000);
    };
    reader.readAsDataURL(attachment_data);
    document.getElementById("submit-cancel-btns-wrapper-" + input_id).style.display = "none";
    if (last_chosen_file_type.indexOf("mp4") != -1) {
        document.getElementById("output-image-" + input_id).parentElement.style.display = "none";
    }
    change_is_flow_ended_variable = false
}


/*
// We are know using different method for stoing the file -> save_attachment_to_data_models()
function upload_attachment_to_server(el,is_flow_ended){
    var formData = new FormData();
    var upload_attachment_data = document.querySelector('#easychat-uploadfile__XPS').files[0]
    formData.append("upload_attachment", upload_attachment_data);
    document.getElementById("easychat-dragdropbottyping-loader").style.display = "inline-block"
    var xhttp = new XMLHttpRequest();
    var params = formData;
    xhttp.open("POST", "/chat/upload-attachment/", true);
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            response = JSON.parse(this.responseText);
            if(response.status==200){
                            attached_file_src = response.src;
                    var file_name = document.getElementById("easychat-dragdropAlertMsg__XPS").childNodes[0].textContent
                    setTimeout(function(){
                    document.getElementById("easychat-dragdropbottyping-loader").style.display = "none"
                    document.getElementsByClassName("easychat-dragdropContainer__XPS")[0].remove()
                    append_bot_text_response(file_name+" has been successfully uploaded.")
                    if(!is_flow_ended){
                        send_message_to_server("attachment", user_id, bot_id, bot_name, "");
                    }
                    }, 1000);
            }
            else{
                document.getElementById("easychat-dragdropUploadBTN__XPS").style.display = "none"
                setTimeout(function(){
                    document.getElementById("easychat-dragdropbottyping-loader").style.display = "none"
                    document.getElementById("easychat-dragdropAlertMsg__XPS").style.color = "red"
                    document.getElementById("easychat-dragdropAlertMsg__XPS").innerHTML = "Unable to Upload"
                    setTimeout(function(){
                        remove_file_from_attachment();
                        }, 1000);
                }, 1000);
            }
        }
    }
    xhttp.send(params);
}*/

function remove_file_from_attachment() {
    document.getElementById("easychat-dragdropAlertMsg__XPS").innerHTML = ""
    document.getElementById("easychat-uploadfile__XPS").value = ""
    document.getElementById("easychat-dragdropUploadBTN__XPS").style.display = "none"
    document.getElementById("easychat-dragdropAlertMsg__XPS").style.display = "none"
    document.getElementsByClassName("easychat-dragdropMsg__XPS")[0].style.display = "flex"
    document.getElementsByClassName("easychat-dragdrop__XPS")[0].style.display = "block"
    document.getElementsByClassName("easychat-dragdropafterSelect__XPS")[0].style.backgroundColor = "unset"
    document.getElementsByClassName("easychat-dragdropafterSelect__XPS")[0].style.padding = "0"
    document.getElementsByClassName("easychat-dragdropafterSelect__XPS")[0].style.boxShadow = "unset"
    document.getElementsByClassName("easychat-dragdropafterSelect__XPS")[0].style.borderRadius = "unset"
    document.getElementsByClassName("easychat-dragdropafterSelect__XPS")[0].style.display = "none"
}

function side_scroll(direction, speed, distance, step, element_id) {
    let scroll_amount = 0;
    let element = document.querySelector('[intent-scroller-id="' + element_id + '"]');
    var slide_timer = setInterval(function () {
        if (direction == 'left') {
            element.scrollLeft -= step;
        } else {
            element.scrollLeft += step;
        }
        let maxScrollLeft = Math.abs(element.scrollWidth - element.clientWidth);
        if (language_script_type == "ltr") {
            if (element.scrollLeft === 0) document.getElementById("left-sliding-arrow-" + element_id).style.display = "none"
            else document.getElementById("left-sliding-arrow-" + element_id).style.display = "block"
            if (element.scrollLeft >= maxScrollLeft) document.getElementById("right-sliding-arrow-" + element_id).style.display = "none"
            else document.getElementById("right-sliding-arrow-" + element_id).style.display = "block"
        } else {
            if (element.scrollLeft === 0) document.getElementById("right-sliding-arrow-" + element_id).style.display = "none"
            else document.getElementById("right-sliding-arrow-" + element_id).style.display = "block"
            if (Math.abs(element.scrollLeft) >= maxScrollLeft) document.getElementById("left-sliding-arrow-" + element_id).style.display = "none"
            else document.getElementById("left-sliding-arrow-" + element_id).style.display = "block"
        }

        scroll_amount += step;
        if (scroll_amount >= distance) {
            window.clearInterval(slide_timer);
        }
    }, speed);
}

function show_slider_icons(element_id){

    let element = document.querySelector('[intent-scroller-id="' + element_id + '"]');
    let maxScrollLeft = Math.abs(element.scrollWidth - element.clientWidth);

    if (language_script_type == "ltr") {
        if (element.scrollLeft === 0) document.getElementById("left-sliding-arrow-" + element_id).style.display = "none"
        else document.getElementById("left-sliding-arrow-" + element_id).style.display = "block"
        if (element.scrollLeft >= maxScrollLeft) document.getElementById("right-sliding-arrow-" + element_id).style.display = "none"
        else document.getElementById("right-sliding-arrow-" + element_id).style.display = "block"
    } else {
        if (element.scrollLeft === 0) document.getElementById("right-sliding-arrow-" + element_id).style.display = "none"
        else document.getElementById("right-sliding-arrow-" + element_id).style.display = "block"
        if (Math.abs(element.scrollLeft) >= maxScrollLeft) document.getElementById("left-sliding-arrow-" + element_id).style.display = "none"
        else document.getElementById("left-sliding-arrow-" + element_id).style.display = "block"
    }
}

function disable_right_slide_arrow(){
    if (EASYCHAT_BOT_THEME != "theme_4") {
        $(".arrow-left, .arrow-right").hide();
        return;
    }
    let recommendation_list = document.querySelectorAll(".easychat-image-intent-recommendation-wrapper")
    recommendation_list = recommendation_list[recommendation_list.length - 1]
    if (recommendation_list) {
        let maxScrollLeft = Math.abs(recommendation_list.scrollWidth - recommendation_list.clientWidth);
        if(Math.abs(recommendation_list.scrollLeft) >= maxScrollLeft) {
            let element_id = recommendation_list.getAttribute("intent-scroller-id")
            let right_slide_arrow = document.getElementById("right-sliding-arrow-" + element_id);
            let left_slide_arrow = document.getElementById("left-sliding-arrow-" + element_id);
            if (language_script_type == "ltr") {
                right_slide_arrow.style.display = "none";
            } else {
                left_slide_arrow.style.display = "none";
            }
        }
    }

}

function get_recommendation_html_for_icon_format(recommendations_list) {
    let unique_id = generate_random_string(3);
    let left_default_display = "none";
    let right_default_display = "block";
    if (language_script_type == "rtl") {
        left_default_display = "block";
        right_default_display = "none;"
    }
    let recommendations_html = `
    <div style=" position: relative;">
    <div class="arrow-left" id="left-sliding-arrow-${unique_id}" onclick=side_scroll('left',25,100,10,"${unique_id}"); style="position: absolute;z-index: 1;top: 35px;display: ${left_default_display}; left: 0">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g filter="url(#filter0_dd_12_3814)">
        <circle cx="24" cy="21" r="14" fill="white"></circle>
        </g>
        <path fill-rule="evenodd" clip-rule="evenodd" d="M25.4713 16.5282C25.7317 16.7886 25.7317 17.2107 25.4713 17.471L21.9427 20.9996L25.4713 24.5282C25.7317 24.7885 25.7317 25.2107 25.4713 25.471C25.211 25.7314 24.7889 25.7314 24.5285 25.471L20.5285 21.471C20.2682 21.2107 20.2682 20.7885 20.5285 20.5282L24.5285 16.5282C24.7889 16.2679 25.211 16.2679 25.4713 16.5282Z" fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round"></path>
        <defs>
        <filter id="filter0_dd_12_3814" x="0" y="0" width="48" height="48" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
        <feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix>
        <feOffset dy="3"></feOffset>
        <feGaussianBlur stdDeviation="5"></feGaussianBlur>
        <feComposite in2="hardAlpha" operator="out"></feComposite>
        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.06 0"></feColorMatrix>
        <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_12_3814"></feBlend>
        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix>
        <feOffset dy="2"></feOffset>
        <feGaussianBlur stdDeviation="4"></feGaussianBlur>
        <feComposite in2="hardAlpha" operator="out"></feComposite>
        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.08 0"></feColorMatrix>
        <feBlend mode="normal" in2="effect1_dropShadow_12_3814" result="effect2_dropShadow_12_3814"></feBlend>
        <feBlend mode="normal" in="SourceGraphic" in2="effect2_dropShadow_12_3814" result="shape"></feBlend>
        </filter>
        </defs>
        </svg>
    </div>
    <div  class="arrow-right" id="right-sliding-arrow-${unique_id}" onclick=side_scroll('right',25,100,10,"${unique_id}"); style="position: absolute;right: 0;z-index: 1;top: 35px; display: ${right_default_display}">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g filter="url(#filter0_dd_12_3818)">
        <ellipse rx="13.9333" ry="14" transform="matrix(-1 0 0 1 23.9333 21)" fill="white"></ellipse>
        </g>
        <path fill-rule="evenodd" clip-rule="evenodd" d="M21.3668 16.5282C21.1064 16.7886 21.1064 17.2107 21.3668 17.471L24.8953 20.9996L21.3668 24.5282C21.1064 24.7886 21.1064 25.2107 21.3668 25.471C21.6271 25.7314 22.0492 25.7314 22.3096 25.471L26.3096 21.471C26.5699 21.2107 26.5699 20.7886 26.3096 20.5282L22.3096 16.5282C22.0492 16.2679 21.6271 16.2679 21.3668 16.5282Z" fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round"></path>
        <defs>
        <filter id="filter0_dd_12_3818" x="-3.05176e-05" y="0" width="47.8667" height="48" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
        <feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix>
        <feOffset dy="3"></feOffset>
        <feGaussianBlur stdDeviation="5"></feGaussianBlur>
        <feComposite in2="hardAlpha" operator="out"></feComposite>
        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.06 0"></feColorMatrix>
        <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_12_3818"></feBlend>
        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix>
        <feOffset dy="2"></feOffset>
        <feGaussianBlur stdDeviation="4"></feGaussianBlur>
        <feComposite in2="hardAlpha" operator="out"></feComposite>
        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.08 0"></feColorMatrix>
        <feBlend mode="normal" in2="effect1_dropShadow_12_3818" result="effect2_dropShadow_12_3818"></feBlend>
        <feBlend mode="normal" in="SourceGraphic" in2="effect2_dropShadow_12_3818" result="shape"></feBlend>
        </filter>
        </defs>
        </svg>
    </div>
    <div onscroll=show_slider_icons("${unique_id}") id="easychat-image-intent-recommendation-list-wrapper" intent-scroller-id="${unique_id}" class="easychat-image-intent-recommendation-wrapper">`;

    for (var i = 0; i < recommendations_list.length; i++) {

        if (recommendations_list[i] == 'Do not disturb' || recommendations_list[i].name == 'Do not disturb') {
            let recommendation_name = DO_NOT_DISTURB_TEXT
            recommendations_html += '<div class="easychat-image-intent-item" intent-name="' + recommendation_name + '" onclick=confirm_do_not_disturb()>\
                    <div class="easychat-intent-image-div">\
                        <svg fill="#000000" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="50px" height="50px">\
                        <path d="M 15 3 C 11.783059 3 8.8641982 4.2807926 6.7070312 6.3496094 A 1.0001 1.0001 0 0 0 6.3476562 6.7070312 C 4.2793766 8.8641071 3 11.783531 3 15 C 3 21.615572 8.3844276 27 15 27 C 18.210007 27 21.123475 25.724995 23.279297 23.664062 A 1.0001 1.0001 0 0 0 23.662109 23.28125 C 25.724168 21.125235 27 18.210998 27 15 C 27 8.3844276 21.615572 3 15 3 z M 15 5 C 20.534692 5 25 9.4653079 25 15 C 25 17.40637 24.155173 19.609062 22.746094 21.332031 L 8.6679688 7.2539062 C 10.390938 5.8448274 12.59363 5 15 5 z M 7.2539062 8.6679688 L 21.332031 22.746094 C 19.609062 24.155173 17.40637 25 15 25 C 9.4653079 25 5 20.534692 5 15 C 5 12.59363 5.8448274 10.390938 7.2539062 8.6679688 z"/>\
                    </svg>\
                </div>\
                <div class="easychat-intent-text-div">\
                    <span style="font-size: 10px; padding-top: 2px; line-height: 14px; height: 30px">' + recommendation_name + '</span>\
                </div>\
            </div>';
        } else if (recommendations_list[i].name == GO_BACK_TEXT) {
            if (BOT_THEME_COLOR.toLowerCase() == "#ffffff") {
                recommendation_intent_icon = '<svg width="50" height="50" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg" style="fill: none !important;">\
                    <path d="M8.22368 38.8158H31.9079C35.8553 38.4868 43.75 35.1645 43.75 24.5066C43.4211 20.7237 40.5921 13.1579 31.9079 13.1579H6.25" stroke="' + WHITE_THEME_COLOR + '" stroke-width="3.125" stroke-linecap="round" stroke-linejoin="round"/>\
                    <path d="M6.25 13.1579L14.1447 6.25" stroke="' + WHITE_THEME_COLOR + '" stroke-width="3.125" stroke-linecap="round" stroke-linejoin="round"/>\
                    <path d="M6.25 13.1579L14.1447 19.079" stroke="' + WHITE_THEME_COLOR + '" stroke-width="3.125" stroke-linecap="round" stroke-linejoin="round"/>\
                </svg>'
            } else {
                recommendation_intent_icon = '<svg width="50" height="50" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg" style="fill: none !important;">\
                    <path d="M8.22368 38.8158H31.9079C35.8553 38.4868 43.75 35.1645 43.75 24.5066C43.4211 20.7237 40.5921 13.1579 31.9079 13.1579H6.25" stroke="' + BOT_THEME_COLOR + '" stroke-width="3.125" stroke-linecap="round" stroke-linejoin="round"/>\
                    <path d="M6.25 13.1579L14.1447 6.25" stroke="' + BOT_THEME_COLOR + '" stroke-width="3.125" stroke-linecap="round" stroke-linejoin="round"/>\
                    <path d="M6.25 13.1579L14.1447 19.079" stroke="' + BOT_THEME_COLOR + '" stroke-width="3.125" stroke-linecap="round" stroke-linejoin="round"/>\
                </svg>'
            }
            recommendations_html += '<div class="easychat-image-intent-item" style="position: relative;" intent-name="' + recommendations_list[i].name + '" onclick=send_selected_intent_icon_recommendation(this)>\
                <div class="easychat-intent-image-div">' + recommendation_intent_icon + '\
                </div>\
                <div class="easychat-intent-text-div">\
                    <span style="font-size: 10px; padding-top: 2px; line-height: 14px; height: 30px">' + recommendations_list[i].name + '</span>\
                </div>\
            </div>';

        } else {
            let recommendation_name = recommendations_list[i].name
            if (recommendation_name.length > 35) {
                recommendation_name = recommendation_name.slice(0, 35) + "..."
            }
            recommendations_html += '<div class="easychat-image-intent-item" intent-name="' + recommendations_list[i].name + '" intent-id="' + recommendations_list[i].id + '" onclick=send_selected_intent_icon_recommendation(this)>\
                <div class="easychat-intent-image-div">' + recommendations_list[i].intent_icon + '\
                </div>\
                <div class="easychat-intent-text-div">\
                    <span style="font-size: 10px; padding-top: 2px; line-height: 14px; height: 30px">' + recommendation_name + '</span>\
                </div>\
            </div>';
        }

    }

    recommendations_html += '</div></div>';

    return recommendations_html;

}

function get_initial_question_for_icon_format(recommendations_list) {
    let unique_id = generate_random_string(3)
    let left_default_display = "none";
    let right_default_display = "block";
    if (language_script_type == "rtl") {
        left_default_display = "block";
        right_default_display = "none;"
    }
    let recommendations_html = `<div style=" position: relative;">
    <div  class="arrow-left" id="left-sliding-arrow-${unique_id}" onclick=side_scroll('left',25,100,10,"${unique_id}"); style="position: absolute;z-index: 1;top: 35px;display: ${left_default_display}; left: 0">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g filter="url(#filter0_dd_12_3814)">
        <circle cx="24" cy="21" r="14" fill="white"></circle>
        </g>
        <path fill-rule="evenodd" clip-rule="evenodd" d="M25.4713 16.5282C25.7317 16.7886 25.7317 17.2107 25.4713 17.471L21.9427 20.9996L25.4713 24.5282C25.7317 24.7885 25.7317 25.2107 25.4713 25.471C25.211 25.7314 24.7889 25.7314 24.5285 25.471L20.5285 21.471C20.2682 21.2107 20.2682 20.7885 20.5285 20.5282L24.5285 16.5282C24.7889 16.2679 25.211 16.2679 25.4713 16.5282Z" fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round"></path>
        <defs>
        <filter id="filter0_dd_12_3814" x="0" y="0" width="48" height="48" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
        <feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix>
        <feOffset dy="3"></feOffset>
        <feGaussianBlur stdDeviation="5"></feGaussianBlur>
        <feComposite in2="hardAlpha" operator="out"></feComposite>
        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.06 0"></feColorMatrix>
        <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_12_3814"></feBlend>
        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix>
        <feOffset dy="2"></feOffset>
        <feGaussianBlur stdDeviation="4"></feGaussianBlur>
        <feComposite in2="hardAlpha" operator="out"></feComposite>
        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.08 0"></feColorMatrix>
        <feBlend mode="normal" in2="effect1_dropShadow_12_3814" result="effect2_dropShadow_12_3814"></feBlend>
        <feBlend mode="normal" in="SourceGraphic" in2="effect2_dropShadow_12_3814" result="shape"></feBlend>
        </filter>
        </defs>
        </svg>
    </div>
    <div  class="arrow-right" id="right-sliding-arrow-${unique_id}" onclick=side_scroll('right',25,100,10,"${unique_id}"); style="display: ${right_default_display};position: absolute;right: 0;z-index: 1;top: 35px;">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g filter="url(#filter0_dd_12_3818)">
        <ellipse rx="13.9333" ry="14" transform="matrix(-1 0 0 1 23.9333 21)" fill="white"></ellipse>
        </g>
        <path fill-rule="evenodd" clip-rule="evenodd" d="M21.3668 16.5282C21.1064 16.7886 21.1064 17.2107 21.3668 17.471L24.8953 20.9996L21.3668 24.5282C21.1064 24.7886 21.1064 25.2107 21.3668 25.471C21.6271 25.7314 22.0492 25.7314 22.3096 25.471L26.3096 21.471C26.5699 21.2107 26.5699 20.7886 26.3096 20.5282L22.3096 16.5282C22.0492 16.2679 21.6271 16.2679 21.3668 16.5282Z" fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round"></path>
        <defs>
        <filter id="filter0_dd_12_3818" x="-3.05176e-05" y="0" width="47.8667" height="48" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
        <feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix>
        <feOffset dy="3"></feOffset>
        <feGaussianBlur stdDeviation="5"></feGaussianBlur>
        <feComposite in2="hardAlpha" operator="out"></feComposite>
        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.06 0"></feColorMatrix>
        <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_12_3818"></feBlend>
        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix>
        <feOffset dy="2"></feOffset>
        <feGaussianBlur stdDeviation="4"></feGaussianBlur>
        <feComposite in2="hardAlpha" operator="out"></feComposite>
        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.08 0"></feColorMatrix>
        <feBlend mode="normal" in2="effect1_dropShadow_12_3818" result="effect2_dropShadow_12_3818"></feBlend>
        <feBlend mode="normal" in="SourceGraphic" in2="effect2_dropShadow_12_3818" result="shape"></feBlend>
        </filter>
        </defs>
        </svg>
    </div>
    <div onscroll=show_slider_icons("${unique_id}") id="easychat-image-intent-recommendation-list-wrapper" intent-scroller-id="${unique_id}" class="easychat-image-intent-recommendation-wrapper">`;

    for (var i = 0; i < recommendations_list.length; i++) {

        let recommendation_name, recommendation_intent_icon;
        if (recommendations_list[i] == 'Do not disturb' || recommendations_list[i].name == 'Do not disturb') {
            recommendation_name = DO_NOT_DISTURB_TEXT
            recommendation_intent_icon = '<svg fill="#000000" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="50px" height="50px">\
                                            <path d="M 15 3 C 11.783059 3 8.8641982 4.2807926 6.7070312 6.3496094 A 1.0001 1.0001 0 0 0 6.3476562 6.7070312 C 4.2793766 8.8641071 3 11.783531 3 15 C 3 21.615572 8.3844276 27 15 27 C 18.210007 27 21.123475 25.724995 23.279297 23.664062 A 1.0001 1.0001 0 0 0 23.662109 23.28125 C 25.724168 21.125235 27 18.210998 27 15 C 27 8.3844276 21.615572 3 15 3 z M 15 5 C 20.534692 5 25 9.4653079 25 15 C 25 17.40637 24.155173 19.609062 22.746094 21.332031 L 8.6679688 7.2539062 C 10.390938 5.8448274 12.59363 5 15 5 z M 7.2539062 8.6679688 L 21.332031 22.746094 C 19.609062 24.155173 17.40637 25 15 25 C 9.4653079 25 5 20.534692 5 15 C 5 12.59363 5.8448274 10.390938 7.2539062 8.6679688 z"/>\
                                        </svg>'
            recommendations_html += '<div class="easychat-image-intent-item" style="position: relative;" intent-name="' + recommendation_name + '" onclick=confirm_do_not_disturb()>'
        } else if (recommendations_list[i].name == GO_BACK_TEXT) {
            recommendation_name = recommendations_list[i].name;
            if (BOT_THEME_COLOR.toLowerCase() == "#ffffff") {
                recommendation_intent_icon = '<svg width="50" height="50" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg" style="fill: none !important;">\
                    <path d="M8.22368 38.8158H31.9079C35.8553 38.4868 43.75 35.1645 43.75 24.5066C43.4211 20.7237 40.5921 13.1579 31.9079 13.1579H6.25" stroke="' + WHITE_THEME_COLOR + '" stroke-width="3.125" stroke-linecap="round" stroke-linejoin="round"/>\
                    <path d="M6.25 13.1579L14.1447 6.25" stroke="' + WHITE_THEME_COLOR + '" stroke-width="3.125" stroke-linecap="round" stroke-linejoin="round"/>\
                    <path d="M6.25 13.1579L14.1447 19.079" stroke="' + WHITE_THEME_COLOR + '" stroke-width="3.125" stroke-linecap="round" stroke-linejoin="round"/>\
                </svg>'
            } else {
                recommendation_intent_icon = '<svg width="50" height="50" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg" style="fill: none !important;">\
                    <path d="M8.22368 38.8158H31.9079C35.8553 38.4868 43.75 35.1645 43.75 24.5066C43.4211 20.7237 40.5921 13.1579 31.9079 13.1579H6.25" stroke="' + BOT_THEME_COLOR + '" stroke-width="3.125" stroke-linecap="round" stroke-linejoin="round"/>\
                    <path d="M6.25 13.1579L14.1447 6.25" stroke="' + BOT_THEME_COLOR + '" stroke-width="3.125" stroke-linecap="round" stroke-linejoin="round"/>\
                    <path d="M6.25 13.1579L14.1447 19.079" stroke="' + BOT_THEME_COLOR + '" stroke-width="3.125" stroke-linecap="round" stroke-linejoin="round"/>\
                </svg>'
            }
            recommendations_html += '<div class="easychat-image-intent-item" style="position: relative;" intent-name="' + recommendation_name + '" onclick=send_selected_intent_icon_recommendation(this)>'

        } else {
            recommendation_name = recommendations_list[i].name
            let full_recommendation_name = recommendation_name
            if (recommendation_name.length > 35) {
                recommendation_name = recommendation_name.slice(0, 35) + "..."
            }
            recommendation_intent_icon = recommendations_list[i].intent_icon
            recommendations_html += '<div class="easychat-image-intent-item"  style="position: relative;" title="'+ full_recommendation_name +'" intent-name="' + recommendations_list[i].name + '" intent-id="' + recommendations_list[i].id + '" onclick=send_selected_intent_icon_recommendation(this)>'
        }

        if (recommendations_list[i].new_tag) {
            recommendations_html += get_new_tag_for_icon_div();
        }

        recommendations_html += '<div class="easychat-intent-image-div">' + recommendation_intent_icon + '\
            </div>\
            <div class="easychat-intent-text-div">\
                <span style="font-size: 10px; padding-top: 2px; line-height: 14px; height: 30px">' + recommendation_name + '</span>\
            </div>\
        </div>';
    }

    recommendations_html += '</div></div>';

    return recommendations_html;
}

function get_recomendations_html_for_chip_format(recommendations_list) {

    recommendations_html = '<div class="easychat-bot-quick-recommendation-wrapper">';

    for (var i = 0; i < recommendations_list.length; i++) {

        var rec_name = recommendations_list[i].name ? recommendations_list[i].name : recommendations_list[i];

        if (rec_name == 'Do not disturb') {
            rec_name = DO_NOT_DISTURB_TEXT
            recommendations_html += "<div class=\"easychat-quick-recommendation-item\" data-id=" + recommendations_list[i].id + " onclick=\"confirm_do_not_disturb()\">" + rec_name + "</div>";
        } else {
            recommendations_html += "<div class=\"easychat-quick-recommendation-item\" data-id=" + recommendations_list[i].id + " onclick=\"send_selected_recommendation(this)\">" + rec_name + "</div>";
        }

    }

    recommendations_html += "</div>";

    return recommendations_html;
}

function get_recomendations_html_for_menu_format(recommendations_list) {

    recommendations_html = '<div class="easychat-recommendation-wrapper-menu"  align="left">';
    for (var i = 0; i < recommendations_list.length; i++) {
        var rec_name = recommendations_list[i].name ? recommendations_list[i].name : recommendations_list[i];

        recommendations_html += "<div class=\"easychat-recommendation-menu\"  style=\"border: 0.05em solid " + BOT_THEME_COLOR + ";color: " + BOT_THEME_COLOR + "\" data-id=" + recommendations_list[i].id + " onclick=\"send_selected_recommendation(this)\">" + rec_name + "</div>";
    }
    recommendations_html += "</div>";

    recommendations_html += "</div>";
    return recommendations_html;
}

function append_bot_recommendations_for_theme_three_and_four(recommendations_list) {

    var is_recommendation_menu = get_cookie("is_recommendation_menu")

    recommendations_html = ""

    if (is_recommendation_menu == "true") {
        if (EASYCHAT_BOT_THEME == "theme_4") {
            recommendations_html = get_recomendations_menu_for_theme_four(recommendations_list)
        } else {
            recommendations_html = get_recomendations_html_for_menu_format(recommendations_list);
        }
    } else if (recommendations_list[0].intent_icon) {
        recommendations_html = get_recommendation_html_for_icon_format(recommendations_list);
    } else {
        recommendations_html = get_recomendations_html_for_chip_format(recommendations_list);
    }

    $("#easychat-chat-container").append(recommendations_html)
    disable_right_slide_arrow()

    try {
        if (recommendations_list[0].intent_icon) {
            element_response = document.querySelectorAll(".easychat-image-intent-recommendation-wrapper")
            element_response_previous_height += element_response[element_response.length - 1].clientHeight
        } else {
            element_response = document.querySelectorAll(".easychat-bot-quick-recommendation-wrapper")
            element_response_previous_height += element_response[element_response.length - 1].clientHeight
        }
    } catch (err) {
        element_response = document.querySelectorAll(".easychat-recommendation-wrapper-menu")
        element_response_previous_height += element_response[element_response.length - 1].clientHeight
        console.log(err)
    }
    resize_chabot_window();
}

function get_new_tag_svg() {
    return '<div class="icon-new-tag">\
                    <svg width="25" height="25" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <path d="M10.9996 20.9994C10.2306 20.9994 9.46257 20.7074 8.87555 20.1243L8.14552 19.3943C7.86251 19.1123 7.4835 18.9563 7.08148 18.9553H6.05444C4.39438 18.9553 3.04333 17.6042 3.04333 15.9442V14.9161C3.04233 14.5151 2.88633 14.1361 2.60332 13.8511L1.88529 13.1341C0.70925 11.965 0.70425 10.054 1.87429 8.87692L2.60432 8.1459C2.88633 7.86289 3.04233 7.48387 3.04333 7.08186V6.05582C3.04333 4.39476 4.39438 3.04371 6.05444 3.04371H7.08248C7.4835 3.04371 7.86151 2.88771 8.14652 2.60269L8.86555 1.88567C10.0346 0.709626 11.9447 0.703626 13.1227 1.87467L13.8527 2.6047C14.1367 2.88771 14.5148 3.04371 14.9158 3.04371H15.9438C17.6039 3.04371 18.9549 4.39476 18.9549 6.05582V7.08286C18.9559 7.48387 19.1119 7.86289 19.3949 8.1479L20.113 8.86592C20.682 9.43194 20.997 10.186 21 10.991C21.002 11.791 20.694 12.5441 20.133 13.1131C20.123 13.1231 20.114 13.1341 20.104 13.1431L19.3939 13.8531C19.1119 14.1361 18.9559 14.5151 18.9549 14.9171V15.9442C18.9549 17.6042 17.6039 18.9553 15.9438 18.9553H14.9158C14.5148 18.9563 14.1357 19.1123 13.8517 19.3953L13.1327 20.1133C12.5467 20.7034 11.7727 20.9994 10.9996 20.9994Z" fill="#E53E3E"/>\
                        <path d="M10.9996 20.9994C10.2306 20.9994 9.46257 20.7074 8.87555 20.1243L8.14552 19.3943C7.86251 19.1123 7.4835 18.9563 7.08148 18.9553H6.05444C4.39438 18.9553 3.04333 17.6042 3.04333 15.9442V14.9161C3.04233 14.5151 2.88633 14.1361 2.60332 13.8511L1.88529 13.1341C0.70925 11.965 0.70425 10.054 1.87429 8.87692L2.60432 8.1459C2.88633 7.86289 3.04233 7.48387 3.04333 7.08186V6.05582C3.04333 4.39476 4.39438 3.04371 6.05444 3.04371H7.08248C7.4835 3.04371 7.86151 2.88771 8.14652 2.6027L8.86555 1.88567C10.0346 0.709626 11.9447 0.703626 13.1227 1.87467L13.8527 2.6047C14.1367 2.88771 14.5148 3.04371 14.9158 3.04371H15.9438C17.6039 3.04371 18.9549 4.39476 18.9549 6.05582V7.08286C18.9559 7.48387 19.1119 7.86289 19.3949 8.1479L20.113 8.86592C20.682 9.43194 20.997 10.186 21 10.991C21.002 11.791 20.694 12.5441 20.133 13.1131C20.123 13.1231 20.114 13.1341 20.104 13.1431L19.3939 13.8531C19.1119 14.1361 18.9559 14.5151 18.9549 14.9171V15.9442C18.9549 17.6042 17.6039 18.9553 15.9438 18.9553H14.9158C14.5148 18.9563 14.1357 19.1123 13.8517 19.3953L13.1327 20.1133C12.5467 20.7034 11.7727 20.9994 10.9996 20.9994" stroke="white" stroke-width="0.833333"/>\
                        <path d="M5.34424 13V9.49902H6.2207L7.56104 11.7012H7.59033V9.49902H8.35449V13H7.47559L6.14014 10.8003H6.11084V13H5.34424ZM8.94541 13V9.49902H11.1622V10.1753H9.73643V10.9004H10.9522V11.5742H9.73643V12.3188H11.2159V13H8.94541ZM11.3747 9.49902H12.239L12.7492 11.7744H12.7883L13.3083 9.49902H14.2849L14.8098 11.7744H14.8488L15.3591 9.49902H16.2233L15.3127 13H14.3776L13.8186 10.6343H13.7795L13.2131 13H12.2829L11.3747 9.49902Z" fill="white"/>\
                    </svg>\
            </div>'
}

function get_new_tag_for_icon_div() {

    return '<div class="easychat-bot-intent-image-new-tag-div">\
            <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">\
                <path d="M10.9999 21C10.2309 21 9.46284 20.708 8.8758 20.1249L8.14575 19.3949C7.86273 19.1129 7.4837 18.9569 7.08168 18.9559H6.05461C4.39449 18.9559 3.0434 17.6048 3.0434 15.9447V14.9166C3.0424 14.5156 2.88639 14.1365 2.60337 13.8515L1.88532 13.1345C0.70924 11.9654 0.70424 10.0543 1.87432 8.87717L2.60437 8.14612C2.88639 7.8631 3.0424 7.48408 3.0434 7.08205V6.05598C3.0434 4.39487 4.39449 3.04378 6.05461 3.04378H7.08267C7.4837 3.04378 7.86173 2.88777 8.14675 2.60275L8.8658 1.8857C10.0349 0.709617 11.945 0.703616 13.1231 1.8747L13.8531 2.60475C14.1372 2.88777 14.5152 3.04378 14.9162 3.04378H15.9443C17.6044 3.04378 18.9555 4.39487 18.9555 6.05598V7.08305C18.9565 7.48408 19.1125 7.8631 19.3955 8.14812L20.1136 8.86617C20.6826 9.43221 20.9976 10.1863 21.0006 10.9913C21.0026 11.7914 20.6946 12.5444 20.1336 13.1135C20.1236 13.1235 20.1146 13.1345 20.1046 13.1435L19.3945 13.8535C19.1125 14.1365 18.9565 14.5156 18.9555 14.9176V15.9447C18.9555 17.6048 17.6044 18.9559 15.9443 18.9559H14.9162C14.5152 18.9569 14.1362 19.1129 13.8521 19.3959L13.1331 20.1139C12.547 20.704 11.773 21 10.9999 21Z" fill="#E53E3E"/>\
                <path d="M10.9999 21C10.2309 21 9.46284 20.708 8.8758 20.1249L8.14575 19.3949C7.86273 19.1129 7.4837 18.9569 7.08167 18.9559H6.0546C4.39449 18.9559 3.0434 17.6048 3.0434 15.9447V14.9166C3.0424 14.5156 2.88639 14.1365 2.60337 13.8515L1.88532 13.1345C0.70924 11.9654 0.70424 10.0543 1.87432 8.87717L2.60437 8.14612C2.88639 7.8631 3.0424 7.48408 3.0434 7.08205V6.05598C3.0434 4.39487 4.39449 3.04378 6.0546 3.04378H7.08267C7.4837 3.04378 7.86173 2.88777 8.14675 2.60275L8.8658 1.8857C10.0349 0.709617 11.945 0.703616 13.1231 1.8747L13.8531 2.60475C14.1372 2.88777 14.5152 3.04378 14.9162 3.04378H15.9443C17.6044 3.04378 18.9555 4.39487 18.9555 6.05598V7.08305C18.9565 7.48408 19.1125 7.8631 19.3955 8.14812L20.1136 8.86617C20.6826 9.43221 20.9976 10.1863 21.0006 10.9913C21.0026 11.7914 20.6946 12.5444 20.1336 13.1135C20.1236 13.1235 20.1146 13.1345 20.1046 13.1435L19.3945 13.8535C19.1125 14.1365 18.9565 14.5156 18.9555 14.9176V15.9447C18.9555 17.6048 17.6044 18.9559 15.9443 18.9559H14.9162C14.5152 18.9569 14.1362 19.1129 13.8521 19.3959L13.1331 20.1139C12.547 20.704 11.773 21 10.9999 21" stroke="white" stroke-width="0.83336"/>\
                <path d="M5.34424 13V9.49902H6.2207L7.56104 11.7012H7.59033V9.49902H8.35449V13H7.47559L6.14014 10.8003H6.11084V13H5.34424ZM8.94541 13V9.49902H11.1622V10.1753H9.73643V10.9004H10.9522V11.5742H9.73643V12.3188H11.2159V13H8.94541ZM11.3747 9.49902H12.239L12.7492 11.7744H12.7883L13.3083 9.49902H14.2849L14.8098 11.7744H14.8488L15.3591 9.49902H16.2233L15.3127 13H14.3776L13.8186 10.6343H13.7795L13.2131 13H12.2829L11.3747 9.49902Z" fill="white"/>\
                </svg>\
        </div>'
}


function append_bot_recommendation(recommendations_list) {
    var is_recommendation_menu = get_cookie("is_recommendation_menu")
    var recommendations_html = '';

    if (is_recommendation_menu == "true") {
        recommendations_html = '<div class="easychat-recommendation-wrapper-menu"  align="left">';
        for (var i = 0; i < recommendations_list.length; i++) {
            var rec_name = recommendations_list[i].name ? recommendations_list[i].name : recommendations_list[i];

            if (EASYCHAT_BOT_THEME == "theme_2") {
                recommendations_html += "<div class=\"easychat-recommendation-menu\"  style=\"border: 0.05em solid " + BOT_THEME_COLOR + ";color: " + BOT_THEME_COLOR + "\" data-id=" + recommendations_list[i].id + " onclick=\"send_selected_recommendation(this)\">" + rec_name + "</div>";

            } else {
                recommendations_html += "<div class=\"easychat-recommendation-menu\" onmouseover='custom_button_change(this)' onmouseout='custom_button_change_normal(this)' style=\"border: 0.05em solid " + BOT_THEME_COLOR + ";color: " + BOT_THEME_COLOR + "\" data-id=" + recommendations_list[i].id + " onclick=\"send_selected_recommendation(this)\">" + rec_name + "</div>";
            }

            if (EASYCHAT_BOT_THEME == "theme_1" && i < recommendations_list.length - 1) {
                recommendations_html += '<hr class = "recommendations-menu-border">';
            }
        }
        recommendations_html += "</div>";

    } else if (recommendations_list[0].intent_icon) {

        var recommendations_html = get_initial_question_for_icon_format(recommendations_list);

    } else {
        recommendations_html = '<div class="easychat-recommendation-wrapper"  align="left">';

        var recommendation_color = BOT_THEME_COLOR;
        if (BOT_THEME_COLOR.toLowerCase() == "#ffffff") {
            recommendation_color = WHITE_THEME_COLOR;
        }
        for (var i = 0; i < recommendations_list.length; i++) {
            var rec_name = recommendations_list[i].name ? recommendations_list[i].name : recommendations_list[i];
            var new_tag = ''
            let intent_on_click_function = 'send_selected_recommendation(this);'
            if (recommendations_list[i] == 'Do not disturb') {
                rec_name = DO_NOT_DISTURB_TEXT
                intent_on_click_function = "confirm_do_not_disturb()"
            }
            if (recommendations_list[i].new_tag) {
                new_tag = get_new_tag_svg()
            }
            if (EASYCHAT_BOT_THEME == "theme_2") {
                recommendations_html += '<div class="easychat-recommendation intent-box-item"  style="border: 0.05em solid ' + recommendation_color + ' ;background-color: ' + recommendation_color + '" data-id="' + recommendations_list[i].id + '" \
                onclick="' + intent_on_click_function + '">' + rec_name + '' + new_tag + '</div>';

            } else {
                recommendations_html += '<div class="easychat-recommendation" onmouseover="custom_button_change(this)" onmouseout="custom_button_change_normal(this)" style="border: 0.05em solid ' + recommendation_color + ';color: ' + recommendation_color + '" data-id="' + recommendations_list[i].id + '"\
                 onclick="' + intent_on_click_function + '"> ' + rec_name + '' + new_tag + '</div>';
            }
        }

        recommendations_html += "</div>";
    }
    $("#easychat-chat-container").append(recommendations_html)
    disable_right_slide_arrow()
    try {
        if (recommendations_list[0].intent_icon) {
            element_response = document.querySelectorAll(".easychat-image-intent-recommendation-wrapper")
            element_response_previous_height += element_response[element_response.length - 1].clientHeight
        } else {
            element_response = document.querySelectorAll(".easychat-recommendation-wrapper-menu")
            element_response_previous_height += element_response[element_response.length - 1].clientHeight
        }
    } catch (err) {
        if (recommendations_list[0].intent_icon) {
            element_response = document.querySelectorAll(".easychat-recommendation-wrapper-menu")
        } else {
            element_response = document.querySelectorAll(".easychat-recommendation-wrapper")
        }
        element_response_previous_height += element_response[element_response.length - 1].clientHeight
    }
    resize_chabot_window();
}


function append_bot_initial_question_based_on_theme(is_web_landing_allowed, recommendations, web_url_initial_intent_present) {

    if (EASYCHAT_BOT_THEME == "theme_1") {
        if (is_web_landing_allowed == "false") {
            append_bot_initial_questions(recommendations);
        } else if (is_web_landing_allowed == "true" && web_url_initial_intent_present == true) {
            append_bot_initial_questions(recommendations);
        }
    } else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        if (is_web_landing_allowed == "false") {
            append_bot_initial_questions_theme_three_and_four(recommendations);
        } else if (is_web_landing_allowed == "true" && web_url_initial_intent_present == true) {
            append_bot_initial_questions_theme_three_and_four(recommendations);
        }
    } else {
        if (is_web_landing_allowed == "false") {
            append_bot_recommendations_based_on_theme(recommendations);
        } else if (is_web_landing_allowed == "true" && web_url_initial_intent_present == true) {
            append_bot_recommendations_based_on_theme(recommendations);
        }
    }

}

function append_bot_initial_questions_theme_three_and_four(recommendations_list) {

    if (recommendations_list[0].intent_icon) {

        var recommendations_html = get_initial_question_for_icon_format(recommendations_list);

    } else {
        var new_tag_enabled = false;
        var recommendations_html = '<div class="easychat-bot-recommendation-wrapper">';
        for (var i = 0; i < recommendations_list.length; i++) {
            var rec_name = recommendations_list[i].name ? recommendations_list[i].name : recommendations_list[i];
            var new_tag = ''

            if (recommendations_list[i].new_tag) {
                new_tag = get_new_tag_svg()
            }

            recommendations_html += "<div class=\"easychat-recommendation-item intent-box-item\"  data-id=" + recommendations_list[i].id + " onclick=\"send_selected_recommendation(this)\">" + rec_name + " " + new_tag + "</div>";
        }
        recommendations_html += "</div>";
    }

    $("#easychat-chat-container").append(recommendations_html)
    disable_right_slide_arrow()

    resize_chabot_window();

}

function append_bot_initial_questions(recommendations_list) {
    new_tag_enabled = false

    if (recommendations_list[0].intent_icon) {

        var recommendations_html = get_initial_question_for_icon_format(recommendations_list);

    } else {
        var recommendations_html = '<div class="easychat-initial-question-wrapper" align="left"><h6>Suggestions:</h6><div class = "easychat-initial-question-div">';
        var initial_questions_background_color = BOT_THEME_COLOR;
        var initial_questions_background_light_color = BOT_THEME_COLOR_LIGHT;
        if (BOT_THEME_COLOR.toLowerCase() == "#ffffff") {
            initial_questions_background_color = WHITE_THEME_COLOR;
            initial_questions_background_light_color = WHITE_THEME_COLOR;
        }
        for (var i = 0; i < recommendations_list.length; i++) {
            var new_tag = ''
            if (recommendations_list[i].new_tag) {
                new_tag = get_new_tag_svg()
            }

            if (new_tag != '') {
                new_tag_enabled = true
            }

            recommendations_html += '<div class="easychat-initial-question intent-box-item" id="border" style = "background: linear-gradient(180deg, ' + initial_questions_background_light_color + ' 0%, ' + initial_questions_background_color + ' 100%) !important;" data-id=' + recommendations_list[i].id + ' onclick="send_selected_initial_question(this)"><p id="initial-question' + i + '">' + recommendations_list[i].name + '</p>' + ' ' + new_tag + '</div>';
        }

        recommendations_html += "</div></div>";
    }

    $("#easychat-chat-container").append(recommendations_html)
    disable_right_slide_arrow()

    if (!recommendations_list[0].intent_icon) {

        for (var recommendation_id = 0; recommendation_id < recommendations_list.length; recommendation_id++) {
            var height = document.getElementById("initial-question" + recommendation_id).offsetHeight;
            var height_parent = document.getElementById('border').clientHeight;
            var fontsize = window.getComputedStyle(document.querySelector('.easychat-initial-question p')).fontSize;
            fontsize = parseFloat(fontsize);
            while (height > height_parent - 35) {
                fontsize = fontsize - 1;
                $("#initial-question" + recommendation_id).css('fontSize', fontsize);
                height = document.getElementById("initial-question" + recommendation_id).offsetHeight;
            }
        }
    }
    resize_chabot_window();

    if (new_tag_enabled) {
        document.getElementsByClassName("easychat-initial-question-div")[0].style.paddingTop = "10px"
    }
}
function get_theme_three_and_four_choice_html(display, value) {

    return '<button class="easychat-choices" value="' + value + '" onclick="send_selected_choice(this)">' + display + '</button>';

}
function append_bot_choices(choices_list) {
    var choices_html = '<div class="easychat-choices-wrapper">';

    var theme_color = BOT_THEME_COLOR;
    if (BOT_THEME_COLOR.toLowerCase() == "#ffffff") {
        theme_color = WHITE_THEME_COLOR;
    }

    for (var i = 0; i < choices_list.length; i++) {
        var display = choices_list[i]["display"];
        var value = choices_list[i]["value"];
        if (EASYCHAT_BOT_THEME == "theme_2") {
            let margin_left_bot_choices = "margin-left:0px;";
            let margin_right_bot_choices = "margin-right:7px;";
            if (language_script_type == "rtl") {
                margin_left_bot_choices = "margin-left:7px;";
                margin_right_bot_choices = "margin-right:0px;";
            }
            choices_html += '<button class="easychat-choices" onmouseover="custom_button_change(this)" onmouseout="custom_button_change_normal(this)" style=\"border: 0.05em solid ' + theme_color + '; ' + margin_left_bot_choices + margin_right_bot_choices + ' background-color: ' + theme_color + '\" value="' + value + '" onclick="send_selected_choice(this)">' + display + '</button>';
            
        } else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {

            choices_html += get_theme_three_and_four_choice_html(display, value);

        } else {
            choices_html += '<button class="easychat-choices" onmouseover="custom_button_change(this)" onmouseout="custom_button_change_normal(this)" style=\"border: 0.05em solid ' + theme_color + ';color: ' + theme_color + '\" value="' + value + '" onclick="send_selected_choice(this)">' + display + '</button>';
        }
    }
    choices_html += "</div>";
    $("#easychat-chat-container").append(choices_html)
    element_response = document.querySelectorAll(".easychat-choices-wrapper")
    element_response_previous_height += element_response[element_response.length - 1].clientHeight
}

function append_feedback_btns_for_theme_three_and_four(feedback_id) {

    if (is_welcome_screen_present()) {
        return;
    }

    html = get_feedback_wrapper_div_html(feedback_id)

    $("#easychat-chat-container").append(html)

}

function append_feedback_btns(feedback_id) {

    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        append_feedback_btns_for_theme_three_and_four(feedback_id);
        return
    }
    let el = null;
    if (is_text_to_speech_required) {
        el = document.getElementById("easychat-chat-container").lastChild.children[document.getElementById("easychat-chat-container").lastChild.children.length - 2];
    } else {
        el = document.getElementById("easychat-chat-container").lastChild.lastChild;
    }
    let is_bot_icon_width_required = true;
    let paddingRight = '10px';

    try {
        if (el.classList.contains('easychat-datepicker-div') || el.classList.contains('easychat-timepicker-div')) {
            is_bot_icon_width_required = false;
        }

        if (el.classList.contains('easychat-recommendation') || el.classList.contains('easychat-datepicker-div') || el.classList.contains('easychat-timepicker-div')) {
            el = el.parentElement;
        }

        if (el.parentElement.classList.contains('easychat-range-slider-container')) {
            paddingRight = '6em';
        } else if (el.classList.contains('easychat-bot-table')) {
            paddingRight = '2em';
        }
    } catch (err) {
        console.log("class error " + err)
    }

    let el_style;
    const bot_icon_width = 35;
    try {
        el_style = window.getComputedStyle ? getComputedStyle(el, null) : el.currentStyle;
    } catch (err) {
        el = el.parentElement;
        el_style = window.getComputedStyle ? getComputedStyle(el, null) : el.currentStyle;
    }

    let width = parseInt(el_style.width)
    width = width < 40 ? 111 : width;

    if (EASYCHAT_BOT_THEME == "theme_2") {
        is_bot_icon_width_required = false;
    }
    if (is_bot_icon_width_required) {
        width += bot_icon_width;
    }

    var padding_left = "0px";
    if (EASYCHAT_BOT_THEME == "theme_1" && document.getElementsByTagName("body")[0].classList.contains("language-right-to-left-wrapper") && (el.classList.contains("checkbox-div") || el.classList.contains("radio-div"))) {
        padding_left = "55px";
    }

    if (EASYCHAT_BOT_THEME == "theme_1" || EASYCHAT_BOT_THEME == "theme_2") {
        if (language_script_type == "rtl") {
            paddingRight = "23px";
        }
        var choices_html = '<div class="easychat-feedback-wrapper" style = "width:' + width + 'px; padding-right: ' + paddingRight + '; padding-left: ' + padding_left + ';">\
        <div id = "thumbs-up" onmouseover="change_thumbs_color(this)" onmouseout="change_thumbs_color_normal(this)" onclick="easychat_send_feedback_msg(this,' + feedback_id + ',1,\'\')" style = "margin: 10px;">\
        <svg style = "pointer-events: none;" width="39" height="39" viewBox="0 0 39 39" fill="none" xmlns="http://www.w3.org/2000/svg">\
        <ellipse id="thumbs-up-part-1" cx="19.5" cy="19.5" rx="18.5" ry="18.5" fill="white" stroke="#BABABA" stroke-width="2" ></ellipse>\
        <g clip-path="url(#clip0)">\
        <path id="thumbs-up-part-2" d="M13.9383 18.825C13.1345 18.825 12.48 19.4795 12.48 20.2833V24.9499C12.48 25.7538 13.1345 26.4083 13.9383 26.4083H15.6883C16.0167 26.4083 16.3189 26.2974 16.5633 26.1131V18.825H13.9383Z" fill="#BABABA"/>\
        <path id="thumbs-up-part-3" d="M26.4799 21.0125C26.4799 20.662 26.3411 20.3353 26.1002 20.0943C26.3726 19.7963 26.5114 19.3967 26.4735 18.9808C26.4053 18.2393 25.7373 17.6583 24.9522 17.6583H21.3489C21.5274 17.1164 21.8133 16.123 21.8133 15.325C21.8133 14.0598 20.7382 12.9917 20.0633 12.9917C19.4572 12.9917 19.0243 13.3329 19.0057 13.3469C18.9369 13.4024 18.8966 13.4864 18.8966 13.575V15.5531L17.2166 19.1925L17.1466 19.2281V25.4803C17.6214 25.7043 18.2223 25.825 18.6049 25.825H23.9594C24.5946 25.825 25.1505 25.3968 25.2812 24.806C25.3483 24.502 25.3092 24.1958 25.1756 23.9298C25.6067 23.7128 25.8966 23.2688 25.8966 22.7625C25.8966 22.556 25.8494 22.3583 25.7595 22.1792C26.1906 21.9622 26.4799 21.5183 26.4799 21.0125Z" fill="#BABABA"/>\
        </g>\
        <defs>\
        <clipPath id="clip0">\
        <rect width="14" height="14" fill="white" transform="translate(12.48 12.7)"/>\
        </clipPath>\
        </defs>\
        </svg>\
        </div>\
        <div id = "thumbs-down" onmouseover="change_thumbs_color(this)" onmouseout="change_thumbs_color_normal(this)" onclick="easychat_send_feedback_msg(this,' + feedback_id + ',-1,\'\')" style = "margin: 10px 0px 10px 10px;">\
        <svg style = "pointer-events: none;" width="39" height="39" viewBox="0 0 39 39" fill="none" xmlns="http://www.w3.org/2000/svg">\
        <ellipse cx="19.5" cy="19.5" rx="19.5" ry="19.5" fill="white"></ellipse>\
        <ellipse id="thumbs-down-part-1" cx="19.5" cy="19.5" rx="18.5" ry="18.5" stroke="#BABABA" stroke-width="2"></ellipse>\
        <path id="thumbs-down-part-2" d="M25.5417 20.875C26.3455 20.875 27 20.2205 27 19.4167V14.75C27 13.9462 26.3455 13.2917 25.5417 13.2917H23.7917C23.4633 13.2917 23.1611 13.4025 22.9167 13.5869V20.875H25.5417Z" fill="#CFCFCF"/>\
        <path id="thumbs-down-part-3" d="M13 18.6874C13 19.038 13.1389 19.3647 13.3798 19.6056C13.1074 19.9037 12.9685 20.3033 13.0065 20.7192C13.0747 21.4606 13.7426 22.0416 14.5278 22.0416H18.131C17.9525 22.5835 17.6667 23.5769 17.6667 24.3749C17.6667 25.6402 18.7418 26.7083 19.4167 26.7083C20.0228 26.7083 20.4557 26.367 20.4743 26.353C20.5431 26.2976 20.5834 26.2136 20.5834 26.1249V24.1469L22.2634 20.5074L22.3334 20.4719V14.2197C21.8585 13.9957 21.2577 13.8749 20.875 13.8749H15.5206C14.8854 13.8749 14.3294 14.3031 14.1988 14.894C14.1317 15.1979 14.1708 15.5042 14.3044 15.7702C13.8733 15.9872 13.5834 16.4311 13.5834 16.9374C13.5834 17.1439 13.6306 17.3417 13.7204 17.5208C13.2894 17.7378 13 18.1817 13 18.6874Z" fill="#CFCFCF"/>\
        </svg>\
        </div>\
    </div>';
    } else {
        var choices_html = '<div class="easychat-choices-wrapper">\
        <button class="easychat-choices" onmouseover="custom_button_change(this)" onmouseout="custom_button_change_normal(this)" style=\"border: 0.05em solid ' + BOT_THEME_COLOR + ';color: ' + BOT_THEME_COLOR + '\" onclick="easychat_send_feedback_msg(this,' + feedback_id + ',1,\'\')"><img src="/static/EasyChatApp/img/thumbs-up-filled.png" style="height:2em;"></button>\
        <button class="easychat-choices" onmouseover="custom_button_change(this)" onmouseout="custom_button_change_normal(this)" style=\"border: 0.05em solid ' + BOT_THEME_COLOR + ';color: ' + BOT_THEME_COLOR + '\" onclick="easychat_send_feedback_msg(this,' + feedback_id + ',-1,\'\')"><img src="/static/EasyChatApp/img/thumbs-down-filled.png" style="height:2em;"></button>\
    </div>';
    }

    $("#easychat-chat-container").append(choices_html)

    if (EASYCHAT_BOT_THEME == "theme_1" || EASYCHAT_BOT_THEME == "theme_2") {
        try {
            element_response = document.querySelectorAll(".easychat-feedback-wrapper")
        } catch (err) { }
    } else {
        try {
            element_response = document.querySelectorAll(".easychat-choices-wrapper")
        } catch (err) { }
    }
    element_response_previous_height += element_response[element_response.length - 1].clientHeight

}

function change_thumbs_color(elem) {
    elem.style.cursor = "pointer";
    var THUMBS_UP_DOWN_COLOR = BOT_THEME_COLOR;
    if (BOT_THEME_COLOR.toLowerCase() == "#ffffff") {
        THUMBS_UP_DOWN_COLOR = "#767B87";
    }
    if (elem.id == "thumbs-up") {
        elem.innerHTML = '<svg style = "pointer-events: none;" width="39" height="39" viewBox="0 0 39 39" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <ellipse id="thumbs-up-part-1" cx="19.5" cy="19.5" rx="18.5" ry="18.5" fill="white" stroke="' + THUMBS_UP_DOWN_COLOR + '" stroke-width="2" ></ellipse>\
                        <g clip-path="url(#clip0)">\
                        <path id="thumbs-up-part-2" d="M13.9383 18.825C13.1345 18.825 12.48 19.4795 12.48 20.2833V24.9499C12.48 25.7538 13.1345 26.4083 13.9383 26.4083H15.6883C16.0167 26.4083 16.3189 26.2974 16.5633 26.1131V18.825H13.9383Z" fill="' + THUMBS_UP_DOWN_COLOR + '"/>\
                        <path id="thumbs-up-part-3" d="M26.4799 21.0125C26.4799 20.662 26.3411 20.3353 26.1002 20.0943C26.3726 19.7963 26.5114 19.3967 26.4735 18.9808C26.4053 18.2393 25.7373 17.6583 24.9522 17.6583H21.3489C21.5274 17.1164 21.8133 16.123 21.8133 15.325C21.8133 14.0598 20.7382 12.9917 20.0633 12.9917C19.4572 12.9917 19.0243 13.3329 19.0057 13.3469C18.9369 13.4024 18.8966 13.4864 18.8966 13.575V15.5531L17.2166 19.1925L17.1466 19.2281V25.4803C17.6214 25.7043 18.2223 25.825 18.6049 25.825H23.9594C24.5946 25.825 25.1505 25.3968 25.2812 24.806C25.3483 24.502 25.3092 24.1958 25.1756 23.9298C25.6067 23.7128 25.8966 23.2688 25.8966 22.7625C25.8966 22.556 25.8494 22.3583 25.7595 22.1792C26.1906 21.9622 26.4799 21.5183 26.4799 21.0125Z" fill="' + THUMBS_UP_DOWN_COLOR + '"/>\
                        </g>\
                        <defs>\
                        <clipPath id="clip0">\
                        <rect width="14" height="14" fill="white" transform="translate(12.48 12.7)"/>\
                        </clipPath>\
                        </defs>\
                        </svg>';
    } else {
        elem.innerHTML = '<svg style = "pointer-events: none;" width="39" height="39" viewBox="0 0 39 39" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <ellipse cx="19.5" cy="19.5" rx="19.5" ry="19.5" fill="white"></ellipse>\
                        <ellipse id="thumbs-down-part-1" cx="19.5" cy="19.5" rx="18.5" ry="18.5" stroke="' + THUMBS_UP_DOWN_COLOR + '" stroke-width="2"></ellipse>\
                        <path id="thumbs-down-part-2" d="M25.5417 20.875C26.3455 20.875 27 20.2205 27 19.4167V14.75C27 13.9462 26.3455 13.2917 25.5417 13.2917H23.7917C23.4633 13.2917 23.1611 13.4025 22.9167 13.5869V20.875H25.5417Z" fill="' + THUMBS_UP_DOWN_COLOR + '"/>\
                        <path id="thumbs-down-part-3" d="M13 18.6874C13 19.038 13.1389 19.3647 13.3798 19.6056C13.1074 19.9037 12.9685 20.3033 13.0065 20.7192C13.0747 21.4606 13.7426 22.0416 14.5278 22.0416H18.131C17.9525 22.5835 17.6667 23.5769 17.6667 24.3749C17.6667 25.6402 18.7418 26.7083 19.4167 26.7083C20.0228 26.7083 20.4557 26.367 20.4743 26.353C20.5431 26.2976 20.5834 26.2136 20.5834 26.1249V24.1469L22.2634 20.5074L22.3334 20.4719V14.2197C21.8585 13.9957 21.2577 13.8749 20.875 13.8749H15.5206C14.8854 13.8749 14.3294 14.3031 14.1988 14.894C14.1317 15.1979 14.1708 15.5042 14.3044 15.7702C13.8733 15.9872 13.5834 16.4311 13.5834 16.9374C13.5834 17.1439 13.6306 17.3417 13.7204 17.5208C13.2894 17.7378 13 18.1817 13 18.6874Z" fill="' + THUMBS_UP_DOWN_COLOR + '"/>\
                        </svg>';
    }
}

function change_thumbs_color_normal(elem) {
    if (elem.getAttribute("easychat-feedback-selected") == "true") { return; }

    if (elem.id == "thumbs-up") {
        elem.innerHTML = '<svg style = "pointer-events: none;" width="39" height="39" viewBox="0 0 39 39" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <ellipse id="thumbs-up-part-1" cx="19.5" cy="19.5" rx="18.5" ry="18.5" fill="white" stroke="#BABABA" stroke-width="2" ></ellipse>\
                        <g clip-path="url(#clip0)">\
                        <path id="thumbs-up-part-2" d="M13.9383 18.825C13.1345 18.825 12.48 19.4795 12.48 20.2833V24.9499C12.48 25.7538 13.1345 26.4083 13.9383 26.4083H15.6883C16.0167 26.4083 16.3189 26.2974 16.5633 26.1131V18.825H13.9383Z" fill="#BABABA"/>\
                        <path id="thumbs-up-part-3" d="M26.4799 21.0125C26.4799 20.662 26.3411 20.3353 26.1002 20.0943C26.3726 19.7963 26.5114 19.3967 26.4735 18.9808C26.4053 18.2393 25.7373 17.6583 24.9522 17.6583H21.3489C21.5274 17.1164 21.8133 16.123 21.8133 15.325C21.8133 14.0598 20.7382 12.9917 20.0633 12.9917C19.4572 12.9917 19.0243 13.3329 19.0057 13.3469C18.9369 13.4024 18.8966 13.4864 18.8966 13.575V15.5531L17.2166 19.1925L17.1466 19.2281V25.4803C17.6214 25.7043 18.2223 25.825 18.6049 25.825H23.9594C24.5946 25.825 25.1505 25.3968 25.2812 24.806C25.3483 24.502 25.3092 24.1958 25.1756 23.9298C25.6067 23.7128 25.8966 23.2688 25.8966 22.7625C25.8966 22.556 25.8494 22.3583 25.7595 22.1792C26.1906 21.9622 26.4799 21.5183 26.4799 21.0125Z" fill="#BABABA"/>\
                        </g>\
                        <defs>\
                        <clipPath id="clip0">\
                        <rect width="14" height="14" fill="white" transform="translate(12.48 12.7)"/>\
                        </clipPath>\
                        </defs>\
                        </svg>';
    } else {
        elem.innerHTML = '<svg style = "pointer-events: none;" width="39" height="39" viewBox="0 0 39 39" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <ellipse cx="19.5" cy="19.5" rx="19.5" ry="19.5" fill="white"></ellipse>\
                        <ellipse id="thumbs-down-part-1" cx="19.5" cy="19.5" rx="18.5" ry="18.5" stroke="#BABABA" stroke-width="2"></ellipse>\
                        <path id="thumbs-down-part-2" d="M25.5417 20.875C26.3455 20.875 27 20.2205 27 19.4167V14.75C27 13.9462 26.3455 13.2917 25.5417 13.2917H23.7917C23.4633 13.2917 23.1611 13.4025 22.9167 13.5869V20.875H25.5417Z" fill="#CFCFCF"/>\
                        <path id="thumbs-down-part-3" d="M13 18.6874C13 19.038 13.1389 19.3647 13.3798 19.6056C13.1074 19.9037 12.9685 20.3033 13.0065 20.7192C13.0747 21.4606 13.7426 22.0416 14.5278 22.0416H18.131C17.9525 22.5835 17.6667 23.5769 17.6667 24.3749C17.6667 25.6402 18.7418 26.7083 19.4167 26.7083C20.0228 26.7083 20.4557 26.367 20.4743 26.353C20.5431 26.2976 20.5834 26.2136 20.5834 26.1249V24.1469L22.2634 20.5074L22.3334 20.4719V14.2197C21.8585 13.9957 21.2577 13.8749 20.875 13.8749H15.5206C14.8854 13.8749 14.3294 14.3031 14.1988 14.894C14.1317 15.1979 14.1708 15.5042 14.3044 15.7702C13.8733 15.9872 13.5834 16.4311 13.5834 16.9374C13.5834 17.1439 13.6306 17.3417 13.7204 17.5208C13.2894 17.7378 13 18.1817 13 18.6874Z" fill="#CFCFCF"/>\
                        </svg>';
    }
}


function get_feedback_options_html(feedback_type, feedback_id) {

    var html = '<div class="easychat-bot-message-div" >\
                        <div class = "easychat-bot-message-wrapper">\
                            <div class="easychat-bot-message-icon-div"><img src=' + MESSAGE_IMG + '></div>'


    html += '<div class="easychat-intent-feedback-wrapper">\
                <div class="easychat-intent-feedback-cmt-wrapper">\
                    <div class = "feedback-provide-title" id="feedback-provide-title">' + FEEDBACK_TEXT + '</div>\
                    <div class = "feedback-empty-warning" id="feedback-empty-warning">' + FEEDBACK_ERROR_TEXT + '</div>\ '


    if (feedback_type == 1) {

        positive_feedback_options_value_list = ["Easy Communication", "Fully Satisfied", "Quick Response", "Query Resolved Quickly", "Good Experience"]

        positive_feedback_label_text_list = [POSITIVE_FEEDBACK_1, POSITIVE_FEEDBACK_2, POSITIVE_FEEDBACK_3, POSITIVE_FEEDBACK_4, POSITIVE_FEEDBACK_5]

        html += '<div class="positive-feedback-options" id = "positive-feedback-options">'

        for (let i = 0; i < positive_feedback_label_text_list.length; i++) {

            value = positive_feedback_options_value_list[i]
            label_text = positive_feedback_label_text_list[i]
            id = "positive_feedback" + i
            html += '<div class="radio-btn-container-item">\
                            <input id="' + id + '" type="radio" name="feedback-radio" value="' + value + '" onclick="feedback_radio_checked()">\
                            <label for="' + id + '" >' + label_text + '</label> \
                    </div>'

        }

        html += '</div>'

    } else if (feedback_type == -1) {

        negative_feedback_options_value_list = ["Inappropriate Answer,", "Response is slow", "Need more information", "I couldn’t find what I was looking for", "Content is too complicated"]

        negative_feedback_label_text_list = [NEGATIVE_FEEDBACK_1, NEGATIVE_FEEDBACK_2, NEGATIVE_FEEDBACK_3, NEGATIVE_FEEDBACK_4, NEGATIVE_FEEDBACK_5]

        html += '<div class="positive-feedback-options" id = "negative-feedback-options">'

        for (let i = 0; i < negative_feedback_label_text_list.length; i++) {

            value = negative_feedback_options_value_list[i]
            label_text = negative_feedback_label_text_list[i]
            id = "negative_feedback" + i

            html += '<div class="radio-btn-container-item">\
                            <input id="' + id + '" type="radio" name="feedback-radio" value="' + value + '" onclick="feedback_radio_checked()">\
                            <label for="' + id + '" >' + label_text + '</label> \
                    </div>'

        }

        html += '</div>'
    }

    html += '</div><button class="easychat-intent-level-feedback-submit-button" id ="easychat-intent-level-feedback-submit-button" onclick="easychat_submit_feedback_message_to_server(' + feedback_id + ',' + feedback_type + ')">\
            ' + SUBMIT_TEXT + '\
            </button>\
        </div>'

    return html

}

function add_inner_html_to_chat_container(html) {

    $("#easychat-chat-container").append(html);
    scroll_to_bottom()
}

function easychat_send_feedback_msg_for_theme_three(element, feedback_id, feedback_type, feedback_cmt) {

    var elements = document.getElementsByClassName("easychat-intent-feedback-wrapper");
    try {
        for (var i = 0; i < elements.length; i++) {
            elements[i].parentNode.parentNode.remove()
        }
    } catch (err) { }

    for (var i = 0; i < element.parentNode.children.length; i++) {
        element.parentNode.children[i].style.fill = "#CBCACA";
        element.parentNode.children[i].removeAttribute("easychat-feedback-selected");
    }

    element.setAttribute("easychat-feedback-selected", "true");

    if (element.id == "easychat-feedback-thumbs-up") {
        element.style.fill = BOT_THEME_COLOR
        if (EASYCHAT_BOT_THEME == "theme_4" || EASYCHAT_BOT_THEME == "theme_3") {
            element.style.fill = "#10B981"
        }
    } else {
        element.style.fill = "#E53E3E"
    }

    easychat_send_feedback_message_to_server(feedback_id, feedback_type, feedback_cmt);

    html = get_feedback_options_html(feedback_type, feedback_id)

    add_inner_html_to_chat_container(html);

}

function easychat_send_feedback_msg(element, feedback_id, feedback_type, feedback_cmt) {
    var elements = document.getElementsByClassName("easychat-intent-feedback-wrapper");
    try {
        for (var i = 0; i < elements.length; i++) {
            elements[i].parentNode.removeChild(elements[elements.length - 1]);
        }
    } catch (err) { }

    for (var i = 0; i < element.parentElement.children.length; i++) {
        element.parentElement.children[i].style.backgroundColor = "white";
        element.parentElement.children[i].style.color = BOT_THEME_COLOR;
        element.parentElement.children[i].style.borderColor = BOT_THEME_COLOR;
        element.parentElement.children[i].removeAttribute("easychat-feedback-selected");
    }

    if (EASYCHAT_BOT_THEME == "theme_1" || EASYCHAT_BOT_THEME == "theme_2") {
        var THUMBS_UP_DOWN_COLOR = BOT_THEME_COLOR;
        if (BOT_THEME_COLOR.toLowerCase() == "#ffffff") {
            THUMBS_UP_DOWN_COLOR = "#767B87";
        }
        if (element.id == "thumbs-up") {
            element.innerHTML = '<svg style = "pointer-events: none;" width="39" height="39" viewBox="0 0 39 39" fill="none" xmlns="http://www.w3.org/2000/svg">\
                            <ellipse id="thumbs-up-part-1" cx="19.5" cy="19.5" rx="18.5" ry="18.5" fill="white" stroke="' + THUMBS_UP_DOWN_COLOR + '" stroke-width="2" ></ellipse>\
                            <g clip-path="url(#clip0)">\
                            <path id="thumbs-up-part-2" d="M13.9383 18.825C13.1345 18.825 12.48 19.4795 12.48 20.2833V24.9499C12.48 25.7538 13.1345 26.4083 13.9383 26.4083H15.6883C16.0167 26.4083 16.3189 26.2974 16.5633 26.1131V18.825H13.9383Z" fill="' + THUMBS_UP_DOWN_COLOR + '"/>\
                            <path id="thumbs-up-part-3" d="M26.4799 21.0125C26.4799 20.662 26.3411 20.3353 26.1002 20.0943C26.3726 19.7963 26.5114 19.3967 26.4735 18.9808C26.4053 18.2393 25.7373 17.6583 24.9522 17.6583H21.3489C21.5274 17.1164 21.8133 16.123 21.8133 15.325C21.8133 14.0598 20.7382 12.9917 20.0633 12.9917C19.4572 12.9917 19.0243 13.3329 19.0057 13.3469C18.9369 13.4024 18.8966 13.4864 18.8966 13.575V15.5531L17.2166 19.1925L17.1466 19.2281V25.4803C17.6214 25.7043 18.2223 25.825 18.6049 25.825H23.9594C24.5946 25.825 25.1505 25.3968 25.2812 24.806C25.3483 24.502 25.3092 24.1958 25.1756 23.9298C25.6067 23.7128 25.8966 23.2688 25.8966 22.7625C25.8966 22.556 25.8494 22.3583 25.7595 22.1792C26.1906 21.9622 26.4799 21.5183 26.4799 21.0125Z" fill="' + THUMBS_UP_DOWN_COLOR + '"/>\
                            </g>\
                            <defs>\
                            <clipPath id="clip0">\
                            <rect width="14" height="14" fill="white" transform="translate(12.48 12.7)"/>\
                            </clipPath>\
                            </defs>\
                            </svg>';

            document.getElementById('thumbs-down-part-1').style.stroke = '#BABABA';
            document.getElementById('thumbs-down-part-2').style.fill = '#CFCFCF';
            document.getElementById('thumbs-down-part-3').style.fill = '#CFCFCF';
        } else {
            element.innerHTML = '<svg style = "pointer-events: none;" width="39" height="39" viewBox="0 0 39 39" fill="none" xmlns="http://www.w3.org/2000/svg">\
                            <ellipse cx="19.5" cy="19.5" rx="19.5" ry="19.5" fill="white"></ellipse>\
                            <ellipse id="thumbs-down-part-1" cx="19.5" cy="19.5" rx="18.5" ry="18.5" stroke="' + THUMBS_UP_DOWN_COLOR + '" stroke-width="2"></ellipse>\
                            <path id="thumbs-down-part-2" d="M25.5417 20.875C26.3455 20.875 27 20.2205 27 19.4167V14.75C27 13.9462 26.3455 13.2917 25.5417 13.2917H23.7917C23.4633 13.2917 23.1611 13.4025 22.9167 13.5869V20.875H25.5417Z" fill="' + THUMBS_UP_DOWN_COLOR + '"/>\
                            <path id="thumbs-down-part-3" d="M13 18.6874C13 19.038 13.1389 19.3647 13.3798 19.6056C13.1074 19.9037 12.9685 20.3033 13.0065 20.7192C13.0747 21.4606 13.7426 22.0416 14.5278 22.0416H18.131C17.9525 22.5835 17.6667 23.5769 17.6667 24.3749C17.6667 25.6402 18.7418 26.7083 19.4167 26.7083C20.0228 26.7083 20.4557 26.367 20.4743 26.353C20.5431 26.2976 20.5834 26.2136 20.5834 26.1249V24.1469L22.2634 20.5074L22.3334 20.4719V14.2197C21.8585 13.9957 21.2577 13.8749 20.875 13.8749H15.5206C14.8854 13.8749 14.3294 14.3031 14.1988 14.894C14.1317 15.1979 14.1708 15.5042 14.3044 15.7702C13.8733 15.9872 13.5834 16.4311 13.5834 16.9374C13.5834 17.1439 13.6306 17.3417 13.7204 17.5208C13.2894 17.7378 13 18.1817 13 18.6874Z" fill="' + THUMBS_UP_DOWN_COLOR + '"/>\
                            </svg>';

            document.getElementById('thumbs-up-part-1').style.stroke = '#BABABA';
            document.getElementById('thumbs-up-part-2').style.fill = '#CFCFCF';
            document.getElementById('thumbs-up-part-3').style.fill = '#CFCFCF';
        }
        element.setAttribute("easychat-feedback-selected", "true");
    } else {
        element.style.backgroundColor = BOT_THEME_COLOR;
        element.style.color = "white";
        element.style.borderColor = BOT_THEME_COLOR;
        element.setAttribute("easychat-feedback-selected", "true");
    }

    for (var i = 0; i < element.parentElement.children.length; i++) {
        //if(element.parentElement.children[i].hasAttribute("onclick")){element.parentElement.children[i].removeAttribute("onclick")}
        //if(element.parentElement.children[i].hasAttribute("onmouseout")){element.parentElement.children[i].removeAttribute("onmouseout")}
        //if(element.parentElement.children[i].hasAttribute("onmouseover")){element.parentElement.children[i].removeAttribute("onmouseover")}
    }

    easychat_send_feedback_message_to_server(feedback_id, feedback_type, feedback_cmt);

    var html = '<div class="easychat-intent-feedback-wrapper">\
                    <div class="easychat-intent-feedback-cmt-wrapper easychat-bot-message easychat-bot-message-line">\
                    <p style="margin: 0;\
    padding: 0.4em 0.3em 0.4em 0.2em;\
    max-height: 300px;\
    height: unset;\
    overflow-y: hidden;\
    transition: max-height 0.2s ease;"\
    id="feedback-provide-title"\
    >\
                    ' + FEEDBACK_TEXT + ':\
                    </p>\
                    <p style="margin: 0;\
    padding: 0.1em 0.3em 0.4em 0.6em;\
    max-height: 300px;\
    height: unset;\
    overflow-y: hidden;\
    transition: max-height 0.2s ease;\
    display:none;\
    color:red"\
    id="feedback-empty-warning"\
    >\
                    ' + FEEDBACK_ERROR_TEXT + '\
                    </p>\ '

    if (feedback_type == 1) {
        html += '<p\
        id = "positive-feedback-options"\
        > \
    <label><input type="radio" name="feedback-radio" value="Easy Communication" onclick="feedback_radio_checked()"><span>' + POSITIVE_FEEDBACK_1 + '</span></label> <br> \
    <label><input type="radio" name="feedback-radio" value="Fully Satisfied" onclick="feedback_radio_checked()"><span>' + POSITIVE_FEEDBACK_2 + '</span></label> <br>\
    <label><input type="radio" name="feedback-radio" value="Quick Response" onclick="feedback_radio_checked()"><span>' + POSITIVE_FEEDBACK_3 + '</span></label> <br>\
    <label><input type="radio" name="feedback-radio" value="Query Resolved Quickly" onclick="feedback_radio_checked()"><span>' + POSITIVE_FEEDBACK_4 + '</span></label> <br>\
    <label><input type="radio" name="feedback-radio" value="Good Experience" onclick="feedback_radio_checked()"><span>' + POSITIVE_FEEDBACK_5 + '</span></label> <br>\
    </p>\
    '
    } else if (feedback_type == -1) {
        html += '<p\
        id = "negative-feedback-options"\
        > \
        <label><input type="radio" name="feedback-radio" value="Inappropriate Answer," onclick="feedback_radio_checked()"><span>' + NEGATIVE_FEEDBACK_1 + '</span></label> <br> \
        <label><input type="radio" name="feedback-radio" value="Response is slow" onclick="feedback_radio_checked()"><span>' + NEGATIVE_FEEDBACK_2 + '</span></label> <br>\
        <label><input type="radio" name="feedback-radio" value="Need more information" onclick="feedback_radio_checked()"><span>' + NEGATIVE_FEEDBACK_3 + '</span></label> <br>\
        <label><input type="radio" name="feedback-radio" value="I couldn’t find what I was looking for" onclick="feedback_radio_checked()"><span>' + NEGATIVE_FEEDBACK_4 + '</span></label> <br>\
        <label><input type="radio" name="feedback-radio" value="Content is too complicated" onclick="feedback_radio_checked()"><span>' + NEGATIVE_FEEDBACK_5 + '</span></label> <br>\
        </p>\
        '
    }

    html += '<button id ="easychat-intent-level-feedback-submit-button" onclick="easychat_submit_feedback_message_to_server(' + feedback_id + ',' + feedback_type + ')" style="margin: 10px 0;margin-right: 10px;float: right;">\
                    ' + SUBMIT_TEXT + '\
                    </button>\
                </div>\
                </div>'
    $("#easychat-chat-container").append(html);
    scroll_to_bottom()
}

function easychat_submit_feedback_message_to_server(feedback_id, feedback_type) {

    if ($("input[name='feedback-radio']:checked").val()) {
        var feedback_cmt = $("input[name='feedback-radio']:checked").val();
        feedback_cmt = feedback_cmt.trim();
        if (feedback_cmt.length == 0) {
            $("#feedback-empty-warning").css("display", "block");
            return;
        } else {
            $("#feedback-empty-warning").css("display", "none");
        }
        var elmnt = document.getElementsByClassName("easychat-intent-feedback-wrapper")[
            document.getElementsByClassName("easychat-intent-feedback-wrapper").length - 1]
        elmnt.setAttribute("feedback_submitted", "true");
        var html = ''
        if (EASYCHAT_BOT_THEME == "theme_1" || EASYCHAT_BOT_THEME == "theme_2") {
            html = '<div class="easychat-bot-message-div" ><div class = "easychat-bot-message-wrapper"><div class="easychat-bot-message easychat-bot-message-line">\
        <p class="easychat-show-less-text">\
                        ' + SUCCESS_FEEDBACK_TEXT + '\
                        </p>\
                </div></div>';
        } else if(EASYCHAT_BOT_THEME == "theme_3"){
            html = `<div class="easychat-intent-feedback-cmt-wrapper easychat-bot-message easychat-bot-message-line">
            <p class="easychat-show-less-text"> ${SUCCESS_FEEDBACK_TEXT} </p>`;
        } 
        else {
            html = '<div class="easychat-bot-message-div" ><div class = "easychat-bot-message-wrapper"><div class="easychat-intent-feedback-cmt-wrapper easychat-bot-message easychat-bot-message-line">\
        <p class="easychat-show-less-text">\
                        ' + SUCCESS_FEEDBACK_TEXT + '\
                        </p>\
                </div></div>';

        }
        if (EASYCHAT_BOT_THEME != "theme_3" && EASYCHAT_BOT_THEME != "theme_4") {
            html += add_mic_icon_to_text()
        }
        elmnt.innerHTML = html + '</div>'
        if (EASYCHAT_BOT_THEME == "theme_4") {
            elmnt.parentElement.innerHTML += get_mic_icon_html_theme_four()
        }
        text_to_speech(SUCCESS_FEEDBACK_TEXT);
        if (EASYCHAT_BOT_THEME == "theme_3") {
            elmnt.style.background = "#f6f6f6";
            elmnt.style.boxShadow = "none";
        }
        //scroll_to_bottom()
        easychat_send_feedback_message_to_server(feedback_id, feedback_type, feedback_cmt);
        element_response = document.querySelectorAll(".easychat-bot-message-line")
        element_response_previous_height += element_response[element_response.length - 1].clientHeight
        try {
            //document.querySelector(".easychat-choices-wrapper").remove();
            var easychat_choices_wrapper_query_selector = document.querySelectorAll(".easychat-choices-wrapper");
            easychat_choices_wrapper_query_selector[easychat_choices_wrapper_query_selector.length - 1].remove()
        } catch (err) { }
        try {
            // document.querySelector(".easychat-feedback-wrapper").remove();
            var easychat_feedback_wrapper_query_selector = document.querySelectorAll(".easychat-feedback-wrapper");
            easychat_feedback_wrapper_query_selector[easychat_feedback_wrapper_query_selector.length - 1].remove()
        } catch (err) { console.log(err) }
        try {
            // document.querySelector(".easychat-feedback-wrapper").remove();
            var easychat_feedback_wrapper_query_selector = document.querySelectorAll(".easychat-bot-feedback-wrapper");
            easychat_feedback_wrapper_query_selector[easychat_feedback_wrapper_query_selector.length - 1].remove()
        } catch (err) { console.log(err) }
    }
    else {
        $("#feedback-empty-warning").css("display", "block");
        scroll_to_bottom();
        return;
    }

}

function add_mic_icon_to_text() {

    if (is_text_to_speech_required) {
        var is_speech_muted = is_mute();
        if (document.getElementsByClassName("mic-icon").length > 0) {
            document.getElementsByClassName("mic-icon")[0].remove();
        }
        if (!is_speech_muted) {
            html = '<div class="mic-icon" style="margin-left: 4px;position: relative;">\
                <div class="mic-icon-on" style="cursor: pointer;" onclick="handleMicIconOn(this)">\
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <path d="M5.92608 10.6668H3.33341C3.1566 10.6668 2.98703 10.5965 2.86201 10.4715C2.73699 10.3465 2.66675 10.1769 2.66675 10.0001V6.0001C2.66675 5.82329 2.73699 5.65372 2.86201 5.52869C2.98703 5.40367 3.1566 5.33343 3.33341 5.33343H5.92608L9.45541 2.44543C9.50425 2.40539 9.56345 2.38005 9.62613 2.37236C9.6888 2.36466 9.75238 2.37493 9.80944 2.40196C9.86651 2.42899 9.91473 2.47168 9.94848 2.52505C9.98223 2.57842 10.0001 2.64028 10.0001 2.70343V13.2968C10.0001 13.3599 9.98223 13.4218 9.94848 13.4751C9.91473 13.5285 9.86651 13.5712 9.80944 13.5982C9.75238 13.6253 9.6888 13.6355 9.62613 13.6278C9.56345 13.6201 9.50425 13.5948 9.45541 13.5548L5.92608 10.6668ZM12.5754 11.0608L11.6274 10.1128C11.9511 9.8639 12.2131 9.54392 12.3934 9.17758C12.5736 8.81125 12.6671 8.40836 12.6667 8.0001C12.6667 7.04676 12.1667 6.2101 11.4134 5.73876L12.3727 4.77943C12.8777 5.15089 13.2882 5.636 13.5709 6.19551C13.8536 6.75502 14.0006 7.37322 14.0001 8.0001C14.0001 9.2281 13.4467 10.3268 12.5754 11.0608Z" fill="'+ BOT_THEME_COLOR + '"/>\
                    </svg>\
                </div>\
                <div class="mic-icon-off" style="cursor: pointer;display: none;" onclick="handleMicIconOff(this)">\
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <path d="M2.7682 2.13181C2.59247 1.95607 2.30754 1.95606 2.13181 2.1318C1.95607 2.30753 1.95606 2.59246 2.1318 2.76819L4.6627 5.29915H3.35C2.60442 5.29915 2 5.90356 2 6.64914V9.34788C2 10.0935 2.60442 10.6979 3.35 10.6979H5.55773C5.66797 10.6979 5.77437 10.7383 5.85675 10.8116L8.55163 13.2078C9.03528 13.6379 9.79999 13.2945 9.79999 12.6474V10.4365L13.2317 13.8683C13.4074 14.044 13.6923 14.044 13.8681 13.8683C14.0438 13.6925 14.0438 13.4076 13.8681 13.2319L2.7682 2.13181Z" fill="#CBCACA"/>\
                        <path d="M11.0846 9.17554L11.7674 9.85837C12.0445 9.29768 12.2 8.66643 12.2 7.99999C12.2 7.27808 12.0175 6.59746 11.6957 6.0031C11.5774 5.78454 11.3043 5.70327 11.0858 5.82159C10.8672 5.9399 10.7859 6.21299 10.9043 6.43155C11.1566 6.89761 11.3 7.43138 11.3 7.99999C11.3 8.41462 11.2237 8.81071 11.0846 9.17554Z" fill="#CBCACA"/>\
                        <path d="M12.4328 10.5238L13.0889 11.1799C13.6662 10.2578 14 9.16741 14 8C14 6.66433 13.563 5.42941 12.8244 4.43217C12.6765 4.23245 12.3947 4.19047 12.1949 4.33839C11.9952 4.48631 11.9532 4.76813 12.1012 4.96784C12.7289 5.81537 13.1 6.8637 13.1 8C13.1 8.91865 12.8575 9.77979 12.4328 10.5238Z" fill="#CBCACA"/>\
                        <path d="M6.51202 4.60288L9.79999 7.89092V3.35C9.79999 2.70282 9.03532 2.35948 8.55166 2.78949L6.51202 4.60288Z" fill="#CBCACA"/>\
                    </svg>\
                </div>\
            </div>';
        } else {
            html = '<div class="mic-icon" style="margin-left: 4px;position: relative;">\
                <div class="mic-icon-on" style="cursor: pointer; display: none;" onclick="handleMicIconOn(this)">\
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <path d="M5.92608 10.6668H3.33341C3.1566 10.6668 2.98703 10.5965 2.86201 10.4715C2.73699 10.3465 2.66675 10.1769 2.66675 10.0001V6.0001C2.66675 5.82329 2.73699 5.65372 2.86201 5.52869C2.98703 5.40367 3.1566 5.33343 3.33341 5.33343H5.92608L9.45541 2.44543C9.50425 2.40539 9.56345 2.38005 9.62613 2.37236C9.6888 2.36466 9.75238 2.37493 9.80944 2.40196C9.86651 2.42899 9.91473 2.47168 9.94848 2.52505C9.98223 2.57842 10.0001 2.64028 10.0001 2.70343V13.2968C10.0001 13.3599 9.98223 13.4218 9.94848 13.4751C9.91473 13.5285 9.86651 13.5712 9.80944 13.5982C9.75238 13.6253 9.6888 13.6355 9.62613 13.6278C9.56345 13.6201 9.50425 13.5948 9.45541 13.5548L5.92608 10.6668ZM12.5754 11.0608L11.6274 10.1128C11.9511 9.8639 12.2131 9.54392 12.3934 9.17758C12.5736 8.81125 12.6671 8.40836 12.6667 8.0001C12.6667 7.04676 12.1667 6.2101 11.4134 5.73876L12.3727 4.77943C12.8777 5.15089 13.2882 5.636 13.5709 6.19551C13.8536 6.75502 14.0006 7.37322 14.0001 8.0001C14.0001 9.2281 13.4467 10.3268 12.5754 11.0608Z" fill="'+ BOT_THEME_COLOR + '"/>\
                    </svg>\
                </div>\
                <div class="mic-icon-off" style="cursor: pointer;display: block;" onclick="handleMicIconOff(this)">\
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <path d="M2.7682 2.13181C2.59247 1.95607 2.30754 1.95606 2.13181 2.1318C1.95607 2.30753 1.95606 2.59246 2.1318 2.76819L4.6627 5.29915H3.35C2.60442 5.29915 2 5.90356 2 6.64914V9.34788C2 10.0935 2.60442 10.6979 3.35 10.6979H5.55773C5.66797 10.6979 5.77437 10.7383 5.85675 10.8116L8.55163 13.2078C9.03528 13.6379 9.79999 13.2945 9.79999 12.6474V10.4365L13.2317 13.8683C13.4074 14.044 13.6923 14.044 13.8681 13.8683C14.0438 13.6925 14.0438 13.4076 13.8681 13.2319L2.7682 2.13181Z" fill="#CBCACA"/>\
                        <path d="M11.0846 9.17554L11.7674 9.85837C12.0445 9.29768 12.2 8.66643 12.2 7.99999C12.2 7.27808 12.0175 6.59746 11.6957 6.0031C11.5774 5.78454 11.3043 5.70327 11.0858 5.82159C10.8672 5.9399 10.7859 6.21299 10.9043 6.43155C11.1566 6.89761 11.3 7.43138 11.3 7.99999C11.3 8.41462 11.2237 8.81071 11.0846 9.17554Z" fill="#CBCACA"/>\
                        <path d="M12.4328 10.5238L13.0889 11.1799C13.6662 10.2578 14 9.16741 14 8C14 6.66433 13.563 5.42941 12.8244 4.43217C12.6765 4.23245 12.3947 4.19047 12.1949 4.33839C11.9952 4.48631 11.9532 4.76813 12.1012 4.96784C12.7289 5.81537 13.1 6.8637 13.1 8C13.1 8.91865 12.8575 9.77979 12.4328 10.5238Z" fill="#CBCACA"/>\
                        <path d="M6.51202 4.60288L9.79999 7.89092V3.35C9.79999 2.70282 9.03532 2.35948 8.55166 2.78949L6.51202 4.60288Z" fill="#CBCACA"/>\
                    </svg>\
                </div>\
            </div>';
        }
        return html
    }
    return ''

}

function feedback_radio_checked() {
    $("#feedback-empty-warning").css("display", "none");
}

function easychat_send_feedback_message_to_server(feedback_id, feedback_type, feedback_cmt) {
    var json_string = JSON.stringify({
        session_id: session_id,
        user_id: user_id,
        feedback_id: feedback_id,
        feedback_type: feedback_type,
        feedback_cmt: feedback_cmt
    });
    json_string = encrypt_variable(json_string);
    json_string = encodeURIComponent(json_string);

    var xhttp = new XMLHttpRequest();
    var params = 'json_string=' + json_string
    xhttp.open("POST", EASYCHAT_FEEDBACK_SAVE_URL, true);
    xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            response = JSON.parse(this.responseText);
        }
    }
    xhttp.send(params);
}

function append_bot_tables(table_list, append_in_faq=false) {
    var empty_tag = true;
    var str
    var tables_html = '<!--<style>table {border-left: 0;border-spacing: 0px;box-shadow: 1px 1px 6px rgba(0, 0, 0, 0.2);background-color: white;}th,td {    padding: 5px 4px 6px 4px; text-align: left; vertical-align: top;}tr {display: table-row;    vertical-align: inherit;    border-color: inherit;}td {    border-top: 1px solid #000;word-break: break-all;    min-width: 65px;}th {    text-align: center;background-color: #9D1D27;    color: white;}</style>--><div class="easychat-table-div-wrapper" style="width:100%;display:inline-block;border-radius:10px;"><table class="easychat-bot-table"><tbody>';
    for (var row_index = 0; row_index < table_list.length; row_index++) {
        tables_html += "<tr>";
        if (row_index == 0) {
            for (var col_index = 0; col_index < table_list[row_index].length; col_index++) {
                str = un_entity(table_list[row_index][col_index]).trim().replace(/<[^>]*>?/gm, '')
                if (str.trim() != "") {
                    empty_tag = false
                }
                tables_html += "<th style=background-color:" + BOT_THEME_COLOR + ">" + stripHTML(un_entity(table_list[row_index][col_index])).trim() + "</th>";
            }
        } else {
            for (var col_index = 0; col_index < table_list[row_index].length; col_index++) {
                str = un_entity(table_list[row_index][col_index]).trim().replace(/<[^>]*>?/gm, '')
                if (str.trim() != "") {
                    empty_tag = false
                }
                tables_html += "<td>" + stripHTML(un_entity(table_list[row_index][col_index])).trim() + "</td>";
            }
        }
        tables_html += "</tr>";
    }
    tables_html += '</tbody></table></div>';
    if(append_in_faq) {
        $("#faq_media_response").append(tables_html)
        return;
    }
    if (empty_tag == false) {
        $("#easychat-chat-container").append(tables_html)
    }
    element_response = document.querySelectorAll(".easychat-bot-table")
    element_response_previous_height += element_response[element_response.length - 1].clientHeight
}

function append_datepicker(datepicker_list) {
    if (datepicker_list.length > 0) {
        datepicker_container = document.getElementById("easychat-datepicker-container");
        if (datepicker_container != undefined && datepicker_container != null) {
            datepicker_container.remove();
        }

        var datepicker_html = '<div class="easychat-datepicker-container"  align="center" id="easychat-datepicker-container">';
        for (var i = 0; i < datepicker_list.length; i++) {
            datepicker_html += '<div style="width:50%" class="easychat-datepicker-div"><br>\
                ' + datepicker_list[i]["placeholder"] + '<br><p id="datepicker_error_' + i + '"style="color:red;display:none;">Please enter a valid date(dd/mm/yyyy)</p><input type="text" inputmode="none" style="width:83%" name="datepicker" class="easychat-datepicker" id="easychat-datepicker-' + i + '" onchange="append_selected_date_into_user_query(this)" placeholder="' + datepicker_list[i]["placeholder"] + '">\
                </div>';
        }
        datepicker_html += "</div>";

        $("#easychat-chat-container").append(datepicker_html);

        setTimeout(function () {
            for (var i = 0; i < datepicker_list.length; i++) {
                $("#easychat-datepicker-" + i).datepicker({
                    showOtherMonths: true,
                    selectOtherMonths: true,
                    showAnim: "clip",
                    format: "dd/mm/yyyy",
                    minDate: "01/01/1900",
                    maxDate: "31/12/2050",
                    changeMonth: true,
                    changeYear: true,
                    yearRange: "1900:2050",
                    regional: "it",
                    minDate: Date.parse("1900-01-01"),
                    maxDate: Date.parse("2100-01-01"),
                    yearRange: "c-90:c+150",
                    autoclose: true,
                    todayHighlight: false,
                    forceParse: false
                });
            }
        }, 200)
        element_response = document.querySelectorAll("#easychat-datepicker-container")
        element_response_previous_height += element_response[element_response.length - 1].clientHeight
    }
}

function append_timepicker(timepicker_list) {
    if (timepicker_list.length > 0) {
        timepicker_container = document.getElementById("easychat-timepicker-container");
        if (timepicker_container != undefined && timepicker_container != null) {
            timepicker_container.remove();
        }

        var timepicker_html = '<div class="easychat-timepicker-container" align="center" id="easychat-timepicker-container">';
        for (var i = 0; i < timepicker_list.length; i++) {
            timepicker_html += '<div style="width:100%" class="easychat-timepicker-div"><br>\
            <input type="text" inputmode="none" name="timepicker" class="easychat-timepicker timepicker" onfocusout="append_selected_time_into_user_query(this)" oninput="append_selected_time_into_user_query(this)" onchange="append_selected_time_into_user_query(this)" id="easychat-timepicker-' + i + '" placeholder="' + timepicker_list[i]["placeholder"] + '">\
            </div>';
        }
        timepicker_html += "</div>";


        setTimeout(function () {
            for (var i = 0; i < timepicker_list.length; i++) {
                $("#easychat-timepicker-" + i).timepicker({
                    timeFormat: 'h:i a',
                    appendTo: 'body',
                    className: null,
                    closeOnWindow: false,
                    disableTextInput: false,
                    disableTimeRanges: [],
                    disableTouchKeyboard: false,
                    durationTime: null,
                    forceRoundTime: false,
                    maxTime: null,
                    minTime: null,
                    noneOption: false,
                    orientation: 'l',
                    scrollDefault: null,
                    selectOnBlur: false,
                    show2400: true,
                    showDuration: false,
                    showOnFocus: true,
                    step: 15,
                    stopScrollPropagation: false,
                    typeaheadHighlight: false,
                    useSelect: false,
                    autoclose: true,
                });
            }
        }, 200)
        $("#easychat-chat-container").append(timepicker_html);
    }
}

function append_calender_date_time(datepicker_list, timepicker_list) {
    calender_date_widget_value = null;
    var calendar_divs_length = document.getElementsByClassName('easychat-calendar-div').length;
    var div_id = calendar_divs_length + 1
    calendar_div_id = String(div_id);

    if (timepicker_list == undefined || timepicker_list == null) {
        timepicker_list = []
    }

    if (datepicker_list == undefined || datepicker_list == null) {
        datepicker_list = []
    }

    if (datepicker_list.length > 0 && timepicker_list.length == 0) {
        //----------------------------only date picker-----------------
        var datepicker_classname = "single-datepicker-div";
        var parent_datepicker_classname = "single-datepicker-parent-div"
        if(datepicker_list.length > 1){
            datepicker_classname = "custom-datepicker-div";
            parent_datepicker_classname = "custom-datepicker-parent-div";

        }
        var html = '<div id="easychat-datetime-picker-wrapper-div-' + div_id + '" class="easychat-datetime-picker-wrapper-div ' + parent_datepicker_classname + '"><div class="easychat-calendar-div ' + datepicker_classname + '" id="calendar-div-' + div_id + '">'
        for (var i = 0; i < datepicker_list.length; i++) {
            html +='<div style="width:100%">'
            var id = div_id + "-" + i
            var label = LABEL_ADD
            var type_picker = "Single date"
            if (datepicker_list.length == 2) {
                type_picker = "Double date"
            }
            if (datepicker_list.length > 1 && i == 0) {
             
                label = LABEL_FROM
                html += '<label  >' + LABEL_FROM + '</label>'
            } else if (datepicker_list.length > 1 && i == 1) {
                label = LABEL_TO
                html += '<label  >' + LABEL_TO + '</label>'
            }
            html += '\
                <div class="main-wrapping-div">\
                    <div class="easychat-date-btn">\
                        <input type="text" readonly  id="datepicker-'+ id + '" onchange="changedDate(\'' + id + '\',\'' + type_picker + '\',this)" style="width: 100% !important;" class="date-time-picker-btns easychat-datepicker-btn" value="' + label + ' ' + LABEL_DATE + '">\
                            <div class="date-displayer datepicker" id="date-displayer-'+ id + '" onclick="callModal(\'' + id + '\')" style="margin-top: -42px; visibility: hidden">\
                                <div class="row" style="display: flex; justify-content: center; margin-top: -2px; column-gap: 6px;">\
                                    <div class="col s6 date">\
                                        16\
                                    </div>\
                                    <div class="col s6" >\
                                        <div class="row month-year" style="margin-bottom: 1px !important;margin-top: 8px !important;">\
                                            May 2021\
                                        </div>\
                                        <div class="row day">\
                                            Thursday\
                                        </div>\
                                    </div>\
                                </div>\
                            </div>\
                        </input>\
                    </div>\
                </div></div>'
        }

        html += '</div><div class="bot-widget-submit-reset-btn-wrapper widget-cancel-reset-wrapper-div">\
                <button type="submit" class="easychat-bot-widget-reset-btn easychat-widget-disabled" onclick="handleReset('+ div_id + ',' + datepicker_list.length + ')">' + RESET_TEXT + '</button>\
            <div class="right-btns">\
                <button type="submit" class="easychat-bot-widget-cancel-btn" onclick="handleCalendarClose(' + div_id + ', ' + datepicker_list.length + ')">'+ CANCEL_TEXT + '</button>\
                <button type="submit" class="easychat-bot-widget-submit-btn easychat-widget-disabled" onclick="handleCalendarSubmit(\'\', ' + div_id + ')">'+ SUBMIT_TEXT + '</button>\
            </div> \
        </div></div>'

    } else if (datepicker_list.length == 0 && timepicker_list.length > 0) {

        //----------------------------only time picker-----------------
        var timepicker_classname = "single-timepicker-div";
        var parent_timepicker_classname = "single-timepicker-parent-div";

        if(timepicker_list.length > 1){
            timepicker_classname = "custom-timepicker-div";
            parent_timepicker_classname = "custom-timepicker-parent-div";

        }
        var html = '<div id="easychat-datetime-picker-wrapper-div-' + div_id + '" class="easychat-datetime-picker-wrapper-div ' + parent_timepicker_classname + '"><div class="easychat-calendar-div ' + timepicker_classname + '" id="calendar-div-' + div_id + '">'
        for (var i = 0; i < timepicker_list.length; i++) {
            html +='<div style="width:100%">'
            var id = div_id + "-" + i
            var label = LABEL_ADD
            var type_picker = "Single time"
            if (timepicker_list.length == 2) {
                type_picker = "Double time"
            }
            if (timepicker_list.length > 1 && i == 0) {
                label = LABEL_FROM
                html += '<label  >' + LABEL_FROM + '</label>'
            } else if (timepicker_list.length > 1 && i == 1) {
                label = LABEL_TO
                html += '<label  >' + LABEL_TO + '</label>'
            }

            currently_time_picker_type = type_picker

            html += '\
                <div class="main-wrapping-div">\
                    <div class="easychat-time-btn">\
                      <input type="button" id="time-picker-btn-'+ id + '" class="date-time-picker-btns easychat-timepicker-btn" value="' + label + ' ' + LABEL_TIME + '" onclick="handleTimePickerClick(\'' + id + '\')" style="width: 100% !important;" onchange="handleTimeBtnChange(\'' + type_picker + '\', \'' + id + '\')"></input>\
                    </div>\
                </div></div>'
        }

        html += '</div><div class="bot-widget-submit-reset-btn-wrapper widget-cancel-reset-wrapper-div">\
            <button type="submit" class="easychat-bot-widget-reset-btn easychat-widget-disabled" onclick="handleReset('+ div_id + ')">' + RESET_TEXT + '</button>\
            <div class="right-btns">\
                <button type="submit" class="easychat-bot-widget-cancel-btn" onclick="handleCalendarClose(' + div_id + ')">'+ CANCEL_TEXT + '</button>\
                <button type="submit" class="easychat-bot-widget-submit-btn easychat-widget-disabled" onclick="handleCalendarSubmit(\'\', ' + div_id + ')">'+ SUBMIT_TEXT + '</button>\
            </div> \
        </div></div>'

    } else if (datepicker_list.length > 0 && timepicker_list.length > 0) {

        if ((datepicker_list.length == 1 && timepicker_list.length == 1) || (datepicker_list.length == 2 && timepicker_list.length == 2)) {
            //-------------------------------date and time in equal nos-------------- both single or both double
            var datetimepicker_classname = "single-datetime-picker-div";
            var parent_datetimepicker_classname = "single-datetime-picker-parent-div";

            if(datepicker_list.length == 2 && timepicker_list.length == 2){
                datetimepicker_classname = "custom-datetime-picker-div";
                parent_datetimepicker_classname = "custom-datetime-picker-parent-div";

            }
            var html = '<div id="easychat-datetime-picker-wrapper-div-' + div_id + '" class="easychat-datetime-picker-wrapper-div ' + parent_datetimepicker_classname + '"><div class="easychat-calendar-div ' + datetimepicker_classname + '" id="calendar-div-' + div_id + '">'
            for (var i = 0; i < datepicker_list.length; i++) {
                html +='<div style="width:100%">'
                var id = div_id + "-" + i
                var label = LABEL_ADD
                var hr_add = false
                var type_picker = "Single datetime"
                if (datepicker_list.length == 2) {
                    type_picker = "Double datetime"
                }
                if (datepicker_list.length > 1 && i == 0) {
                    label = LABEL_FROM
                    hr_add = true
                    html += '<label  >' + LABEL_FROM + '</label>'
                } else if (datepicker_list.length > 1 && i == 1) {
                    hr_add = false
                    label = LABEL_TO
                    html += '<label  >' + LABEL_TO + '</label>'
                }
                currently_time_picker_type = type_picker

                html += '\
                <div class="main-wrapping-div">\
                    <div class="easychat-date-btn">\
                        <input type="text" readonly id="datepicker-'+ id + '" onchange="changedDate(\'' + id + '\',\'' + type_picker + '\',this)" style="width: 100%;" class="date-time-picker-btns easychat-datepicker-btn" value="' + label + ' ' + LABEL_DATE + '">\
                            <div class="date-displayer datepicker" id="date-displayer-'+ id + '" onclick="callModal(\'' + id + '\')" style="margin-top: -42px;">\
                                <div class="row" style="display: flex; justify-content: center; margin-top: -2px; column-gap: 6px;">\
                                    <div class="col s6 date">\
                                        16\
                                    </div>\
                                    <div class="col s6" >\
                                        <div class="row month-year" style="margin-bottom: 1px !important;margin-top: 8px !important;">\
                                            May 2021\
                                        </div>\
                                        <div class="row day">\
                                            Thursday\
                                        </div>\
                                    </div>\
                                </div>\
                            </div>\
                        </input>\
                    </div>\
                    <div class="easychat-time-btn">\
                      <input type="button" id="time-picker-btn-'+ id + '" class="date-time-picker-btns easychat-timepicker-btn" value="' + label + ' ' + LABEL_TIME + '" onclick="handleTimePickerClick(\'' + id + '\')" style="width: 100%;" onchange="handleTimeBtnChange(\'' + type_picker + '\', \'' + id + '\')"></input>\
                    </div>\
                </div></div>'

                if (hr_add) {
                    html += '<hr style="width: 100%; background-color: #e5e5e5; margin-top: 8px; margin-bottom: 8px "/>'
                }
            }

            html += '</div><div class="bot-widget-submit-reset-btn-wrapper widget-cancel-reset-wrapper-div">\
                <button type="submit" class="easychat-bot-widget-reset-btn easychat-widget-disabled" onclick="handleReset('+ div_id + ',' + datepicker_list.length + ')">' + RESET_TEXT + '</button>\
                <div class="right-btns">\
                    <button type="submit" class="easychat-bot-widget-cancel-btn" onclick="handleCalendarClose(' + div_id + ', ' + datepicker_list.length + ')">'+ CANCEL_TEXT + '</button>\
                    <button type="submit" class="easychat-bot-widget-submit-btn easychat-widget-disabled" onclick="handleCalendarSubmit(\''+ type_picker + '\', ' + div_id + ')">' + SUBMIT_TEXT + '</button>\
                </div> \
            </div></div>';

        } else if (datepicker_list.length > 0 && timepicker_list.length == 1) {
            // -----------------multi dates but single time ---------------
            var html = '<div id="easychat-datetime-picker-wrapper-div-' + div_id + '" class="easychat-datetime-picker-wrapper-div custom-date-single-time-picker-parent-div"><div class="easychat-calendar-div custom-date-single-time-picker-div" id="calendar-div-' + div_id + '">'
            var id = div_id + "-0"
            var label = LABEL_ADD
            var hr_add = true
            var type_picker = "Double date single time"
            currently_time_picker_type = type_picker
            html += ''

            html += '<div class="main-wrapping-div">\
            <div style="width:100%;">\
            <label>' + LABEL_FROM + '</label>\
                    <div class="easychat-date-btn">\
                        <input type="text" readonly id="datepicker-'+ id + '" onchange="changedDate(\'' + id + '\',\'' + type_picker + '\',this)" style="width: 100%;" class="date-time-picker-btns easychat-datepicker-btn" value="' + LABEL_FROM + ' ' + LABEL_DATE + '">\
                            <div class="date-displayer datepicker" id="date-displayer-'+ id + '" onclick="callModal(\'' + id + '\')" style="margin-top: -42px;">\
                                <div class="row" style="display: flex; justify-content: flex-end; margin-top: -2px; column-gap: 6px;">\
                                    <div class="col s6 date">\
                                        16\
                                    </div>\
                                    <div class="col s6" >\
                                        <div class="row month-year" style="margin-bottom: 1px !important;margin-top: 8px !important;">\
                                            May 2021\
                                        </div>\
                                        <div class="row day">\
                                            Thursday\
                                        </div>\
                                    </div>\
                                </div>\
                            </div>\
                        </input>\
                    </div>\
                    </div>'
            id = div_id + "-1"
            html += '<div style="width:100%;">\
                    <label>' + LABEL_TO + '</label>\
                   <div class="easychat-date-btn">\
                        <input type="text" readonly  id="datepicker-'+ id + '" onchange="changedDate(\'' + id + '\',\'' + type_picker + '\',this)" style="width: 100%;" class="date-time-picker-btns easychat-datepicker-btn" value="' + LABEL_TO + ' ' + LABEL_DATE + '">\
                            <div class="date-displayer datepicker" id="date-displayer-'+ id + '" onclick="callModal(\'' + id + '\')" style="margin-top: -42px;">\
                                <div class="row" style="display: flex; justify-content: flex-start; margin-top: -2px; column-gap: 6px;">\
                                    <div class="col s6 date">\
                                        16\
                                    </div>\
                                    <div class="col s6">\
                                        <div class="row month-year" style="margin-bottom: 1px !important;margin-top: 8px !important;">\
                                            May 2021\
                                        </div>\
                                        <div class="row day">\
                                            Thursday\
                                        </div>\
                                    </div>\
                                </div>\
                            </div>\
                        </input>\
                    </div>\
                    </div>\
                </div>'

            if (hr_add) {
                html += '<hr style="width: 100%; background-color: #e5e5e5; margin-top: 8px; margin-bottom: 8px "/>'
            }

            id = div_id + "-0"
            html += '\
                    <div class="main-wrapping-div">\
                        <div class="easychat-time-btn">\
                          <input type="button" id="time-picker-btn-'+ id + '" class="date-time-picker-btns easychat-timepicker-btn" value="' + LABEL_ADD + ' ' + LABEL_TIME + '" onclick="handleTimePickerClick(\'' + id + '\')" style="width: 100% !important;" onchange="handleTimeBtnChange(\'' + type_picker + '\', \'' + id + '\')"></input>\
                        </div>\
                    </div></div>\
                    <div class="bot-widget-submit-reset-btn-wrapper widget-cancel-reset-wrapper-div">\
                        <button type="submit" class="easychat-bot-widget-reset-btn easychat-widget-disabled" onclick="handleReset('+ div_id + ',' + datepicker_list.length + ')">' + RESET_TEXT + '</button>\
                        <div class="right-btns">\
                            <button type="submit" class="easychat-bot-widget-cancel-btn" onclick="handleCalendarClose(' + div_id + ', ' + datepicker_list.length + ')">Cancel</button>\
                            <button type="submit" class="easychat-bot-widget-submit-btn easychat-widget-disabled" onclick="handleCalendarSubmit(\''+ type_picker + '\', ' + div_id + ')">' + SUBMIT_TEXT + '</button>\
                        </div> \
                    </div>'

            html += '</div>'

        } else if (datepicker_list.length == 1 && timepicker_list.length > 0) {
            //-----------------double time picker single date picker----------
            var html = '<div id="easychat-datetime-picker-wrapper-div-' + div_id + '" class="easychat-datetime-picker-wrapper-div custom-time-single-date-picker-parent-div"><div class="easychat-calendar-div custom-time-single-date-picker-div" id="calendar-div-' + div_id + '">'
            var id = div_id + "-0"
            var label = LABEL_ADD
            var hr_add = true
            var type_picker = "Single date double time"
            currently_time_picker_type = type_picker
            html += ''

            html += '\
                <div class="main-wrapping-div">\
                    <div class="easychat-date-btn">\
                        <input type="text" readonly id="datepicker-'+ id + '" onchange="changedDate(\'' + id + '\',\'' + type_picker + '\',this)" style="width: 100% !important;" class="date-time-picker-btns easychat-datepicker-btn" value="' + LABEL_ADD + ' ' + LABEL_DATE + '">\
                            <div class="date-displayer datepicker" id="date-displayer-'+ id + '" onclick="callModal(\'' + id + '\')" style="margin-top: -42px;">\
                                <div class="row" style="display: flex; justify-content: center; margin-top: -2px; column-gap: 6px;">\
                                    <div class="col s6 date">\
                                        16\
                                    </div>\
                                    <div class="col s6" >\
                                        <div class="row month-year" style="margin-bottom: 1px !important;margin-top: 8px !important;">\
                                            May 2021\
                                        </div>\
                                        <div class="row day">\
                                            Thursday\
                                        </div>\
                                    </div>\
                                </div>\
                            </div>\
                        </input>\
                    </div>\
                </div>'

            if (hr_add) {
                html += '<hr style="width: 100%; background-color: #e5e5e5; margin-top: 8px; margin-bottom: 8px "/>'
            }

            id = div_id + "-0"
            html += '\
                    <div class="main-wrapping-div">\
                    <div style="width:100%;">\
                    <label>' + LABEL_FROM + '</label>\
                        <div class="easychat-time-btn">\
                          <input type="button" id="time-picker-btn-'+ id + '" class="date-time-picker-btns easychat-timepicker-btn" value="' + LABEL_FROM + ' ' + LABEL_TIME + '" onclick="handleTimePickerClick(\'' + id + '\')" style="width: 100%;" onchange="handleTimeBtnChange(\'' + type_picker + '\', \'' + id + '\')"></input>\
                        </div>\
                        </div>'

            id = div_id + "-1"

            html += '<div style="width:100%;">\
                    <label>' + LABEL_TO + '</label>\
            <div class="easychat-time-btn">\
                          <input type="button" id="time-picker-btn-'+ id + '" class="date-time-picker-btns easychat-timepicker-btn" value="' + LABEL_TO + ' ' + LABEL_TIME + '" onclick="handleTimePickerClick(\'' + id + '\')" style="width: 100%;" onchange="handleTimeBtnChange(\'' + type_picker + '\', \'' + id + '\')"></input>\
                        </div>\
                        </div>\
                    </div>\
                    </div><div class="bot-widget-submit-reset-btn-wrapper widget-cancel-reset-wrapper-div">\
                        <button type="submit" class="easychat-bot-widget-reset-btn easychat-widget-disabled" onclick="handleReset('+ div_id + ',' + datepicker_list.length + ')">' + RESET_TEXT + '</button>\
                        <div class="right-btns">\
                            <button type="submit" class="easychat-bot-widget-cancel-btn" onclick="handleCalendarClose(' + div_id + ', ' + datepicker_list.length + ')">'+ CANCEL_TEXT + '</button>\
                            <button type="submit" class="easychat-bot-widget-submit-btn easychat-widget-disabled" onclick="handleCalendarSubmit(\''+ type_picker + '\', ' + div_id + ')">' + SUBMIT_TEXT + '</button>\
                        </div>\
                        </div>'

            html += '</div>'

        }


    }


    $("#easychat-chat-container").append(html);
    inital_calendar_html = document.querySelector("#calendar-div-" + div_id).innerHTML;

    var node = document.getElementById("ui-datepicker-div");
    if (node != undefined) {
        document.getElementById("ui-datepicker-div").remove();
        document.querySelector("#top-container").appendChild(node);
    }
    if (datepicker_list.length > 0) {
        if (datepicker_list.length == 1) {
            $("#datepicker-" + div_id + "-0").datepicker({
                autoclose: true
            });
        }
        else if (datepicker_list.length == 2) {
            $("#datepicker-" + div_id + "-0").datepicker({ autoclose: true });
            $("#datepicker-" + div_id + "-1").datepicker({ autoclose: true });
        }
    }
    $("#easychat-chat-container").scroll(function () {

        setTimeout(function () {
            if (document.getElementById("datepicker-" + div_id + "-0")) {
                $("#datepicker-" + div_id + "-0").datepicker('hide');
                $("#datepicker-" + div_id + "-0").blur();
            }
            if (document.getElementById("datepicker-" + div_id + "-1")) {
                $("#datepicker-" + div_id + "-1").datepicker('hide');
                $("#datepicker-" + div_id + "-1").blur();
            }
        }, 200);
    });

    if (document.getElementsByClassName('easychat-time-btn').length > 0) {
        const input = document.querySelector('.easychat-timepicker-btn');

        const descriptor = Object.getOwnPropertyDescriptor(Object.getPrototypeOf(input), 'value');

        Object.defineProperty(input, 'value', {
            set: function (t) {
                console.log('Input value was changed programmatically');
                return descriptor.set.apply(this, arguments);
            },
            get: function () {
                return descriptor.get.apply(this);
            }
        });
    }

    update_input_placeholder_based_on_theme(WIDGETS_PLACEHOLDER_TEXT.split("$$$")[5])
}

//date picker script
function callModal(i) {
    $("#datepicker-" + i).datepicker({ autoclose: true });
}


// time picker script
var ansHr = "", ansMin = "", ansAmpm = "";
function handleclickTime() {
    let allHrs = document.querySelectorAll(".hr-clock ul li");
    let allMins = document.querySelectorAll(".min-clock ul li");
    let allAmpm = document.querySelectorAll(".ampm-clock ul li");
    allHrs = Array.prototype.slice.call(allHrs);
    allMins = Array.prototype.slice.call(allMins);
    allAmpm = Array.prototype.slice.call(allAmpm);
    allHrs.forEach(function (eachHr) {
        if (eachHr.childNodes[1].checked === true) {
            eachHr.childNodes[0].classList.add("datetimepicker-selected-time");
            ansHr = eachHr.childNodes[0].innerText;
        }
        else
            eachHr.childNodes[0].classList.remove("datetimepicker-selected-time");
    })
    allMins.forEach(function (eachMin) {
        if (eachMin.childNodes[1].checked === true) {
            eachMin.childNodes[0].classList.add("datetimepicker-selected-time");
            ansMin = eachMin.childNodes[0].innerText;
        }
        else
            eachMin.childNodes[0].classList.remove("datetimepicker-selected-time");
    })
    allAmpm.forEach(function (eachAmpm) {
        if (eachAmpm.childNodes[1].checked === true) {
            eachAmpm.childNodes[0].classList.add("datetimepicker-selected-time");
            ansAmpm = eachAmpm.childNodes[0].innerText;
        }
        else
            eachAmpm.childNodes[0].classList.remove("datetimepicker-selected-time");
    })
    handle_save_button()
}

function handle_save_button() {
    let btnSubmit = document.getElementById("custom-timepicker-footer-submit-button");
    let selected_time = document.getElementById("time-picker-btn-" + currently_opened_time_modal_id).value;
    let amPmVal, hrVal, minVal;
    if (selected_time.includes(":")) {
        selected_time = selected_time.split(" ")
        amPmVal = selected_time[1]
        let time_value = selected_time[0].split(":")
        hrVal = time_value[0]
        minVal = time_value[1]
    }
    if ((ansHr && ansMin && ansAmpm) || (hrVal && minVal && amPmVal)) {
        btnSubmit.disabled = false;
    } else {
        btnSubmit.disabled = true;
    }
}

function unCheckAll() {
    let allHrs = document.querySelectorAll(".hr-clock ul li");
    let allMins = document.querySelectorAll(".min-clock ul li");
    let allAmpm = document.querySelectorAll(".ampm-clock ul li");
    allHrs = Array.prototype.slice.call(allHrs);
    allMins = Array.prototype.slice.call(allMins);
    allAmpm = Array.prototype.slice.call(allAmpm);
    let selected_time = document.getElementById("time-picker-btn-" + currently_opened_time_modal_id).value;
    let amPmVal, hrVal, minVal;
    if (selected_time.includes(":")) {
        selected_time = selected_time.split(" ")
        amPmVal = selected_time[1]
        let time_value = selected_time[0].split(":")
        hrVal = time_value[0]
        minVal = time_value[1]
    }
    allHrs.forEach(function (eachHr) {
        if (eachHr.childNodes[0].innerHTML == hrVal) {
            eachHr.childNodes[1].checked = true
            eachHr.childNodes[0].classList.add("datetimepicker-selected-time");
        } else {
            eachHr.childNodes[1].checked = false
            eachHr.childNodes[0].classList.remove("datetimepicker-selected-time");
        }
    })
    allMins.forEach(function (eachMin) {
        if (eachMin.childNodes[0].innerHTML == minVal) {
            eachMin.childNodes[1].checked = true
            eachMin.childNodes[0].classList.add("datetimepicker-selected-time");
        } else {
            eachMin.childNodes[1].checked = false
            eachMin.childNodes[0].classList.remove("datetimepicker-selected-time");
        }
    })
    allAmpm.forEach(function (eachAmpm) {
        if (eachAmpm.childNodes[0].innerHTML == amPmVal) {
            eachAmpm.childNodes[1].checked = true
            eachAmpm.childNodes[0].classList.add("datetimepicker-selected-time");
        } else {
            eachAmpm.childNodes[1].checked = false
            eachAmpm.childNodes[0].classList.remove("datetimepicker-selected-time");
        }
    })
}

function handleTimePickerClick(id) {

    document.querySelector(".timepicker-container").style.display = "flex";
   
    timepicker_in_form = false
    currently_opened_time_modal_id = id
    unCheckAll()
    handle_save_button()
    if (EASYCHAT_BOT_THEME == "theme_1") {
        disable_footer_widget_response_theme_1()
    }
    else if (EASYCHAT_BOT_THEME == "theme_2") {
        disable_footer_widget_response_theme_2()
    }
    else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        disable_footer_widget_response_theme3_and_theme4()
    }
}
function closeTimeModal() {
    ansHr = ""
    ansMin = ""
    ansAmpm = ""
    document.querySelector(".timepicker-container").style.display = "none";
 
}
function handleSaveTime() {

     document.querySelector(".timepicker-container").style.display = "none";

    if (timepicker_in_form) {
        if (ansHr && ansAmpm && ansMin) {
            document.getElementById("time-picker-btn-" + currently_opened_time_modal_id).value = ansHr.toString().trim() + ":" + ansMin.toString().trim() + " " + ansAmpm;
            update_answers_filled(document.getElementById("time-picker-btn-" + currently_opened_time_modal_id))
        }
    } else {

        if (ansHr && ansAmpm && ansMin) {
            document.getElementById("time-picker-btn-" + currently_opened_time_modal_id).value = ansHr.toString().trim() + ":" + ansMin.toString().trim() + " " + ansAmpm;

            if (currently_time_picker_type == "Single time" || currently_time_picker_type == "Double time")
                append_selected_calender_time_into_user_query(document.getElementById("time-picker-btn-" + currently_opened_time_modal_id), currently_opened_time_modal_id)

            handleTimeBtnChange(currently_time_picker_type, calendar_div_id);
        }
    }
    ansHr = ""
    ansMin = ""
    ansAmpm = ""

    if (EASYCHAT_BOT_THEME == "theme_1") {
        disable_footer_widget_response_theme_1()
    }
    else if (EASYCHAT_BOT_THEME == "theme_2") {
        disable_footer_widget_response_theme_2()
    }
    else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        disable_footer_widget_response_theme3_and_theme4()
    }

}
function handleBtnSection(type_picker, i) {

    if (type_picker == "Single date") {
        var btns = document.getElementsByClassName('easychat-datepicker-btn')
        var btn_section = document.querySelector('#easychat-datetime-picker-wrapper-div-' + i.split("-")[0] + ' .bot-widget-submit-reset-btn-wrapper');
        var reset_btn = btn_section.querySelector(".easychat-bot-widget-reset-btn");
        var submit_btn = btn_section.querySelector(".easychat-bot-widget-submit-btn");
        
        if (btns[btns.length - 1].value !== (LABEL_ADD + " " + LABEL_DATE) && changed_date_picker_single) {
            submit_btn.classList.remove("easychat-widget-disabled");
            $("#calendar-div-" + i.split("-")[0]).addClass('easychat-calendar-margin-div')
            $('#easychat-chat-container').animate({ scrollTop: $('#easychat-chat-container').prop('scrollHeight') }, 400);
        }
        else
            submit_btn.classList.add("easychat-widget-disabled");
            reset_btn.classList.remove("easychat-widget-disabled");
    } else if (type_picker == "Double date") {
        var btns = document.getElementsByClassName('easychat-datepicker-btn')
        var btn_section = document.querySelector('#easychat-datetime-picker-wrapper-div-' + i.split("-")[0] + ' .bot-widget-submit-reset-btn-wrapper');
        var reset_btn = btn_section.querySelector(".easychat-bot-widget-reset-btn");
        var submit_btn = btn_section.querySelector(".easychat-bot-widget-submit-btn");

        if (btns[btns.length - 2].value !== (LABEL_FROM + " " + LABEL_DATE) && btns[btns.length - 1].value != (LABEL_TO + " " + LABEL_DATE) && changed_date_picker_from && changed_date_picker_to) {
            submit_btn.classList.remove("easychat-widget-disabled");
            $("#calendar-div-" + i.split("-")[0]).addClass('easychat-calendar-margin-div')
            $('#easychat-chat-container').animate({ scrollTop: $('#easychat-chat-container').prop('scrollHeight') }, 400);
        }
        else
            submit_btn.classList.add("easychat-widget-disabled");
            reset_btn.classList.remove("easychat-widget-disabled");
    } else if (type_picker == "Single datetime") {
        var btns_date = document.getElementsByClassName('easychat-datepicker-btn')
        var btns_time = document.getElementsByClassName('easychat-timepicker-btn')
        var btn_section = document.querySelector('#easychat-datetime-picker-wrapper-div-' + i.split("-")[0] + ' .bot-widget-submit-reset-btn-wrapper');
        var reset_btn = btn_section.querySelector(".easychat-bot-widget-reset-btn");
        var submit_btn = btn_section.querySelector(".easychat-bot-widget-submit-btn");

        if (btns_date[btns_date.length - 1].value !== (LABEL_ADD + " " + LABEL_DATE) && changed_date_picker_single && btns_time[btns_time.length - 1].value !== (LABEL_ADD + " " + LABEL_TIME)) {
            submit_btn.classList.remove("easychat-widget-disabled");
            $("#calendar-div-" + i.split("-")[0]).addClass('easychat-calendar-margin-div')
            $('#easychat-chat-container').animate({ scrollTop: $('#easychat-chat-container').prop('scrollHeight') }, 400);
        }
        else
            submit_btn.classList.add("easychat-widget-disabled");
            reset_btn.classList.remove("easychat-widget-disabled");
    } else if (type_picker == "Double datetime") {

        var btns_date = document.getElementsByClassName('easychat-datepicker-btn')
        var btns_time = document.getElementsByClassName('easychat-timepicker-btn')
        var btn_section = document.querySelector('#easychat-datetime-picker-wrapper-div-' + i.split("-")[0] + ' .bot-widget-submit-reset-btn-wrapper');
        var reset_btn = btn_section.querySelector(".easychat-bot-widget-reset-btn");
        var submit_btn = btn_section.querySelector(".easychat-bot-widget-submit-btn");

        if (btns_date[btns_date.length - 2].value !== (LABEL_FROM + " " + LABEL_DATE) && btns_date[btns_date.length - 1].value != (LABEL_TO + " " + LABEL_DATE) && changed_date_picker_from && changed_date_picker_to && btns_time[btns_time.length - 2].value !== (LABEL_FROM + " " + LABEL_TIME) && btns_time[btns_time.length - 1].value != (LABEL_TO + " " + LABEL_TIME)) {
            submit_btn.classList.remove("easychat-widget-disabled");
            $("#calendar-div-" + i.split("-")[0]).addClass('easychat-calendar-margin-div')
            $('#easychat-chat-container').animate({ scrollTop: $('#easychat-chat-container').prop('scrollHeight') }, 400);
        }
        else
            submit_btn.classList.add("easychat-widget-disabled");
            reset_btn.classList.remove("easychat-widget-disabled");
    } else if (type_picker == "Double date single time") {
        var btns_date = document.getElementsByClassName('easychat-datepicker-btn')
        var btns_time = document.getElementsByClassName('easychat-timepicker-btn')
        var btn_section = document.querySelector('#easychat-datetime-picker-wrapper-div-' + i.split("-")[0] + ' .bot-widget-submit-reset-btn-wrapper');
        var reset_btn = btn_section.querySelector(".easychat-bot-widget-reset-btn");
        var submit_btn = btn_section.querySelector(".easychat-bot-widget-submit-btn");

        if (btns_date[btns_date.length - 2].value !== (LABEL_FROM + " " + LABEL_DATE) && btns_date[btns_date.length - 1].value != (LABEL_FROM + " " + LABEL_DATE) && changed_date_picker_from && changed_date_picker_to && btns_time[btns_time.length - 1].value !== (LABEL_ADD + " " + LABEL_TIME)) {
            submit_btn.classList.remove("easychat-widget-disabled");
            $("#calendar-div-" + i.split("-")[0]).addClass('easychat-calendar-margin-div')
            $('#easychat-chat-container').animate({ scrollTop: $('#easychat-chat-container').prop('scrollHeight') }, 400);
        }
        else
            submit_btn.classList.add("easychat-widget-disabled");
            reset_btn.classList.remove("easychat-widget-disabled");
    } else if (type_picker == "Single date double time") {
        var btns_date = document.getElementsByClassName('easychat-datepicker-btn')
        var btns_time = document.getElementsByClassName('easychat-timepicker-btn')
        var btn_section = document.querySelector('#easychat-datetime-picker-wrapper-div-' + i.split("-")[0] + ' .bot-widget-submit-reset-btn-wrapper');
        var reset_btn = btn_section.querySelector(".easychat-bot-widget-reset-btn");
        var submit_btn = btn_section.querySelector(".easychat-bot-widget-submit-btn");

        if (btns_date[btns_date.length - 1].value !== (LABEL_ADD + " " + LABEL_DATE) && changed_date_picker_single && btns_time[btns_time.length - 2].value != (LABEL_FROM + " " + LABEL_TIME) && btns_time[btns_time.length - 1].value !== (LABEL_TO + " " + LABEL_TIME)) {
            submit_btn.classList.remove("easychat-widget-disabled");
            $("#calendar-div-" + i.split("-")[0]).addClass('easychat-calendar-margin-div')
            $('#easychat-chat-container').animate({ scrollTop: $('#easychat-chat-container').prop('scrollHeight') }, 400);
        }
        else
            submit_btn.classList.add("easychat-widget-disabled");
            reset_btn.classList.remove("easychat-widget-disabled");
    }

    // if( document.querySelector(".easychat-timepicker-btn").value!=="Add Time" && document.querySelector(".easychat-datepicker-btn").value!=="Add Date")
    // document.querySelector(".btns-sections").style.display="flex";
    // else
    // document.querySelector(".btns-sections").style.display="none";
}
function handleTimeBtnChange(type_picker, i) {
    var calendar_div = document.getElementsByClassName('easychat-calendar-div')
    if (type_picker == "Single time") {
        var btns = document.getElementsByClassName('easychat-timepicker-btn')
        var btn_section = document.querySelector('#easychat-datetime-picker-wrapper-div-' + i.split("-")[0] + ' .bot-widget-submit-reset-btn-wrapper');
        var reset_btn = btn_section.querySelector(".easychat-bot-widget-reset-btn");
        var submit_btn = btn_section.querySelector(".easychat-bot-widget-submit-btn");

        if (btns[btns.length - 1].value !== (LABEL_ADD + " " + LABEL_TIME)) {
            submit_btn.classList.remove("easychat-widget-disabled");
            calendar_div[calendar_div.length - 1].classList.add('easychat-calendar-margin-div')
            $('#easychat-chat-container').animate({ scrollTop: $('#easychat-chat-container').prop('scrollHeight') }, 400);
        }
        else
            submit_btn.classList.add("easychat-widget-disabled");
            reset_btn.classList.remove("easychat-widget-disabled");
    } else if (type_picker == "Double time") {
        var btns = document.getElementsByClassName('easychat-timepicker-btn')
        var btn_section = document.querySelector('#easychat-datetime-picker-wrapper-div-' + i.split("-")[0] + ' .bot-widget-submit-reset-btn-wrapper');
        var reset_btn = btn_section.querySelector(".easychat-bot-widget-reset-btn");
        var submit_btn = btn_section.querySelector(".easychat-bot-widget-submit-btn");

        if (btns[btns.length - 2].value !== (LABEL_FROM + " " + LABEL_TIME) && btns[btns.length - 1].value != (LABEL_TO + " " + LABEL_TIME)) {
            submit_btn.classList.remove("easychat-widget-disabled");
            calendar_div[calendar_div.length - 1].classList.add('easychat-calendar-margin-div')
            $('#easychat-chat-container').animate({ scrollTop: $('#easychat-chat-container').prop('scrollHeight') }, 400);
        }
        else
            submit_btn.classList.add("easychat-widget-disabled");
            reset_btn.classList.remove("easychat-widget-disabled");
    } else if (type_picker == "Single datetime") {
        var btns_date = document.getElementsByClassName('easychat-datepicker-btn')
        var btns_time = document.getElementsByClassName('easychat-timepicker-btn')
        var btn_section = document.querySelector('#easychat-datetime-picker-wrapper-div-' + i.split("-")[0] + ' .bot-widget-submit-reset-btn-wrapper');
        var reset_btn = btn_section.querySelector(".easychat-bot-widget-reset-btn");
        var submit_btn = btn_section.querySelector(".easychat-bot-widget-submit-btn");

        if (btns_date[btns_date.length - 1].value !== (LABEL_ADD + " " + LABEL_DATE) && changed_date_picker_single && btns_time[btns_time.length - 1].value !== (LABEL_ADD + " " + LABEL_TIME)) {
            submit_btn.classList.remove("easychat-widget-disabled");
            calendar_div[calendar_div.length - 1].classList.add('easychat-calendar-margin-div')
            $('#easychat-chat-container').animate({ scrollTop: $('#easychat-chat-container').prop('scrollHeight') }, 400);
        }
        else
            submit_btn.classList.add("easychat-widget-disabled");
            reset_btn.classList.remove("easychat-widget-disabled");
    } else if (type_picker == "Double datetime") {

        var btns_date = document.getElementsByClassName('easychat-datepicker-btn')
        var btns_time = document.getElementsByClassName('easychat-timepicker-btn')
        var btn_section = document.querySelector('#easychat-datetime-picker-wrapper-div-' + i.split("-")[0] + ' .bot-widget-submit-reset-btn-wrapper');
        var reset_btn = btn_section.querySelector(".easychat-bot-widget-reset-btn");
        var submit_btn = btn_section.querySelector(".easychat-bot-widget-submit-btn");

        if (btns_date[btns_date.length - 2].value !== (LABEL_FROM + " " + LABEL_DATE) && btns_date[btns_date.length - 1].value != (LABEL_TO + " " + LABEL_DATE) && changed_date_picker_from && changed_date_picker_to && btns_time[btns_time.length - 2].value !== (LABEL_FROM + " " + LABEL_TIME) && btns_time[btns_time.length - 1].value != (LABEL_TO + " " + LABEL_TIME)) {
            submit_btn.classList.remove("easychat-widget-disabled");
            calendar_div[calendar_div.length - 1].classList.add('easychat-calendar-margin-div')
            $('#easychat-chat-container').animate({ scrollTop: $('#easychat-chat-container').prop('scrollHeight') }, 400);
        }
        else
            submit_btn.classList.add("easychat-widget-disabled");
            reset_btn.classList.remove("easychat-widget-disabled");
    } else if (type_picker == "Double date single time") {
        var btns_date = document.getElementsByClassName('easychat-datepicker-btn')
        var btns_time = document.getElementsByClassName('easychat-timepicker-btn')
        var btn_section = document.querySelector('#easychat-datetime-picker-wrapper-div-' + i.split("-")[0] + ' .bot-widget-submit-reset-btn-wrapper');
        var reset_btn = btn_section.querySelector(".easychat-bot-widget-reset-btn");
        var submit_btn = btn_section.querySelector(".easychat-bot-widget-submit-btn");

        if (btns_date[btns_date.length - 2].value !== (LABEL_FROM + " " + LABEL_DATE) && btns_date[btns_date.length - 1].value != (LABEL_TO + " " + LABEL_DATE) && changed_date_picker_from && changed_date_picker_to && btns_time[btns_time.length - 1].value !== (LABEL_ADD + " " + LABEL_TIME)) {
            submit_btn.classList.remove("easychat-widget-disabled");
            calendar_div[calendar_div.length - 1].classList.add('easychat-calendar-margin-div')
            $('#easychat-chat-container').animate({ scrollTop: $('#easychat-chat-container').prop('scrollHeight') }, 400);
        }
        else
            submit_btn.classList.add("easychat-widget-disabled");
            reset_btn.classList.remove("easychat-widget-disabled");
    } else if (type_picker == "Single date double time") {
        var btns_date = document.getElementsByClassName('easychat-datepicker-btn')
        var btns_time = document.getElementsByClassName('easychat-timepicker-btn')
        var btn_section = document.querySelector('#easychat-datetime-picker-wrapper-div-' + i.split("-")[0] + ' .bot-widget-submit-reset-btn-wrapper');
        var reset_btn = btn_section.querySelector(".easychat-bot-widget-reset-btn");
        var submit_btn = btn_section.querySelector(".easychat-bot-widget-submit-btn");

        if (btns_date[btns_date.length - 1].value !== (LABEL_ADD + " " + LABEL_DATE) && changed_date_picker_single && btns_time[btns_time.length - 2].value != (LABEL_FROM + " " + LABEL_TIME) && btns_time[btns_time.length - 1].value !== (LABEL_TO + " " + LABEL_TIME)) {
            submit_btn.classList.remove("easychat-widget-disabled");
            calendar_div[calendar_div.length - 1].classList.add('easychat-calendar-margin-div')
            $('#easychat-chat-container').animate({ scrollTop: $('#easychat-chat-container').prop('scrollHeight') }, 400);
        }
        else
            submit_btn.classList.add("easychat-widget-disabled");
            reset_btn.classList.remove("easychat-widget-disabled");
    }
}
function changedDate(i, type, element) {

    if (document.querySelector("#datepicker-" + i).value !== (LABEL_ADD + " " + LABEL_DATE) && document.querySelector("#datepicker-" + i).value !== (LABEL_FROM + " " + LABEL_DATE) && document.querySelector("#datepicker-" + i).value !== (LABEL_TO + " " + LABEL_DATE)) {

        if (i.indexOf("-0") != -1) {
            changed_date_picker_from = true
            changed_date_picker_single = true
        } else {
            changed_date_picker_to = true
        }

        var dayArr = language_days_list;
        var monthArr = language_months_list;
        var date = new Date(document.querySelector("#datepicker-" + i).value);
        var datenum = date.getDate();
        var month = date.getMonth();
        var year = date.getFullYear();
        var day = date.getDay();
        if (day == 0)
            day = 7

        document.querySelector("#date-displayer-" + i + " .date").innerHTML = datenum;
        document.querySelector("#date-displayer-" + i + " .month-year").innerHTML = monthArr[month] + " " + year;

        document.querySelector("#date-displayer-" + i + " .day").innerHTML = dayArr[day - 1];
        if (!isNaN(datenum)) {

            if (document.getElementById('calendar-div-' + i.split("-")[0]).style.opacity + "" != "0.9") {
                handleBtnSection(type, i);
                document.getElementById("datepicker-" + i).style.opacity = "0 ";
                document.getElementById("date-displayer-" + i).style.visibility = "visible";
                if (type == "Single date" || type == "Double date")
                    append_selected_calender_date_into_user_query(element, i)
                else if (type == "Single date double time") {
                    document.getElementById("datepicker-" + i).style.width = "130px"
                }
            }
        }
        if (is_widgets) {
            if (EASYCHAT_BOT_THEME == "theme_1") {
                disable_footer_widget_response_theme_1()
            }
            else if (EASYCHAT_BOT_THEME == "theme_2") {
                disable_footer_widget_response_theme_2()
            }
            else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
                disable_footer_widget_response_theme3_and_theme4()
            }

        }
    }

}
function reset_changed_date_variables() {
    changed_date_picker_to = false
    changed_date_picker_from = false
    changed_date_picker_single = false
}
function handleCalendarClose(div_id, datepicker_length) {
    handleReset(div_id, datepicker_length);
    set_global_calendar_input("")
    reset_changed_date_variables()
    calender_date_widget_value = null
    calender_time_widget_value = null
    currently_time_picker_type = ""
    calendar_div_id = ""
    currently_opened_time_modal_id = ""
    inital_calendar_html = ""
    set_global_calendar_input("")
    document.querySelector("#easychat-datetime-picker-wrapper-div-" + div_id).classList.add("easychat-widget-disabled");
    enable_user_input()
    if (is_widgets) {
        if (EASYCHAT_BOT_THEME == "theme_1") {
            enable_footer_widget_response_theme_1()
            deactivate_query_submit_button()
        }
        else if (EASYCHAT_BOT_THEME == "theme_2") {
            enable_footer_widget_response_theme_2()
            deactivate_query_submit_button()
        }
        else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
            enable_footer_widget_response_theme3_and_theme4()
        }
        show_user_input = true;
    }
    update_input_placeholder_based_on_theme(get_placeholder_text_based_on_theme());
}

function handleCalendarSubmit(type_picker, div_id) {

    if (type_picker == "Single datetime") {
        var date_input = ""
        date_input = document.getElementsByClassName('easychat-datepicker-btn')
        if (date_input.length > 0) {
            date_input = date_input[date_input.length - 1].value
            date_input = render_date_in_alpha(date_input)
        }

        var time_input = ""
        time_input = document.getElementsByClassName('easychat-timepicker-btn')
        if (time_input.length > 0) {
            time_input = time_input[time_input.length - 1].value
        }
        edit_user_input_based_on_theme("Date: " + date_input + ", Time: " + time_input)
    } else if (type_picker == "Double datetime") {
        var date_input = ""
        var date_input2 = ""
        date_input = document.getElementsByClassName('easychat-datepicker-btn')
        if (date_input.length > 0) {
            date_input2 = date_input[date_input.length - 1].value
            date_input = date_input[date_input.length - 2].value
            if (new Date(date_input) > new Date(date_input2)) {
                alert("'From date' must be less than 'To date'")
                return;
            }
            date_input = render_date_in_alpha(date_input)
            date_input2 = render_date_in_alpha(date_input2)
        }

        var time_input = ""
        var time_input2 = ""
        time_input = document.getElementsByClassName('easychat-timepicker-btn')
        if (time_input.length > 0) {
            time_input2 = time_input[time_input.length - 1].value
            time_input = time_input[time_input.length - 2].value
        }
        formated_input = "From Date: " + date_input + ", From Time: " + time_input + ", To Date: " + date_input2 + ", To Time: " + time_input2
        edit_user_input_based_on_theme(formated_input)
    } else if (type_picker == "Double date single time") {
        var date_input = ""
        var date_input2 = ""
        date_input = document.getElementsByClassName('easychat-datepicker-btn')
        if (date_input.length > 0) {
            date_input2 = date_input[date_input.length - 1].value
            date_input = date_input[date_input.length - 2].value
            if (new Date(date_input) > new Date(date_input2)) {
                alert("'From date' must be less than 'To date'")
                return;
            }
            date_input = render_date_in_alpha(date_input)
            date_input2 = render_date_in_alpha(date_input2)
        }

        var time_input = ""
        time_input = document.getElementsByClassName('easychat-timepicker-btn')
        if (time_input.length > 0) {
            time_input = time_input[time_input.length - 1].value
        }
        formated_input = "From Date: " + date_input + ", To Date: " + date_input2 + ", Time: " + time_input
        edit_user_input_based_on_theme(formated_input)
    } else if (type_picker == "Single date double time") {
        var date_input = ""
        date_input = document.getElementsByClassName('easychat-datepicker-btn')
        if (date_input.length > 0) {
            date_input = date_input[date_input.length - 1].value
            date_input = render_date_in_alpha(date_input)
        }

        var time_input = ""
        var time_input2 = ""
        time_input = document.getElementsByClassName('easychat-timepicker-btn')
        if (time_input.length > 0) {
            time_input2 = time_input[time_input.length - 1].value
            time_input = time_input[time_input.length - 2].value

            var fromdt = "2013/05/29 " + time_input;
            var todt = "2013/05/29 " + time_input2;
            var from = new Date(Date.parse(fromdt));
            var to = new Date(Date.parse(todt));

            if (from > to) {
                alert("'From time' must be less than 'To time'")
                return;
            }
        }
        formated_input = "Date: " + date_input + ", From Time: " + time_input + ", To Time: " + time_input2
        edit_user_input_based_on_theme(formated_input)
    }
    else if (type_picker == "") {
        formated_input = get_global_calendar_input()
        edit_user_input_based_on_theme(formated_input)
    }

    is_widget_data = true;

    var btn_section = document.querySelector("#easychat-datetime-picker-wrapper-div-" + div_id + " .bot-widget-submit-reset-btn-wrapper");
    btn_section.style.display = "none";

    var calendar_divs = document.getElementsByClassName("easychat-calendar-div")
    length = calendar_divs.length
    calendar_divs[length - 1].style.opacity = "0.9"
    calendar_divs[length - 1].style.pointerEvents = "none"
    calendar_divs[length - 1].classList.remove('easychat-calendar-margin-div')
    reset_changed_date_variables()
    send_message();
    enable_user_input();
    calender_date_widget_value = null
    calender_time_widget_value = null
    currently_time_picker_type = ""
    calendar_div_id = ""
    currently_opened_time_modal_id = ""
    set_global_calendar_input("")
    is_remove_widget = false;
    currently_time_picker_type = ""
    inital_calendar_html = ""
    document.querySelector("#easychat-datetime-picker-wrapper-div-" + div_id).classList.add("calendar-widget-submit-wrapper")
}
function handleReset(div_id, length) {
    reset_changed_date_variables()
    if (length != 1 && length != 2) {
        length = 0
    }
    document.querySelector("#calendar-div-" + div_id).innerHTML = inital_calendar_html;
    $("#calendar-div-" + div_id).removeClass('easychat-calendar-margin-div')

    //date picker
    if (length > 0) {
        if (length == 1) {
            $("#datepicker-" + div_id + "-0").datepicker({ autoclose: true });
        }
        else if (length == 2) {
            $("#datepicker-" + div_id + "-0").datepicker({ autoclose: true });
            $("#datepicker-" + div_id + "-1").datepicker({ autoclose: true });
        }
    }
    $("#easychat-chat-container").scroll(function () {

        setTimeout(function () {
            if (document.getElementById("datepicker-" + div_id + "-0")) {
                $("#datepicker-" + div_id + "-0").datepicker('hide');
                $("#datepicker-" + div_id + "-0").blur();
            }

            if (document.getElementById("datepicker-" + div_id + "-1")) {
                $("#datepicker-" + div_id + "-1").datepicker('hide');
                $("#datepicker-" + div_id + "-1").blur();
            }
        }, 200);
    });

    //time picker
    if (document.getElementsByClassName('easychat-time-btn').length > 0) {
        const input = document.querySelector('.easychat-timepicker-btn');

        const descriptor = Object.getOwnPropertyDescriptor(Object.getPrototypeOf(input), 'value');

        Object.defineProperty(input, 'value', {
            set: function (t) {
                console.log('Input value was changed programmatically');
                return descriptor.set.apply(this, arguments);
            },
            get: function () {
                return descriptor.get.apply(this);
            }
        });
    }

    document.querySelector("#easychat-datetime-picker-wrapper-div-" + div_id + " .easychat-bot-widget-reset-btn").classList.add("easychat-widget-disabled");
    document.querySelector("#easychat-datetime-picker-wrapper-div-" + div_id + " .easychat-bot-widget-submit-btn").classList.add("easychat-widget-disabled");
}

function render_date_in_alpha(date_in_num) {
    const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    try {
        const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        var dd_MM_yyyy = ""
        if (date_in_num.split("/").length == 3) {
            var date_input = new Date(date_in_num);
            var day = date_input.getDate();
            var month = date_input.getMonth();
            month = monthNames[month]
            var year = date_input.getFullYear();
            dd_MM_yyyy = day + "-" + month + "-" + year;
            return dd_MM_yyyy
        }
    } catch (err) {
        console.log(err)
        return ""
    }
}
// time picker script ends

function append_calender_time(timepicker_list) {
    if (timepicker_list.length > 0) {
        timepicker_container = document.getElementById("easychat-timepicker-container");
        if (timepicker_container != undefined && timepicker_container != null) {
            timepicker_container.remove();
        }
        calender_time_widget_value = null;
        var timepicker_html = '<div class="easychat-timepicker-container easychat-calender-timepicker-container" align="center" id="easychat-timepicker-container">';
        for (var i = 0; i < timepicker_list.length; i++) {
            timepicker_html += '<div style="width:100%" class="easychat-timepicker-div"><br>\
            <input type="text" inputmode="none" name="timepicker" class="easychat-timepicker timepicker easychat-timepicker-theme-sp" onfocusout="append_selected_calender_time_into_user_query(this)" oninput="append_selected_calender_time_into_user_query(this)" onchange="append_selected_calender_time_into_user_query(this)" id="easychat-timepicker-' + i + '" placeholder="' + timepicker_list[i]["placeholder"] + '">\
            </div>';
        }
        timepicker_html += "</div>";


        setTimeout(function () {
            for (var i = 0; i < timepicker_list.length; i++) {
                $("#easychat-timepicker-" + i).timepicker({
                    timeFormat: 'h:i a',
                    appendTo: 'body',
                    className: null,
                    closeOnWindow: false,
                    disableTextInput: false,
                    disableTimeRanges: [],
                    disableTouchKeyboard: false,
                    durationTime: null,
                    forceRoundTime: false,
                    maxTime: null,
                    minTime: null,
                    noneOption: false,
                    orientation: 'l',
                    scrollDefault: null,
                    selectOnBlur: false,
                    show2400: true,
                    showDuration: false,
                    showOnFocus: true,
                    step: 15,
                    stopScrollPropagation: false,
                    typeaheadHighlight: false,
                    useSelect: false,
                    autoclose: true,
                });
            }
        }, 200)
        $("#easychat-chat-container").append(timepicker_html);
    }
}

function append_selected_calender_date_into_user_query(element, id) {
    var div_id = id.split("-")
    div_id = div_id[0]
    easychat_datepicker_list = document.querySelectorAll("#calendar-div-" + div_id + " .easychat-datepicker-btn");

    const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    var user_input = "";
    var date_array = []
    calender_date_widget_value = null;
    if (easychat_datepicker_list.length == 1) {
        easychat_datepicker_list[easychat_datepicker_list.length - 1].placeholder = "Date"
    } else if (easychat_datepicker_list.length == 2) {
        easychat_datepicker_list[easychat_datepicker_list.length - 2].placeholder = "From Date"
        easychat_datepicker_list[easychat_datepicker_list.length - 1].placeholder = "To Date"
    }
    for (var i = 0; i < easychat_datepicker_list.length; i++) {
        var date_input_value = easychat_datepicker_list[i].value
        date_input_split_with_hyphen = true
        try {
            var dd_MM_yyyy = ""
            if (date_input_value.split("/").length == 3) {
                date_input_split_with_hyphen = false
                var date_input = new Date(date_input_value);
                var day = date_input.getDate();
                var month = date_input.getMonth();
                month = monthNames[month]
                var year = date_input.getFullYear();
                dd_MM_yyyy = day + "-" + month + "-" + year;

            }
        } catch (err) {
            console.log(err)
        }
        if (date_input_split_with_hyphen == true) {
            try {
                var dd_MM_yyyy = ""
                if (date_input_value.split("-").length == 3) {
                    date_input_split_with_hyphen = false
                    date_input_value = date_input_value.split("-")
                    date_input_value = date_input_value[1] + "/" + date_input_value[0] + "/" + date_input_value[2]
                    var date_input = new Date(date_input_value);
                    var day = date_input.getDate();
                    var month = date_input.getMonth();
                    month = monthNames[month]
                    var year = date_input.getFullYear();
                    dd_MM_yyyy = day + "-" + month + "-" + year;

                }
            } catch (err) { }
        }
        user_input += easychat_datepicker_list[i].placeholder + ": " + dd_MM_yyyy;
        date_array.push(dd_MM_yyyy)
        if (i != easychat_datepicker_list.length - 1) {
            user_input += ", ";
        }
    }

    for (var i = 0; i < date_array.length; i++) {
        if (date_array[i] == "NaN-undefined-NaN") {
            easychat_datepicker_list[i].value = ""
            return;
        }
    }

    for (var i = 0; i < date_array.length; i++) {
        if (date_array[i] == "") {
            empty_user_input_based_on_theme()
            is_remove_widget = false;
            return;
        }
    }
    calender_date_widget_value = user_input;
    if (calender_date_widget_value != null
        // && calender_time_widget_value != null
    ) {
        if (calender_time_widget_value == null)
            set_global_calendar_input(calender_date_widget_value)
        else
            set_global_calendar_input(calender_date_widget_value + ", " + calender_time_widget_value)
    }
    is_remove_widget = true;
    disable_user_input();

}

function set_global_calendar_input(text) {
    global_calendar_input = text
}

function get_global_calendar_input() {
    return global_calendar_input
}

function convertTime12to24(time12h) {
    try {
        var complete_time = time12h.split(' ');
        var time = complete_time[0]
        var modifier = complete_time[1]

        var hrsmins = time.split(':');
        var hours = hrsmins[0]
        var minutes = hrsmins[1]
        if (hours === '12') {
            hours = '00';
        }
        if (modifier === 'PM') {
            hours = parseInt(hours, 10) + 12;
        }
        var final_time = hours + ":" + minutes
        return final_time
    } catch (err) {
        return ""
    }
}

function append_selected_calender_time_into_user_query(element, id) {
    var div_id = id.split("-")
    div_id = div_id[0]
    easychat_timepicker_list = document.querySelectorAll("#calendar-div-" + div_id + " .easychat-timepicker-btn");
    var user_input = "";
    calender_time_widget_value = null;
    if (easychat_timepicker_list.length == 1) {
        easychat_timepicker_list[easychat_timepicker_list.length - 1].placeholder = "Time"
    } else if (easychat_timepicker_list.length == 2) {
        easychat_timepicker_list[easychat_timepicker_list.length - 2].placeholder = "From Time"
        easychat_timepicker_list[easychat_timepicker_list.length - 1].placeholder = "To Time"
    }

    for (var i = 0; i < easychat_timepicker_list.length; i++) {
        var time_input_value = easychat_timepicker_list[i].value
        hh_mm = time_input_value
        hh_mm = hh_mm.replace(" ", "")

        if (/^([0-9]{1,2}:[0-9]{1,2}[aApP][mM])$/.test(hh_mm) == false) {
            empty_user_input_based_on_theme()
            is_remove_widget = false;
            return;
        }
        user_input += easychat_timepicker_list[i].placeholder + ": " + hh_mm;
        if (i != easychat_timepicker_list.length - 1) {
            user_input += " , ";
        }
    }

    calender_time_widget_value = user_input;
    if (calender_time_widget_value != null) {

        if (calender_date_widget_value == null)
            set_global_calendar_input(calender_time_widget_value)
        else
            set_global_calendar_input(calender_date_widget_value + ", " + calender_time_widget_value)

        activate_query_submit_button();
    }
    is_remove_widget = true;
    disable_user_input();
}

function append_selected_date_into_user_query(element) {

    easychat_datepicker_list = document.getElementsByClassName("easychat-datepicker-btn");
    const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    var user_input = "";
    var date_array = []
    for (var i = 0; i < easychat_datepicker_list.length; i++) {
        var date_input_value = easychat_datepicker_list[i].value
        date_input_split_with_hyphen = true
        try {
            var dd_MM_yyyy = ""
            if (date_input_value.split("/").length == 3) {
                date_input_split_with_hyphen = false
                // date_input_value = date_input_value.split("/")
                // date_input_value = date_input_value[1] + "/" + date_input_value[0] + "/" + date_input_value[2]
                var date_input = new Date(date_input_value);
                var day = date_input.getDate();
                var month = date_input.getMonth();
                month = monthNames[month]
                var year = date_input.getFullYear();
                dd_MM_yyyy = day + "-" + month + "-" + year;

            }
        } catch (err) { }
        if (date_input_split_with_hyphen == true) {
            try {
                var dd_MM_yyyy = ""
                if (date_input_value.split("-").length == 3) {
                    date_input_split_with_hyphen = false
                    date_input_value = date_input_value.split("-")
                    date_input_value = date_input_value[1] + "/" + date_input_value[0] + "/" + date_input_value[2]
                    var date_input = new Date(date_input_value);
                    var day = date_input.getDate();
                    var month = date_input.getMonth();
                    month = monthNames[month]
                    var year = date_input.getFullYear();
                    dd_MM_yyyy = day + "-" + month + "-" + year;

                }

            } catch (err) { }
        }
        user_input += easychat_datepicker_list[i].placeholder + ": " + dd_MM_yyyy;
        date_array.push(dd_MM_yyyy)
        if (i != easychat_datepicker_list.length - 1) {
            user_input += ", ";
        }
    }

    for (var i = 0; i < date_array.length; i++) {
        if (date_array[i] == "NaN-undefined-NaN") {
            easychat_datepicker_list[i].value = ""
            return;
        }
    }
    for (var i = 0; i < date_array.length; i++) {
        if (date_array[i] == "") {
            empty_user_input_based_on_theme()
            is_remove_widget = false;
            return;
        }
    }
    edit_user_input_based_on_theme(user_input)
    activate_query_submit_button();
    is_remove_widget = true;
    disable_user_input();
}


function handleRadio(element, radio_widget_id) {
    $("#easychat-radio-button-container-" + radio_widget_id + " .radio-item").removeClass("radio-item-active");
    $(element.parentElement).addClass("radio-item-active");
}

function handleFormRadio(element, id) {
    $(".radio-item-" + id).removeClass("radio-item-active");
    $(element.parentElement).addClass("radio-item-active");
}


function append_radio_buttons(radio_button_choices) {
    if (radio_button_choices.length > 0) {

        $(".easychat-radio-button-container:not(.easychat-widget-disabled)").remove()

        var radio_container_count = $(".easychat-radio-button-container").length;

        var radio_button_html = '<div class="easychat-radio-button-container" id="easychat-radio-button-container-' + radio_container_count + '" align="left">';
        var radio_button_start_count = $(".radio-input").length;

        if (EASYCHAT_BOT_THEME == "theme_1") {

            radio_button_html += '<div class="radio-div">'
            for (var i = 0; i < radio_button_choices.length; i++) {

                radio_button_html += '<label for="easychat-radio-' + (radio_button_start_count + i) + '">\
                    <div class="radio-item">\
                        <input type="radio" class="radio-input" name="radio_button_' + radio_container_count + '" onchange="handleRadio(this, ' + radio_container_count + ')"  id="easychat-radio-' + (radio_button_start_count + i) + '" onclick="select_radio_choice(this,' + (radio_button_start_count + i) + ',' + radio_button_choices.length + ')" value=\"' + radio_button_choices[i] + '\">\
                        <span class="radio_btn_choices_span" style="height: auto !important; padding-left: 20px !important;">'+ radio_button_choices[i] + '</span>\
                    </div>\
                </label>'
            }
            radio_button_html += "</div>"

        } else if (EASYCHAT_BOT_THEME == "theme_2" || EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
            radio_button_html += '<div class="radio-div">'

            for (var i = 0; i < radio_button_choices.length; i++) {

                radio_button_html += '<label for="easychat-radio-' + (radio_button_start_count + i) + '">\
                    <div class="radio-item">\
                        <input type="radio" class="radio-input" name="radio_button_' + radio_container_count + '" onchange="handleRadio(this, ' + radio_container_count + ')"  id="easychat-radio-' + (radio_button_start_count + i) + '" onclick="select_radio_choice(this,' + (radio_button_start_count + i) + ',' + radio_button_choices.length + ')" value=\"' + radio_button_choices[i] + '\">\
                        <span class="radio_btn_choices_span" style="height: auto !important;  padding-left: 20px !important;">'+ radio_button_choices[i] + '</span>\
                    </div>\
                </label>'
            }

            radio_button_html += "</div>";

        } else {
            for (var i = 0; i < radio_button_choices.length; i++) {
                radio_button_html += '<table><tbody>'
                radio_button_html +=
                    '<tr>\
                    <th style="font-weight:inherit">\
                        <label>\
                        <input type="radio" name="radio_button_' + radio_container_count + '" class="easychat-radio" id="easychat-radio-' + (radio_button_start_count + i) + '" onclick="append_selected_radio_choice_into_user_query(this)" value=\"' + radio_button_choices[i] + '\">\
                        <span style="font-family: "Silka", Sans-Serif;"><th style="font-weight:inherit;text-align: left;">' + radio_button_choices[i] + '</th></span>\
                        </label>\
                    </th>\
                </tr>'
            }
            radio_button_html += "</tbody></table>"
        }

        radio_button_html += "<div class='bot-widget-submit-reset-btn-wrapper'>\
                <button class='easychat-bot-widget-cancel-btn' onclick='cancel_radio_btn(this)'>" + CANCEL_TEXT + "</button>\
                <button class='easychat-bot-widget-submit-btn easychat-widget-disabled' onclick='send_radio_button_user_input(this)'>" + SUBMIT_TEXT + "</button>\
            </div>\
        </div>";

        $("#easychat-chat-container").append(radio_button_html);
        element_response = document.querySelectorAll(".easychat-radio-button-container")
        element_response_previous_height += element_response[element_response.length - 1].clientHeight

        update_input_placeholder_based_on_theme(WIDGETS_PLACEHOLDER_TEXT.split("$$$")[0]);
    }

}

function scroll_csat_form_to_bottom() {
    var objDiv = document.getElementById("easychat-csat-form-container");
    objDiv.scrollTop = objDiv.scrollHeight;
}

function initialize_phone_number_selector_csat(id, country_code, error_div_id) {
 
    window.iti = $("#" + id).intlTelInput({
        initialCountry: country_code,
        allowExtensions: true,
        formatOnDisplay: true,
        autoFormat: true,
        autoHideDialCode: true,
        autoPlaceholder: false,
        // utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
        utilsScript: "../../static/EasyChatApp/js/phone_widget_utils.js",
        // defaultCountry: "auto",
        ipinfoToken: "yolo",
        nationalMode: false,
        numberType: "MOBILE",
        //onlyCountries: ['us', 'gb', 'ch', 'ca', 'do'],
        preferredCountries: ['in', 'ae', 'qa', 'om', 'bh', 'kw', 'ma'],
        preventInvalidNumbers: true,
        separateDialCode: true,
    })

    document.getElementById(id).placeholder = ENTER_PHONE_TEXT;

    var isMobile = /Android.+Mobile|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

    if(!isMobile) {
        if ($("#searchinput_country_csat_form").length == 0){ 

            $(".easychat-form-div .country-list").prepend("<input autocomplete='off' id='searchinput_country_csat_form' placeholder='" + SEARCH_TEXT + "..' class='search_phone_number_widget_class'  type='text' onkeydown='filterFunctionCSAT(event, \"easychat-form-div\")' data-search autofocus/>");
            $(".easychat-form-div .country-list").append("<div class='country-no-result-found' id='country_no_result_found_livechat_modal'>" + NO_RESULT_FOUND + "</div>");
            
            $("#searchinput_country_csat_form").focus();
            $("#searchinput_country_csat_form").click(function(event) {
                event.stopPropagation();
                $(".easychat-form-div .country-list").addClass("show");
            });
        }
    }

    var error_div = document.getElementById(error_div_id)

    $(".selected-flag").on("click", function() {
        scroll_csat_form_to_bottom()
        if (isMobile) {
            $(".searchinput_country_csat_form").remove()
            $(".country-no-result-found").remove()
            $(".country").css("display", "");
            
            $(".country-list").prepend("<input autocomplete='off' id='searchinput_country_csat_form' class='searchinput_country_csat_form' placeholder='" + SEARCH_TEXT + "..' class='search_phone_number_widget_class'  type='text' onkeydown='filterFunctionCSAT(event, \"easychat-form-div\")' data-search autofocus/>");
            $(" .country-list").append("<div class='country-no-result-found' id='country_no_result_found_livechat_modal'>" + NO_RESULT_FOUND + "</div>");
            
            $("#searchinput_country_csat_form").focus();
            $("#searchinput_country_csat_form").click(function(event) {
                event.stopPropagation();
                $(".country-list").addClass("show");
            });
            
        }
    })

    $("#" + id).on("countrychange", function() {
        reset_phone_widget_csat(id, error_div)
        validate_phone_number_input_csat(id, error_div_id)

      });

    $("#" + id).focus(function() {
        $(".country-dropdown-placeholder").hide();
        
    })

    $("#" + id).keyup(function(event) {
        var character =  event.target.value.charAt(event.target.selectionStart - 1).charCodeAt()
        var value = String.fromCharCode(character)
        if (validate_number_input_value(value, event)) {
            reset_phone_widget_csat(id, error_div)
        }
        validate_phone_number_input_csat(id, error_div_id);
    })

    $("#" + id).keydown(function(event) {
        validate_number_input(event)
      
    })

    $("#" + id).focusout(function() {
        if ($("#" + id).val() == "") {
            $(".country-dropdown-placeholder").show();
    
        } else {
            $(".country-dropdown-placeholder").hide();
        }
    })
}

function initialize_phone_number_selector_themes(id, country_code, error_div_id) {
    window.iti = $("#" + id).intlTelInput({
        initialCountry: country_code,

        allowExtensions: true,
        formatOnDisplay: true,
        autoFormat: true,
        autoHideDialCode: true,
        autoPlaceholder: true,
        // utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/phone_widget_utils.js",
        utilsScript: "../../static/EasyChatApp/js/phone_widget_utils.js",

        // defaultCountry: "auto",
        ipinfoToken: "yolo",
        nationalMode: false,
        numberType: "MOBILE",
        //onlyCountries: ['us', 'gb', 'ch', 'ca', 'do'],
        preferredCountries: ['in', 'ae', 'qa', 'om', 'bh', 'kw', 'ma'],
        preventInvalidNumbers: true,
        separateDialCode: true,
    })

    var isMobile = /Android.+Mobile|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

    var phone_widget_id = id.split("_")[id.split("_").length - 1]

    if (!isMobile) {
        $("#easychat-country-code-dropdown-wrapper-" + phone_widget_id + " .country-list").prepend("<input id='searchinput_country_" + phone_widget_id + "' autocomplete='off' placeholder='" + SEARCH_TEXT + "..'  type='text' onkeydown='filterFunctionThemes(event, this, \"easychat-country-code-dropdown-wrapper-" + phone_widget_id + "\")' data-search autofocus/>");
        $("#easychat-country-code-dropdown-wrapper-" + phone_widget_id + " .country-list").append("<div class='country-no-result-found' id='country_no_result_found_modal_" + phone_widget_id + "\' >" + NO_RESULT_FOUND + "</div>");

        $("#searchinput_country_" + phone_widget_id).focus();
        $("#searchinput_country_" + phone_widget_id).click(function (event) {
            event.stopPropagation();
            $("#easychat-country-code-dropdown-wrapper-" + phone_widget_id + " .country-list").addClass("show");
        });

    }

    var error_div = document.getElementById(error_div_id)

    $(".selected-flag").on("click", function() {
        setTimeout(function () {
            scroll_to_bottom()
    
            }, 500)
        if (isMobile) {
            $(".searchinput_country").remove();
            $(".country-no-result-found").remove();
            $(".country").css("display", "");
            $(".country-list").prepend("<input id='searchinput_country_" + phone_widget_id + "' class='searchinput_country' autocomplete='off' placeholder='" + SEARCH_TEXT + "..'  type='text' onkeydown='filterFunctionThemes(event, this, \"easychat-country-code-dropdown-wrapper-" + phone_widget_id + "\")' data-search autofocus/>");
            $(".country-list").append("<div class='country-no-result-found' id='country_no_result_found_modal_" + phone_widget_id + "\' >" + NO_RESULT_FOUND + "</div>");

            $("#searchinput_country_" + phone_widget_id).focus();
            $("#searchinput_country_" + phone_widget_id).click(function (event) {
                event.stopPropagation();
                $(".country-list").addClass("show");
            });
        }
    })

    $("#" + id).change(function () {
        reset_phone_widget(id, error_div)
        if ($("#" + id).val() == "") return;
        validate_phone_number_input(id, error_div_id)

    })

    $("#" + id).on("countrychange", function () {
        reset_phone_widget(id, error_div)
        if ($("#" + id).val() == "") return;
        validate_phone_number_input(id, error_div_id)

    });

    $("#" + id).on('paste', function () {
        reset_phone_widget(id, error_div)
        show_phone_number_submit_btn(id)
        if ($("#" + id).val() == "") return;
        validate_phone_number_input(id, error_div_id)


    })

    $("#" + id).keydown(function (event) {
        if ($("#" + id).val() == "") return;
        validate_number_input(event)

        if (event.keyCode == 13) {
            if (validate_phone_number_input(id, error_div_id)) {
                $("#easychat-country-code-dropdown-wrapper-" + id.split("_")[id.split("_").length - 1] + " .easychat-bot-widget-submit-btn").click()
            } else {
                phone_widget_enter_pressed = true
                event.preventDefault()
            }
        }

    })


    $("#" + id).keyup(function (event) {
        var character =  event.target.value.charAt(event.target.selectionStart - 1).charCodeAt()
        var value = String.fromCharCode(character)
        reset_phone_widget(id, error_div)
        if ($("#" + id).val() == "") return;
        if (validate_number_input_value(value, event)) {   
            show_phone_number_submit_btn(id)
        }
        validate_phone_number_input(id, error_div_id)

    })

    setTimeout(function () {
        $("#" + id).focus()
    }, 500)

    // on blur: validate
    $("#" + id).blur(function () {
        reset_phone_widget(id, error_div)
        if ($("#" + id).val() == "") return;
        validate_phone_number_input(id, error_div_id)

    });

}

function show_phone_number_submit_btn(id) {

    var is_valid = $("#" + id).intlTelInput("isValidNumber")

    var phone_widget_id = id.split("_")[id.split("_").length - 1]

    if (!is_valid) {
        document.querySelector("#easychat-country-code-dropdown-wrapper-" + phone_widget_id + " .easychat-bot-widget-submit-btn").classList.add("easychat-widget-disabled");

    } else {

        if ($("#" + id).intlTelInput("getSelectedCountryData").dialCode == "91") {
            var phone = $("#" + id).val() + ""
            if (!validate_phone_number(phone)) {
                document.querySelector("#easychat-country-code-dropdown-wrapper-" + phone_widget_id + " .easychat-bot-widget-submit-btn").classList.add("easychat-widget-disabled");
            } else {
                document.querySelector("#easychat-country-code-dropdown-wrapper-" + phone_widget_id + " .easychat-bot-widget-submit-btn").classList.remove("easychat-widget-disabled");
                scroll_to_element()

            }
        } else {
            document.querySelector("#easychat-country-code-dropdown-wrapper-" + phone_widget_id + " .easychat-bot-widget-submit-btn").classList.remove("easychat-widget-disabled");
            scroll_to_element()
        }

    }
}

function validate_number_input(event) {
    let isnum = /^\d+$/.test(event.key);
    if (!isnum && event.keyCode != 8 && event.keyCode != 46 && event.keyCode != 37 && event.keyCode != 39) {
        event.preventDefault()
        return false
    }

    return true
}

function validate_number_input_value(value, event) {
    let isnum = /^\d+$/.test(value);
    if (!isnum) {
        event.preventDefault()
        return false
    }

    return true
}

function is_valid_number(text) {
    let isnum = /^\d+$/.test(text);
    if (!isnum) {
        return false
    }

    return true
}

function validate_phone_number_input(id, error_div_id) {
    var is_valid = $("#" + id).intlTelInput("isValidNumber")
    var error_div = document.getElementById(error_div_id)
    var validation_err = $("#" + id).intlTelInput("getValidationError")

    var phone_widget_id = id.split("_")[id.split("_").length - 1]
    
    if (!is_valid) {
        error_div.style.display = "block"
        $("#" + id).css({ "border": "1px solid #E10E00" })
        if (phone_widget_error_map[validation_err] == undefined) {
            validation_err = 0
        }
        error_div.innerHTML = phone_widget_error_map[validation_err]
        document.querySelector("#easychat-country-code-dropdown-wrapper-" + phone_widget_id + " .easychat-bot-widget-submit-btn").classList.add("easychat-widget-disabled");
        setTimeout(function (){scroll_to_bottom()}, 500)
        
        return false

    } else {
        if ($("#" + id).intlTelInput("getSelectedCountryData").dialCode == "91") {
            if (!validate_phone_number($("#" + id).val())) {
                error_div.style.display = "block"
                $("#" + id).css({ "border": "1px solid #E10E00" })
                error_div.innerHTML = phone_widget_error_map[0]

                document.querySelector("#easychat-country-code-dropdown-wrapper-" + phone_widget_id + " .easychat-bot-widget-submit-btn").classList.add("easychat-widget-disabled");
                setTimeout(function (){scroll_to_bottom()}, 500)


                return false
            } else {
                $("#" + id).css({ "border": "1px solid #10B981" })
                error_div.style.display = "none"
                document.querySelector("#easychat-country-code-dropdown-wrapper-" + phone_widget_id + " .easychat-bot-widget-submit-btn").classList.remove("easychat-widget-disabled");
                setTimeout(function (){scroll_to_bottom()}, 500)

                return true
            }
        } else {
            $("#" + id).css({ "border": "1px solid #10B981" })
            error_div.style.display = "none"
            document.querySelector("#easychat-country-code-dropdown-wrapper-" + phone_widget_id + " .easychat-bot-widget-submit-btn").classList.remove("easychat-widget-disabled");
            setTimeout(function (){scroll_to_bottom()}, 500)

            return true
        }
    }
}

function validate_phone_number_input_csat(id, error_div_id) {
    var is_valid = $("#" + id).intlTelInput("isValidNumber")
    var error_div = document.getElementById(error_div_id)
    var validation_err = $("#" + id).intlTelInput("getValidationError")
    
    if (!is_valid) {
        error_div.style.display = "block"
        $("#" + id).css({ "border": "1px solid #E10E00" })
        if (phone_widget_error_map[validation_err] == undefined) {
            validation_err = 0
        }
        error_div.innerHTML = phone_widget_error_map[validation_err]
        return false

    } else {
        if ($("#" + id).intlTelInput("getSelectedCountryData").dialCode == "91") {
            if (!validate_phone_number($("#" + id).val())) {
                error_div.style.display = "block"
                $("#" + id).css({ "border": "1px solid #E10E00" })
                error_div.innerHTML = phone_widget_error_map[0]

                return false
            } else {
                $("#" + id).css({ "border": "1px solid #10B981" })
                error_div.style.display = "none"
                return true
            }
        } else {
            $("#" + id).css({ "border": "1px solid #10B981" })
            error_div.style.display = "none"
            return true
        }
    }
}

function initialize_phone_number_selector_form(id, country_code, error_div_id, form_field_id, phone_no, default_country_code) {
    if (default_country_code == '' || default_country_code == null || default_country_code == undefined) default_country_code = "in"

    if (country_code == '' || country_code == null || country_code == undefined) return

    window.iti = $("#" + id).intlTelInput({
        initialCountry: default_country_code,

        allowExtensions: true,
        formatOnDisplay: true,
        autoFormat: true,
        autoHideDialCode: true,
        autoPlaceholder: true,
        // utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
        utilsScript: "../../static/EasyChatApp/js/phone_widget_utils.js",
        // defaultCountry: "auto",
        ipinfoToken: "yolo",
        nationalMode: false,
        numberType: "MOBILE",
        //onlyCountries: ['us', 'gb', 'ch', 'ca', 'do'],
        preferredCountries: ['in', 'ae', 'qa', 'om', 'bh', 'kw', 'ma'],
        preventInvalidNumbers: true,
        separateDialCode: true,
    }).then(function () {
        if (phone_no == '' || phone_no == null || phone_no == undefined) return

        if (is_valid_number(phone_no.trim())) {
            $("#" + id).intlTelInput("setCountry", country_code)
            $("#" + id).val(phone_no.trim())
            $("#" + id).focusout()
            form_field_phone_changed($("#" + id))
        } else {
            $("#" + id).val("")
            $("#" + id).focusout()
            $("#" + id).intlTelInput("setCountry", country_code)
        }

    });
    var isMobile = /Android.+Mobile|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

    if (!isMobile) {
        $("#parent-input-" + form_field_id + " .country-list").prepend("<input id='searchinput_country_" + form_field_id + "' autocomplete='off' placeholder='" + SEARCH_TEXT + "..'  type='text' onkeydown='filterFunctionThemes(event, this, \"parent-input-" + form_field_id + "\")' data-search autofocus/>");
        $("#parent-input-" + form_field_id + " .country-list").append("<div class='country-no-result-found' id='country_no_result_found_modal_" + form_field_id + "\' >" + NO_RESULT_FOUND + "</div>");

        $("#searchinput_country_" + form_field_id).focus();
        $("#searchinput_country_" + form_field_id).click(function (event) {
            event.stopPropagation();
            $("#parent-input-" + form_field_id + " .country-list").addClass("show");
        });
    }

    var error_div = document.getElementById(error_div_id)

    $(".selected-flag").on("click", function() {
        
        if (isMobile) {
            $(".searchinput_country").remove()
            $(".country-no-result-found").remove()
            $(".country").css("display", "");
            $(".country-list").prepend("<input id='searchinput_country_" + form_field_id + "' class='searchinput_country' autocomplete='off' placeholder='" + SEARCH_TEXT + "..'  type='text' onkeydown='filterFunctionThemes(event, this, \"parent-input-" + form_field_id + "\")' data-search autofocus/>");
            $(".country-list").append("<div class='country-no-result-found' id='country_no_result_found_modal_" + form_field_id + "\' >" + NO_RESULT_FOUND + "</div>");

            $("#searchinput_country_" + form_field_id).focus();
            $("#searchinput_country_" + form_field_id).click(function (event) {
                event.stopPropagation();
                $(".country-list").addClass("show");
            });
        }
    })

    $("#" + id).change(function () {
        reset_phone_widget_form(id, error_div)
        form_field_phone_changed($("#" + id))

    })

    $("#" + id).keydown(function (event) {

        validate_number_input(event)

    })

    $("#" + id).keyup(function () {
        reset_phone_widget_form(id, error_div)
        form_field_phone_changed($("#" + id))

    })

}

function reset_phone_widget_form(id, error_div) {
    error_div.innerHTML = "";
    error_div.style.display = "none";
};

function reset_phone_widget_csat(id, error_div) {
    $("#" + id).css({ "border": "1px solid #EBEBEB" })
    error_div.innerHTML = "";
    error_div.style.display = "none";
}

function reset_phone_widget(id, error_div) {
    $("#" + id).css({ "border": "1px solid #EBEBEB" })
    error_div.innerHTML = "";
    error_div.style.display = "none";

    if (document.getElementById(id).value.trim().length) {
        document.querySelector("#easychat-country-code-dropdown-wrapper-" + id.split("_")[id.split("_").length - 1] + " .easychat-bot-widget-reset-btn").classList.remove("easychat-widget-disabled");
    } else {
        document.querySelector("#easychat-country-code-dropdown-wrapper-" + id.split("_")[id.split("_").length - 1] + " .easychat-bot-widget-reset-btn").classList.add("easychat-widget-disabled");
    }
};

function filterFunctionCSAT(event, wrapper_id) {
    var input, filter, ul, a, i;
    input = document.getElementById("searchinput_country_csat_form");
    
    a = document.querySelectorAll("#easychat-csat-form-container .country");
    event.stopPropagation();
    setTimeout(function() {
        filter = input.value.toUpperCase().trim();
        var no_results_found = true
        for (i = 0; i < a.length; i++) {
            var txtValue = a[i].textContent || a[i].innerText;
            if (txtValue.toUpperCase().startsWith(filter)) {
                a[i].style.display = "";
                no_results_found = false
            } else {
                a[i].style.display = "none";
            }
        }
        if (filter != "") {
            $("#easychat-csat-form-container li.country.preferred, li.divider").hide();
        } else {
            $("#easychat-csat-form-container li.country.preferred, li.divider").show();
        }
        if (no_results_found) {
            document.querySelector(".country-no-result-found").style.display = "block";
        } else {
            document.querySelector(".country-no-result-found").style.display = "none";
        }
        scroll_csat_form_to_bottom()
    }, 100)
}

function filterFunctionThemes(event, ele, wrapper_id) {
    var input, filter, ul, a, i;
    input = ele;
    a = document.querySelectorAll(".country");
    event.stopPropagation();
    setTimeout(function () {
        filter = input.value.toUpperCase().trim();
        var no_results_found = true
        for (i = 0; i < a.length; i++) {
            var txtValue = a[i].textContent || a[i].innerText;
            if (txtValue.toUpperCase().startsWith(filter)) {
                a[i].style.display = "";
                no_results_found = false
            } else {
                a[i].style.display = "none";
            }
        }
        if (filter != "") {
            $("li.country.preferred, li.divider").hide();
        } else {
            $("li.country.preferred, li.divider").show();
        }
        if (no_results_found) {
            document.querySelector(".country-no-result-found").style.display = "block";
        } else {
            document.querySelector(".country-no-result-found").style.display = "none";
        }
    }, 100)

}

function append_phone_number_widget(country_code) {

    var phone_widget_count = document.getElementsByClassName("easychat-country-code-submit-btn-wrapper").length;

    var phone_number_html = '<div style="margin-bottom:12px" id="easychat-country-code-submit-btn-wrapper-' + phone_widget_count + '" class="easychat-country-code-submit-btn-wrapper easychat-country-code-submit-btn-wrapper-widget">\
    <div class="easychat-country-code-dropdown-wrapper" id="easychat-country-code-dropdown-wrapper-' + phone_widget_count + '">\
    <input id="country_phone_number_' + phone_widget_count + '" type="text" placeholder="' + ENTER_PHONE_TEXT + '">\
    <div class="country-code-error-message-div" id="country-code-error-message-div-' + phone_widget_count + '">\
        The Phone number is not valid\
    </div>\
    <div class="bot-widget-submit-reset-btn-wrapper widget-cancel-reset-wrapper-div">\
        <button class="easychat-bot-widget-reset-btn easychat-widget-disabled" onclick="reset_phone_widget_input(' + phone_widget_count + ')">' + RESET_TEXT + '</button>\
        <div>\
            <button class="easychat-bot-widget-cancel-btn" onclick="cancel_phone_widget(' + phone_widget_count + ')">' + CANCEL_TEXT + '</button>\
            <button type="button" class="easychat-bot-widget-submit-btn easychat-widget-disabled" onclick="submit_phone_number_widget(\'country-code-error-message-div-' + phone_widget_count + '\', ' + phone_widget_count + ')">' + SUBMIT_TEXT + '</button>\
        </div>\
    </div>\
        </div>\
</div>'

    $("#easychat-chat-container").append(phone_number_html);
    initialize_phone_number_selector_themes("country_phone_number_" + phone_widget_count, country_code, "country-code-error-message-div-" + phone_widget_count)
    element_response = document.querySelectorAll(".easychat-country-code-dropdown-wrapper")
    element_response_previous_height += element_response[element_response.length - 1].clientHeight
    update_input_placeholder_based_on_theme(WIDGETS_PLACEHOLDER_TEXT.split("$$$")[2]);
}

function select_radio_choice(element, index, choices_length) {
    var selected_div_id = 'easychat-radio-div-' + index;
    append_selected_radio_choice_into_user_query(element);
    element.parentElement.parentElement.parentElement.parentElement.querySelector(".easychat-bot-widget-submit-btn").classList.remove("easychat-widget-disabled");
}

function submit_phone_number_widget(error_div_id, phone_widget_id) {

    var error_div = document.getElementById(error_div_id)
    if (validate_phone_number_input("country_phone_number_" + phone_widget_id, error_div_id)) {
        is_remove_widget = true
        is_widget_data = true;
        error_div.style.display = "none"
        var message_to_be_sent = "+" + $("#country_phone_number_" + phone_widget_id).intlTelInput("getSelectedCountryData").dialCode + " " + $("#country_phone_number_" + phone_widget_id).val()

        if (is_remove_widget == true) {
            remove_widgets();
        }

        empty_user_input_based_on_theme();
        send_user_input(message_to_be_sent);
    }
}


function append_selected_radio_choice_into_user_query(element) {

    var user_input = element.value;
    widget_user_selected_list = user_input.split();
    is_remove_widget = true;
    disable_user_input();
}

function onCheckBoxClick(element) {
    $(element.parentElement).toggleClass("checkbox-item-active");
    toggle_checkbox_submit_button(element);
    toggle_checkbox_reset_btn(element)
}

function onFormCheckBoxClick(element) {
    $(element.parentElement).toggleClass("checkbox-item-active");
    update_answers_filled(element)
}


function append_checkbox(check_box_choices) {
    if (check_box_choices.length > 0) {
        $('.easychat-check-box-container:not(.easychat-widget-disabled)').remove()

        var checkbox_counter = document.getElementsByClassName("easychat-check-box-container").length;

        var check_box_html = '<div class="easychat-check-box-container"  align="left" id="easychat-check-box-container-' + checkbox_counter + '">';

        if (EASYCHAT_BOT_THEME == "theme_1") {
            check_box_html += '<div class="checkbox-div">'
            for (var i = 0; i < check_box_choices.length; i++) {
                check_box_html += '<label for="easychat-checkbox-' + checkbox_counter + "-" + i + '">\
                    <div class="checkbox-item">\
                        <input type="checkbox" class="checkbox-input" onchange="onCheckBoxClick(this)" id="easychat-checkbox-' + checkbox_counter + "-" + i + '" value=\"' + check_box_choices[i] + '\">\
                        <span class="checkbox_btn_choices_span" style="height: auto !important;  padding-left: 20px !important;">'+ check_box_choices[i] + '</span>\
                    </div>\
                </label>'
            }
            check_box_html += "</div>"
        }
        else if (EASYCHAT_BOT_THEME == "theme_2" || EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
            check_box_html += '<div class="checkbox-div">'
            for (var i = 0; i < check_box_choices.length; i++) {
                check_box_html += '<label for="easychat-checkbox-' + checkbox_counter + "-" + i + '">\
                    <div class="checkbox-item">\
                        <input type="checkbox" class="checkbox-input" onchange="onCheckBoxClick(this)" id="easychat-checkbox-' + checkbox_counter + "-" + i + '" value=\"' + check_box_choices[i] + '\">\
                        <span class="checkbox_btn_choices_span" style="height: auto !important;  padding-left: 20px !important;">'+ check_box_choices[i] + '</span>\
                    </div>\
                </label>'
            }
            check_box_html += "</div>"

        } else {
            check_box_html += '<table><tbody>'
            for (var i = 0; i < check_box_choices.length; i++) {
                check_box_html +=
                    '<tr>\
                    <th style="font-weight:inherit">\
                        <label>\
                            <input type="checkbox" class="easychat-check-box" id="easychat-checkbox-' + checkbox_counter + "-" + i + '" onclick="append_selected_check_box_into_user_query(this)" value=\"' + check_box_choices[i] + '\">\
                            <span style="font-family: "Silka", Sans-Serif;"><th style="font-weight:inherit;text-align: left;">' + check_box_choices[i] + '</th></span>\
                        </label>\
                    </th>\
                </tr>'
            }
            check_box_html += "</tbody></table>"
        }
        check_box_html += "<div class='bot-widget-submit-reset-btn-wrapper widget-cancel-reset-wrapper-div'>\
            <button class='easychat-bot-widget-reset-btn easychat-widget-disabled' onclick='reset_checkbox_btn(this)'>" + RESET_TEXT + "</button>\
            <div>\
            <button class='easychat-bot-widget-cancel-btn' onclick='cancel_checkbox_btn(this)'>" + CANCEL_TEXT + "</button>\
            <button class='easychat-bot-widget-submit-btn easychat-widget-disabled' onclick='send_checkbox_user_input(this)'>" + SUBMIT_TEXT + "</button>\
            </div></div></div>";

        $("#easychat-chat-container").append(check_box_html);
        element_response = document.querySelectorAll(".easychat-check-box-container")

        element_response_previous_height += element_response[element_response.length - 1].clientHeight
        update_input_placeholder_based_on_theme(WIDGETS_PLACEHOLDER_TEXT.split("$$$")[0]);
    }

}

function select_checkbox(element, i) {
    append_selected_check_box_into_user_query(element)
}

function append_selected_check_box_into_user_query(element) {
    activate_query_submit_button();
    var user_input = element.value;
    var user_input_element = get_user_input_based_on_theme();

    if (user_input_element == "") {
        if (document.getElementById(element.id).checked) {
            edit_user_input_based_on_theme(user_input)
        } else {
            let formated_input = get_user_input_based_on_theme().replace(user_input, "")
            edit_user_input_based_on_theme(formated_input)
        }
    } else {
        if (document.getElementById(element.id).checked) {
            let formated_input = user_input_element + ", " + user_input;
            edit_user_input_based_on_theme(formated_input)
        } else {
            if (is_widgets) {
                if (EASYCHAT_BOT_THEME == "theme_1") {
                    disable_footer_widget_response_theme_1()
                }
                else if (EASYCHAT_BOT_THEME == "theme_2") {
                    disable_footer_widget_response_theme_2()   
                }
                else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
                    if (!($("input.checkbox-input:checked").length)) {
                        disable_footer_widget_response_theme3_and_theme4()
                    }
                }
            }
            var input = user_input_element.split(",")
            if (input.slice(-1)[0].trim() == user_input) {
                if (user_input_element.indexOf(', ') > -1) {
                    let formated_input = get_user_input_based_on_theme().replace(", " + user_input, "")
                    edit_user_input_based_on_theme(formated_input)
                } else {
                    let formated_input = get_user_input_based_on_theme().replace(user_input, "")
                    edit_user_input_based_on_theme(formated_input)

                }
            } else if (user_input_element.indexOf(', ') > -1) {
                let formated_input = get_user_input_based_on_theme().replace(user_input + ", ", "")
                edit_user_input_based_on_theme(formated_input)

            } else {
                let formated_input = get_user_input_based_on_theme().replace(user_input, "")
                edit_user_input_based_on_theme(formated_input)
            }
        }
    }

    var user_input_element = get_user_input_based_on_theme();
    if (user_input_element == '') {
        deactivate_query_submit_button();
    }

    widget_user_selected_list = get_user_input_based_on_theme().split(",")
    is_remove_widget = true;
    disable_user_input();
}

function click_dropdown(elem) {
    $(".easychat-widget-dropdown-content").toggleClass("easychat-display-dropdown");
    scroll_to_bottom();
}

function search_dropdown(element) {
    var original_height = 0, el;
    if (original_height == 0) {
        el = document.getElementsByClassName('easychat-widget-dropdown-content')[0];
        var el_style = window.getComputedStyle ? getComputedStyle(el, null) : el.currentStyle;
        original_height = parseInt(el_style.height);
    }
    var inputVal = $(element).val();
    var elem = document.getElementById('dropdown_choices');
    if (inputVal != '') {
        drop_down_html = '<a href="#" style = "display:none;"></a>'
        var is_empty = true;
        for (var i = 0; i < drop_down_choices_theme6.length; i++) {
            if (drop_down_choices_theme6[i].toUpperCase().indexOf(inputVal.toUpperCase()) != -1) {
                drop_down_html += '<a href="#" onclick="append_selected_drop_down_into_user_query(this); return false;"> ' + drop_down_choices_theme6[i] + '</a>';
                is_empty = false;
            }
        }
        if (is_empty) {
            drop_down_html = '<a href="#">' + NO_RESULT_FOUND + '</a>'
        }
    } else {
        drop_down_html = '<a href="#" style = "display:none;"></a>'

        for (var i = 0; i < drop_down_choices_theme6.length; i++) {
            drop_down_html += '<a href="#" onclick="append_selected_drop_down_into_user_query(this); return false;"> ' + drop_down_choices_theme6[i] + '</a>';
        }
    }
    elem.innerHTML = drop_down_html;
    var el_style = window.getComputedStyle ? getComputedStyle(el, null) : el.currentStyle;
    var height = parseInt(el_style.height);
    if (window.outerWidth > 450) {
        if (height < original_height) {
            el.style.marginBottom = (original_height - height) + 10 + 'px';
            scroll_to_bottom();
        } else {
            el.style.marginBottom = '10px';
            scroll_to_bottom();
        }
    }
}

var selected;
var last_selected = "";
var dropdown;
var optionsContainer;
var searchBox;
var optionsList;
var radioBtns;
var arrow;
let open;

function dropdown_click(ele) {
    // selected = document.getElementsByClassName("selected-dropdown")[0];
    // dropdown = document.getElementsByClassName("wrapper-box-dropdown")[0];
    // optionsContainer = document.getElementsByClassName("options-container-dropdown")[0];
    // searchBox = document.getElementsByClassName("search-box-dropdown")[0].firstElementChild;

    // optionsList = document.querySelectorAll(".option-dropdown");
    // radioBtns = document.querySelectorAll(".radio-dropdown");
    // arrow = document.getElementsByClassName("arrow-dropdown")[0];

    selected = ele.parentElement.parentElement.getElementsByClassName("selected-dropdown")[0];
    dropdown = ele.parentElement.parentElement.getElementsByClassName("wrapper-box-dropdown")[0];
    optionsContainer = ele.parentElement.parentElement.getElementsByClassName("options-container-dropdown")[0];
    searchBox = ele.parentElement.parentElement.getElementsByClassName("search-box-dropdown")[0].firstElementChild;
    dropdownWrapper = ele.parentElement.parentElement.getElementsByClassName("select-box-dropdown")[0];
    


    optionsList = ele.parentElement.parentElement.querySelectorAll(".option-dropdown");
    radioBtns = ele.parentElement.parentElement.querySelectorAll(".radio-dropdown");
    arrow = ele.parentElement.parentElement.getElementsByClassName("arrow-dropdown")[0];


    open = !open;
    if (optionsContainer.classList.contains("active")) {
        optionsContainer.className = "options-container-dropdown"
        dropdownWrapper.className = "select-box-dropdown"

    } else {
        ele.parentElement.parentElement.getElementsByClassName("options-container-dropdown")[0].className = "options-container-dropdown active"
        optionsContainer.classList.add("active")
        dropdownWrapper.classList.add("active-dropdown")

    }
    if (open) {
        selected.innerHTML = DROPDOWN_TEXT;
        selected.style.border = "none";
       
            arrow.style.transform = "translateY(-50%) rotate(180deg)";
     
        searchBox.parentElement.style.display = "block"
        $('#easychat-chat-container').animate({ scrollTop: $('#easychat-chat-container').prop('scrollHeight') }, 400);
    } else {
        searchBox.parentElement.style.display = "none"
        radioBtns.forEach(function (eachRadioBtn) {
            if (eachRadioBtn.checked) {
                selected.innerHTML = eachRadioBtn.nextElementSibling.innerText;
                eachRadioBtn.parentElement.setAttribute("id", "selected-blue-radio-dropdown");
            } else {
                eachRadioBtn.parentElement.removeAttribute("id");
            }
        })
    
            arrow.style.transform = "translateY(-50%) rotate(0deg)";
      
    }
    searchBox.value = "";
    filterList("");
    var channel_name = url_parameters["channel"]
    if (optionsContainer.classList.contains("active") && check_and_lower_string(channel_name) != "android" && check_and_lower_string(channel_name) != "ios" && !mobile_and_tablet_check()) {
        searchBox.focus();
    }
}

function search_keyup_dropdown(e) {
    filterList(e.target.value);
}

//Searching

function filterList(searchTerm) {
    searchTerm = searchTerm.toLowerCase();
    let flag = 0;
    document.querySelector(".no-elem-dropdown").style.display = "none";


    optionsList = Array.prototype.slice.call(optionsList);
    optionsList.forEach(function (option) {
        let label = option.firstElementChild.nextElementSibling.innerText.toLowerCase();
        if (label.indexOf(searchTerm) != -1) {
            flag = 1;
            option.style.display = "block";
        }
        else {
            option.style.display = "none";
        }
    })
    if (flag === 0)
        document.querySelector(".no-elem-dropdown").style.display = "block";
}

//drop select
function dropdown_select(eachOption, dropdown_id) {

    if (!document.querySelector('#easychat-drop-down-container-' + dropdown_id + " .active-dropdown")) {
        return;
    }

    if (last_selected != "")
        last_selected.removeAttribute("id");

    eachOption.setAttribute("id", "selected-blue-radio-dropdown");
    selected.innerHTML = eachOption.getElementsByClassName('dropdown-label')[0].innerText
    last_selected = eachOption

    searchBox.parentElement.style.display = "none"

    open = false;
    if (open)
        arrow.style.transform = "translateY(-50%) rotate(180deg)";
    else {
       
            arrow.style.transform = "translateY(-50%) rotate(0deg)";
        
    }
    optionsContainer.classList.remove("active");
    dropdownWrapper.classList.remove("active-dropdown")

    eachOption.parentElement.parentElement.parentElement.querySelector(".easychat-bot-widget-submit-btn").classList.remove("easychat-widget-disabled");

}


function append_dropdown(drop_down_choices) {
    var search_dropdown_icon = '<svg style="cursor: pointer; margin: 0px 10px; " width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">\
                            <path d="M5.55942 11.1182C6.79289 11.118 7.99083 10.7051 8.96247 9.94526L12.0174 13L13 12.0174L9.9451 8.96269C10.7054 7.991 11.1185 6.79285 11.1188 5.55912C11.1188 2.49396 8.62474 0 5.55942 0C2.49409 0 0 2.49396 0 5.55912C0 8.62428 2.49409 11.1182 5.55942 11.1182ZM5.55942 1.38978C7.85893 1.38978 9.72898 3.25973 9.72898 5.55912C9.72898 7.85851 7.85893 9.72846 5.55942 9.72846C3.2599 9.72846 1.38985 7.85851 1.38985 5.55912C1.38985 3.25973 3.2599 1.38978 5.55942 1.38978Z" fill="#757575"/>\
                            </svg> '

    if (drop_down_choices.length > 0) {
        drop_down_choices_theme6 = drop_down_choices;

        $('.easychat-drop-down-container:not(.easychat-widget-disabled)').remove()

        var dropdown_count = document.querySelectorAll('.easychat-drop-down-container').length;

        var drop_down_html = '<div id="easychat-drop-down-container-' + dropdown_count + '" class="easychat-drop-down-container easychat-theme6-drop-down-widget" >'

        drop_down_html += '<div class="container-dropdown">\
                <div class="select-box-dropdown">\
                  <div class="options-container-dropdown">'
        for (var i = 0; i < drop_down_choices.length; i++) {
            drop_down_html += ' <div class="option-dropdown" onclick="dropdown_select(this, ' + dropdown_count + ')">\
                            <input type="radio" class="radio-dropdown" id="dropdown-option-'+ dropdown_count + "-" + i + '" name="category"/>\
                            <label class="dropdown-label" for="dropdown-option-' + dropdown_count + "-" + i + '">' + drop_down_choices[i] + '</label>\
                        </div>'

        }

        drop_down_html += '<p class="no-elem-dropdown">' + NO_RESULT_FOUND + '</p>\
                  </div>\
                  <div class="wrapper-box-dropdown" onclick="dropdown_click(this)">\
                    <div class="box-dropdown">\
                      <div class="selected-dropdown">'
            + DROPDOWN_TEXT +
            '</div>\
                    </div>\
                    <div class="arrow-dropdown">\
                        <svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">\
                            <path d="M0.200408 0.739665C0.48226 0.436132 0.956809 0.418556 1.26034 0.700408L5 4.22652L8.73967 0.700408C9.0432 0.418556 9.51775 0.436132 9.7996 0.739665C10.0815 1.0432 10.0639 1.51775 9.76034 1.7996L5.51034 5.7996C5.22258 6.0668 4.77743 6.0668 4.48967 5.7996L0.239665 1.7996C-0.0638681 1.51775 -0.081444 1.0432 0.200408 0.739665Z" fill="#7b7a7b"/>\
                        </svg>\
                        </div>\
                  </div>\
                    <div class="search-box-dropdown" style="display: none">\
                      <input type="text" placeholder="&nbsp; &nbsp; &nbsp; '+ SEARCH_TEXT + '" onkeyup="search_keyup_dropdown(event)">\
                      </input>\
                    </div>\
                </div>\
                <div class="bot-widget-submit-reset-btn-wrapper" style="width: 100%;">\
                    <button class="easychat-bot-widget-cancel-btn" onclick="cancel_dropdown_btn(this)">' + CANCEL_TEXT + '</button>\
                    <button class="easychat-bot-widget-submit-btn easychat-widget-disabled" onclick="send_dropdown_user_input(this)">' + SUBMIT_TEXT + '</button>\
                </div>\
            </div>\
        </div></div>';

        $("#easychat-chat-container").append(drop_down_html);

        selected = document.getElementsByClassName("selected-dropdown")[0];
        last_selected = ""
        dropdown = document.getElementsByClassName("wrapper-box-dropdown")[0];
        optionsContainer = document.getElementsByClassName("options-container-dropdown")[0];
        searchBox = document.getElementsByClassName("search-box-dropdown")[0].firstElementChild;

        optionsList = document.querySelectorAll(".option-dropdown");
        radioBtns = document.querySelectorAll(".radio-dropdown");
        arrow = document.getElementsByClassName("arrow-dropdown")[0];
        open = false;
        update_input_placeholder_based_on_theme(WIDGETS_PLACEHOLDER_TEXT.split("$$$")[0]);
    }

}
function append_selected_drop_down_into_user_query(element) {
    activate_query_submit_button();
    edit_user_input_based_on_theme(element.innerText)
    widget_user_selected_list = get_user_input_based_on_theme().split()
    is_remove_widget = true;
    disable_user_input();
}

function append_selected_time_into_user_query(element) {
    easychat_timepicker_list = document.getElementsByClassName("easychat-timepicker");
    var user_input = "";
    for (var i = 0; i < easychat_timepicker_list.length; i++) {
        var time_input_value = easychat_timepicker_list[i].value
        hh_mm = time_input_value
        hh_mm = hh_mm.replace(" ", "")
        if (/^([0-9]{1,2}:[0-9]{1,2}[aApP][mM])$/.test(hh_mm) == false) {

            empty_user_input_based_on_theme();
            is_remove_widget = false;
            return;
        }
        user_input += easychat_timepicker_list[i].placeholder + ": " + hh_mm;
        if (i != easychat_timepicker_list.length - 1) {
            user_input += ", ";
        }
    }
    activate_query_submit_button();
    edit_user_input_based_on_theme(user_input);
    is_remove_widget = true;
    disable_user_input();
}


function append_bot_range_slider(range_slider_list) {
    if (range_slider_list.length > 0) {
        easychat_range_slider_container = document.getElementById("easychat-range-slider-container");
        if (easychat_range_slider_container != undefined && easychat_range_slider_container != null) {
            easychat_range_slider_container.remove();
        }

        var range_slider_html = '<div class="easychat-range-slider-container" id="easychat-range-slider-container">';
        for (var i = 0; i < range_slider_list.length; i++) {
            range_slider = range_slider_list[i];
            range_slider_html += '<div style="width:100%;display:inline-block;">\
              <p>' + MIN_TEXT + ': ' + range_slider["min"] + ', ' + MAX_TEXT + ': ' + range_slider["max"] + '</p>\
              <p>' + range_slider["placeholder"] + ': <span id="easychat-range-slider-value-' + i + '"></span></p>\
              <div class = "range-slider-div">'
            if (EASYCHAT_BOT_THEME == 'theme_2') {
                range_slider_html += '<label>' + RANGE_TEXT + '</label>'
            }
            range_slider_html += '<input class = "range-slider-input easychat-range-slider" type="range" min="' + range_slider["min"] + '" max="' + range_slider["max"] + '" value="' + range_slider["max"] + '" id="easychat-range-slider-' + i + '" oninput="append_selected_value_into_user_query(this)" placeholder="' + range_slider["placeholder"] + '">\
            </div></div>';
        }
        range_slider_html += '</div>';
        $("#easychat-chat-container").append(range_slider_html);
        element_response = document.querySelectorAll(".easychat-range-slider-container")
        element_response_previous_height += element_response[element_response.length - 1].clientHeight

        disable_user_input();
        /*for (var i = 0; i < range_slider_list.length; i++) {
            document.getElementById("easychat-range-slider-" + i).onchange();
        }*/
    }
}

function append_single_bot_range_slider(range_slider_list) {
    if (range_slider_list.length > 0) {
        $('.easychat-range-slider-wrapper:not(.easychat-widget-disabled)').remove();

        var range_slider = range_slider_list[0];
        var single_range_slider_count = document.getElementsByClassName("easychat-range-slider-wrapper").length;
        var range_slider_html = '<div class="easychat-range-slider-wrapper" id="easychat-bot-single-range-slider-' + single_range_slider_count + '"><div class="easychat-bot-range-slider-div">\
                <div class="easychat-bot-range-slider-div-heading">'
            + SELECT_VALUE_TEXT +
            '</div>\
                <div class="easychat-bot-range-slider-area">\
                    <input type="range" min="' + range_slider["min"] + '" max="' + range_slider["max"] + '" value="' + range_slider["max"] + '" steps="1" id="easychat-single-range-input-' + single_range_slider_count + '" ';
        if (is_internet_explorer) {
            range_slider_html += 'onchange="change_single_range_slider_values_for_ie(this.value, ' + single_range_slider_count + ')';
        } else {
            range_slider_html += 'oninput="change_single_range_slider_values(' + single_range_slider_count + ')';
        }
        range_slider_html += '">\
                    <div id="easychat-bot-slider-output-' + single_range_slider_count + '">'+ range_slider["max"] + '</div>\
                </div>\
                <div class="easychat-bot-range-min-max-value-wrapper">\
                    <div class="easychat-bot-range-min-value-div">\
                        <input type="number" oninput="update_single_range_slider(' + single_range_slider_count + ')" class="easychat-bot-range-min-inner-value" id="easychat-bot-range-selected-value-' + single_range_slider_count + '" style="color:'+ BOT_THEME_COLOR + '">\
                        <p>'+ SELECTED_VALUE_TEXT + '</p>\
                    </div>\
                </div>\
            </div>\
            <div class="range-slider-error-msg-div" id="single-slider-error-div-' + single_range_slider_count + '" style="color: #E10E00; font-size:12px; font-weight:400; margin-bottom:8px; display: none; direction: ltr;"></div>\
            <div class="bot-widget-submit-reset-btn-wrapper widget-cancel-reset-wrapper-div range-slider-btns-container">\
            <button class="easychat-bot-widget-reset-btn" onclick="reset_single_range_slider_btn(' + single_range_slider_count + ')">' + RESET_TEXT + '</button>'

            range_slider_html += '<div style="display: flex;">'

            range_slider_html += '<button type="button" class="easychat-bot-widget-cancel-btn" onclick="cancel_single_range_slider(' + single_range_slider_count + ')">'
            + CANCEL_TEXT +
            '</button>'

            range_slider_html += '<button type="button" class="easychat-bot-widget-submit-btn" onclick="append_selected_range_slider_value(' + single_range_slider_count + ')" style="background:'+ BOT_THEME_COLOR + '">'
            + SUBMIT_TEXT +
            '</button>'
            
            range_slider_html += '</div>\
                </div>\
            </div>'
        $("#easychat-chat-container").append(range_slider_html);
        element_response = document.querySelectorAll(".easychat-bot-range-slider-div")
        element_response_previous_height += element_response[element_response.length - 1].clientHeight

        var single_range_slider = document.getElementById("easychat-single-range-input-" + single_range_slider_count)
        var min = single_range_slider.min
        var max = single_range_slider.max
        var value = single_range_slider.value
        var percent_grad = ((value - min) / (max - min)) * 100
        var single_range_output = document.getElementById("easychat-bot-range-selected-value-" + single_range_slider_count);
        single_range_output.value = single_range_slider.value;

        single_range_slider.style.background = 'linear-gradient(94.34deg, ' + BOT_THEME_COLOR + ' 1%, ' + BOT_THEME_COLOR + ' ' + percent_grad + '%, rgba(106, 109, 205, 0.3) ' + percent_grad + '%, rgba(106, 109, 205, 0.3) 100%)'
        disable_user_input();
        update_input_placeholder_based_on_theme(WIDGETS_PLACEHOLDER_TEXT.split("$$$")[3])
        /*for (var i = 0; i < range_slider_list.length; i++) {
            document.getElementById("easychat-range-slider-" + i).onchange();
        }*/
    }
}

function change_single_range_slider_values(single_range_slider_id) {
    var single_range_slider = document.getElementById("easychat-single-range-input-" + single_range_slider_id)
    var min = single_range_slider.min
    var max = single_range_slider.max
    var value = single_range_slider.value
    var single_range_output = document.getElementById("easychat-bot-range-selected-value-" + single_range_slider_id);
    single_range_output.value = single_range_slider.value;
    var percent_grad = (value - min) / (max - min) * 100

    var slider_direction = "right";
    if (document.getElementsByTagName("body")[0].classList.contains("language-right-to-left-wrapper")) {
        slider_direction = "left";
    }

    single_range_slider.style.background = 'linear-gradient(to ' + slider_direction + ', ' + BOT_THEME_COLOR + ' 1%, ' + BOT_THEME_COLOR + ' ' + percent_grad + '%, rgba(106, 109, 205, 0.3) ' + percent_grad + '%, rgba(106, 109, 205, 0.3) 100%)'
    single_range_slider.oninput = function () {

        var slider_direction = "right";
        if (document.getElementsByTagName("body")[0].classList.contains("language-right-to-left-wrapper")) {
            slider_direction = "left";
        }

        var this_percent_grad = (this.value - this.min) / (this.max - this.min) * 100
        this.style.background = 'linear-gradient(to ' + slider_direction + ', ' + BOT_THEME_COLOR + ' 1%, ' + BOT_THEME_COLOR + ' ' + this_percent_grad + '%, rgba(106, 109, 205, 0.3) ' + this_percent_grad + '%, rgba(106, 109, 205, 0.3) 100%)'
        single_range_output.value = this.value;
    };
}

function change_single_range_slider_values_for_ie(value, single_range_slider_id) {
    var single_range_output = document.getElementById("easychat-bot-range-selected-value-" + single_range_slider_id);
    single_range_output.value = value;
}

function cancel_single_range_slider(single_range_slider_id) {
    document.getElementById("easychat-bot-single-range-slider-" + single_range_slider_id).classList.add("easychat-widget-disabled");
    reset_single_range_slider_btn(single_range_slider_id);
    enable_user_input();
    empty_user_input_based_on_theme();
    update_input_placeholder_based_on_theme(get_placeholder_text_based_on_theme());
}

function append_selected_range_slider_value(single_range_slider_id) {
    var range_slider_selected_value = document.getElementById("easychat-bot-range-selected-value-" + single_range_slider_id).value;
    edit_user_input_based_on_theme(SELECTED_VALUE_TEXT + ': ' + range_slider_selected_value)
    document.getElementById("easychat-bot-single-range-slider-" + single_range_slider_id).remove();
    is_widget_data = true;
    send_message();
    enable_user_input();
    is_remove_widget = true;
}

function append_multi_bot_range_slider(range_slider_list) {
    if (range_slider_list.length > 0) {
        // easychat_range_slider_container = document.getElementById("easychat-bot-multi-range-slider");
        // if (easychat_range_slider_container != undefined && easychat_range_slider_container != null) {
        //     easychat_range_slider_container.remove();
        // }
        var range_slider = range_slider_list[0];
        var multi_range_slider_count = document.getElementsByClassName("easychat-range-slider-wrapper").length;
        var range_slider_html = '<div class="easychat-range-slider-wrapper" id="easychat-bot-multi-range-slider-' + multi_range_slider_count + '"><div class="easychat-bot-range-slider-div">\
                <div class="easychat-bot-range-slider-div-heading">'
            + SELECT_VALUE_TEXT +
            '</div>\
                <div class="easychat-bot-range-slider-area" style="margin-bottom: 28px; margin-top:0px;">\
                    <input type="text" class="js-range-slider" name="my_range" value="" data-skin="round" data-type="double" data-min="' + range_slider["min"] + '" data-max="' + range_slider["max"] + '" data-grid="false" />\
                    <div id="multi-range-slider-min-max-static-value-' + multi_range_slider_count + '"><div>' + range_slider["min"] + '</div><div>' + range_slider["max"] + '</div></div>\
                    <input type="text" maxlength="1" value="' + range_slider["min"] + '" class="from dual-range-min-value" id="multi-range-slider-min-val-' + multi_range_slider_count + '" readonly oninput="change_multi_range_min_value()" style="display: none" />\
                    <input type="text" maxlength="1" value="' + range_slider["max"] + '" class="to dual-range-max-value" id="multi-range-slider-max-val-' + multi_range_slider_count + '" readonly oninput="change_multi_range_max_value()" style="display: none" />\
                </div>\
                <div class="easychat-bot-range-min-max-value-wrapper">\
                    <div class="easychat-bot-range-min-value-div">\
                        <input type="number" oninput="update_multi_range_slider(' + multi_range_slider_count + ')" class="easychat-bot-range-min-inner-value" id="easychat-bot-range-min-selected-value-' + multi_range_slider_count + '" style="color:'+ BOT_THEME_COLOR + '">\
                        <p>'+ MIN_TEXT + '</p>\
                    </div>\
                    <svg width="9" height="2" viewBox="0 0 9 2" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <path d="M0 0.905273H9" stroke="#8F8F8F"/>\
                        </svg>\
                    <div class="easychat-bot-range-max-value-div">\
                        <input type="number" oninput="update_multi_range_slider(' + multi_range_slider_count + ')" class="easychat-bot-range-max-inner-value" id="easychat-bot-range-max-selected-value-' + multi_range_slider_count + '" style="color:'+ BOT_THEME_COLOR + '">\
                        <p>'+ MAX_TEXT + '</p>\
                    </div>\
                </div></div>\
                <div class="range-slider-error-msg-div" id="multi-slider-error-div-' + multi_range_slider_count + '" style="color: #E10E00; font-size:12px; font-weight:400; margin-bottom:8px; display: none; direction: ltr;"></div>\
                <div class="bot-widget-submit-reset-btn-wrapper widget-cancel-reset-wrapper-div range-slider-btns-container">\
                <button class="easychat-bot-widget-reset-btn" onclick="reset_multi_range_slider_btn(' + multi_range_slider_count + ')">' + RESET_TEXT + '</button>'
            range_slider_html += '<div style="display: flex;">'

            range_slider_html += '<button type="button" class="easychat-bot-widget-cancel-btn" onclick="cancel_multi_range_slider(' + multi_range_slider_count + ')" >'
            + CANCEL_TEXT +
            '</button>'

            range_slider_html += '<button type="button" class="easychat-bot-widget-submit-btn" onclick="append_selected_multi_range_slider_value(' + multi_range_slider_count + ')" style="background:'+ BOT_THEME_COLOR + '">'
            + SUBMIT_TEXT +
            '</button>'
            
            range_slider_html += '</div>\
                </div>\
            </div>'

        $("#easychat-chat-container").append(range_slider_html);
        element_response = document.querySelectorAll(".easychat-bot-range-slider-div")
        element_response_previous_height += element_response[element_response.length - 1].clientHeight

        var multi_range_min_slider = document.getElementById("multi-range-slider-min-val-" + multi_range_slider_count);
        var multi_range_max_slider = document.getElementById("multi-range-slider-max-val-" + multi_range_slider_count);
        document.getElementById("easychat-bot-range-min-selected-value-" + multi_range_slider_count).value = multi_range_min_slider.value;
        document.getElementById("easychat-bot-range-max-selected-value-" + multi_range_slider_count).value = multi_range_max_slider.value;

        setTimeout(function () {
            $("#easychat-bot-multi-range-slider-" + multi_range_slider_count + " .js-range-slider").ionRangeSlider({
                onChange: function (data) {
                    slider_from = data.from;
                    slider_to = data.to;
                    updateValues(multi_range_slider_count);
                }
            });
        }, 100);

        disable_user_input();
        update_input_placeholder_based_on_theme(WIDGETS_PLACEHOLDER_TEXT.split("$$$")[3]);
    }
}

function change_multi_range_min_value() {
    slider_from = +$(this).prop("value");
    var min = $range.data('min');
    var max = $range.data('max')
    if (slider_from < min) {
        slider_from = min;
    }
    if (slider_from > slider_to) {
        slider_from = slider_to;
    }
    updateValues(multi_range_slider_id);
    updateRange();
}

function change_multi_range_max_value() {
    slider_to = +$(this).prop("value");
    var min = $range.data('min');
    var max = $range.data('max')
    if (slider_to > max) {
        slider_to = max;
    }
    if (slider_to < slider_from) {
        slider_to = slider_from;
    }
    updateValues(multi_range_slider_id);
    updateRange();
}

var updateValues = function (multi_range_slider_id) {
    $("#easychat-bot-multi-range-slider-" + multi_range_slider_id + " .from").prop("value", slider_from);
    $("#easychat-bot-multi-range-slider-" + multi_range_slider_id + " .to").prop("value", slider_to);

    document.querySelector("#easychat-bot-multi-range-slider-" + multi_range_slider_id + " .range-slider-error-msg-div").style.display = "none";

    if (document.getElementsByTagName("body")[0].classList.contains("language-right-to-left-wrapper")) {
        var min_value = parseInt(document.getElementById("multi-range-slider-min-max-static-value-" + multi_range_slider_id).children[0].innerText);
        var max_value = parseInt(document.getElementById("multi-range-slider-min-max-static-value-" + multi_range_slider_id).children[1].innerText);
        var span_length = max_value - min_value;

        // Calculate distance of max value from right end
        document.getElementById("easychat-bot-range-max-selected-value-" + multi_range_slider_id).value = Math.round((1 - ((slider_from - min_value) / span_length)) * span_length + min_value);

        // Calculate distance of min value from left end
        document.getElementById("easychat-bot-range-min-selected-value-" + multi_range_slider_id).value = Math.round((1 - ((slider_to - min_value) / span_length)) * span_length + min_value);
    } else {
        document.getElementById("easychat-bot-range-min-selected-value-" + multi_range_slider_id).value = document.getElementById("multi-range-slider-min-val-" + multi_range_slider_id).value;
        document.getElementById("easychat-bot-range-max-selected-value-" + multi_range_slider_id).value = document.getElementById("multi-range-slider-max-val-" + multi_range_slider_id).value;
    }
};

var updateRange = function () {
    slider_range = $range.data("ionRangeSlider");
    range.update({
        slider_from: slider_from,
        slider_to: slider_to
    });
};


function cancel_multi_range_slider(multi_range_slider_id) {
    if (is_widgets) {
        if(EASYCHAT_BOT_THEME  ==  "theme_1") {
            enable_footer_widget_response_theme_1()
            document.getElementById("tooltiptext-send").style.display = "none";
        }
        else if (EASYCHAT_BOT_THEME == "theme_2") {
            enable_footer_widget_response_theme_2()
            document.getElementById("tooltiptext-send").style.display = "none";
        }
        else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
            enable_footer_widget_response_theme3_and_theme4()
        }
        
    }
    document.getElementById("easychat-bot-multi-range-slider-" + multi_range_slider_id).classList.add("easychat-widget-disabled");
    document.getElementById("multi-slider-error-div-" + multi_range_slider_id).style.display = "none";
    reset_multi_range_slider_btn(multi_range_slider_id);
    update_input_placeholder_based_on_theme(get_placeholder_text_based_on_theme());
    enable_user_input();
    empty_user_input_based_on_theme();
}

function append_selected_multi_range_slider_value(multi_range_slider_id) {
    var range_slider_selected_min_value = document.getElementById("easychat-bot-range-min-selected-value-" + multi_range_slider_id).value;
    var range_slider_selected_max_value = document.getElementById("easychat-bot-range-max-selected-value-" + multi_range_slider_id).value;
    edit_user_input_based_on_theme(MIN_TEXT + ': ' + range_slider_selected_min_value + ', ' + MAX_TEXT + ': ' + range_slider_selected_max_value)
    document.getElementById("easychat-bot-multi-range-slider-" + multi_range_slider_id).remove();
    is_widget_data = true;
    send_message();
    enable_user_input();
    is_remove_widget = true;
}

function append_selected_value_into_user_query(element) {
    activate_query_submit_button();
    range_count = element.id.split("-")[3];
    document.getElementById("easychat-range-slider-value-" + range_count).innerHTML = element.value;
    var user_input = "";
    easychat_range_slider_list = document.getElementsByClassName("easychat-range-slider");
    for (var i = 0; i < easychat_range_slider_list.length; i++) {
        range_slider_element = easychat_range_slider_list[i];
        user_input += range_slider_element.placeholder + ": " + range_slider_element.value;
        if (i != easychat_range_slider_list.length - 1) {
            user_input += ", ";
        }
    }
    edit_user_input_based_on_theme(user_input)
    is_remove_widget = true;
    disable_user_input();
}

/* Form Widget function starts */
var answers_filled = {};

function get_form_dropdown_html(id, options) {

    let html =
        '<select id="' + id + '" class="easychat-form-select-input" onchange="update_answers_filled(this)" data-type="dropdown_list" >\
    <option selected></option>';

    options = options.split('$$$');
    for (let j = 0; j < options.length; ++j) {
        let option = options[j].trim();

        html += '<option value="' + option + '">' + option + '</option>';
    }

    html += '</select></div>';

    return html;
}

function get_form_checkbox_html(id, choices) {
    if (choices == '' || choices == null || choices == undefined) return '</div>'
    choices = choices.split('$$$');
    let html = '';
    for (let j = 0; j < choices.length; ++j) {
        let choice = choices[j].trim();

        html += '<label for="easychat-check-box-' + id + '-' + j + '">\
                    <div class="checkbox-item">\
                        <input type="checkbox" class="easychat-check-box cls-'+ id + '" onchange="onFormCheckBoxClick(this)" id="easychat-check-box-' + id + '-' + j + '"  data-type="checkbox" value=\"' + choice + '\">\
                        <span class="checkbox_btn_choices_span" style="height: auto !important;  padding-left: 18px !important; font-size: 14px !important; line-height:17px !important">'+ choice + '</span>\
                    </div>\
                </label>'


        // html += '<div style = "width: inherit; padding: 10px 3px 3px 10px; margin: 5px 0px;">\
        //             <label>\
        //                 <input type="checkbox" class="easychat-check-box ' + id + '" value=\"' + choice + '\" onchange="update_answers_filled(this)" data-type="checkbox">\
        //                 <span style="font-family: \'Silka\', Sans-Serif;"><th style="font-weight:inherit;text-align: left;">' + choice + '</th></span>\
        //             </label>\
        //         </div>';
    }

    html += '</div>'

    return html;
}

function get_form_radio_html(id, choices) {
    if (choices == '' || choices == null || choices == undefined) return '</div>'
    choices = choices.split('$$$');
    let html = '';
    for (let j = 0; j < choices.length; ++j) {
        let choice = choices[j].trim();

        html += '<label for="easychat-radio-' + id + '-' + j + '">\
                    <div class="radio-item-'+ id + '" >\
                        <input type="radio" class="easychat-radio" name="radio_button-'+ id + '" onchange="handleFormRadio(this,\'' + id + '\')" onclick="update_answers_filled(this)" data-type="radio"  id="easychat-radio-' + id + '-' + j + '"  value=\"' + choice + '\">\
                        <span class="radio_btn_choices_span" style="height: auto !important; padding-left: 18px !important; font-size: 14px !important">'+ choice + '</span>\
                    </div>\
                </label>'

        // html += '<div style="width:inherit; padding: 5px 10px 8px 7px">\
        //             <label>\
        //             <input type="radio" name="radio_button-' + id + '" class="easychat-radio" onclick="update_answers_filled(this)" value="' + choice + '" data-type="radio">\
        //             <span style="font-family: "Silka", Sans-Serif;"><th style="font-weight:inherit;text-align: left;">' + choice + '</th></span>\
        //             </label>\
        //         </div>'
    }

    html += '</div>'

    return html;
}

function get_form_range_html(id, range) {
    range = range.split('-');

    let html = '<div class="easychat-range-slider-container">\
                    <div style="width:100%;display:inline-block;">\
                        <p> ' + MIN_TEXT + ': ' + range[0] + ', ' + MAX_TEXT + ': ' + range[1] + '</p>\
                        <p>' + RANGE_TEXT + ': <span id="easychat-range-slider-value-' + id + '"></span></p>\
                        <div class = "range-slider-div">\
                            <input class = "range-slider-input easychat-range-slider" type="range" min="' + range[0] + '" max="' + range[1] + '" value="' + range[1] + '" onchange="update_answers_filled(this)" data-type="range">\
                        </div>\
                    </div>\
                </div>';

    html += '</div>';

    return html;
}

//single range slider form

function get_form_append_single_bot_range_slider(id, range) {
    var range_slider = range.split('-');
    easychat_range_slider_container = document.getElementById("easychat-bot-single-range-slider-" + id);
    if (easychat_range_slider_container != undefined && easychat_range_slider_container != null) {
        easychat_range_slider_container.remove();
    }

    var range_slider_html = '<div class="easychat-bot-range-slider-div" id="easychat-bot-single-range-slider-' + id + '" >\
                                <div class="easychat-bot-range-slider-div-heading">'
        + SELECT_VALUE_TEXT +
        '</div>\
                                <div class="easychat-bot-range-slider-area">\
                                    <input type="range" min="' + range_slider[0] + '" max="' + range_slider[1] + '" value="' + range_slider[1] + '" steps="1" id="easychat-single-range-input-' + id + '" onchange="form_change_single_range_slider_values(\'' + id + '\')" data-type="range">\
                                    <div id="easychat-bot-slider-output-'+ id + '">' + range_slider[1] + '</div>\
                                </div>\
                                <div class="easychat-bot-range-min-max-value-wrapper">\
                                    <div class="easychat-bot-range-min-value-div">\
                                        <input oninput="form_update_single_range_slider(\'' + id + '\')" class="easychat-bot-range-min-inner-value" id="easychat-bot-range-selected-value-'+ id + '" style="color:' + BOT_THEME_COLOR + ';">\
                                        <p>'+ SELECTED_VALUE_TEXT + '</p>\
                                    </div>\
                                </div>\
                            </div>\
                            <div class="range-slider-error-msg-div" id="single-slider-error-div-' + id + '" style="color: #E10E00; font-size:12px; font-weight:400; margin-bottom:8px; display: none; direction: ltr;"></div>\
                            </div>'
    return range_slider_html;
}

function form_range_slider_initializations(id) {
    // element_response = document.querySelectorAll("#easychat-bot-range-slider-div-"+id)
    //    element_response_previous_height += element_response[element_response.length - 1].clientHeight

    var single_range_slider = document.getElementById("easychat-single-range-input-" + id)
    var min = single_range_slider.min
    var max = single_range_slider.max
    var value = single_range_slider.value
    var single_range_output = document.getElementById("easychat-bot-range-selected-value-" + id);
    single_range_output.value = single_range_slider.value;
    var percent_grad = (value - min) / (max - min) * 100
    update_answers_filled(single_range_slider)
    single_range_slider.style.background = 'linear-gradient(94.34deg, ' + BOT_THEME_COLOR + ' 1%, ' + BOT_THEME_COLOR + ' ' + percent_grad + '%, rgba(106, 109, 205, 0.3) ' + percent_grad + '%, rgba(106, 109, 205, 0.3) 100%)'
}

function form_change_single_range_slider_values(id) {
    var single_range_slider = document.getElementById("easychat-single-range-input-" + id)
    var min = single_range_slider.min
    var max = single_range_slider.max
    var value = single_range_slider.value
    var single_range_output = document.getElementById("easychat-bot-range-selected-value-" + id);
    single_range_output.value = single_range_slider.value;
    var percent_grad = (value - min) / (max - min) * 100

    document.querySelector("#single-slider-error-div-" + id).style.display = "none";

    var slider_direction = "right";
    if (document.getElementsByTagName("body")[0].classList.contains("language-right-to-left-wrapper")) {
        slider_direction = "left";
    }

    single_range_slider.style.background = 'linear-gradient(to ' + slider_direction + ', ' + BOT_THEME_COLOR + ' 1%, ' + BOT_THEME_COLOR + ' ' + percent_grad + '%, rgba(106, 109, 205, 0.3) ' + percent_grad + '%, rgba(106, 109, 205, 0.3) 100%)'
    single_range_slider.oninput = function () {

        var slider_direction = "right";
        if (document.getElementsByTagName("body")[0].classList.contains("language-right-to-left-wrapper")) {
            slider_direction = "left";
        }

        var this_percent_grad = (this.value - this.min) / (this.max - this.min) * 100
        this.style.background = 'linear-gradient(to ' + slider_direction + ', ' + BOT_THEME_COLOR + ' 1%, ' + BOT_THEME_COLOR + ' ' + this_percent_grad + '%, rgba(106, 109, 205, 0.3) ' + this_percent_grad + '%, rgba(106, 109, 205, 0.3) 100%)'
        single_range_output.innerHTML = this.value;
    };
    update_answers_filled(single_range_slider)
}

//Multi Range slider form

function get_form_append_multi_bot_range_slider(id, range) {
    var range_slider = range.split('-');
    easychat_range_slider_container = document.getElementById("easychat-bot-multi-range-slider-" + id);
    if (easychat_range_slider_container != undefined && easychat_range_slider_container != null) {
        easychat_range_slider_container.remove();
    }
    var range_slider_html = '<div class="easychat-bot-range-slider-div" id="easychat-bot-multi-range-slider-' + id + '" >\
                <div class="easychat-bot-range-slider-div-heading">'
        + SELECT_VALUE_TEXT +
        '</div>\
                <div class="easychat-bot-range-slider-area" style="margin-bottom: 28px; margin-top:0px;">\
                    <input  type="text" id="js-range-slider-'+ id + '" class="js-range-slider" name="my_range" value="" data-skin="round" data-type="double" data-min="' + range_slider[0] + '" data-max="' + range_slider[1] + '" data-grid="false" />\
                    <div id="multi-range-slider-min-max-static-value-'+ id + '"><div>' + range_slider[0] + '</div><div>' + range_slider[1] + '</div></div>\
                    <input type="text" maxlength="1" value="' + range_slider[0] + '" class="from dual-range-min-value" id="multi-range-slider-min-val-' + id + '" readonly onchange="form_change_multi_range_min_value(\'' + id + '\',this)" style="display: none" data-type="range"/>\
                    <input type="text" maxlength="1" value="' + range_slider[1] + '" class="to dual-range-max-value" id="multi-range-slider-max-val-' + id + '" readonly onchange="form_change_multi_range_max_value(\'' + id + '\',this)" style="display: none" data-type="range"/>\
                </div>\
                <div class="easychat-bot-range-min-max-value-wrapper">\
                    <div class="easychat-bot-range-min-value-div">\
                        <input type="number" oninput="form_update_multi_range_slider(\'' + id + '\')" class="easychat-bot-range-min-inner-value" id="easychat-bot-range-min-selected-value-'+ id + '" style="color:' + BOT_THEME_COLOR + ';">\
                        <p>'+ MIN_TEXT + '</p>\
                    </div>\
                    <svg width="9" height="2" viewBox="0 0 9 2" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <path d="M0 0.905273H9" stroke="#8F8F8F"/>\
                        </svg>\
                    <div class="easychat-bot-range-max-value-div">\
                        <input type="number" oninput="form_update_multi_range_slider(\'' + id + '\')" class="easychat-bot-range-max-inner-value" id="easychat-bot-range-max-selected-value-'+ id + '" style="color:' + BOT_THEME_COLOR + ';">\
                        <p>'+ MAX_TEXT + '</p>\
                    </div>\
                </div>\
            </div>\
            <div class="range-slider-error-msg-div" id="multi-slider-error-div-' + id + '" style="color: #E10E00; font-size:12px; font-weight:400; margin-bottom:8px; display: none; direction: ltr;"></div>\
            </div>'
    return range_slider_html;
    // disable_user_input();
}

function form_multi_range_slider_initializations(id) {
    var multi_range_min_slider = document.getElementById("multi-range-slider-min-val-" + id);
    var multi_range_max_slider = document.getElementById("multi-range-slider-max-val-" + id);
    document.getElementById("easychat-bot-range-min-selected-value-" + id).value = multi_range_min_slider.value;
    document.getElementById("easychat-bot-range-max-selected-value-" + id).value = multi_range_max_slider.value;
    document.getElementById("js-range-slider-" + id).value = multi_range_min_slider.value + ";" + multi_range_max_slider.value
    update_answers_filled(document.getElementById("js-range-slider-" + id))
    setTimeout(function () {
        $("#js-range-slider-" + id).ionRangeSlider({
            onChange: function (data) {
                slider_from = data.from;
                slider_to = data.to;
                updateValuesForm(id);
                update_answers_filled(document.getElementById("js-range-slider-" + id))
            }
        });
    }, 100);
}

var updateValuesForm = function (id) {
    document.getElementById("multi-slider-error-div-" + id).style.display = "none";
    $("#multi-range-slider-min-val-" + id).prop("value", slider_from);
    $("#multi-range-slider-max-val-" + id).prop("value", slider_to);

    if (document.getElementsByTagName("body")[0].classList.contains("language-right-to-left-wrapper")) {
        var min_value = parseInt(document.getElementById("multi-range-slider-min-max-static-value-" + id).children[0].innerText);
        var max_value = parseInt(document.getElementById("multi-range-slider-min-max-static-value-" + id).children[1].innerText);
        var span_length = max_value - min_value;

        // Calculate distance of max value from right end
        document.getElementById("easychat-bot-range-max-selected-value-" + id).value = Math.round((1 - ((slider_from - min_value) / span_length)) * span_length + min_value);

        // Calculate distance of min value from left end
        document.getElementById("easychat-bot-range-min-selected-value-" + id).value = Math.round((1 - ((slider_to - min_value) / span_length)) * span_length + min_value);
    } else {
        document.getElementById("easychat-bot-range-min-selected-value-" + id).value = document.getElementById("multi-range-slider-min-val-" + id).value;
        document.getElementById("easychat-bot-range-max-selected-value-" + id).value = document.getElementById("multi-range-slider-max-val-" + id).value;
    }
};

function form_change_multi_range_min_value(id) {
    slider_from = +$(this).prop("value");
    var min = $range.data('min');
    var max = $range.data('max')
    if (slider_from < min) {
        slider_from = min;
    }
    if (slider_from > slider_to) {
        slider_from = slider_to;
    }
    updateValuesForm(id);
    updateRangeForm();
}

function form_change_multi_range_max_value(id) {
    slider_to = +$(this).prop("value");
    var min = $range.data('min');
    var max = $range.data('max')
    if (slider_to > max) {
        slider_to = max;
    }
    if (slider_to < slider_from) {
        slider_to = slider_from;
    }
    updateValuesForm(id);
    updateRangeForm();
}

var updateRangeForm = function () {
    slider_range = $range.data("ionRangeSlider");
    range.update({
        slider_from: slider_from,
        slider_to: slider_to
    });
};

function get_form_date_picker(form_id, calendar_type) {
    calender_date_widget_value = null;
    var calendar_divs_length = document.getElementsByClassName('easychat-calendar-div').length;
    var div_id = calendar_divs_length + 1
    var list_length = 0
    if (calendar_type.indexOf("Single") != -1) {
        list_length = 1
    } else {
        list_length = 2
    }

    //----------------------------only date picker-----------------
    var datepicker_classname_form = "single-datepicker-div";
        if(list_length == 2){
            datepicker_classname_form = "custom-datepicker-div";

        }
    var html = '<div class="easychat-calendar-div ' + datepicker_classname_form + '" id="form-calendar-div-' + form_id + '" style = "left: 0% !important; margin-bottom: 15px;">'
    for (var i = 0; i < list_length; i++) {
        html +='<div style="width:100%;">'
        var id = form_id + "-" + i
        var label = LABEL_ADD
        var hr_add = false
        var data_type = "single_date"
        var type_picker = "Single date"
        if (list_length == 2) {
            type_picker = "Double date"
            data_type = "double_date"
        }
        if (list_length > 1 && i == 0) {
            label = LABEL_FROM
            hr_add = true
            data_type = "double_date"
            html += '<label style="color: #4d4d4d;font-weight: 400 !important;">' + LABEL_FROM + '</label>'
        } else if (list_length > 1 && i == 1) {
            hr_add = false
            label = LABEL_TO
            data_type = "double_date"
            html += '<label style="color: #4d4d4d;font-weight: 400 !important;">' + LABEL_TO + '</label>'
        }
        html += '<div class="main-wrapping-div">\
                        <div class="easychat-date-btn">\
                            <input type="text" readonly id="datepicker-'+ id + '" data-type="' + data_type + '" onchange="formchangedDate(\'' + id + '\',\'' + type_picker + '\',this)" style="width: 100% !important;" class="date-time-picker-btns easychat-datepicker-btn" value="' + label + ' ' + LABEL_DATE + '">\
                                <div class="date-displayer datepicker" id="date-displayer-'+ id + '" onclick="callModal(\'' + id + '\')" style="margin-top: -39px;">\
                                    <div class="row" style="display: flex; justify-content: center; margin-top: -5px; column-gap:6px;">\
                                        <div class="col s6 date">\
                                            16\
                                        </div>\
                                        <div class="col s6">\
                                            <div class="row month-year" style="margin-bottom: 1px !important;margin-top: 8px !important;">\
                                                May 2021\
                                            </div>\
                                            <div class="row day">\
                                                Thursday\
                                            </div>\
                                        </div>\
                                    </div>\
                                </div>\
                            </input>\
                        </div>\
                    </div></div>'
        if (hr_add) {
            html += '<hr style="width: 85%; background-color: #e7e8ec; margin-top: 12px; margin-bottom: 8px "/>'
        }
    }

    html += '</div>'

    return html;
}

function form_date_picker_initializations(id, type_picker) {
    var list_length = 0
    if (type_picker.indexOf("Single") != -1) {
        list_length = 1
    } else {
        list_length = 2
    }
    if (list_length > 0) {
        if (list_length == 1) {
            $("#datepicker-" + id + "-0").datepicker({ autoclose: true })
        }
        else if (list_length == 2) {
            $("#datepicker-" + id + "-0").datepicker({ autoclose: true });
            $("#datepicker-" + id + "-1").datepicker({ autoclose: true });
        }
    }
}

function formchangedDate(i, type, element) {
    if (document.querySelector("#datepicker-" + i).value !== (LABEL_ADD + " " + LABEL_DATE) && document.querySelector("#datepicker-" + i).value !== (LABEL_FROM + " " + LABEL_DATE) && document.querySelector("#datepicker-" + i).value !== (LABEL_TO + " " + LABEL_DATE)) {

        var dayArr = language_days_list;
        var monthArr = language_months_list;
        var date = new Date(document.querySelector("#datepicker-" + i).value);
        var datenum = date.getDate();
        var month = date.getMonth();
        var year = date.getFullYear();
        var day = date.getDay();
        if (day == 0)
            day = 7
        document.querySelector("#date-displayer-" + i + " .date").innerHTML = datenum;
        document.querySelector("#date-displayer-" + i + " .month-year").innerHTML = monthArr[month] + " " + year;
        document.querySelector("#date-displayer-" + i + " .day").innerHTML = dayArr[day - 1];
        document.getElementById("datepicker-" + i).style.opacity = "0";
        document.getElementById("date-displayer-" + i).style.visibility = "visible";
        update_answers_filled(document.getElementById("datepicker-" + i))

    }
}
//------------------form phone number widget
function get_form_phone_number_widget(id, country_code, placeholder_or_options, phone_number) {
    if (country_code == '' || country_code == null || country_code == undefined) return '</div>'
    var phone_number_html = '<div class="easychat-country-code-submit-btn-wrapper form-widget" style="margin-top: 8px">\
    <div class="easychat-country-code-dropdown-wrapper" style="width: 100%;">'
    if (phone_number == '' || phone_number == null || phone_number == undefined)
        phone_number_html += '<input  data-type="phone_number_field" id="country_phone_number_' + id + '" placeholder="' + placeholder_or_options + '">'
    else
        phone_number_html += '<input  data-type="phone_number_field" value="' + phone_number + '" id="country_phone_number_' + id + '"  placeholder="' + placeholder_or_options + '">'

    phone_number_html += '<div class="country-code-error-message-div" id="country-code-error-message-div-' + id + '">\
        The Phone number is not valid\
            </div>\
            </div>\
        </div>\
        </div>'

    return phone_number_html
}

function form_field_phone_changed(element) {
    update_answers_filled(element.get(0))
}
//------------------form time picker

function get_form_time_picker(form_id, calendar_type) {
    calender_time_widget_value = null;
    var calendar_divs_length = document.getElementsByClassName('easychat-calendar-div').length;
    var div_id = calendar_divs_length + 1
    var list_length = 0
    if (calendar_type.indexOf("Single") != -1) {
        list_length = 1
    } else {
        list_length = 2
    }

    //----------------------------only date picker-----------------
    var html = '<div class="easychat-calendar-div" id="calendar-div-' + div_id + '" style = "margin-bottom: 8px; left: 0% !important; margin-bottom: 15px;">'
    for (var i = 0; i < list_length; i++) {
        html +='<div style="width:100%; display:flex; flex-direction:column; row-gap:4px;">'
        var id = form_id + "-" + i
        var label = LABEL_ADD
        var hr_add = false
        var data_type = "single_time"
        var type_picker = "Single time"
        if (list_length == 2) {
            type_picker = "Double time"
            data_type = "double_time"
        }
        if (list_length > 1 && i == 0) {
            label = LABEL_FROM
            hr_add = true
            data_type = "double_time"
            html += '<label style="color: #4d4d4d;">' + LABEL_FROM + '</label>'
        } else if (list_length > 1 && i == 1) {
            hr_add = false
            label = LABEL_TO
            data_type = "double_time"
            html += '<label style="color: #4d4d4d;">' + LABEL_TO + '</label>'
        }
        currently_time_picker_type = type_picker
        html += '\
                <div class="main-wrapping-div">\
                    <div class="easychat-time-btn">\
                        <input type="button" id="time-picker-btn-'+ id + '" data-type="' + data_type + '" class="date-time-picker-btns easychat-timepicker-btn" value="' + label + ' ' + LABEL_TIME + '" onclick="formhandleTimePickerClick(\'' + id + '\')" style="width: 100% !important;"></input>\
                    </div>\
                </div></div>'
        if (hr_add) {
            html += '<hr style="width: 85%; background-color: #e7e8ec; margin-top: 12px; margin-bottom: 8px "/>'
        }
    }
    html += '</div>'
    return html;
}

function formhandleTimePickerClick(id) {

    document.querySelector(".timepicker-container").style.display = "flex";

    timepicker_in_form = true
    currently_opened_time_modal_id = id
    unCheckAll()
    handle_save_button()
}

function form_time_picker_initializations() {

    if (document.getElementsByClassName('easychat-time-btn').length > 0) {
        const input = document.querySelector('.easychat-timepicker-btn');

        const descriptor = Object.getOwnPropertyDescriptor(Object.getPrototypeOf(input), 'value');
        Object.defineProperty(input, 'value', {
            set: function (t) {
                console.log('Input value was changed programmatically');
                return descriptor.set.apply(this, arguments);
            },
            get: function () {
                return descriptor.get.apply(this);
            }
        });
    }
}

function get_form_file_attach_html(id, file_type) {
    file_type = file_type_ext[file_type];
    let html = '<div class="easychat-dragdropContainer__XPS form-widget" style="left: 0% !important;">\
                    <div class="easychat-attachment-dragdrop-wrapper"><span class="easychat-dragdropMsg__XPS" style="color:' + BOT_THEME_COLOR + ';height:80%;flex-direction: column;">\
                    <svg width="48" height="48" viewBox="0 0 78 78" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\
                    <rect width="78" height="78" fill="url(#pattern0)"/>\
                    <defs>\
                    <pattern id="pattern0" patternContentUnits="objectBoundingBox" width="1" height="1">\
                    <use xlink:href="#image0" transform="scale(0.00195312)"/>\
                    </pattern>\
                    <image id="image0" width="512" height="512" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAACAASURBVHic7d1rkFxnfefx39Onu6fnKll32VZsXWxJlrls4uDFgC3J9tpJ1oQFQgi7IUC2sikW2M0LMMtShMAmRZZsKLLspWIo2HJIsWQrgMOaYCyNjcFeiEmBQdaMJFsGgdHV1mVGM9N9+jz74misizWjnpnT5znPeb6fqi4blzX9p7vdz3fO1QiltP+wXWVN+xVJYjcaYzZK9lpJKyX1n3ksdjshyiqxkqyUSLJWShIpPvNoJ1IrkVrt9O8vpmJsksjERpqSNUcT2UkjHZP0nGSOGdljidWhSsUcUDv5sWztmW1bzMEc/y8CpWBcD4Bs7N1rezTYvrNS0e2ydpuMrnM9EzCbdiJNxWcfzViy8/9xk5KekbTLGP3QJuZHkY2fOLS55+k3GdPOaGSgVAgAz+0/2PynSVR5qxL7mzJa4noeYL4SK0220sfp1sxbCObotJG+Z6XHJPNoqxo9dscGcziTnwx4jgDwkLXW7D/avsvKfkBWN7qeB8iclSZiabwpnZ5a0JaBFzNmnxINS/q6aUQ7tq01x7P88YAvCADPPH0kfq219j9JeonrWYA8JFY63ZTGptJdBRmLJX1H0tcTJV+5bVPPE5k/A1BQBIAnRo/aK6pJ/AlJv+F6FsCVqVg6MSlNNLv1DPYZydxnjP5m67XVbxtjMt34ABQJAVBw1lrz9JHWeyTzJ5L6XM8DFMFULJ2YkCZaXXwSY/ZJ9t4oqn72lg3mQBefCXCCACiwp56zixTH94jf+oGLaral50+nBw52USLpG1bmM1NRdN+vXmOmuvpsQE4IgILaf7j58sToy7LmKtezAEU31pSOn87szIHZHJXRX1bb1U/dfJ35edefDegiAqCA9h5pba1YfVnSItezAL5IrHR8QhqbzPisgYtrGukrSuyfb7uu/v+6/3RA9giAgtl3KP4Xxti/ltRwPQvgo6lYOjqWXnkwD0YatlZ/tH1z7eF8nhHIBgFQIE8diX9N1n5ZUtX1LIDPrJWOjqenD+bo2zL6w+0baztyfVZgngiAgth/sHljUjE7lF6nH0AGTk1Jz4/nskvgXDsTqw/etrn2WL5PC8wNAVAATx+Z3GiT6FEu5Qtkr9WWDp/Kb5fAGdZa+79la++/9Trz41yfGegQAeDY/v22kfTHj0l6uetZgLJqJ9LhsfSGQzlrSvqf7Vr1Q7evNydyf3ZgFhXXA4Su3d/+r2LxB7oqqkgrB6VGLfenrkt6T9SKR4ZH4zfn/uzALNgC4NDTh+M3Wtm/cT0HEApHBwe+wEhfk43fuW1z7zNuJgDOIgAcGTliB2s23i3pCtezACGxSg8MPOXuen7jMvrQ0Wurn3yTMW1nUyB47AJwpGbjj4jFH8idkbSkXxqoOxuhX1b/Zdlo/OjDT05e42wKBI8tAA7s/fnUlkpU+b443x9wx6YHBnb1hkKXdtrIfmDbpvonnU6BIBEADjx1qPl5GfMW13MAobNWOnjKydkB5zFWX1Kl+nvbNpqjbidBSAiAnO05NLkuMtGo+O0fKIS2lQ6elGL3e+N/ahL7G9xbAHnhGICcVVW9Wyz+QGFERloxIFXc/zp0pa2YR4ZHWne7HgRhcP+RD8jBg7Z/vBIflDTgehYA5xubko6Nu55imv3r1lTt9+54mSnMRCgftgDkaMy03yAWf6CQBnqkfndnBlzAvKXWE3/74X12jetJUF4EQI5Mxf626xkAzGxJv1SLXE/xgpe14/g7wyPNG1wPgnIiAHJy4IRdIqttrucAMLOKkZYNqEg7R1dbmeEdu+O7XA+C8iEActKcbG+VVJzfLQBcVD2ShnpcT3GeAWPsl4ZHm//W9SAoFwIgJ9bw2z/gi0W9UrViXY9xrsha86kdI62PuR4E5UEA5MQYSwAAnqgY6bK+4uwHmGaku3eOtP7UWlu84eAdAiAHu6yty2qj6zkAdK6vLvXmf/vgTrzvodH2f/+wtXx/Y0H4AOWg/lxzg7j4D+CdJX0q0gGBL7Cyv3/zaPseIgALwYcnB5U42uR6BgBzV42k/mJuBZBk3/GaPe3PEAGYLz44OTCy61zPAGB+FvUWciOAJMlY+zYiAPPFhyYHidFi1zMAmJ9alB4PUFREAOaLD0wODJf/Bbw21Ot6gtkRAZgPPiy5MIOuJwAwf/WosGcEvMBY+7abR9ufJgLQKT4oebBJwX9/AHApgw3XE3TCvp0tAegUHxIA6EBvNb1AUNGxOwCd4gMCAJ0wRbpd8OyIAHSCDwcAdKjfi90AKSIAl8IHAwA61BOlpwX6ggjAbPhQAMAcFPmaABfD2QGYCR8IAJiDhpd39eDsALwYHwYAmIOeWnEvDTwbdgfgQnwQAGAOjNII8BERgHPxIQCAOfJzN0CKCMA0H7dk5W541C6zNt5orNlgK0m/sWbQGi2ytrOAWj2ku3qquq7bcwLIx1QsHTzpeoqFscZ87pFro9/9sDGJ61ngBgFwgfv32p4eG9+otrYbo62Srpe0dCE/c1m/1N+TyXgACsBa6cDx9K8+IwLCRgBIevxxWzvR375Txr7VSL8mKdNr9xMAQPk8e0JqtV1PsXBEQLiCDoAHRuzlNcV/YKXfkbS8W89DAADlc3RcGp9yPUVWzGe/uTH610RAWIIMgIdHJta2Vbtbsm+T1PWlmQAAyuf4hHRiwvUU2WFLQHiCCoBHD9jeibH4bmP0fuWw8E8jAIDyGZ9KtwKUCREQlmBOAxneHf/zyfHWk8boD5Xj4g+gnCKP7gnQKS4bHJbSv8n377U9O0dan7TG3ieZqx2PA6AkqqXdfsplg0NR6jd4eNfkhkY7flTSexTY7g4A3VUp8TcKFwsKQ2nf3AdHm79so+gxSb/oehYA5VOpqNS/VhAB5VfKN3Z4T+u2ijU7JC1zPQuA8irlF+g5iIByK92bunN3/Hqb6H5Jg65nAQDfEQHlVao3dHh3a6uM/bwkT+/VBcAnpsS7AM5FBJRTad7MB0emXmqNviSp4XoWAGEIZP2XxCmCZVSKN/Lvd9klFZn7JC12PQsAlBenCJaJ92+itdbUo/izkrnK9SwAUHbsDigP79/A4dH4vZJe63oOAAgFEVAOXr95Dz85eY2kj7ieAwBCQwT4z+s3rl2J/kJc1x8AnCAC/ObtmzY8Gr9Z0p2u5wCAkBEB/vLyDfuitZGVPup6DgAApwj6yss3a/lo+7dk7QbXcwAAptm3EwF+8e6NstYaK3u36zkAABciAnzi3Zv00Gh8h6TrXc8BALgYIsAX3r1B1ti3up4BADAbIsAHXr059++1Q7Lm113PAQC4FCKg6Lx6Y3rj1usl9bmeAwDQCSKgyLx6UxLpDtczAADmgggoKm/eEGutMcZsdT0HAGCuiIAi8ubNGH6yeZ2kVa7nAADMBxFQNN68EaZqXul6BgDAQhABReLNm5DIbHI9AwBgoYiAovDpDdjoegAAQBaIgCLw5sU3Vte6ngEAkBUiwDWfXngOAASAUiECXPLiRbfWGkn9rucAAGSNCHDFixf8gSfUJylyPQcAoBuIABe8eLGjigZczwAA6CYiIG9evNBJjd/+AaD8iIA88SIDAAqECMgLLzAAoGCIgDzw4gIACogI6DZeWABAQREB3cSLCgAoMCKgW3hBAQAFRwR0Ay8mAMADREDWeCEBAJ4gArLEiwgA8AgRkBVeQACAZ4iALPDiAQA8ZN9+82j7HiJg/njhAGCejHE9QejsO9gSMH+8aAAwT3yBFgG7A+aLFwwA5oktAEVBBMwHLxYAzFOFb9AC4ZiAueKFAoB5qvINWjAcEzAXvEgAME/1yPUEeLF0S4C1lh00l0AAAMA8VQmAgrLvGB5tf8r1FEVHAADAPNUiSfyeWVD2nTtHWn/qeooiIwAAYJ4qRurhW7TI3rdjpPVB10MUFR9dAFiARt31BJiNkT66Y3fz3a7nKCICAAAWoFFzPQEuxRjziZ0j8Wtdz1E0BAAALEAjkiK+SYsukuwXdu5p3uh6kCLhYwsAC2GkPnYD+KBXifnSjiftVa4HKQoCAAAWaIAA8MVqVeK/G95lB1wPUgQEAAAsUL2aPlB8RnpJUmnd43qOIiAAACADixquJ0CnjDFv3jHS/Peu53CNAACADPTVz1wYCF4wMh/fsad1s+s5XCIAACAji3tdT4A5qJpEX3jwh3al60FcIQAAICN9da4L4JnVlVr8v0K9cRABAAAZWtLH7QE8c8fO0dbvux7CBQIAADJUi6QhdgV4xcj82c6RyY2u58gbAQAAGVvckHo4LdAnfVL0V48/boPagUMAAEDWjLR8IL1bILxxw8n++L2uh8gTAQAAXRBVpGUD4oAAnxh9cHjX5AbXY+SFAACALumtScs4KNAnvTaK7gnlrAACAAC6qL9HWtznegrMwdaHRtpvdT1EHggAAOiyoYZ0GRHgDWvsnz3yhL3M9RzdRgAAQA6GGtJSjgnwxbK4Hn/I9RDdRgAAQE4G6tKKAanCN2/hWemdD+6evNb1HN3ExxAActRbk1YPcp0AD9QrJvq46yG6iQAAgJxVI2nl4JlbCLNLoMheu2Oktd31EN1CAACAA8akZwesHmJrQJEZ6T+X9bRAAgAAHKpH0qohaWm/VOUbuYh+aXhP+1dcD9ENfNwAoAAGeqTLF6dXD6xFrqfBeaz9SBm3AhAAAFAQRlJ/XVq9SFo5lF5EyJRu2fHSLw3vbf+q6yGyRgAAQMEYSY2qtKxfuvLMVoGBBlsGnEps6a4LQAAAQIFVTLpVYGmfdPmiNAiWD6RXFhzoSUOhHqXHD1Qq4qyC7nnFjj2tm10PkSWOPQUAj0QVqa/ueor5sZKsldqJlJz5a9yW4iR9NNvpPyusRH8g6Zuux8gKAQAAyIVRekxDZZZdGYmVpuJzHq00HIrASK/dsXdy/a3XNJ5yPUsW2AUAACiMikmvlri4N71Y0pol6V8HG+nWD+fjJdV/53qIrLh/OQEAmIGR1KhJS/qkKxZLKwbTeypUXB3rYO3bvzViBx09e6YIAACAF4zSrQNLB86eHdHIf0f2QMu0fjP3Z+0CAgAA4B1z5uyIlUPplRR78zww0pp35PhsXUMAAAC81lNNb7O8elG6e6Dbewes9MoH905d1+Wn6ToCAABQCvUo3T2welF63EA3maTi/VYAAgAAUCq1M7dbXtbfvTMHjNW//KK1Xl+bkQAAAJRSf0969cShhrqxX2DV8pH4NZn/1BwRAACA0qqY9LLJqwelasa/r1uZN2b7E/NFAAAASq9elS4/c4fFzBj7Bp93AxAAAIAgGJMeF7BsILMLCa1aujd+VSY/yQECAAAQlOnrB1QzWAFNW69b+E9xgwAAAASnHqUXEKov/EqCd2QwjhMEAAAgSFFFWjWYXl543oyu+8Yu+wuZDZUjAgAAECxjpOUDUt8CLiVcjVq3ZzdRfggAAEDQjEkPDBxozO/PJzJ3ZjtRPvK/jxJQIhMt6ecnpWNj0qkpabIlWddDoZCqlfQ69Yv70gPQlvalCw+KwSi95bBNpPHmnP/sNmutMcZ49Z8/AQDMkbXSgePS6CHp0Kn0fwOdOCxJx9K/76tL65dJm1Z2/7r16IxReppgYtO4n4OlD+1pbpQ00pXBuoQAAObg0Cnpu89IxydcTwLfnW5KP3xWevKgtGW1dP3lUsQWAffOHBNw8JTUjDv/Y9aam+RZAHAMANABa6V//In0wG4Wf2SrnUhP/Ez6vz+STvDZKgRjpBVzvHSwVeWV3ZuoOwgA4BLiRNq5R9p10PUkKLMTE9L9T0rPnnA9CaR0a8yKOVwx0Fh7U3cnyh4BAMwiSaSH9/KljHzEbWl4b3pgKdyrRemNhDpitPn+vXaoqwNljAAAZvHYfhZ/5CtJpG/uk8amXE8CSRroSc/e6ICpx/GWLo+TKQIAmMHTx9IHkLdmLD3yFGeYFMWS/nRrwKVUZF/S/WmyQwAAFzEVS4//2PUUCNnRMWnPEddTQDp7oSBd6niASuX6PObJCgEAXMTug2kEAC498bP0IFS4V4+kRT2z/zvGWgIA8FnbSqOHXU8BpFeW3H/U9RSYtqg3vYHQTKzEMQCAz376/NwuAAJ001MEQGEYc8mzAlZ8a8QO5jTOghEAwAV+etz1BMBZR8fZHVUk/fXZbx/cbDe9uTUwAQBc4PAp1xMAZ1nLZ7JoLuub5XjAWnR1jqMsCAEAnKM9jzuBAd12ctL1BDhXLZL6Zjgg0Njk6lyHWQACADjHRItzr1E8RGnxLGrMsBXAmqvznWT+CADgHJxyhSJqtV1PgAvVIqn3IlcItNauyH+a+SEAAKDguEtwMS3qvdg/NUvznmO+CADgHFX+i0ABzeW2tMhPPZIaF54RUBEBAPior56e6wsUycAlrkAHdwYveG+sJQAAL1UMX7YonqGG6wkwk95a+r0xzYgAALy10pvreCEExkgrBlxPgZkY86JTAr15twgA4AJXLnY9AXDWikGpXnU9BWYzcP7ZAHVrrRc7EgkA4AJXLJJ6+MJFQazzZoNyuHqq5x9A/LV9usgJgsVDAAAXqFSkzStdTwGk+5fXLnM9BTrRd/6S78WRRAQAcBGbVs1+ww8gDy+/Uoq82JiMc08HXGa0yN0knSMAgIuoRdIvX+V6CoRs5aC0nt/+vdFTPXsKca3hx5kABAAwg6uWSNd4c1FPlElPVXr1eq5J4ZOKkXrOXLDJGD8u3kgAALO48SrpCs4KQI6qFWn7tS/apwwP9Hi225AAAGZhjLT1mnRrANBt9ap060ZpmTdnkuNcDc/OHvJsXCB/FSO9Zr20uFd64lluF4zuWNov3byBK1H6rKfm142bCACgA8ZIL70ivUjQd5+Rjoy7nghlUYukl14ubV7FPn/fGfl14yYCAJiDJf3SnVukZ09Iew5LPz3OFgHMz1AjPcr/2hVc6a9MagQAUG6XL0ofzVg6dEo6Oi6dnJCm2lKr7Xo6FE3FpLeOHeiRFvdJqwZnupc8fEcAAIGoV6U1l6UPAIg8OrTeo1EBACg2n7YAEAAAAGTEp0s3EwAAAGSkQgAAABCeyEg1Ky/ODSIAAADIipGm2mq6HqMTBAAAABnqqRAAAAAEpxERAAAABKdWU+x6hk4QAAAABIgAAAAgQAQAAAABIgAAAAgQAQAAQIAIAAAAAkQAAAAQIAIAAIAAEQAAAASIAAAAIEAEAAAAASIAAAAIEAEAAECACAAAAAJEAAAAEKCq6wEA+C9JpGOnpaNj0qlJaTKWmrEUVaR6JA00pMW90opBqbfmeloAEgEAYAEOnpT2HZUOPC/F7c7+zNIBae0SacNyqRZ1dz4AMyMAAMzZwZPS9w5Iz43P/c8eG0sfP/iZtGmVdP1qqcrOSCB3BACAjrXa0neekfYfy+Zn/fBn0tNHpZvWSquGFv4zAXSO7gbQkeMT0ld/lM3if67xKenB0TQGAOSHLQAALunImLRzT3pgXzdYK33/Z9J4S7rxKsmY7jwPgLPYAgBgVkfG0t/Qu7X4n2vvYelbT6dBAKC7CAAAM5pe/Ds9wj8LzxwjAoA8EAAALsrF4j+NCAC6jwAA8CIuF/9pRADQXQQAgPMUYfGfRgQA3UMAAHhBkRb/aUQA0B0EAABJxVz8pxEBQPYIAACFXvynEQFAtggAIHA+LP7TiAAgOwQAEDCfFv9pRACQDQIACJSPi/80IgBYOAIACJDPi/80IgBYGAIACEwZFv9pRAAwfwQAEJAyLf7TiABgfggAIBBlXPynEQHA3BEAQADKvPhPIwKAuSEAgJILYfGfRgQAnSMAgBILafGfRgQAnSEAgJIKcfGfRgQAl0YAACUU8uI/jQgAZkcAACXD4n8WEQDMjAAASoTF/8WIAODiCACgJFj8Z0YEAC9GAAAlwOJ/aUQAcD4CAPAci3/niADgLAIA8BiL/9wRAUCKAAA8xeI/f0QAQAAAXmLxXzgiAKEjAADPsPhnhwhAyAgAwCMs/tkjAhAqAgDwBIt/9xABCBEBAHiAxb/7iACEhgAACo7FPz9EAEJCAAAFxuKfPyIAoSAAgIJi8XeHCEAICACggFj83SMCUHYEAFAwLP7FQQSgzAgAoEBY/IuHCEBZEQBAQbD4FxcRgDIiAIACYPEvPiIAZUMAAI6x+PuDCECZEACAQyz+/iECUBYEAOAIi7+/iACUAQEAOMDi7z8iAL4jAICcsfiXBxEAnxEAQI5Y/MuHCICvCAAgJyz+5UUEwEcEAJADFv/yIwLgGwIA6DIW/3AQAfAJAQB0EYt/eIgA+IIAALqExT9cRAB8QAAAXcDiDyIARUcAABlj8cc0IgBFRgAAGWLxx4WIABQVAQBk5PiEtIPFHxfxzDHp8Z+4ngI4HwEAZKBtpYf2Si0Wf8xg5JD0k+ddTwGcRQAAGdhzSDo16XoKFN33fsKuABQHAQBkYO8R1xPAB2NT0sFTrqcAUgQAsEBTsXRiwvUU8MWhk64nAFIEALBA41OuJ4BP+LygKAgAAMiTcT0AkCIAgAUa6HE9AXzSz+cFBUEAAAtUr0qLel1PAV+sGHA9AZAiAIAMrF/megL4oK9HWj3kegogRQAAGdi4Quqru54CRfdPrpAMxwCgIAgAIAPVSHr1OqnCf1GYwdVLpXVsKUKB8HUFZGTlkHTLhjQGgHNdvVR61VrXUwDnIwCADF25WLrreukXLmNTL9IzRF61Xnr1erYOoXiqrgcAymagR7rlGul0M73s66lJqZ109zmfPy09e6K7z1EGPVVpw/LuP09fTVo6IC3rJwRRXAQA0CV9dWnd0nyea98RAqATjZr0i2tcTwEUAxulAAAIEAEAAECACAAAAAJEAAAAECACAACAABEAAAAEiAAAACBABAAAAAEiAAAACBABAABAgAgAAAACRAAAABAgAgAAgAARAAAABIgAAAAgQAQAAAABIgAAAAgQAQAAQIAIAAAAAkQAAAAQIAIAAIAAEQAAAASIAAAAIEAEAAAAASIAAAAIEAEAAECACAAAAAJEAAAAECACAACAABEAAAAEiAAAACBABAAAAAEiAAAACBABAABAgAgAAAACRAAAABAgAgAAgAARAAAABIgAAAAgQAQAAAABIgAAAAgQAQAAQIAIAAAAAkQAAAAQIAIAAIAAEQAAAASIAAAAIEAEAAAAASIAAAAIEAEAAECACAAAAAJEAAAAECACAACAABEAAAAEiAAAACBABAAAAAEiAAAACBABAABAgAgAAAACRAAAABAgAgAAgAARAAAABIgAAAAgQAQAAAABIgAAAAgQAQAAQIAIAAAAAkQAAAAQIAIAAIAAEQAAAASIAAAAIEAEAAAAASIAAAAIEAEAAECACAAAAAJEAAAAECACAACAABEAAAAEiAAAACBABAAAAAEiAAAACBABAABAgAgAAAACRAAAABAgAgAAgAARAAAABIgAAAAgQAQAAAABIgAAAAgQAQAAQIAIAAAAAkQAAAAQIAIAAIAAEQAAAASIAAAAIEAEAAAAASIAAAAIEAEAAECACAAAAAJEAAAAECACAACAABEAAAAEiAAAACBABAAAAAEiAAAACBABAABAgAgAAAACRAAAJVAxrifwA68TcBYBAJRAo+Z6Aj80qq4nAIqDAABKYKjhegI/DPW6ngAoDgIAKIGBHmkxi9slrbnM9QRAcRAAQElsWe16gmJb0ietGnQ9BVAcBABQEmuXSiuHXE9RTBUj3bhWMhwECLyAAABKwhhp6wZ2BVzIGOmmtdKyfteTAMVCAAAlUq9Kv3JdujUA0kDd6vaN0tplricBioeTYoCSqUbSq9dLm1dK+45Kz56QxpuSta4ny0dPNd3ff9USaf1yw7n/wAwIAKCklg6kD0myklqx03FyEUVSxIIPdIQAAAJglO4eAIBpHAMAAECACAAAAAJEAAAAECACAACAABEAAAAEiAAAACBABAAAAAEiAAAACBABAABAgAgAAAACRAAAABAgAgAAgAARAAAABIgAAAAgQAQAAAABIgAAAAgQAQAAQIAIAAAAAkQAAAAQIAIAAIAAEQAAAASIAAAAIEAEAAAAASIA8mBcDwAAyEucqO16hk4QADlIrOsJAAB5qTV10vUMnSAAckAAAEAw4jVrzITrITpBAOTAEgAAEIox1wN0igDIQZsAAIBQHHQ9QKcIgBy0vDgcBACwYEYjrkfoFAGQg5gAAIAwWI26HqFTBEAO2gkHAgJAGCwBgPNNxa4nAAB0mzHJo65n6BQBkJPJlusJAADdZKVn1y1vsAUA55tkCwAAlJuxO1yPMBcEQE5acXosAACgnIwqX3c9w1wQADmxksabrqcAAHTJ+KSNvuJ6iLkgAHJEAABAOVlj/3bLCuPNVQAlAiBXzZiLAgFAGVUSc6/rGeaKAMjZyUnXEwAAMmW0a+2KqlcHAEoEQO7GmlLMwYAAUBrWmo8aY7z7ZicA8malU2wFAICSMPvWL4/+j+sp5oMAcODUJPcHAIAysFbvNcZ4+Y1OADhgJT132vUUAICFsNLXN6ysftn1HPNFADgy0eK0QADw2JQx7fe4HmIhCACHnj/N1QEBwEvGvn/98sYe12MsBAHgUDuRjo6nuwQAAN746rpltU+6HmKhCADHJlvSyQnXUwAAOmMPNJvVtxljvP/djQAogBMTHA8AAB44Yazu2nylOeZ6kCwQAAVgJR0bTw8MBAAU0qSR7lq3sv4D14NkhQAoCGulo2PSVOx6EgDAeaya1prfWrei9ojrUbJEABRIYqXDp9LjAgAAhTBujXmdz+f7z4QAKJjESofHpNMcEwAAThnpWGJ1+4YV1a+5nqUbCIACslY6MnbmaoHeH2cKAF56PLbtV1yzsvaY60G6hQAosFOT0qFTXCwIAHJkjfQXk8urr7p2ZeNp18N0U9X1AJjdZCw9e0Ja0if197ieBgBKba+xete6lbUHXA+SB7YAeCCx6RUDD56Uml7ecwoABUSl6AAABSJJREFUCm1CVn9UGa++NJTFX2ILgFemYunnJ6WBmjTUK9Ui1xMBgNcmjMynkyj6+Ial5oDrYfJGAPjGSmPN9MqBvXVpqCH18C4CwFwckvQ5Y6ufWLfSHHI9jCssHZ6ySk8VPN2UqpX0+ID+OlsFAGAGY7L2PpnK53+yPHpgmzHBX3aNACiBOEnvJ3BiQqpG6RaB3ppUj6RaRZJxPSEA5O6IjJ6w0sNKtPPAiup3WPTPRwCUTNxOH+NTZ/6BSSOgFkmVSnrUpzFShSgAUFDVSE/21fR3nfy7Vmob6aSsPWFUGTM22Vftre1Zs8g81+05fUcAlJ2VWu30AQBeMPYH2zfW3+96jLLjNEAAAAJEAAAAECACAACAABEAAAAEiAAAACBABAAAAAEiAAAACBABAABAgLwIgEYi63oGAADKxIsAaPdqwvUMAICc2Mpp1yOEwIsA0DMacz0CACAfRvaU6xlC4EUAbNtmYkmTrucAAHSftTrpeoYQeBEAZxx3PQAAIAcVnXA9Qgh8CoCnXA8AAMiBNftcjxACjwLAjLqeAACQh5jv+xx4FACWDwQAlF88NNbztOshQuBPAFj9wPUIAICue/KGG0zL9RAh8CYAxserj0hqup4DANA9RtrpeoZQeBMAd91gTkv6rus5AADdk1hDAOTEmwCQJFnKEABKLE7q0TddDxEKvwIgSb7oegQAQHcY6Ru3rzdcAyAnXgXA9i09uyR93/UcAIDsJdbc63qGkHgVAJIkIz4gAFA+Y3Ezus/1ECHxLgCqleq9krhTFACUirn3jpeZcddThMS7ALj5GnNE0qddzwEAyEwrUuvjrocIjXcBIEkmqn5cXBMAAErC/NUtm3r3u54iNF4GwLZrzE8l8xnXcwAAFqyZ2PhjrocIkZcBIEnNdvRBSUdczwEAmD9j9ee3bW7scT1HiLwNgDu3mOeMsR9wPQcAYL7sASXVP3Y9Rai8DQBJ2npt7TNGesT1HACA+ai8a9sWM+Z6ilB5HQDGGKuo+hZJR13PAgDonDHmU9s3VTnv3yGvA0A6c0CgMb8jybqeBQDQkSd6+qL3uR4idN4HgCRt31i930p/4noOAMAlHbFR+/U3rTETrgcJnXE9QFastWZ4tH2PZH/X9SwAgIs6nVjddtvm2mOuB0FJtgBI6fEARzdG/0ZGf+t6FgDAi7SM9AYW/+IoTQBI0puMaTf6qv9KEgeWAEBxTEjmjds21f7e9SA4q1QBIEk3rTETRzdWXy9j/tL1LAAAHU+M7uCI/+IpzTEAF7LWmof2xB+yVh9SCUMHAArPmH2K26/bvqVnl+tR8GKlDYBpD460tlWkz0ta7XoWAAiFsfqSGtV3bFtrjrueBRdX+gCQpG8+aVfHlfhzkv6Z61kAoOTGrOz7bt1U/x+uB8HsggiAaTt2x3cZk/w3yaxxPQsAlI01+qra1Xfdep35setZcGlBBYAk3b/XDjXa8X+U9E5JA67nAYAS+Edr9R9u3Vx7wPUg6FxwATDtwd12qVH8bmP0bklLXM8DAB561Frzse2boq8aY7gcu2eCDYBp3xqxgy3beoM15rclbRVnDADAbI7ImC8kSu69bWP9H1wPg/kLPgDO9fA+uyZutX69IrPdGt0itgwAgLXSjyTtlDFfX3QqevCGG0zL9VBYOAJgBh+2trJtX+tl7aTyEslulNVGSVdL5jLJDio9fqDX7ZQAkInnJY1LGpN0SNbsMbKjNjIjrUr0D3dsMIcdz4cu+P/SjihghBhptgAAAABJRU5ErkJggg=="/>\
                    </defs>\
                </svg>\
                    <p class="attachment-click-here-text-div" style="width:90%; margin-bottom:0px;">' + FILE_ATTACHEMENT_TEXT + ' <br><span style="position:relative; top:2px;">' + file_type + '</span></p><p id = "max-file-size-allowed-message"style="color:#E10E00;font-size:12px;padding-left: 10px; padding-right: 10px;">*' + FILE_SIZE_LIMIT_TEXT + ' ' + max_file_size_allowed + ' MB</p></span>\
                    <div class="easychat-dragdrop__XPS" style="margin:0px;"><input id="s32" onchange="check_selected_file(this, \'' + id + '\')" type="file" accept="' + file_type + '"></div></div>\
                    <div class="easychat-dragdropafterSelect__XPS" style="display:none;"><span>'+ FILE_ICON_SVG_FORM + '</span>\
                        <span class="easychat-form-widget-file-alert">Error Message</span>\
                        <div style="width:auto;float:left;display:none;"><img src="' + EASYCHAT_IMG_PATH + 'preloader.svg" style="height:3em;"></div>\
                    </div>\
                    <div class="form-uploaded-file" style="display: none;">\
                    ' + FILE_ICON_SVG_FORM + '\
                    <p id="file-name-'+ id + '"></p>\
                    </div>\
                </div>\
                <div class="file-upload-err" style="color: red; display: none;"></div>\
                </div>';

    return html;
}

function check_selected_file(el, id) {
    if (el.files[0] != undefined || el.files[0] != null) {
        var file_ext = el.files[0].name.split(".");
        file_ext = el.files[0].name.split(".")[file_ext.length - 1];

        var error_div = document.querySelector("#parent-" + id + " .file-upload-err");
        error_div.style.display = "none";

        if (el.getAttribute("accept").toString().indexOf(file_ext.toLowerCase()) !== -1) {
            if (el.files[0].size <= (max_file_size_allowed) * 1024 * 1024) {                
                upload_form_attachment(id);
            } else {
                // alert("Please Select file < " + max_file_size_allowed + "MB*")
                el.value = "";
                error_div.innerText = "Please Select file < " + max_file_size_allowed + "MB*";
                error_div.style.display = "block";
                scroll_to_bottom()
            }
        } else {
            // alert('Please select correct file type');
            el.value = "";
            error_div.innerText = "Please select correct file type";
            error_div.style.display = "block";
                
        }
    } else {
        // alert('No file selected')
        el.value = "";
        error_div.innerText = "No file selected";
        error_div.style.display = "block";
    }
}

function remove_file_from_form_attachment(el) {
    el.parentElement.parentElement.previousElementSibling.lastElementChild.firstElementChild.value = "";

    el.parentElement.nextElementSibling.style.display = "none";

    el.parentElement.style.display = "none";
    el.parentElement.parentElement.previousElementSibling.firstElementChild.style.display = "flex";
    el.parentElement.parentElement.previousElementSibling.style.display = "block";

    el.parentElement.parentElement.style.cssText += "background-color: unset; padding: 0; box-shadow: unset; border-radius: unset; display: none";
    el.parentElement.innerHTML = "";
}

function upload_form_attachment(id) {
    var attachment_data = document.querySelector("#parent-" + id + " input").files[0];

    var reader = new FileReader();
    reader.readAsDataURL(attachment_data);
    reader.onload = function () {

        base64_str = reader.result.split(",")[1];

        uploaded_file = [];
        uploaded_file.push({
            "filename": attachment_data.name,
            "base64_file": base64_str,
            "user_id": user_id,
        });

        upload_form_attachment_to_server(uploaded_file, id);
    };

    reader.onerror = function (error) {
        console.log('Error: ', error);
    };

}

function upload_form_attachment_to_server(uploaded_file, id) {
    var json_string = JSON.stringify(uploaded_file)
    json_string = encrypt_variable(json_string)

    encrypted_data = {
        "Request": json_string
    }

    var params = JSON.stringify(encrypted_data);

    var xhttp = new XMLHttpRequest();
    xhttp.open("POST", "/chat/upload-attachment/", true);
    xhttp.setRequestHeader('Content-Type', 'application/json');
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            response = this.response
            response = JSON.parse(response)
            response = custom_decrypt(response)
            response = JSON.parse(response);

            if (response.status == 200) {
                attached_file_src = response.src;
                attached_file_name = response.name;
                answers_filled["parent-" + id].value = attached_file_src
                attached_file_src = "";

                var show_file_name = attached_file_name;
                if (show_file_name.length > 20) {
                    var split_file_name = attached_file_name.split(".");
                    show_file_name = split_file_name.slice(0, split_file_name.length - 1).join(".").slice(0, 17 - split_file_name[split_file_name.length - 1].length) + "..." + split_file_name[split_file_name.length - 1];
                }

                document.querySelector("#parent-" + id + " .easychat-dragdropafterSelect__XPS").style.backgroundColor = BOT_THEME_COLOR;
                document.querySelector("#parent-" + id + " .easychat-dragdropafterSelect__XPS").style.cssText += "padding: 1em; box-shadow: 1px 1px 6px rgba(0, 0, 0, 0.2); border-radius: 1em;";
                document.querySelector("#parent-" + id + " .easychat-form-widget-file-alert").style.cssText += "display: flex; font-size: unset; color: black;";
                document.querySelector("#parent-" + id + " .easychat-form-widget-file-alert").innerHTML = '<span>' + show_file_name + '</span>' + ' <div onclick="form_reset_file_attach(\'' + "parent-" + id + '\')" class="easychat-dragdropAlertMsgClose__XPS" style="color: ' + BOT_THEME_COLOR + ';">' + get_cross_button_svg_form() + '</div>'
                document.querySelector("#parent-" + id + " .easychat-dragdropafterSelect__XPS").style.display = "flex";
                document.querySelector("#parent-" + id + " .easychat-dragdropafterSelect__XPS").style.alignItems = "center";
                document.querySelector("#parent-" + id + " .easychat-dragdropMsg__XPS").style.display = "none"
                document.querySelector("#parent-" + id + " .easychat-attachment-dragdrop-wrapper").style.display = "none"
            } else {
                // alert("Malicious File not accepted");
                document.querySelector("parent-" + id + " input").value = "";
                document.querySelector("#parent-" + id + " .file-upload-err").innerText = "Malicious File not accepted";
                document.querySelector("#parent-" + id + " .file-upload-err").style.display = "block";
            }
        }
    }
    xhttp.send(params);
}

function append_create_form_modal(form_name, form_fields_list) {
    disable_sticky_div();
    form_fields_list = JSON.parse(form_fields_list);
    current_form_list = form_fields_list
    widget_form_name = form_name;
    form_fields = form_fields_list;
    $(".easychat-form-container:not(.easychat-widget-disabled)").remove()
    form_fields_length = form_fields_list.length;
    var forms_count = document.getElementsByClassName("easychat-form-container").length;
    if (form_fields_list.length > 0) {
        let html = '\
                    <div class="easychat-form-container" id="easychat-form-container-' + forms_count + '">\
                        <h5>' + form_name + '</h5>\
                        <hr style="\
                            margin-bottom: 10px;\
                            margin-left: -18px;\
                            margin-right: -17px;\
                            background-color: #f0f1f5 !important;\
                        ">';

        var dropdown_ids = []
        for (let i = 0; i < form_fields_list.length; ++i) {
            let id = "input-" + forms_count + "_" + i;
            if (form_fields_list[i].field_id_num) {
                id = "input-" + forms_count + "_" + form_fields_list[i].field_id_num;
            }
            let parent_id = 'parent-' + id;
            if (form_fields_list[i].optional == "true") {
                html += '\
                        <div class="input-field-custom" id="parent-' + id + '">\
                            <label for="' + id + '">' + form_fields_list[i].label_name + '</label>\
                        ';
            } else {
                html += '\
                <div class="input-field-custom" id="parent-' + id + '">\
                    <label for="' + id + '">' + form_fields_list[i].label_name + '<span style="color: red;"> *</span></label>\
                ';
            }
            answers_filled[parent_id] = { type: form_fields_list[i].input_type, validator: form_fields_list[i].validator, optional: form_fields_list[i].optional };

            if (form_fields_list[i].input_type == "text_field") {
                var input_type = "text";
                var pattern = "";
                if (["6digitotp_validator", "4digitotp_validator"].includes(form_fields_list[i].validator)) {
                    input_type = "number";
                    pattern = 'pattern="\\d*"';
                }
                html += '<input type="' + input_type + '" ' + pattern + '  id="' + id + '" class="easychat-form-input" placeholder="' + form_fields_list[i].placeholder_or_options + '" autocomplete="off" onkeyup="update_answers_filled(this)" data-type="text_field">\
                                </div>\
                ';
            } else if (form_fields_list[i].input_type == "dropdown_list") {
                dropdown_ids.push(id);
                html += get_form_dropdown_html(id, form_fields_list[i].placeholder_or_options);

            } else if (form_fields_list[i].input_type == "checkbox") {
                html += get_form_checkbox_html(id, form_fields_list[i].placeholder_or_options);

            } else if (form_fields_list[i].input_type == "radio") {
                html += get_form_radio_html(id, form_fields_list[i].placeholder_or_options);

            } else if (form_fields_list[i].input_type == "range") {
                if (form_fields_list[i].range_type.toString().indexOf("Single") != -1)
                    html += get_form_append_single_bot_range_slider(id, form_fields_list[i].placeholder_or_options);
                else {
                    html += get_form_append_multi_bot_range_slider(id, form_fields_list[i].placeholder_or_options);
                }

            } else if (form_fields_list[i].input_type == "file_attach") {
                html += get_form_file_attach_html(id, form_fields_list[i].placeholder_or_options);
            } else if (form_fields_list[i].input_type == "date_picker") {
                html += get_form_date_picker(id, form_fields_list[i].calendar_type);
                html += "</div>";
            }
            else if (form_fields_list[i].input_type == "time_picker") {
                html += get_form_time_picker(id, form_fields_list[i].calendar_type);
                html += "</div>";
            } else if (form_fields_list[i].input_type == "phone_number") {
                if (form_fields_list[i].phone_widget_data != undefined) {
                    html += get_form_phone_number_widget(id, form_fields_list[i].phone_widget_data[0], form_fields_list[i].placeholder_or_options, form_fields_list[i].phone_widget_data[1])
                }
                else {
                    html += get_form_phone_number_widget(id, form_fields_list[i].country_code, form_fields_list[i].placeholder_or_options)
                }
            }
        }
        html += '<div class="easychat-form-error-div-wrapper" style="display:none; padding:0px 12px">';
        html += '<p class="easychat-form-error" style="color:red; margin-bottom:0px; margin-top:8px;"></p>';
        html += "</div>";
        html += '<div class="easychat-form-submit-cancel-btn-wrapper" style = "height: 5em; margin-bottom: 10px; margin-top: -16px;"><input class="livechat-modal-submit-btn" style="background-color:' + BOT_THEME_COLOR + ' ; float: right; padding: 0px;"onclick="submit_form_confirmation(' + forms_count + ')" type="submit" value="' + SUBMIT_TEXT + '">'
        html += '<input type = "button" value = "' + CANCEL_TEXT + '" class = "easychat-customer-modal-cancel-btn" onclick="cancel_and_reset_form_submission(' + forms_count + ')" style = "float: right;"></div>';

        html += '</div>';

        $("#easychat-chat-container").append(html)

        for (let i = 0; i < form_fields_list.length; ++i) {
            let id = "input-" + forms_count + "_" + form_fields_list[i].field_id_num;
            if (form_fields_list[i].dependent_field_ids != '') {
                if (form_fields_list[i].input_type == 'dropdown_list') {
                    $('#' + id).on("change", function () {
                        let selected_option = $('#' + id).val()
                        update_dependent_fields(form_fields_list, i, selected_option, forms_count)
                    });
                } else if (form_fields_list[i].input_type == 'radio') {
                    let radio_options = form_fields_list[i].placeholder_or_options
                    if (radio_options != '' || radio_options != null) {
                        radio_options = radio_options.split('$$$')

                        for (let j = 0; j < radio_options.length; j++) {
                            $('#easychat-radio-' + id + '-' + j).on("change", function () {
                                update_dependent_fields(form_fields_list, i, radio_options[j], forms_count);
                            });
                        }
                    }
                } else if (form_fields_list[i].input_type == 'checkbox') {
                    let checkboxes = document.querySelectorAll('.' + id)

                    checkboxes.forEach(function (checkbox) {
                        checkbox.addEventListener('change', function () {
                            let checked_checkboxes = []
                            for (let j = 0; j < checkboxes.length; j++) {
                                if (checkboxes[j].checked) {
                                    checked_checkboxes.push(checkboxes[j].value)
                                }
                            }
                            checked_checkboxes = checked_checkboxes.join('$$$');
                            update_dependent_fields(form_fields_list, i, checked_checkboxes, forms_count);
                        });
                    });
                } else if (form_fields_list[i].input_type == 'text_field') {
                    $('#' + id).focusout(function () {
                        update_dependent_fields(form_fields_list, i, $('#' + id).val(), forms_count)
                    })
                } else if (form_fields_list[i].input_type == 'range') {
                    if (form_fields_list[i].range_type.includes('Single')) {
                        $('#easychat-single-range-input-' + id).on("change", function () {
                            setTimeout(function () {
                                update_dependent_fields(form_fields_list, i, $('#easychat-single-range-input-' + id).val(), forms_count)
                            }, 100)
                        })
                    } else {
                        $('#js-range-slider-' + id).on("change", function () {
                            setTimeout(function () {
                                let range_min_value = $('#easychat-bot-range-min-selected-value-' + id).val()
                                let range_max_value = $('#easychat-bot-range-max-selected-value-' + id).val()
                                let range_values = range_min_value + '$$$' + range_max_value
                                update_dependent_fields(form_fields_list, i, range_values, forms_count)
                            }, 100)
                        })
                    }
                } else if (form_fields_list[i].input_type == 'phone_number') {
                    var phone_widget_id = "country_phone_number_" + id
                    $('#' + phone_widget_id).focusout(function () {
                        var phone_number_final = "+" + $('#' + phone_widget_id).intlTelInput("getSelectedCountryData").dialCode + " " + $('#' + phone_widget_id).val()

                        update_dependent_fields(form_fields_list, i, phone_number_final, forms_count)
                    })
                }
            }
            if (form_fields_list[i].input_type == "range") {
                if (form_fields_list[i].range_type.indexOf("Single") != -1) {
                    form_range_slider_initializations(id)
                } else {
                    form_multi_range_slider_initializations(id)
                }
            }
            else if (form_fields_list[i].input_type == "date_picker") {
                form_date_picker_initializations(id, form_fields_list[i].calendar_type)
            } else if (form_fields_list[i].input_type == "text_field") {
                if (form_fields_list[i].text_field_value) {
                    $('#' + id).val(form_fields_list[i].text_field_value).trigger('keyup');
                    $('#' + id).trigger("focusout");
                }
            } else if (form_fields_list[i].input_type == "phone_number") {
                if (form_fields_list[i].phone_widget_data != undefined) {
                    initialize_phone_number_selector_form("country_phone_number_" + id, form_fields_list[i].phone_widget_data[0], "country-code-error-message-div-" + id, forms_count + "_" + form_fields_list[i].field_id_num, form_fields_list[i].phone_widget_data[1], form_fields_list[i].country_code)
                } else {
                    initialize_phone_number_selector_form("country_phone_number_" + id, form_fields_list[i].country_code, "country-code-error-message-div-" + id, forms_count + "_" + form_fields_list[i].field_id_num)
                }
            }
        }

        // if (form_fields_list[i].input_type == "time_picker") {
        //     alert("asd")
        //     form_time_picker_initializations()
        // }

        setTimeout(function () {
            for (let i = 0; i < dropdown_ids.length; ++i) {
                $('#' + dropdown_ids[i]).select2({
                    width: "100%",
                    placeholder: DROPDOWN_TEXT,
                    allowClear: true,
                    dropdownParent: $('#easychat-form-container-' + forms_count),
                });
                if (EASYCHAT_BOT_THEME == "theme_1" || EASYCHAT_BOT_THEME == "theme_2") {
                    $('#' + dropdown_ids[i]).on("select2:open", function(event) {
                        $('input.select2-search__field').attr('placeholder', SEARCH_TEXT);
                        const evt = "scroll.select2";
                        $(event.target).parents().off(evt);
                        $(window).off(evt);
                    });
                }
               else {
                    $('#' + dropdown_ids[i]).on("select2:open", function(event) {
                        $('input.select2-search__field').attr('placeholder', SEARCH_TEXT);               
                    });
                }
            }

        }, 200)

    }

    update_input_placeholder_based_on_theme(WIDGETS_PLACEHOLDER_TEXT.split("$$$")[6]);

}

function update_answers_filled(el, file_src) {
    let parent_id = el.parentElement.id;

    if (!parent_id) parent_id = el.parentElement.parentElement.parentElement.id;
    if (!parent_id) parent_id = el.parentElement.parentElement.parentElement.parentElement.id;

    let id = parent_id.split('-')[2];
    let single_answer_type = ['text_field', 'dropdown_list', 'radio', 'range', 'file_attach', 'double', 'single_date', 'double_date', 'single_time', 'double_time', 'phone_number_field'];


    if (single_answer_type.toString().indexOf(el.dataset.type) != -1) {

        if (el.dataset.type == 'file_attach') {
            answers_filled[parent_id]['value'] = file_src;

        } else {
            if (el.dataset.type == "double") {
                var value = el.value.split(';')
                el.value = value[0] + ' - ' + value[1]
            }

            if (el.dataset.type == "single_date") {
                parent_id = el.parentElement.parentElement.parentElement.parentElement.parentElement.id;
                answers_filled[parent_id]['value'] = LABEL_DATE + ": " + render_date_in_alpha(el.value);

            } else if (el.dataset.type == "double_date") {
                var div_id = el.id.split("-")[2]
                var from_date = $("#datepicker-input-" + div_id + "-0").val()
                var to_date = $("#datepicker-input-" + div_id + "-1").val()
                from_date = render_date_in_alpha(from_date)
                to_date = render_date_in_alpha(to_date);
                if (from_date == null || from_date + "" == "undefined")
                    from_date = ""
                if (to_date == null || to_date + "" == "undefined")
                    to_date = ""
                parent_id = el.parentElement.parentElement.parentElement.parentElement.parentElement.id;
                answers_filled[parent_id]['value'] = LABEL_FROM + " " + LABEL_DATE + ": " + from_date + ", " + LABEL_TO + " " + LABEL_DATE + ": " + to_date

            } else if (el.dataset.type == "single_time") {
                parent_id = el.parentElement.parentElement.parentElement.parentElement.parentElement.id;

                answers_filled[parent_id]['value'] = LABEL_TIME + ": " + convertTime12to24(el.value);

            } else if (el.dataset.type == "double_time") {

                var div_id = el.id.split("-")[4]
                var from_time = $("#time-picker-btn-input-" + div_id + "-0").val()
                var to_time = $("#time-picker-btn-input-" + div_id + "-1").val()
                from_time = convertTime12to24(from_time)
                to_time = convertTime12to24(to_time)

                if (from_time == null || (from_time + "").indexOf("undefined") != -1)
                    from_time = ""

                if (to_time == null || (to_time + "").indexOf("undefined") != -1)
                    to_time = ""
                parent_id = el.parentElement.parentElement.parentElement.parentElement.parentElement.id;
                answers_filled[parent_id]['value'] = LABEL_FROM + " " + LABEL_TIME + ": " + from_time + ", " + LABEL_TO + " " + LABEL_TIME + ": " + to_time;
            }
            else {
                if (el.dataset.type == "phone_number_field") {
                    answers_filled[parent_id]['value'] = "+" + $("#" + el.id).intlTelInput("getSelectedCountryData").dialCode + " " + el.value
                }
                else {
                    answers_filled[parent_id]['value'] = el.value;
                }
            }
            // if (el.dataset.type == 'range') {
            //     el.parentElement.previousElementSibling.lastElementChild.innerHTML = el.value;
            // }
        }
    } else {
        if (el.checked) {
            if (!answers_filled[parent_id]['value']) {
                answers_filled[parent_id]['value'] = [];
            }
            answers_filled[parent_id]['value'].push(el.value);
        } else {
            let choices = answers_filled[parent_id]['value'];
            for (let i = 0; i < choices.length; ++i) {
                if (choices[i] == el.value) choices.splice(i, i + 1);
            }
        }
    }
}

function remove_form_from_container() {
    current_form_list = ""
    $(".easychat-form-container:not(.easychat-widget-disabled)").remove()
    enable_user_input();
    enable_sticky_div();
    if (is_widgets) {
        if(EASYCHAT_BOT_THEME=="theme_1"){
            enable_footer_widget_response_theme_1()
            $("#tooltiptext-send").css('display', 'none');
        }
        else if (EASYCHAT_BOT_THEME=="theme_2"){
            enable_footer_widget_response_theme_2()
            $("#tooltiptext-send").css('display', 'none');
        }
        else if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
            enable_footer_widget_response_theme3_and_theme4()
        }
        
    }
}

function submit_form_confirmation(form_id) {

    var error_elem = document.querySelector("#easychat-form-container-" + form_id + "  .easychat-form-error-div-wrapper");
    error_elem.style.display = "none";
    var error_text = ""
    for (id in answers_filled) {
        let value = answers_filled[id]['value'];
        if (value == undefined) { }
        else {
            if (answers_filled[id]['type'] == 'text_field') {
                if (answers_filled[id]['validator'] == '6digitotp_validator') {
                    let isnum = /^\d+$/.test(value);
                    if (!isnum || value.length != 6) {
                        error_text = OTP_SIX_DIGIT_ERROR_TEXT
                    }
                } else if (answers_filled[id]['validator'] == '4digitotp_validator') {
                    let isnum = /^\d+$/.test(value);
                    if (!isnum || value.length != 4) {
                        error_text = OTP_FOUR_DIGIT_ERROR_TEXT
                    }
                }
                else if (answers_filled[id]['validator'] == 'email_validator') {
                    if (validate_email(value) == false) {
                        error_text = EMAIL_ERROR_TEXT
                    }
                }
                else if (answers_filled[id]['validator'] == 'pan_validator') {
                    var regex = /[A-Z]{5}[0-9]{4}[A-Z]{1}$/;
                    if (!regex.test(value)) {
                        error_text = PAN_ERROR_TEXT
                    }
                }
                else if (answers_filled[id]['validator'] == 'name_validator') {

                    if (validate_name(value) == false) {
                        error_text = NAME_ERROR_TEXT
                    }
                }
                else if (answers_filled[id]['validator'] == 'mobile_validator') {
                    if (!validate_phone_number(value)) {
                        error_text = MOBILE_ERROR_TEXT;
                    }
                }
            }

            if (answers_filled[id]['type'] == 'phone_number') {
                var phone_widget_id = "country_phone_number_input-" + id.split("-")[2]
                if (!$("#" + phone_widget_id).intlTelInput("isValidNumber")) {
                    var validation_err = $("#" + phone_widget_id).intlTelInput("getValidationError")
                    if (phone_widget_error_map[validation_err] == undefined) {
                        validation_err = 0
                    }
                    error_text = phone_widget_error_map[validation_err]
                } else {
                    if ($("#" + phone_widget_id).intlTelInput("getSelectedCountryData").dialCode == "91") {
                        if (!validate_phone_number($("#" + phone_widget_id).val())) {
                            error_text = phone_widget_error_map[0]
                        }

                    }
                }
            }

            if (answers_filled[id].type == "range") {
                if (document.querySelector("#" + id + " .range-slider-error-msg-div")) {
                    if (document.querySelector("#" + id + " .range-slider-error-msg-div").style.display == "block") {
                        error_text = RANGE_SLIDER_ERROR_MESSAGES.split("$$$")[0];
                    }
                }
            }

            if (value.toString().length == 0 && answers_filled[id]['optional'] == "true") {
                error_text = ""
            }
            if (error_text != "") {
                error_elem.style.display = "block";
                error_elem.firstChild.innerHTML = error_text;
                return;
            }
        }
        if ((value == undefined || value == null || value == '' || (Array.isArray(value) && value.length == 0))) {
            if (answers_filled[id]['optional'] != "true") {
                alert(FILL_FORM_TEXT);
                return;
            }
        }
    }
    document.getElementById('form-submit-confirmation-text').innerHTML = SUBMIT_FORM_TEXT;
    document.getElementById('form-submit-confirmation-yes').setAttribute("onclick", "submit_form_widget(" + form_id + ")");
    document.getElementById('form-submit-confirmation-yes').value = YES;
    document.getElementById('form-submit-confirmation-no').value = NO;
    document.getElementById('submit-form-confirmation-modal').style.display = 'flex';
}

function cancel_form_submission() {
    document.getElementById('submit-form-confirmation-modal').style.display = 'none';
}

function submit_form_widget(form_id) {
    var html;
    let form_data = {};
    is_widget_data = true;

    form_data_misdashboard, form_data = get_theme_four_submitted_form_html(form_id)

    remove_form_from_container();
    document.getElementById('submit-form-confirmation-modal').style.display = 'none';

    var json_string = JSON.stringify({
        user_id: user_id,
        form_name: widget_form_name,
        form_data: form_data,
        bot_id: bot_id
    });

    json_string = encrypt_variable(json_string);
    json_string = encodeURIComponent(json_string);

    var xhttp = new XMLHttpRequest();
    var params = 'json_string=' + json_string
    xhttp.open("POST", '/chat/save-form-data/', true);

    xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            entered_suggestion = false;
            response = JSON.parse(this.responseText);
            response = custom_decrypt(response)
            response = JSON.parse(response);

            if (response.status == 200) {
                console.log('Form data saved!');
                form_data = {}
                form_data_misdashboard = ""
            }
        }
    }
    xhttp.send(params);
    send_message_to_server("", user_id, bot_id, bot_name, "");
    change_is_flow_ended_variable = false
    timepicker_in_form = false


    enable_user_input();
    scroll_to_bottom();
}

/* Form Widget function ends */

function show_bot_typing_loader() {

    var element = document.getElementById("div-bottyping-loader")
    if (element == null || element == undefined) {
        if (EASYCHAT_BOT_THEME == "theme_1") {
            $("#easychat-chat-container").append('<div class="spinner" id="div-bottyping-loader" style="display: block;">\
                                                                                <div class="bounce1"></div>\
                                                                                <div class="bounce2"></div>\
                                                                                <div class="bounce3"></div>\
                                                                            </div>')
        } else if (EASYCHAT_BOT_THEME == "theme_2" || EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {

            $("#easychat-chat-container").append('<div class="typing-indicator" id="div-bottyping-loader">' + TYPING_TEXT + '<span></span>\
                                                                                <span></span><span></span>\
                                                                            </div>')
        }
        else {
            $("#easychat-chat-container").append('<div style="width:100%;float:left;display:inline-block;" id="div-bottyping-loader"><img src="' + EASYCHAT_IMG_PATH + 'preloader.svg" style="height:3em;"></div>');
        }
        scroll_to_bottom()
    }
}

function show_start_bot_loader() {
    if (EASYCHAT_BOT_THEME == "theme_1") {
        $("#easychat-chat-container").append('<div class="spinner" id="div-bot-start-loader" style="display: block;">\
                                                                            <div class="bounce1"></div>\
                                                                            <div class="bounce2"></div>\
                                                                            <div class="bounce3"></div>\
                                                                        </div>')
    } else {
        $("#easychat-chat-container").append('<div style="width:100%;float:left;padding-left:28%;padding-top:46%" id="div-bot-start-loader"><img src="' + EASYCHAT_IMG_PATH + 'preloader.svg" style="height:12em;"></div>');
    }
}

function hide_start_bot_loader() {
    document.getElementById("div-bot-start-loader").remove();
}

function increase_brightness(hex, percent) {
    // strip the leading # if it's there
    hex = hex.replace(/^\s*#|\s*$/g, '');

    if (hex.length == 3) {
        hex = hex.replace(/(.)/g, '$1$1');
    }

    var r = parseInt(hex.substr(0, 2), 16),
        g = parseInt(hex.substr(2, 2), 16),
        b = parseInt(hex.substr(4, 2), 16);

    return '#' +
        ((0 | (1 << 8) + r + (256 - r) * percent / 100).toString(16)).substr(1) +
        ((0 | (1 << 8) + g + (256 - g) * percent / 100).toString(16)).substr(1) +
        ((0 | (1 << 8) + b + (256 - b) * percent / 100).toString(16)).substr(1);
}

function disable_intent_level_feedback() {
    try {
        var thumbs_down_queryselector = document.querySelectorAll("#thumbs-down");
        for (i = 0; i < thumbs_down_queryselector.length; i++) {
            thumbs_down_queryselector[i].style.display = "none"
        }
    } catch (err) { }
    try {
        var thumbs_up_queryselector = document.querySelectorAll("#thumbs-up");
        for (i = 0; i < thumbs_up_queryselector.length; i++) {
            thumbs_up_queryselector[i].style.display = "none"
        }
    } catch (err) { }
}

function disable_intent_level_feedback_theme_three_and_four() {

    try {
        var thumbs_down_queryselector = document.querySelectorAll("#easychat-feedback-thumbs-down");
        for (i = 0; i < thumbs_down_queryselector.length; i++) {
            thumbs_down_queryselector[i].style.display = "none"
        }
    } catch (err) { }

    try {
        var thumbs_up_queryselector = document.querySelectorAll("#easychat-feedback-thumbs-up");
        for (i = 0; i < thumbs_up_queryselector.length; i++) {
            thumbs_up_queryselector[i].style.display = "none"
        }
    } catch (err) { }
}

function disable_intent_level_feedback_based_on_themes() {

    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        disable_intent_level_feedback_theme_three_and_four();
    } else {
        disable_intent_level_feedback();
    }

}


function update_bot_languge_if_needed(response) {
    is_bot_language_change_confirmed = false
    if ("is_bot_language_change_confirmed" in response["response"]) {

        is_bot_language_change_confirmed = response["response"]["is_bot_language_change_confirmed"]

        if (is_bot_language_change_confirmed) {

            selected_language = response["response"]["language_src"]
            parent.postMessage({
                event_id: 'set_local_storage',
                data: {
                    var_value: selected_language,
                }
            }, "*")

            url_parameters = get_url_vars();
            bot_id = url_parameters["id"];
            update_language_in_url_without_reload(selected_language)
            update_bot_language_details_without_refresh(selected_language, bot_id)

            update_chatbot_form_assist_text(bot_id, selected_language)

        }
    }
    return is_bot_language_change_confirmed

}

function update_is_bot_auto_detected_language(response) {
    if ("is_auto_detected_language_response" in response) {
        is_bot_auto_language_detected = response["is_auto_detected_language_response"]

        if ("detected_language" in response) {
            detected_language = response["detected_language"]
        }
    }
}

function set_easychat_user_id_cookie(user_id) {

    document.cookie = "easychat_user_id" + "=" + user_id + ";path = / ; SameSite=None; Secure ";

}

function set_easychat_prev_session_id_cookie(session_id) {

    document.cookie = "easychat_prev_session_id" + "=" + session_id + ";path = / ; SameSite=None; Secure "
    var url_parameters = get_url_vars();
    var channel_name = url_parameters["channel"];
    if(channel_name == 'iOS') {
        try {       
            webkit.messageHandlers.setChatbotSessionID.postMessage({"mobile_session_id": session_id});
        } catch(err) {}
    }
}

function remove_special_characters_from_str(text) {
    const regex = /:|;|'|"|=|-|\$|\*|%|!|`|~|&|\^|\(|\)|\[|\]|\{|\}|\[|\]|#|<|>|\/|\\/g;
    text = text.replace(regex, "");
    return text;
}

function get_video_recorder_preview_html(video_src) {
    return '<div class="video-recorder-preview-wrapper-div">\
        <video style="width:85%;height: 100%;" controls="">\
            <source src="' + video_src + '" type="video/mp4">\
        </video>\
    </div>';
}

function send_message_to_server(message, userid, bot_id, bot_name, channel_params, path, thumbnail_url, preview_attachment_path, is_faq_intent=false) {
    if ($('#bot_action_btn_items').css('display') != "none" ) {
        $('#bot_action_opner_btn').click();
    }
    if(!is_bot_started){
        clear_userData();
        save_time_spent();
        is_bot_started = true
    }
    is_bot_response_message_showed = false
    if (bot_response_delay_allowed) {
        reset_bot_response_delay_timer();
    }
    if (path === undefined) {
        path = ""
    }
    if (thumbnail_url == undefined) {
        thumbnail_url = "";
    }
    window.clearTimeout(bot_inactivity_timer);

    url_parameters = get_url_vars();
    selected_language = url_parameters["selected_language"]

    if (is_livechat) {
        send_message_in_socket(message, livechat_session_id, "Customer", path, thumbnail_url, preview_attachment_path, selected_language);
        return;
    }

    session_id = get_easychat_prev_session_id_from_cookies()

    user_id = get_easychat_user_id();

    document.getElementById("easychat-chat-container").click();
    if ((global_file_name[0] == "" || global_file_name[0] == undefined) && !is_faq_intent)
        show_bot_typing_loader();
    disable_user_input();

    var channel_name = url_parameters["channel"]
    if (channel_name == undefined || channel_name == null)
        channel_name = "Web"

    var category_name = null
    if (check_and_lower_string(channel_name) == "android" || check_and_lower_string(channel_name) == "ios") {

        category_name = url_parameters["category_name"]
        if (category_name == undefined || category_name == null || category_name == "")
        category_name = null
    }

    data = {
        "session_id": session_id,
        "window_location": decodeURIComponent(window_location),
        "is_form_assist": form_assist_enabled,
        "attached_file_src": attached_file_src,
        "file_extension": file_extension,
        "is_save_attachment_required": is_save_attachment_required,
        "widget_user_selected_list": widget_user_selected_list,
        "is_sticky_message": is_sticky_message,
        "is_video_recorder_allowed": is_video_recorder_allowed,
        "entered_suggestion": entered_suggestion,
        "is_campaign_link": is_campaign_link,
        "form_data_misdashboard": form_data_misdashboard,
        "client_city": client_location_city,
        "client_state": client_location_state,
        "client_pincode": client_location_pincode,
        "web_page_source": decodeURIComponent(url_parameters["web_page_source"]),
        "is_first_query": is_first_query,
        "is_manually_typed_query": is_manually_typed_query,
        "bot_web_page": decodeURIComponent(url_parameters["easychat_window_location"]),
        "is_widget_data": is_widget_data,
        "is_initial_intent": is_initial_intent,
    }

    if (category_name != null && category_name != undefined && category_name != "") {
        data["category_name"] = category_name
    }
    
    if (embed_cookies != "" && embed_cookies != null && embed_cookies != undefined) {
        embed_cookies_decrypted = custom_decrypt(embed_cookies)
        embed_cookies_decrypted = JSON.parse(embed_cookies_decrypted)
        try {
            data = Object.assign({}, data, embed_cookies_decrypted);
        } catch (err) {
            for (key in embed_cookies_decrypted) {
                data[key] = embed_cookies_decrypted[key];
            }
        }
    }
    if (embed_meta_data != "" && embed_meta_data != null && embed_meta_data != undefined) {
        embed_meta_data_decrypted = custom_decrypt(embed_meta_data)
        embed_meta_data_decrypted = JSON.parse(embed_meta_data_decrypted)
        try {
            data = Object.assign({}, data, embed_meta_data_decrypted);
        } catch (err) {
            for (key in embed_meta_data_decrypted) {
                data[key] = embed_meta_data_decrypted[key];
            }
        }
    }

    disable_intent_level_feedback_based_on_themes();

    channel_params = JSON.stringify(data);

    if (selected_language == undefined || selected_language == null) {
        selected_language = "en"
    }

    var json_string = JSON.stringify({
        query_token_id: query_token_id,
        message: message,
        user_id: userid,
        channel: channel_name,
        channel_params: channel_params,
        bot_id: bot_id,
        bot_name: bot_name,
        bot_display_name: bot_name,
        selected_language: selected_language,
    });
    json_string = encrypt_variable(json_string);
    json_string = encodeURIComponent(json_string);

    var xhttp = new XMLHttpRequest();
    var params = 'json_string=' + json_string
    xhttp.open("POST", EASYCHAT_QUERY_URL, true);

    xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    current_request_xhttp = xhttp
    if (global_file_name[0] != "" && global_file_name[0] != undefined) {

        var progress_circle = $('.circle')

        progress_circle.circleProgress({
            startAngle: -Math.PI / 2,
            value: 0.0,
            size: 40,
            thickness: 4,
            emptyFill: "#eeeaef",
            fill: { gradient: [increase_brightness(BOT_THEME_COLOR, 25), increase_brightness(BOT_THEME_COLOR, 50)] }
        });

        xhttp.upload.onprogress = function (e) {
            let upload_value = (e.loaded / e.total).toFixed(2);

            console.log(upload_value);

            progress_circle.circleProgress('value', upload_value).on('circle-animation-progress', function (event, progress, stepValue) {
                progress_circle.css("display", "block")
                $('.circle-progress-value').text((stepValue * 100).toFixed(0) + "%");
                // if((stepValue * 100).toFixed(0) == 100)
                // {
                //       var element = document.getElementsByClassName("easychat-dragdropContainer__XPS")[0]
                //       if (element != null && element != undefined) {
                //         if(last_chosen_file_type.indexOf("png") != -1 || last_chosen_file_type.indexOf("jpeg") != -1 || last_chosen_file_type.indexOf("jpg") != -1 ||last_chosen_file_type.indexOf("gif") != -1 || last_chosen_file_type.indexOf("mp4") != -1 )
                //                 {
                //                     element.remove()
                //                 }
                //         }     

                // }
            });
        };
    }

    xhttp.onreadystatechange = function () {
        // var succesfull_attachment = document.querySelectorAll('.successful-submission-text')
        // succesfull_attachment = succesfull_attachment[succesfull_attachment.length - 1]

        // changes to remove all the widgets before new ones are appended
        // $(".easychat-country-code-submit-btn-wrapper-widget").remove()
        // $("#easychat-form-container").remove()
        remove_widgets()
        if (this.readyState == 4 && this.status == 200) {
            entered_suggestion = false;
            response = JSON.parse(this.responseText);
            response = custom_decrypt(response)
            response = JSON.parse(response);

            if (response.status_code == '200') {
                if (global_file_name[0] != "" && global_file_name[0] != undefined) {
                    try {
                        //  succesfull_attachment.style.display = "block"
                        if (previewImg != null && previewImg != undefined && previewImg != "") {
                            if (last_chosen_file_type.indexOf("png") != -1 || last_chosen_file_type.indexOf("jpeg") != -1 || last_chosen_file_type.indexOf("jpg") != -1 || last_chosen_file_type.indexOf("gif") != -1 || last_chosen_file_type.indexOf("mp4") != -1) {
                                // previewImg.style.display = "block"  
                                scroll_to_bottom()
                            }
                        }
                        global_file_name = ""
                    } catch (err) {
                        console.log(err)
                    }
                }

                user_id = response.user_id;

                is_user_authenticated = response["response"]["is_user_authenticated"]
                is_first_query = false;
                if (is_initial_intent) {
                    is_first_query = true;
                }
                is_initial_intent = false;
                is_manually_typed_query = true;
                is_widget_data = false;

                // starting session management

                start_authenticated_session(user_id, is_user_authenticated)

                query_token_id = response.query_token_id

                set_easychat_user_id_cookie(user_id)

                if ("session_id" in response) {
                    session_id = response["session_id"]
                    set_easychat_prev_session_id_cookie(session_id)
                }
                if (is_faq_intent && is_bot_started) {
                    display_faq_intent_response(response, message)
                    enable_user_input();
                    $('#faq_loader').hide()
                    return;
                }

                attached_file_src = "";
                file_extension = null;
                is_save_attachment_required = null;
                widget_user_selected_list = null;
                is_sticky_message = false;
                is_video_recorder_allowed = false;
                is_campaign_link = false;
                hide_bot_typing_loader();
                if (form_assist_enabled) {
                    if (is_intent_icon_enabled_for_dnd) {
                        response["response"]["recommendations"].push({
                            "name": "Do not disturb",
                            "intent_icon": "true"
                        });    
                    } else {
                        response["response"]["recommendations"].push(["Do not disturb"]);
                    }
                    do_not_disturb = "true";
                }
                file_src = ""
                file_name = ""
                try {
                    if ("attached_file_src" in response["response"]) {
                        file_src = window.location.origin + response["response"]["attached_file_src"]
                        file_name = response["response"]["attached_file_name"]
                    }
                } catch (err) {
                    console.log(err)
                }
                if (file_src != "" && file_src != undefined && file_src != null && is_bot_started) {
                    append_user_attachment_preview(file_name, file_src, file_src)
                    succesfull_attachment_html = get_attachment_succesful_submission_html()
                    $("#easychat-chat-container").append(succesfull_attachment_html)

                }

                if ("video_recorder_file_src" in response["response"]) {
                    $("#easychat-chat-container").append(get_video_recorder_preview_html(response["response"]["video_recorder_file_src"]) + get_video_recorder_upload_successfull_html());
                }

                enable_user_input();
                detectmob();
                update_is_bot_auto_detected_language(response)
                is_bot_language_change_confirmed = update_bot_languge_if_needed(response)
                if(is_bot_started){
                    if (is_bot_language_change_confirmed) {
                        const temp_response = response
                        setTimeout(function () {
                            append_bot_response(temp_response);
                        }, 500)
                    } else {
                        append_bot_response(response);
                    }
                }

                if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
                    document.getElementById("easychat-query-mic-send-icon-wrapper").style.pointerEvents = "auto";
                }

                if (document.getElementById("feedback_modal")) {
                    if (document.getElementById("feedback_modal").style.display != "block") {
                        enable_footer();
                        enable_sticky_div();
                        focus_user_input();
                    }
                } else {
                    enable_footer();
                    enable_sticky_div();
                    focus_user_input();
                }

                //scroll_to_bottom();
                current_request_xhttp = null

                form_assist_enabled = false;
            } else if (response.status_code == '500') {
                enable_user_input();
                if(is_bot_started){
                    append_bot_text_response(INVALID_SESSION_ID_RESPONSE_TEXT);
                }
                global_file_name = ""
                is_bot_response_message_showed = true;
                attached_file_src = "";
                scroll_to_bottom();
                current_request_xhttp = null

            }
        } 
        else if(this.status != 200 && this.readyState == 4)  {
            enable_user_input();
            if(is_bot_started){
                append_bot_text_response(QUERY_API_FAILURE_TEXT);
            }
            if (is_text_to_speech_required) {
                text_to_speech(QUERY_API_FAILURE_TEXT);
            }
            global_file_name = ""
            is_bot_response_message_showed = true;
            attached_file_src = "";
            is_widget_data = false;
            scroll_to_bottom();
            current_request_xhttp = null
        }
    }
    xhttp.send(params);
}


function append_bot_prev_session_response(response, message_sent) {
    // currently prev session response only supports cards, videos, images tables , text response ques answers only

    var cards = response.response.cards;
    var videos = response.response.videos;
    var images = response.response.images;
    var tables = response.response.tables;

    var easy_search_results = response.response.easy_search_results;

    var google_search_results = response.response.google_search_results;
    var pdf_search_results = response.response.pdf_search_results;

    message_list = get_message_list(message_sent, RESPONSE_SENTENCE_SEPARATOR);

    for (var i = 0; i < message_list.length; i++) {
        append_bot_text_response(message_list[i]);
    }
    reset_size_of_text_field(message_list.length);



    if (easy_search_results != null && easy_search_results != undefined && easy_search_results.length > 0) {

        append_bot_slider_cards(easy_search_results);
    }

    if (google_search_results != null && google_search_results != undefined && google_search_results.length > 0) {

        append_bot_slider_cards(google_search_results);
    }

    if (pdf_search_results != null && pdf_search_results != undefined && pdf_search_results.length > 0) {

        append_pdf_search_bot_slider_cards(pdf_search_results);
    }

    if (tables != undefined && tables != null && tables.length > 0) {
        append_bot_tables(tables);
    }

    if (images.length > 0) {
        append_bot_slider_images(images);
    }

    if (videos.length > 0) {
        append_bot_slider_videos(videos);
    }

    if (cards.length > 0) {
        append_bot_slider_cards(cards);
    }

    enable_user_input();

    setTimeout(function (e) {
        scroll_to_bottom();
    }, 500);


}

function append_user_prev_session_response(user_msg, attached_file_src, attached_file_name) {

    if (attached_file_src == "") {

        append_user_input(user_msg)
    } else {

        append_user_attachment_preview(attached_file_name, attached_file_src, attached_file_src)
    }

}

function getPrevSessionHistory(prev_session_id, speech_welcome_message, is_text_to_speech_required) {
    var json_string = JSON.stringify({
        session_id: prev_session_id,
        bot_id: bot_id
    });
    json_string = encrypt_variable(json_string);
    json_string = encodeURIComponent(json_string);

    var xhttp = new XMLHttpRequest();
    var params = 'json_string=' + json_string
    xhttp.open("POST", "/chat/get-previous-session-data/", true);
    xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            response = JSON.parse(this.responseText);
            response = custom_decrypt(response)
            response = JSON.parse(response);

            if (response['status'] == 200) {

                is_previous_chat_history_required = response["is_previous_chat_history_required"]

                if (!is_previous_chat_history_required) {
                    return
                }

                is_first_query = false
                response_objs = response["prev_session_response"]
                if (response_objs.length > 0) {
                    remove_banner_based_on_theme();
                    is_conversaion_started = true
                } else if(is_text_to_speech_required){
                    
                    text_to_speech(speech_welcome_message)
                }
                

                for (var i = 0; i < response_objs.length; i++) {

                    user_msg = response_objs[i]['message_received']

                    bot_resp = response_objs[i]['response_json']
                    message_sent = response_objs[i]['message_sent']
                    user_attached_file_src = response_objs[i]["attached_file_src"]
                    user_attached_file_name = response_objs[i]["attached_file_name"]
                    last_spoken_language = response_objs[i]['selected_language']
            
                    append_user_prev_session_response(user_msg, user_attached_file_src, user_attached_file_name)

                    append_bot_prev_session_response(bot_resp, message_sent)

                }


                if (response_objs.length > 0 && is_text_to_speech_required) { 
                    text_to_speech(message_sent, last_spoken_language)
                }

            }
            scroll_to_bottom();
            enable_bot_footer();
            enable_sticky_div();
        }
    }
    xhttp.send(params);
}

function default_bot_color(bot_id) {
    var json_string = JSON.stringify({
        bot_id: bot_id,
    });
    json_string = encrypt_variable(json_string);
    json_string = encodeURIComponent(json_string);

    var xhttp = new XMLHttpRequest();
    var params = "json_string=" + json_string;
    xhttp.open("POST", "/chat/get-bot-message-image/", true);
    xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhttp.onload = function () {
        if (this.status == 200) {
            response = JSON.parse(this.responseText);
            response = custom_decrypt(response)
            response = JSON.parse(response);
            BOT_THEME_COLOR = "#" + response.bot_theme_color
            document.getElementById("easychat-navbar-wrapper").style.backgroundColor = BOT_THEME_COLOR;
            document.getElementById("user_input").style.borderColor = BOT_THEME_COLOR;
            document.getElementById("model-feedback-header").style.color = BOT_THEME_COLOR;
            document.getElementById("img-scroll-to-bottom").style.color = BOT_THEME_COLOR;
        }
    }
    xhttp.send(params);
}

function custom_button_change(x) {
    // x.style.backgroundColor = BOT_THEME_COLOR;
    var theme_color = BOT_THEME_COLOR;
    if (theme_color.toLowerCase() == "#ffffff") {
        theme_color = WHITE_THEME_COLOR
    }
    x.style.setProperty('background-color', theme_color, 'important');
    x.style.setProperty('color', 'white', 'important');
    x.style.borderWidth = "0.05em";
    x.style.borderColor = theme_color;
    x.style.borderStyle = "solid";
}

function custom_button_change_normal(x) {
    var theme_color = BOT_THEME_COLOR;
    if (theme_color.toLowerCase() == "#ffffff") {
        theme_color = WHITE_THEME_COLOR
    }

    if (x.getAttribute("easychat-feedback-selected") == "true") { return; }

    if (EASYCHAT_BOT_THEME == 'theme_1') {
        x.style.setProperty('background-color', "transparent", 'important')
        x.style.color = theme_color;
    } else if (EASYCHAT_BOT_THEME == 'theme_2') {
        //do nothing  if theme 6 
    } else if (EASYCHAT_BOT_THEME == 'theme_4') {
        x.style.border = 'none';
        x.style.setProperty('background-color', "transparent", 'important')
        x.style.color = '#4D4D4D';
    }
    else {
        x.style.setProperty('background-color', "#f6f6f6", 'important')
        x.style.color = BOT_THEME_COLOR;
    }
}

function custom_button_change_card(x) {
    x.style.backgroundColor = BOT_THEME_COLOR;
    x.style.color = "white";
    x.style.borderRadius = "1em";
}


function custom_button_change_normal_card(x) {
    x.style.backgroundColor = "white";
    x.style.color = "black";
    x.style.borderRadius = "1em";
}

function append_bot_inactivity_msg() {
    if (is_livechat == true) {
        return;
    }
    if (!is_bot_inactivity_msg_present && is_livechat == false) {
        append_bot_text_response(bot_inactivity_msg)
        if (is_text_to_speech_required) {
            text_to_speech(bot_inactivity_msg)
        }
        is_bot_inactivity_msg_present = true
        scroll_to_bottom();

        maximize_chatbot(1);
    }
}


function reset_bot_inactivity_timer() {

    window.clearTimeout(bot_inactivity_timer);
    bot_inactivity_timer = setTimeout(append_bot_inactivity_msg, bot_inactivity_time * 1000);
}

function disable_bot_inactivity_detection() {
    bot_inactivity_detection_required = false;

    if (bot_inactivity_timer != null) {
        window.clearTimeout(bot_inactivity_timer);
    }
}

function append_bot_response_delay_message() {
    if (is_livechat == false && is_bot_response_message_showed == false) {
        append_bot_text_response(bot_response_delay_message)
        is_bot_response_message_showed = true
        if (is_text_to_speech_required) {
            text_to_speech(bot_response_delay_message)
        }
        scroll_to_bottom();
        show_bot_typing_loader();
    }
}

function reset_bot_response_delay_timer() {

    if (bot_message_delay_timer != null) {
        window.clearTimeout(bot_message_delay_timer);
    }
    bot_message_delay_timer = setTimeout(append_bot_response_delay_message, bot_response_delay_timer * 1000);
}

function sticky_scroll_forward() {
    document.getElementById("easychat-sticky-intents").scrollBy(200, 0);
}

function sticky_scroll_backward() {
    document.getElementById("easychat-sticky-intents").scrollBy(-200, 0);
}

function sticky_scroll_left() {

    document.getElementById('easychat-bot-sticky-intent-items-div').scrollLeft += 200;
}

function sticky_scroll_right() {
    document.getElementById('easychat-bot-sticky-intent-items-div').scrollLeft -= 200;

}

function sticky_scroll_left_theme4_no_input() {
    document.getElementById('easychat-bot-sticky-intent-items-div-no-input').scrollLeft += 200;
    
}

function sticky_scroll_right_theme4_no_input() {
    document.getElementById('easychat-bot-sticky-intent-items-div-no-input').scrollLeft -= 200;
    
}


function send_sticky_message(user_input, intent_id) {
    if (sticky_button_display_format == "Menu") {
        let sticky_menu = document.getElementById('easychat_sticky_menu_items');
        sticky_menu.className = 'easychat-sticky-menu-items';
        if (EASYCHAT_BOT_THEME == 'theme_4') {
            $("#bot_menu_option_items_wrapper").removeClass("easychat-sticky-menu-option-show")
            $("#bot_menu_option_opner_div").removeClass("bot-menu-opner-active");
            resize_chabot_window();
        }
    }

    entered_suggestion = true;
    is_sticky_message = true;
    send_user_input(user_input, intent_id);
}

function disable_sticky_div() {
    try {
        var easychat_sticky_div = document.getElementById('easychat-sticky');

        if (easychat_sticky_div) {
            easychat_sticky_div.style.pointerEvents = 'none';
        }
    } catch (err) {
        console.log(err);
    }
}

function enable_sticky_div() {
    try {
        var easychat_sticky_div = document.getElementById('easychat-sticky');

        if (easychat_sticky_div) {
            easychat_sticky_div.style.pointerEvents = 'auto';
        }
    } catch (err) {
        console.log(err);
    }
}

function append_hamburger_items(hamburger_items) {
    var html = ""
    var index = 717;
    complete_hamburger_list = hamburger_items
    if (hamburger_items.length > 0 && EASYCHAT_BOT_THEME == "theme_7") {
        for (var i = 0; i < hamburger_items.length; i++) {
            if (EASYCHAT_BOT_THEME == "theme_7") {
                index = index + 2;
                if (i % 2 == 0) {

                    html = html + '<li  class="category even" onclick="send_hamburger_intent(' + i + ')" id="hamburger_li_' + i + '" data-ember-action="" data-ember-action-' + index + '="' + index + '">'

                } else {
                    html = html + '<li class="category odd" onclick="send_hamburger_intent(' + i + ')" id="hamburger_li_' + i + '" data-ember-action="" data-ember-action-' + index + '="' + index + '">'
                }
                html = html + '<div class="category-inner">\
                        <div class="category-icon">\
                            <i class="fa ' + hamburger_items[i][2] + ' category-icon-img" aria-hidden="true" style = "font-size: 1.2em; color: ' + BOT_THEME_COLOR + '" id="bot-hamburger-icon_' + index + '"></i>\
                        </div>\
                        <div class="block-with-text">'+ hamburger_items[i][3] + '</div>\
                    </div>\
                </li>'

            }
        }
        document.getElementById("bot_hamburger_container").innerHTML = html
    }
}


var send_hamburger_intent = function (index) {
    intent_key = complete_hamburger_list[index][1]
    intent_name = complete_hamburger_list[index][4]
    link = complete_hamburger_list[index][5]

    if (intent_key == "1883") {
        var pattern = /^((http|https|ftp):\/\/)/;
        if (!pattern.test(link)) { link = "http://" + link; }
        window.open(link);
        $('.chatFullMenu').fadeToggle(250);


    }
    else {
        send_user_input(intent_name)
        $('.chatFullMenu').fadeToggle(250);
    }
}

function append_quick_menu_items(quick_items) {
    quick_menu_html =
        '<div class="quick-links-cards-container" style="display: inline-block;">'
    if (quick_items.length > 0 && EASYCHAT_BOT_THEME == "theme_7") {
        for (var i = 0; i < quick_items.length; i++) {

            if (quick_items[i][5] == "nil") {

                quick_menu_html += '<div class="quick-link-card" onclick="send_user_input(\'' + quick_items[i][4] + '\')">\
                <div class="quick-link-card-image-div"> <img class="quick-link-card-img" src="'+ quick_items[i][2] + '"> </div>\
                <div class="quick-link-card-title" style="cursor: pointer;"><span>'+ quick_items[i][3] + '</span></div>\
                </div>'

            }
            else {
                quick_menu_html += '<div class="quick-link-card" onclick="window.open(\'' + quick_items[i][5] + '\', \'_blank\')">\
                                <div class="quick-link-card-image-div"> <img class="quick-link-card-img" style="height:40px;" src="'+ quick_items[i][2] + '"> </div>\
                                <div class="quick-link-card-title" style="cursor: pointer;"><span>'+ quick_items[i][3] + '</span></div>\
                                </div>'
            }

        }
        quick_menu_html += '</div>'
        $('.easychat-bot-message-div').css("flex-direction", "column")
        $('.easychat-bot-message-div div:eq(0)').after(quick_menu_html)
    }
}

function append_sticky_intents_menu_theme_three_and_four(sticky_intents_list_menu) {

    document.getElementById("sticky-menu-header-text").innerText = MENU_TEXT

    if (typeof sticky_intents_list_menu !== 'undefined' && sticky_intents_list_menu.length > 0) {
        html = ""
        if (EASYCHAT_BOT_THEME == "theme_4") {
            $("#tooltip-menu-text").html(MENU_TEXT)
            $('#bot_menu_option_opner_div').attr('style', 'display: flex !important')
            $('#easychat-restart-div').css('width', 'calc(100% - 56px)')
        }
        for (let i = 0; i < sticky_intents_list_menu.length; i++) {
            intent_name = sticky_intents_list_menu[i][0]
            intent_icon = sticky_intents_list_menu[i][1]
            intent_id = sticky_intents_list_menu[i][2]
            let clean_intent_name = intent_name.split("'").join("\\"+"'");
            html += '<div class="easychat-sticky-menu-item" onclick="send_sticky_message(\'' + clean_intent_name + '\', \'' + intent_id + '\')"><div style="margin-top: auto; margin-bottom: auto;"><i class = "fa ' + intent_icon + ' sticky-menu-item-icon" style="color:' + BOT_THEME_COLOR + '"></i></div><div class = "easychat-sticky-menu-item-text" >' + intent_name + '</div></div>';
        }

        easychat_sticky_menu_items = document.getElementById("easychat_sticky_menu_items")
        easychat_sticky_menu_items.innerHTML = html;
        is_sticky_intent_menu_present = true
    }

    add_sticky_menu_item_keyup_keydown_event_listener();
}

function append_sticky_intents_for_theme_three_and_four(sticky_intents_list) {

    if (typeof sticky_intents_list !== 'undefined' && sticky_intents_list.length > 0) {
        is_sticky_intent_button_present = true

        var html = "";

        easychat_bot_sticky_intent_items_div = document.getElementById("easychat-bot-sticky-intent-items-div")

        for (let i = 0; i < sticky_intents_list.length; i++) {

            let button_name = sticky_intents_list[i]["name"]
            let clean_intent_name = button_name.split("'").join("\\"+"'");
            let intent_id = sticky_intents_list[i]["id"]

            html += '<button class="button-sticky-item" onclick="send_sticky_message(\'' + clean_intent_name + '\', \'' + intent_id + '\')"> ' + button_name + '</button>'
        }

        easychat_bot_sticky_intent_items_div.innerHTML = html

        $(".easychat-bot-sticky-intent-wrapper").css("display", "flex");
        // $("#img-scroll-to-bottom").css("bottom", "6.7em");

        total_length_of_buttons = 0
        for (var button_iterator = 0; button_iterator < document.getElementsByClassName("button-sticky-item").length; button_iterator++) {
            total_length_of_buttons += document.getElementsByClassName("button-sticky-item")[button_iterator].offsetWidth;
        }
        if (total_length_of_buttons <  document.getElementById("easychat-bot-sticky-intent-items-div").offsetWidth) {
            
            $(".sticky-intent-arrow-button-right").css("display", "none");
            $(".sticky-intent-arrow-button-left").css("display", "none");
            $(".easychat-bot-sticky-intent-items-div").css("width", "100%");

        }

        // $(".easychat-bot-sticky-intent-wrapper").css("display", "none");
        // $("#img-scroll-to-bottom").css("bottom", "3.7em");
    }
}

function append_sticky_intents_menu_based_on_theme(sticky_intents_list_menu) {
    if (IS_TEXTFIELD_INPUT_ENABLED) {
        if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
            append_sticky_intents_menu_theme_three_and_four(sticky_intents_list_menu);
        } else {
            append_sticky_intents_menu(sticky_intents_list_menu);
        }
    } else {
        if (EASYCHAT_BOT_THEME != "theme_3" && EASYCHAT_BOT_THEME != "theme_4") {
            $("#easychat-sticky").remove()
        }
        else {
            $("#easychat-sticky-theme3").remove();  
            $("#easychat-sticky-theme4").remove();   
            
            if (EASYCHAT_BOT_THEME == "theme_3") {
                if (total_languages_supported == 1 && sticky_intents_list_menu.length == 0) {
                    $("#easychat-restart-div-no-input").css('display', '')
                    $("#bot_action_opner_btn").css('display', 'none')
                } else {
                    $("#easychat-restart-div-no-input").css('display', 'none')
                    $("#user_actions_div.footer-with-button-only").css('align-items', 'fl,ex-end')

                    if (total_languages_supported == 1) {
                        $("#sticky_lang_dropdown_opner_btn").css('display', 'none')
                    }
                }
            }
        }
        
        if (sticky_intents_list_menu.length > 0) {
            append_sticky_intents_menu_no_input_field(sticky_intents_list_menu);
            $("#easychat-restart-div-no-input").css('display', 'none')
            $("#easychat_bot_sticky_menu_wrapper").css('display', '')

        } else {
            $("#easychat_bot_sticky_menu_wrapper").css('display', 'none')

            if (EASYCHAT_BOT_THEME != "theme_3") {
                $("#bot_action_opner_btn").css('display', 'none')
                $("#easychat-restart-div-no-input").css('display', '')
            } else {
                $("#sticky_menu_opner_btn").css('display', 'none')
            }
            
        }
        
        
    }
}

function append_sticky_intent_based_on_theme(sticky_intents_list) {
    if (IS_TEXTFIELD_INPUT_ENABLED) {
        if (EASYCHAT_BOT_THEME == "theme_3"  || EASYCHAT_BOT_THEME == "theme_4") {
            append_sticky_intents_for_theme_three_and_four(sticky_intents_list);
        } else {
            append_sticky_intents(sticky_intents_list);
        }
    } else {
        if (EASYCHAT_BOT_THEME != "theme_3") {
            $("#easychat-sticky").remove()
        }
        else {
            $("#easychat-bot-sticky-intent-wrapper").remove()
            if (total_languages_supported == 1) {
                $("#easychat-restart-div-no-input").css('display', '')
                $("#bot_action_opner_btn").css('display', 'none')
            } else {
                $("#easychat-restart-div-no-input").css('display', 'none')
                $("#user_actions_div.footer-with-button-only").css('flex-direction',"row-reverse").css('align-items', 'flex-end')
            }
            $("#img-scroll-to-bottom").css("bottom", "3.7em");
        }

            if (sticky_intents_list.length > 0) {
                if (EASYCHAT_BOT_THEME == "theme_1" || EASYCHAT_BOT_THEME == "theme_2") {

                    $("#easychat-sticky-btn").css('display', '')
                    append_sticky_intents_no_input_field(sticky_intents_list);
                } else {
                    append_sticky_intents_no_input_field_theme_3_4(sticky_intents_list);    
                }                
            } else {

                $("#easychat-sticky-btn").css('display', 'none')
                $("#easychat-sticky-btn-theme3-4").css('display', 'none')

                if (EASYCHAT_BOT_THEME != "theme_3" ) {
                    $("#easychat-restart-div-no-input").css('display', '')
                }

            }
        
    }
}


function append_sticky_intents(sticky_intents_list) {
    if (typeof sticky_intents_list !== 'undefined' && sticky_intents_list.length > 0) {
        var sticky_intent_arrow_color = BOT_THEME_COLOR;
        if (BOT_THEME_COLOR.toLowerCase() == "#ffffff") {
            sticky_intent_arrow_color = WHITE_THEME_COLOR;
        }
        var html = "";
        if (EASYCHAT_BOT_THEME == "theme_1") {
            html = '<div id="sticky-div" style=overflow:hidden;width:max-content;margin-bottom:1rem>'
            html += '<button class="arrow-button-left" onclick="sticky_scroll_backward()" style="border: none !important;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\
<path d="M0 0H18C21.3137 0 24 2.68629 24 6V18C24 21.3137 21.3137 24 18 24H0V0Z" fill=""/>\
<path fill-rule="evenodd" clip-rule="evenodd" d="M15.7071 4.29289C16.0976 4.68342 16.0976 5.31658 15.7071 5.70711L9.41421 12L15.7071 18.2929C16.0976 18.6834 16.0976 19.3166 15.7071 19.7071C15.3166 20.0976 14.6834 20.0976 14.2929 19.7071L7.29289 12.7071C6.90237 12.3166 6.90237 11.6834 7.29289 11.2929L14.2929 4.29289C14.6834 3.90237 15.3166 3.90237 15.7071 4.29289Z" fill=' + sticky_intent_arrow_color + '>\
</svg></button>'
            for (var i = 0; i < sticky_intents_list.length; i++) {
                let clean_intent_name = sticky_intents_list[i].name.split("'").join("\\"+"'");
                html += '<button class="button_sticky" onclick="send_sticky_message(\'' + clean_intent_name + '\', \'' + sticky_intents_list[i].id + '\')" style="color:' + BOT_THEME_COLOR + ';font-size:15px;outline:auto;border-radius:10px;border:0;height:30px;">' + sticky_intents_list[i].name + '</button>&nbsp;&nbsp;&nbsp;&nbsp;'
            }
            html += '<button class="arrow-button-right" onclick="sticky_scroll_forward()" style="border: none !important;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\
            <path d="M24 0H6C2.68629 0 0 2.68629 0 6V18C0 21.3137 2.68629 24 6 24H24V0Z" fill=""/>\
            <path fill-rule="evenodd" clip-rule="evenodd" d="M8.2929 4.29289C7.9024 4.68342 7.9024 5.31658 8.2929 5.70711L14.5858 12L8.2929 18.2929C7.9024 18.6834 7.9024 19.3166 8.2929 19.7071C8.6834 20.0976 9.3166 20.0976 9.7071 19.7071L16.7071 12.7071C17.0976 12.3166 17.0976 11.6834 16.7071 11.2929L9.7071 4.29289C9.3166 3.90237 8.6834 3.90237 8.2929 4.29289Z" fill=' + sticky_intent_arrow_color + '>\
            </svg></button>'
            html += '</div>'
        } else {
            html = '<div id="sticky-div" style=overflow:hidden;width:max-content;margin-bottom:0.5em>'
            html += '<button class="arrow-button-left" onclick="sticky_scroll_backward()" style="border: none !important;"><svg width="24" height="35" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\
<path d="M0 0H18C21.3137 0 24 2.68629 24 6V18C24 21.3137 21.3137 24 18 24H0V0Z" fill=""/>\
<path fill-rule="evenodd" clip-rule="evenodd" d="M15.7071 4.29289C16.0976 4.68342 16.0976 5.31658 15.7071 5.70711L9.41421 12L15.7071 18.2929C16.0976 18.6834 16.0976 19.3166 15.7071 19.7071C15.3166 20.0976 14.6834 20.0976 14.2929 19.7071L7.29289 12.7071C6.90237 12.3166 6.90237 11.6834 7.29289 11.2929L14.2929 4.29289C14.6834 3.90237 15.3166 3.90237 15.7071 4.29289Z" fill=' + sticky_intent_arrow_color + '>\
</svg></button>'
            for (var i = 0; i < sticky_intents_list.length; i++) {
                let clean_intent_name = sticky_intents_list[i].name.split("'").join("\\"+"'");
                html += '<button class="button_sticky" onclick="send_sticky_message(\'' + clean_intent_name + '\', \'' + sticky_intents_list[i].id + '\')" style="color:' + BOT_THEME_COLOR + ';font-size:15px;outline:auto;border-radius:10px;border:0;height:30px;">' + sticky_intents_list[i].name + '</button>&nbsp;&nbsp;&nbsp;&nbsp;'
            }
            html += '<button class="arrow-button-right" onclick="sticky_scroll_forward()" style="border: none !important;"><svg width="24" height="35" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\
<path d="M24 0H6C2.68629 0 0 2.68629 0 6V18C0 21.3137 2.68629 24 6 24H24V0Z" fill=""/>\
<path fill-rule="evenodd" clip-rule="evenodd" d="M8.2929 4.29289C7.9024 4.68342 7.9024 5.31658 8.2929 5.70711L14.5858 12L8.2929 18.2929C7.9024 18.6834 7.9024 19.3166 8.2929 19.7071C8.6834 20.0976 9.3166 20.0976 9.7071 19.7071L16.7071 12.7071C17.0976 12.3166 17.0976 11.6834 16.7071 11.2929L9.7071 4.29289C9.3166 3.90237 8.6834 3.90237 8.2929 4.29289Z" fill=' + sticky_intent_arrow_color + '>\
</svg></button>'
            html += '</div>'
        }
        document.getElementById("easychat-sticky-intents").innerHTML = html;
        total_length_of_buttons = 0
        for (var button_iterator = 0; button_iterator < document.getElementsByClassName("button_sticky").length; button_iterator++) {
            total_length_of_buttons += document.getElementsByClassName("button_sticky")[button_iterator].offsetWidth
        }
        if (detectIEEdge()) {
            document.getElementById("sticky-div").style.width = 1.15 * (total_length_of_buttons) + "px";
            //document.getElementsByClassName("arrow-button-left")[0].style.display = "none";
            //document.getElementsByClassName("arrow-button-right")[0].style.display = "none";
        }

        if (total_length_of_buttons < 0.9 * document.getElementById("easychat-sticky-intents").offsetWidth) {
            
            document.getElementsByClassName("arrow-button-left")[0].style.display = "none";
            document.getElementsByClassName("arrow-button-right")[0].style.display = "none";
        }
        resize_chabot_window()
    } else {
        try {
            document.getElementById("easychat-sticky").remove();
            if (EASYCHAT_BOT_THEME == "theme_1") {
                document.getElementById('easychat-footer').style.boxShadow = '0px 0px 15px rgba(0, 0, 0, 0.1)';
            }
            document.getElementById("easychat-chat-container").style.height = '500px';
        } catch (err) { }
    }

}

function add_sticky_menu_item_keyup_keydown_event_listener() {

    var obj_div = document.getElementById("easychat_sticky_menu_items");

    if (obj_div != null || obj_div != undefined) {

        var obj = document.getElementById("user_input");
        user_input = get_user_input_based_on_theme();
        var currentFocus = -1;

        obj.addEventListener("keydown", function (e) {

            var is_menu_open = document.getElementsByClassName('easychat-sticky-menu-items-show');

            if (is_menu_open.length > 0) {
                objDiv = document.getElementById("easychat_sticky_menu_items");
                current_div = objDiv.getElementsByClassName(
                    "easychat-sticky-menu-item"
                );

                if (e.keyCode == 40) {
                    currentFocus++;
                    addActive(current_div);
                } else if (e.keyCode == 38) {
                    currentFocus--;
                    addActive(current_div);
                } else if (e.keyCode == 13) {

                    e.preventDefault();
                    if (currentFocus > -1 && get_user_input_based_on_theme() == "") {
                        if (current_div) current_div[currentFocus].click();
                        currentFocus = -1;
                    }
                }
            }
        });
    }

    function addActive(current_div) {

        if (!current_div) return false;
        removeActive(current_div);
        if (currentFocus >= current_div.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = current_div.length - 1;

        current_div[currentFocus].classList.add("autocomplete-active");
        if (navigator.userAgent.indexOf("Firefox") != -1) {
            current_div[currentFocus].scrollIntoView({
                behaviour: "smooth",
                block: "nearest",
            });
        } else {
            current_div[currentFocus].scrollIntoViewIfNeeded();
        }
    }

    function removeActive(current_div) {
        for (var elem = 0; elem < current_div.length; elem++) {
            current_div[elem].classList.remove("autocomplete-active");
        }
    }
}

function append_sticky_intents_menu(sticky_intents_list_menu) {

    var arrow_up_svg = '<svg style = "fill:#000;width:15px;height:8px;" width="10" height="6" viewBox="0 0 10 6"  xmlns="http://www.w3.org/2000/svg">\
<path d="M5 4.37114e-07L10 5L9 6L5 2L0.999999 6L-8.74228e-08 5L5 4.37114e-07Z" />\
</svg>'
    var arrow_down_svg = '<svg style = "fill:#000;width:15px;height:8px;" width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">\
<path d="M5 6.05344L0 1.07251L1 0.0763245L5 4.06107L9 0.0763245L10 1.07251L5 6.05344Z" />\
</svg>'

    if (typeof sticky_intents_list_menu !== 'undefined' && sticky_intents_list_menu.length > 0) {
        document.getElementById('easychat-sticky-intents').style.width = '100%';
        document.getElementById('easychat-sticky-intents').style.marginLeft = '0';
        document.getElementById('easychat-sticky').style.background = 'white';

        let html = ""

        if (EASYCHAT_BOT_THEME == "theme_2") {

            html = '<div onclick="display_sticky_menu_items()"><div class="easychat-sticky-menu">\
                            <div style="color: #4d4d4d; font-size: 17px">' + MENU_TEXT + '</div>\
                            <div id="arrow_up" class="arrow_up" style="display:block">'+ arrow_up_svg + '</div>\
                            <div id="arrow_down" class="arrow_up" style="display:none;">'+ arrow_down_svg + '</div>\
                        </div><div class = "easychat-sticky-menu-items" id="easychat_sticky_menu_items">';

        } else {
            html = '<div onclick="display_sticky_menu_items()"><div class="easychat-sticky-menu">\
                            <div style="color: #4d4d4d; font-size: 17px">' + MENU_TEXT + '</div>\
                            <div id="arrow_up" class="arrow_up" style="margin-right:3%;display:block"><img src="' + EASYCHAT_IMG_PATH + 'arrow_up_sticky.svg"></div>\
                            <div id="arrow_down" class="arrow_up" style="margin-right:3%;display:none;"><img src="' + EASYCHAT_IMG_PATH + 'arrow_down_sticky.svg"></div>\
                        </div><div class = "easychat-sticky-menu-items" id="easychat_sticky_menu_items">';

        }
        for (let i = 0; i < sticky_intents_list_menu.length; ++i) {
            let sticky_intent = sticky_intents_list_menu[i];
            let clean_intent_name = sticky_intent[0].split("'").join("\\"+"'");
            html += '<div class="easychat-sticky-menu-item" style="display:flex; margin: 0px 0px 10px 0px;" onclick="send_sticky_message(\'' + clean_intent_name + '\', \'' + sticky_intent[2] + '\')"><div style="margin-top: auto; margin-bottom: auto;"><i class = "fa ' + sticky_intent[1] + ' sticky-menu-item-icon" style="color:' + BOT_THEME_COLOR + '"></i></div><div class = "easychat-sticky-menu-item-text" style="margin-left:10px; color: #4d4d4d; font-size:15px;">' + sticky_intent[0] + '</div></div>';
        }

        html += '</div></div>';
        is_sticky_intent_menu_present = true;
        document.getElementById("easychat-sticky-intents").innerHTML = html;
        document.getElementById("easychat-sticky-intents").style.overflow = "hidden";
        resize_chabot_window()
    } else {
        try {
            document.getElementById("easychat-sticky").remove();
            is_sticky_intent_menu_present = false;
            if (EASYCHAT_BOT_THEME == "theme_1") {
                document.getElementById('easychat-footer').style.boxShadow = '0px 0px 15px rgba(0, 0, 0, 0.1)';
            }
            document.getElementById("easychat-chat-container").style.height = '500px';
        } catch (err) { }
    }

    add_sticky_menu_item_keyup_keydown_event_listener();
}

function display_sticky_menu_items() {
    if (is_sticky_menu_closed()) {
        open_sticky_menu();

    } else {
        close_sticky_menu();

    }
    resize_chabot_window();
    scroll_to_bottom();
}

function is_sticky_menu_closed() {
    if (!is_sticky_intent_menu_present) {
        return true
    }
    if (EASYCHAT_BOT_THEME == 'theme_4') {
        return $("#bot_menu_option_items_wrapper").hasClass("easychat-sticky-menu-option-show")
    }
    return document.getElementById("arrow_up").style.display == "block";
}

function open_sticky_menu() {
    document.getElementById("arrow_up").style.display = "none";
    document.getElementById("arrow_down").style.display = "block";
    let sticky_menu = document.getElementById('easychat_sticky_menu_items');
    sticky_menu.className += ' easychat-sticky-menu-items-show';
}

function close_sticky_menu() {
    if (EASYCHAT_BOT_THEME == 'theme_4') {
        $("#bot_menu_option_items_wrapper").removeClass("easychat-sticky-menu-option-show")
        $("#bot_menu_option_opner_div").removeClass("bot-menu-opner-active");
        resize_chabot_window();
        return;
    }
    document.getElementById("arrow_up").style.display = "block";
    document.getElementById("arrow_down").style.display = "none";
    let sticky_menu = document.getElementById('easychat_sticky_menu_items');
    sticky_menu.className = ' easychat-sticky-menu-items';
}


function display_sticky_div() {
    var elem = document.getElementById('easychat-sticky');
    if (elem != undefined && elem != null) {
        elem.style.display = 'block';
    }
}

function add_welcome_message_response_for_welcome_screen(welcome_message) {
    welcome_message = welcome_message.split("$$$").join('')
    document.getElementById("easychat-chatbot-welcome-message").innerHTML = welcome_message
    document.getElementById("easychat-chatbot-welcome-screen-response").innerText = THEME_3_WELCOME_TEXT
    document.getElementById("easychat-bot-welcome-message-hello-text").innerText = THEME_3_GREETING_TEXT
}



function append_welcome_message(bot_id, bot_name, is_livechat_ended=false) {
//  theme 3 does not need to show typing loader for welcome message
    if (EASYCHAT_BOT_THEME != "theme_3" && EASYCHAT_BOT_THEME != "theme_4") {
        show_bot_typing_loader();
    }


    session_id = get_easychat_prev_session_id_from_cookies()

    user_id = get_easychat_user_id();

    if (bot_restarted || is_livechat_ended) {

        session_id = ""
    }

    url_parameters = get_url_vars();
    var channel_name = url_parameters["channel"]
    if (channel_name == undefined || channel_name == null)
        channel_name = "Web"

    var json_string = JSON.stringify({
        bot_id: bot_id,
        bot_name: bot_name,
        user_id: user_id,
        session_id: session_id,
        channel_name: channel_name,
        selected_language: selected_language,
        bot_web_page: decodeURIComponent(url_parameters["easychat_window_location"]),
        web_page_source: decodeURIComponent(url_parameters["web_page_source"])
    });
    json_string = encrypt_variable(json_string);
    json_string = encodeURIComponent(json_string);

    var xhttp = new XMLHttpRequest();
    var params = 'json_string=' + json_string
    xhttp.open("POST", "/chat/get-channel-details/", true);
    xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhttp.onload = function () {
        if (this.status == 200) {
            response = JSON.parse(this.responseText);
            response = custom_decrypt(response)
            response = JSON.parse(response);
            welcome_message = response.welcome_message;
            default_response = welcome_message;
            recommendations = response.initial_messages["items"];
            welcome_banner_list = response.welcome_banner_list;
            welcome_msg_images = response.initial_messages["images"];
            welcome_msg_compressed_imgs = response.initial_messages["compressed_images"];
            user_id = response.user_id;
            sticky_intents_list = response.sticky_intents_list;
            sticky_intents_list_menu = response.sticky_intents_list_menu;
            hamburger_items = response.hamburger_items
            quick_items = response.quick_items
            sticky_button_display_format = response.sticky_button_display_format;
            welcome_msg_videos = response.initial_messages["videos"];
            is_text_to_speech_required = response.is_text_to_speech_required

            if (is_internet_explorer) {
                is_text_to_speech_required = false;
            }
            // bot_start_conversation_intent = response.bot_start_conversation_intent
            poweredby_required = response.is_powered_by_required;
            bot_inactivity_detection_enabled = response.bot_inactivity_detection_enabled;
            bot_inactivity_msg = response.bot_inactivity_msg;
            bot_inactivity_time = response.bot_inactivity_time;
            bot_response_delay_allowed = response.bot_response_delay_allowed;
            bot_response_delay_timer = response.bot_response_delay_timer;
            bot_response_delay_message = response.bot_response_delay_message;
            query_token_id = response.query_token_id
            EASYCHAT_BOT_THEME = response.bot_theme
            is_automatic_carousel_enabled = response.is_automatic_carousel_enabled
            carousel_time = parseInt(response.carousel_time)
            livechat_queue_time = parseInt(response.queue_timer)
            web_url_initial_intent_present = response.web_url_initial_intent_present
            web_url_is_welcome_message_present = response.web_url_is_welcome_message_present
            web_url_initial_image_present = response.web_url_initial_image_present
            web_url_initial_videos_present = response.web_url_initial_videos_present
            web_url_is_welcome_banner_present = response.web_url_is_welcome_banner_present
            is_bot_notification_sound_enabled = response.is_bot_notification_sound_enabled
            queue_timer = (livechat_queue_time / 5) + 1;
            default_order_of_response = response.default_order_of_response;
            show_livechat_form_or_no = response.show_livechat_form_or_no

            max_file_size_allowed = response.max_file_size_allowed;
            bot_inactivity_detection_required = bot_inactivity_detection_enabled;
            csat_feedback_form_enabled = response.csat_feedback_form_enabled
            mark_all_fields_csat_compulsory = response.mark_all_fields_mandatory
            collect_phone_number = response.collect_phone_number
            collect_email_id = response.collect_email_id
            mask_confidential_info = response.mask_confidential_info
            is_audio_notification_enabled = response.is_audio_notification_enabled

            is_spell_check_while_typing_enabled = response.is_spell_check_while_typing_enabled
            is_intent_icon_enabled_for_dnd = response.is_intent_icon_enabled_for_dnd

            WORDS_LIST = response.words_list

            SPELL_CHECK_API_ENDPOINT = response.spell_check_api_endpoint
            SPELL_CHECK_ID = response.spell_check_id

            if ("phonetic_typing_supported_langugage_list" in response) {
                list_of_phonetic_typing_enabled_languages = response["phonetic_typing_supported_langugage_list"]

            }
            if ("phonetic_typing_disclaimer_text_dict" in response) {
                disclaimer_text_dict = response["phonetic_typing_disclaimer_text_dict"]

            }
            set_transilitration_for_phonetic_languages(selected_language)

            session_id = response["session_id"]

            easychat_prev_session_id = session_id

            set_easychat_user_id_cookie(user_id)

            set_easychat_prev_session_id_cookie(session_id)

            bot_restarted = false
            if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
                is_feedback_required = false
                html_striped_welcome_message = stripHTML(welcome_message)
                add_welcome_message_response_for_welcome_screen(html_striped_welcome_message)
            }

            if (sticky_button_display_format == 'Menu') {
                append_sticky_intents_menu_based_on_theme(sticky_intents_list_menu)
            } else {
                append_sticky_intent_based_on_theme(sticky_intents_list)
            }

            // append_hamburger_items(hamburger_items);

            if (poweredby_required === true) {
                document.getElementById("easychat-powered-by-div").style.display = "block";
            };

            var display_welcome_banner = true

            if (is_web_landing_allowed == "true" && web_url_is_welcome_banner_present == false) {
                display_welcome_banner = false
            }

            if (welcome_banner_list.length && display_welcome_banner == true) {
                is_welcome_banner_present = true;
                add_banner_based_on_theme(welcome_banner_list, is_automatic_carousel_enabled, carousel_time);
            } else if (EASYCHAT_BOT_THEME == 'theme_4') {
                $('#easychat-bot-welcome-banner-parent').hide()
            }

            $('#botloader').hide();
            // prev_session_id = get_cookie("easychat_prev_session_id");

            message_list = get_message_list(welcome_message, RESPONSE_SENTENCE_SEPARATOR);

            if (is_web_landing_allowed == "false") {
                for (var i = 0; i < message_list.length; i++) {
                    append_bot_text_response(message_list[i], undefined, true);
                }
                reset_size_of_text_field(message_list.length);
            } else if (is_web_landing_allowed == "true" && web_url_is_welcome_message_present == true) {
                for (var i = 0; i < message_list.length; i++) {
                    append_bot_text_response(message_list[i], undefined, true);
                }
                reset_size_of_text_field(message_list.length);
            }

            // append_quick_menu_items(quick_items); 

            hide_bot_typing_loader();


            if (welcome_msg_videos != null && welcome_msg_videos != undefined && welcome_msg_videos.length > 0) {
                if (is_web_landing_allowed == "false") {
                    append_bot_slider_videos(welcome_msg_videos);
                } else if (is_web_landing_allowed == "true" && web_url_initial_videos_present == true) {
                    append_bot_slider_videos(welcome_msg_videos);
                }
            }

            if (welcome_msg_images != null && welcome_msg_images != undefined && welcome_msg_images.length > 0) {
                if (is_web_landing_allowed == "false") {
                    append_bot_slider_images(welcome_msg_images, welcome_msg_compressed_imgs);
                } else if (is_web_landing_allowed == "true" && web_url_initial_image_present == true) {
                    append_bot_slider_images(welcome_msg_images, welcome_msg_compressed_imgs);
                }
            }

            if (EASYCHAT_BOT_THEME == "theme_3") {
                // in theme 3 welcome message is not displayed
                if (is_welcome_screen_present() && is_web_landing_allowed == "true" && web_url_initial_videos_present == true) {
                    $(".easychat-bot-message-div").css("display", "none")
                    $(".easychat-slider-wrapper").css("display", "none")
                } else if (is_welcome_screen_present() && is_web_landing_allowed == "false") {
                    $(".easychat-bot-message-div").css("display", "none")
                    $(".easychat-slider-wrapper").css("display", "none")
                }

                if (!is_welcome_screen_present()) {
                    toogle_sticky_menu_for_theme_three("block")
                }
                else{
                    toogle_sticky_menu_for_theme_three("none")
                }
            }
            if (EASYCHAT_BOT_THEME == "theme_4"){
                if (!is_welcome_screen_present()) {
                    toogle_sticky_menu_for_theme_three("block")
                }
                else{
                    toogle_sticky_menu_for_theme_three("none")
                }
            }

            if (recommendations.length > 0) {

                set_cookie("is_recommendation_menu", "false")
                append_bot_initial_question_based_on_theme(is_web_landing_allowed, recommendations, web_url_initial_intent_present)

            }

            speech_welcome_message = response['speech_welcome_message']
            if (easychat_prev_session_id != "") {

                getPrevSessionHistory(easychat_prev_session_id, speech_welcome_message, is_text_to_speech_required);

            } else if (is_text_to_speech_required) {
                text_to_speech(speech_welcome_message); 
            }

            if (bot_inactivity_detection_enabled && bot_inactivity_detection_required) {

                reset_bot_inactivity_timer()

            }

            if (EASYCHAT_BOT_THEME == 'theme_4') {
                append_faq_intents(response.faq_intents)
            }

            if (is_web_landing_allowed == "false") {

                if (response["initial_intent"] != null && is_initial_trigger_intent.toString() == 'false' && is_first_query) {
                    initial_intent_in_welcome_message = true
                    cancel_text_to_speech_response = false
                    is_initial_intent = true
                    entered_suggestion = true;
                    send_message_to_server(response["initial_intent"], user_id, bot_id, bot_name, "None")
                    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
                        document.getElementById("easychat-query-mic-send-icon-wrapper").style.pointerEvents = "auto"
                        remove_banner_and_fix_navbar();
                    }
                    initial_intent_in_welcome_message = false
                }

            }

            is_bot_response_message_showed = true;

            if (is_initial_trigger_intent == 'true') {
                is_initial_trigger_intent = true
                is_manually_typed_query = false;
                setTimeout(function () {
                    send_user_input(easychat_intent_name);
                }, 200);
            }

            welcome_message_appended = true
            if (check_element_exists("user_input")) {
                // document.getElementById("user_input").disabled = true;
                if (!is_widgets) {
                    document.getElementById("user_input").disabled = false;
                }
            }
            if (!is_widgets) {
                detectmob();
            }

            if (url_parameters["query_question"]) {
                welcome_banner_query_question = decodeURIComponent(url_parameters["query_question"]);
            }
            if (welcome_banner_query_question != null && welcome_banner_query_question != undefined && welcome_banner_query_question != "" && welcome_banner_query_question != "INTENT_NAME") {
                setTimeout(trigger_welcome_banner_query_question, 500);
            }

            if (external_trigger_intent_info != null && external_trigger_intent_info != undefined && external_trigger_intent_info != "" && external_trigger_intent_info != "INTENT_INFO") {
                trigger_external_intent(external_trigger_intent_info);
                external_trigger_intent_info = "INTENT_INFO";
            }
        }
    }
    xhttp.send(params);
}

function remove_widgets() {
    $('.easychat-radio-button-container:not(.easychat-widget-disabled)').remove()
    $('.easychat-range-slider-wrapper:not(.easychat-widget-disabled)').remove()
    $('.easychat-drop-down-container:not(.easychat-widget-disabled)').remove()
    $('.easychat-check-box-container:not(.easychat-widget-disabled)').remove()
    $('.easychat-country-code-submit-btn-wrapper:not(.easychat-widget-disabled,.form-widget)').remove()
    $(".easychat-form-container:not(.easychat-widget-disabled)").remove()
    $(".easychat-dragdropContainer__XPS:not(.easychat-widget-disabled,.form-widget)").remove()

    is_remove_widget = false;
}

function get_user_input_based_on_theme() {

    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        user_input = $('#user_input').text().trim();
        user_input = user_input.replace(/\u200B/g, '');
    } else {
        user_input = document.getElementById("user_input").value.trim();
    }

    return user_input
}

function empty_user_input_based_on_theme() {

    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {

        document.getElementById('user_input').innerText = ""
        document.getElementById("easychat-query-send-icon").style.display = "none";
        document.getElementById("easychat-mic-icon").style.display = "flex";
        document.getElementById("user_input_placeholder_text").style.visibility = "visible";
        document.getElementById("tooltip-mic-send-text").classList.remove("tooltip-send-only-text");
        document.getElementById("tooltip-mic-send-text").innerHTML = MIC_BUTTON_TOOLTIP;

        enable_footer_widget_response_theme3_and_theme4();
        check_and_disable_mic_state_for_theme_three();
        if (EASYCHAT_BOT_THEME == "theme_4" && !mic_access) {
            $("#easychat-mic-icon, #tooltip-mic-send-text").hide()
        }
    } else {

        if (document.getElementById("user_input") !== null || document.getElementById("user_input") !== undefined) {
            document.getElementById("user_input").value = "";
        }
        if (is_widgets) {
            if (EASYCHAT_BOT_THEME == "theme_1"){
                enable_footer_widget_response_theme_1();
            }
            else if (EASYCHAT_BOT_THEME == "theme_2"){
                enable_footer_widget_response_theme_2();
            }
        }

        
    }

}

function edit_user_input_based_on_theme_android(user_input) {

    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {

        document.getElementById('user_input').innerText += " " + user_input
        document.getElementById("user_input_placeholder_text").style.visibility = "hidden";


    } else {

        if (document.getElementById("user_input") !== null || document.getElementById("user_input") !== undefined) {
            document.getElementById("user_input").value += " " + user_input;
        }

    }

    deactivate_mic_android()
    activate_query_submit_button()
}



function edit_user_input_based_on_theme(user_input) {

    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {

        document.getElementById('user_input').innerText = user_input
        document.getElementById("user_input_placeholder_text").style.visibility = "hidden";
        position_cursor();

        if (user_input.trim() != "") {
            display_query_send_button_for_theme_three();
        }

    } else {

        if (document.getElementById("user_input") !== null || document.getElementById("user_input") !== undefined) {
            document.getElementById("user_input").value = user_input;
        }

    }

}


function send_message() {

    var user_input = get_user_input_based_on_theme();

    if (user_input.length == 0) {
        return;
    }

    if (is_remove_widget == true) {
        remove_widgets();
    }

    empty_user_input_based_on_theme();
    send_user_input(user_input);

}

function get_user_query_and_handle_send_button(input_element) {

    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        var user_query = input_element.innerText.trim();

        if (user_query != "") {
            show_query_send_button();
        } else {
            hide_query_send_button();
            check_and_disable_mic_state_for_theme_three();
        }
        if(input_element.textContent === ""){
            document.getElementById("user_input_placeholder_text").style.visibility = "visible";
        }
    } else {

        var user_query = input_element.value.trim();

        if (user_query != "") {
            activate_query_submit_button();
        } else {
            deactivate_query_submit_button();
        }

    }

    return user_query
}

document.onkeyup = function (e) {
    e = e || window.event;
    var input_element = document.getElementById("user_input");
    user_query = get_user_query_and_handle_send_button(input_element);

    if (is_livechat && user_query != "") {
        send_typing_message_to_agent();
    }

    maxlength = input_element.maxlength;
    if (user_query.length > maxlength) {
        restricted_value = user_query.substr(0, maxlength);
        input_element.value = restricted_value;
    }

    if (e.keyCode == 13) {
        send_message();
    }
}

function confirm_do_not_disturb() {
    append_bot_text_response(DO_NOT_DISTURB_CONFIRMATION_TEXT);
    var choices_html = '<div class="easychat-choices-wrapper">';
    choices_html += '<button class="easychat-choices" onmouseover="custom_button_change(this)" onmouseout="custom_button_change_normal(this)" style=\"border: 0.05em solid ' + BOT_THEME_COLOR + ';color: ' + BOT_THEME_COLOR + '\" value="Yes" onclick="disable_form_assist(this)">' + YES + '</button>';
    choices_html += '<button class="easychat-choices" onmouseover="custom_button_change(this)" onmouseout="custom_button_change_normal(this)" style=\"border: 0.05em solid ' + BOT_THEME_COLOR + ';color: ' + BOT_THEME_COLOR + '\" value="No" onclick="nothing_form_assist(this)">' + NO + '</button>';
    choices_html += "</div>";
    $("#easychat-chat-container").append(choices_html);
}

function disable_form_assist(element) {
    parent.postMessage('disable-form-assist', '*');
}

function nothing_form_assist(element) {
    append_bot_text_response(DO_NOT_DISTURB_DENIED_TEXT);
}

function send_selected_initial_question(element) {
    var user_input = element.innerText;
    var intent_id = element.dataset.id

    entered_suggestion = true;
    if (do_not_disturb == "true") {
        if (user_input.toLowerCase().trim() == "do not disturb") {
            confirm_do_not_disturb();
        }
        do_not_disturb = "false";
    } else {

        send_user_input(user_input, intent_id);
        element.remove();
    }
}


function send_selected_recommendation(element) {
    remove_widgets();
    var user_input = element.innerText;
    var intent_id = element.dataset.id

    entered_suggestion = true;
    if (do_not_disturb == "true") {
        if (user_input.toLowerCase().trim() == "do not disturb") {
            // show_form_assist_result();
            // do_not_disturb = "false"
            // form_assist_enabled = true
            // document.getElementsByClassName("easychat-recommendation")[0].style.pointerEvents = "none"
            // document.getElementsByClassName("easychat-recommendation")[1].style.pointerEvents = "none"
            // parent.postMessage('enable-form-assist','*');
            confirm_do_not_disturb();
        } else {
            // do_not_disturb = "true"
            // form_assist_enabled = false
            // document.getElementsByClassName("easychat-recommendation")[0].style.pointerEvents = "none"
            // document.getElementsByClassName("easychat-recommendation")[1].style.pointerEvents = "none"
            // append_welcome_message(bot_id, bot_name);
            // get_suggestion_list(bot_id, bot_name);
        }
        do_not_disturb = "false";
    } else {
        // var user_input = element.innerHTML;

        let list_of_el = document.getElementsByClassName("easychat-choices-wrapper");
        var last_choice_wrapper = list_of_el[list_of_el.length - 1]
        if ((typeof last_choice_wrapper !== 'undefined')) {
            for (var i = 0; i < last_choice_wrapper.children.length; i++) {
                if (last_choice_wrapper.children[i].hasAttribute("onclick")) { last_choice_wrapper.children[i].removeAttribute("onclick") }
                if (last_choice_wrapper.children[i].hasAttribute("onmouseout")) { last_choice_wrapper.children[i].removeAttribute("onmouseout") }
                if (last_choice_wrapper.children[i].hasAttribute("onmouseover")) { last_choice_wrapper.children[i].removeAttribute("onmouseover") }
                last_choice_wrapper.children[i].style.opacity = 0.5;
                last_choice_wrapper.children[i].style.cursor = "default";
            }
        }


        for (var i = 0; i < element.parentElement.children.length; i++) {
            if (element.parentElement.children[i].hasAttribute("onclick")) { element.parentElement.children[i].removeAttribute("onclick") }
            if (element.parentElement.children[i].hasAttribute("onmouseout")) { element.parentElement.children[i].removeAttribute("onmouseout") }
            if (element.parentElement.children[i].hasAttribute("onmouseover")) { element.parentElement.children[i].removeAttribute("onmouseover") }
            element.parentElement.children[i].style.opacity = 0.5;
            element.parentElement.children[i].style.cursor = 'default';
        }

        if (element.classList.contains("easychat-recommendation-menu")) {
            custom_button_change(element);
        }

        disable_intent_icons();
        send_user_input(user_input, intent_id);
    }
}

function send_selected_choice(element) {
    remove_widgets();
    var user_input = element.value;
    let list_of_el = document.getElementsByClassName("easychat-recommendation-wrapper");
    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        list_of_el = document.getElementsByClassName("easychat-bot-quick-recommendation-wrapper");
    }
    var last_recomendation_wrapper = list_of_el[list_of_el.length - 1]
    if ((typeof last_recomendation_wrapper !== 'undefined')) {
        for (var i = 0; i < last_recomendation_wrapper.children.length; i++) {
            if (last_recomendation_wrapper.children[i].hasAttribute("onclick")) { last_recomendation_wrapper.children[i].removeAttribute("onclick") }
            if (last_recomendation_wrapper.children[i].hasAttribute("onmouseout")) { last_recomendation_wrapper.children[i].removeAttribute("onmouseout") }
            if (last_recomendation_wrapper.children[i].hasAttribute("onmouseover")) { last_recomendation_wrapper.children[i].removeAttribute("onmouseover") }
            last_recomendation_wrapper.children[i].style.opacity = 0.5;
            last_recomendation_wrapper.children[i].style.cursor = "default";
        }
    }
    for (var i = 0; i < element.parentElement.children.length; i++) {
        if (element.parentElement.children[i].hasAttribute("onclick")) { element.parentElement.children[i].removeAttribute("onclick") }
        if (element.parentElement.children[i].hasAttribute("onmouseout")) { element.parentElement.children[i].removeAttribute("onmouseout") }
        if (element.parentElement.children[i].hasAttribute("onmouseover")) { element.parentElement.children[i].removeAttribute("onmouseover") }
        element.parentElement.children[i].style.opacity = 0.5;
        element.parentElement.children[i].style.cursor = 'default';
    }

    disable_intent_icons();
    send_user_input(user_input);
}

function disable_choices() {
    var list_of_el = document.getElementsByClassName("easychat-choices-wrapper");
    var last_choice_wrapper = list_of_el[list_of_el.length - 1]
    if ((typeof last_choice_wrapper !== 'undefined')) {
        for (var i = 0; i < last_choice_wrapper.children.length; i++) {
            if (last_choice_wrapper.children[i].hasAttribute("onclick")) { last_choice_wrapper.children[i].removeAttribute("onclick") }
            if (last_choice_wrapper.children[i].hasAttribute("onmouseout")) { last_choice_wrapper.children[i].removeAttribute("onmouseout") }
            if (last_choice_wrapper.children[i].hasAttribute("onmouseover")) { last_choice_wrapper.children[i].removeAttribute("onmouseover") }
            last_choice_wrapper.children[i].style.opacity = 0.5;
            last_choice_wrapper.children[i].style.cursor = "default";
        }
    }
}

function disable_intent_icons(intent_icon_wrapper) {
    if (!intent_icon_wrapper) {
        var intent_icon_wrappers = document.getElementsByClassName("easychat-image-intent-recommendation-wrapper");
        intent_icon_wrapper = intent_icon_wrappers[intent_icon_wrappers.length - 1];
    }

    if (intent_icon_wrapper) {
        for (var i = 0; i < intent_icon_wrapper.children.length; i++) {
            intent_icon_wrapper.children[i].removeAttribute("onclick");
            intent_icon_wrapper.children[i].style.opacity = "0.5";
            intent_icon_wrapper.children[i].classList.add("easychat-image-intent-item-disabled");
        }
    }
}

function send_selected_intent_icon_recommendation(element) {
    remove_widgets()
    disable_intent_icons(element.parentElement);
    disable_choices();
    entered_suggestion = true;
    var user_input = element.getAttribute("intent-name");
    var intent_id = element.getAttribute("intent-id");
    if (user_input == GO_BACK_TEXT) {
        intent_id = undefined;
    }
    send_user_input(user_input, intent_id);
}

if (!('webkitSpeechRecognition' in window)) {
    try {
        document.getElementById("easychat-mic-div").remove();
        document.getElementById("easychat-mic-disable").style.display = "none";
    } catch (err) {

    }


    try {
        document.getElementById('user-input-div').style.marginRight = '15px';
    } catch (err) { }


    setTimeout(function () {

        if (EASYCHAT_BOT_THEME == "theme_1") {
            document.getElementById('easychat-mic-div-not-allowed').style.display = 'flex';
        }
        recognition = null;
        mic_access = false;
        hide_mic_icon();
    }, 1000);
    //document.getElementById("recognition-img").display="none";
} else {

    if (EASYCHAT_BOT_THEME == "theme_1") {
        var stream;
        navigator.mediaDevices.getUserMedia({ audio: true })
            .then(function (s) {
                return stream = s;
            }, function (e) {
                if (e.message === 'Permission denied') {
                    mic_access = false;
                    document.getElementById('easychat-mic-div').style.display = 'none';
                    document.getElementById('easychat-mic-div-not-allowed').style.display = 'flex';
                }
            })
            .catch(function (e) { console.log(e); });
    }
    // start_button.style.display = 'inline-block';
    var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition
    recognition = new SpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = true;

    recognition.onstart = function () {
        recognizing = true;
    };

    recognition.onerror = function (event) {
        if (event.error == 'no-speech') {
            ignore_onend = true;
        }
        if (event.error == 'audio-capture') {
            ignore_onend = true;
        }
        if (event.error == 'not-allowed') {
            ignore_onend = true;
            recognition = null;
            deactivate_mic();
            alert("You will not be able to use voicebot feature as you haven't allowed microphone access.");
        }
    };

    recognition.onend = function () {
        recognizing = false;
        if (ignore_onend) {
            return;
        }
        if (!final_transcript) {
            return;
        }
    };

    recognition.onresult = function (event) {
        // document.getElementById('user_input').value = event.results[0][0].transcript;
        edit_user_input_based_on_theme(event.results[0][0].transcript)
        send_typing_message_to_agent();
        if (event.results[0].isFinal) {
            // user_input = document.getElementById('user_input').value;
            user_input = get_user_input_based_on_theme();
            if (user_input.trim() != '' && user_input.length < 300) {
                send_user_input(user_input);
            }
            recognition.stop();
            empty_user_input_based_on_theme()
        }
    };
    if (get_browser_name() == "safari") {
        recognition = null;
    }
}

function initMap() {
    var current_latitude = "";
    var current_longitude = "";

    if (("geolocation" in navigator)) {
        navigator.geolocation.getCurrentPosition(
            function success(position) {
                current_latitude = position.coords.latitude
                current_longitude = position.coords.longitude

                var map = new google.maps.Map(document.getElementById('map'), {
                    center: { lat: current_latitude, lng: current_longitude },
                    zoom: 15
                });

                var request = {
                    placeId: 'ChIJN1t_tDeuEmsRUsoyG83frY4',
                    fields: ['name', 'formatted_address', 'place_id', 'geometry']
                };

                var infowindow = new google.maps.InfoWindow();
                var service = new google.maps.places.PlacesService(map);

                service.getDetails(request, function (place, status) {
                    if (status === google.maps.places.PlacesServiceStatus.OK) {
                        marker = new google.maps.Marker({
                            map: map,
                            position: place.geometry.location
                        });

                        marker.setPosition(map.getCenter())

                        var centerControlDiv = document.createElement("div");
                        var centerControl = new CenterControl(centerControlDiv, map);
                        centerControlDiv.index = 1;
                        map.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(centerControlDiv);
                    }
                });

                function CenterControl(controlDiv, map) {
                    var controlUI = document.createElement("div");
                    controlUI.style.backgroundColor = "#fff";
                    controlUI.style.border = "2px solid #fff";
                    controlUI.style.borderRadius = "3px";
                    controlUI.style.boxShadow = "0 2px 6px rgba(0,0,0,.3)";
                    controlUI.style.cursor = "pointer";
                    controlUI.style.marginBottom = "22px";
                    controlUI.style.textAlign = "center";
                    controlUI.title = "Click to Submit the location";
                    controlDiv.appendChild(controlUI);
                    // Set CSS for the control interior.\
                    var controlText = document.createElement("div");
                    controlText.style.color = "rgb(25,25,25)";
                    controlText.style.fontFamily = "Roboto,Arial,sans-serif";
                    controlText.style.fontSize = "16px";
                    controlText.style.lineHeight = "38px";
                    controlText.style.paddingLeft = "5px";
                    controlText.style.paddingRight = "5px";
                    controlText.innerHTML = "Click here to submit your location";
                    controlUI.appendChild(controlText);
                    // Setup the click event listeners: simply set the map to Chicago.\
                    controlUI.addEventListener("click", function () {
                        var lat = marker.getPosition().lat();
                        var lng = marker.getPosition().lng();
                        user_input = lat + "__" + lng;
                        send_message_to_server(user_input, user_id, bot_id, bot_name, "None");
                        scroll_to_bottom();
                    });
                }
            },
            function error(error_message) {
                // for when getting location results in an error
                console.error('An error has occured while retrieving' +
                    'location before', error_message)
                document.getElementById("google-map").remove();
                append_bot_text_response("Unable to fetch your location details.");
                send_message_to_server("Share Pincode", user_id, bot_id, bot_name, "None");
            });
    } else {
        document.getElementById("google-map").remove();
        append_bot_text_response("Unable to fetch your location details.");
        send_message_to_server("Share Pincode", user_id, bot_id, bot_name, "None");
    }
}

/*

// Commenting this older approach for future uses
function autocomplete(inp, arr, word_mapper_list) {
    var currentFocus;
    inp.addEventListener("input", function(e) {
        var a, b, i, val = this.value;
        closeAllLists();
        if (!val) { return false; }
        currentFocus = -1;
        a = document.createElement("DIV");
        a.setAttribute("id", this.id + "autocomplete-list");
        a.setAttribute("class", "autocomplete-items");
        this.parentNode.appendChild(a);

        for (var word_index = 0; word_index < word_mapper_list.length; word_index++) {
            for (var s_index = 0; s_index < word_mapper_list[word_index]["similar_words"].length; s_index++) {
                if (word_mapper_list[word_index]["similar_words"][s_index].toLowerCase() == val.toLowerCase()) {
                    //similar_word_list.push(word_mapper_list[word_index]["keyword"].toLowerCase());
                    val = word_mapper_list[word_index]["keyword"].toLowerCase();
                }
            }
        }

        var count = 0;
        arr_value_list = []
        for (i = 0; i < arr.length; i++) {
            if (is_flow_ended && count < 5 && is_livechat == false) {
                if (arr[i]["key"].toUpperCase().indexOf(val.toUpperCase()) != -1 && arr_value_list.indexOf(arr[i]["value"]) < 0) {
                    b = document.createElement("DIV");
                    arr_value_list.push(arr[i]["value"]);
                    b.innerHTML = "" + arr[i]["value"].substr(0, val.length) + "";
                    b.innerHTML += arr[i]["value"].substr(val.length);
                    //b.innerHTML += "<input type='hidden' value='" + arr[i]["value"] + "'>";
                    b.innerHTML += '<input type="hidden" value="' + arr[i]["value"] + '">';
                    b.addEventListener("click", function(e) {
                        inp.value = this.getElementsByTagName("input")[0].value;
                        closeAllLists();
                        entered_suggestion = true
                        send_user_input(inp.value);
                        inp.value = "";
                    });
                    a.appendChild(b);
                    count += 1;
                }
            }
        }

        if (count == 0) {

            token_list = val.split(" ");

            query_token_list = token_list.filter(function(e) { return e != ""; });

            if (query_token_list.length == 0) {
                return;
            }

            split_val = 1
            while( split_val <= query_token_list.length ){

                val = query_token_list[query_token_list.length - split_val];
                
                arr_value_list = [];

                for (i = 0; i < arr.length; i++) {

                    if (is_flow_ended && count < 5 && is_livechat == false) {
                        if (arr[i]["key"].toUpperCase().indexOf(val.toUpperCase()) != -1 && arr_value_list.indexOf(arr[i]["value"]) < 0) {
                            b = document.createElement("DIV");
                            arr_value_list.push(arr[i]["value"]); 
                            b.innerHTML = "" + arr[i]["value"].substr(0, val.length) + "";
                            b.innerHTML += arr[i]["value"].substr(val.length);
                            b.innerHTML += "<input type='hidden' value='" + arr[i]["value"] + "'>";
                            b.addEventListener("click", function(e) {
                                inp.value = this.getElementsByTagName("input")[0].value;
                                closeAllLists();

                                send_user_input(inp.value);
                                inp.value = "";
                            });
                            a.appendChild(b);
                            count += 1;
                        }
                    }
                }

                if(count == 0){
                    split_val += 1
                }else{
                    break;
                }
            }
        }
    });

    inp.addEventListener("keydown", function(e) {
        var x = document.getElementById(this.id + "autocomplete-list");
        if (x) x = x.getElementsByTagName("div");
        if (e.keyCode == 40) {
            
            currentFocus++;
           
            addActive(x);
        } else if (e.keyCode == 38) { //up
            
            currentFocus--;

            addActive(x);
        } else if (e.keyCode == 13) {
            e.preventDefault();
            if (currentFocus > -1) {
                if (x) x[currentFocus].click();
            }
        }
    });

    function addActive(x) {
        if (!x) return false;
        removeActive(x);
        if (currentFocus >= x.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = (x.length - 1);
        x[currentFocus].classList.add("autocomplete-active");
    }

    function removeActive(x) {
        for (var i = 0; i < x.length; i++) {
            x[i].classList.remove("autocomplete-active");
        }
    }

    function closeAllLists(elmnt) {
        var x = document.getElementsByClassName("autocomplete-items");
        for (var i = 0; i < x.length; i++) {
            if (elmnt != x[i] && elmnt != inp) {
                x[i].parentNode.removeChild(x[i]);
            }
        }
    }
    document.addEventListener("click", function(e) {
        closeAllLists(e.target);
    });
}*/


function get_user_input_value_based_on_tag_type(inp) {

    if (inp.tagName == "DIV") {
        return inp.innerText;
    } else {
        return inp.value
    }

}

function edit_user_input_based_on_tag(inp, user_input) {
    if (inp.tagName == "DIV") {
        inp.innerText = user_input;
    } else {
        inp.value = user_input
    }
}

/*the autocomplete function takes two arguments,
the text field element and an array of possible autocompleted values:*/
function autocomplete(inp, arr, word_mapper_list) {
    var currentFocus;

    /*execute a function when someone writes in the text field:*/
    inp.addEventListener("input", temp_function_before_input)
    try {
        if (is_web_worker_supported) {
            worker_for.onmessage = function (event) {
                var data = JSON.parse(event.data);

                if (data.id == 'search_res') {
                    add_suggestions_html(data.value)
                }else if(data.id == 'check_and_update_suggestion_list'){
                    check_and_get_suggestions_in_index_db()   
                }
            }
        }
    } catch (err) {
        console.log(err)
    }
    var autocomplete_timer = null;
    function temp_function_before_input() {
        if (autocomplete_timer != null) {
            clearTimeout(autocomplete_timer);
        }

        autocomplete_timer = setTimeout(function () {
            try {
                if (is_web_worker_supported) {
                    var val = get_user_input_value_based_on_tag_type(inp);

                    if (!val || val.length < 2) {
                        closeAllLists();
                        return;
                    }

                    worker_for.postMessage(JSON.stringify({
                        id: 'search',
                        value: val,
                    }))
                } else {
                    add_suggestions_html();
                }
            } catch (err) {
                console.log(err)
            }
        }, 200);
    }

    function add_suggestions_html(results_fuzzy) {
        var a, b, i, val = get_user_input_value_based_on_tag_type(inp);

        /*close any already open lists of autocompleted values*/
        closeAllLists();
        if (!val) {
            return false;
        }
        if (val.length >= 2) {

            if (is_flow_ended && is_livechat == false) {

                currentFocus = -1;
                a = get_suggestion_box_html(inp);

                val = check_and_get_similar_word(val);

                var count = 0;
                arr_value_list = []
                already_added_keys = []

                if (!is_web_worker_supported) {
                    if(!fuzzyhound.source){
                        check_and_get_suggestions_in_index_db()
                        initalize_fuzzy_search()
                    }
                    fuzzyhound.search(val)
                    results_fuzzy = fuzzyhound.results
                    results_fuzzy.sort(function (first, second) {
                        return second["_item"]["count"] - first["_item"]["count"];
                    });
                }

                for (var i = 0; i < results_fuzzy.length; i++) {
                    if (already_added_keys.indexOf(results_fuzzy[i]["_item"]["value"].toLowerCase()) == -1 && results_fuzzy[i]["_score"] >= 7) {
                        already_added_keys.push(results_fuzzy[i]["_item"]["value"].toLowerCase())
                        count += 1;
                        if (count >= 6) {
                            break;
                        }
                        b = document.createElement("DIV");
                        /*make the matching letters bold:*/
                        b.innerHTML = "" + results_fuzzy[i]["_item"]["value"].substr(0, results_fuzzy[i]["_item"]["value"].length) + "";
                        b.innerHTML += results_fuzzy[i]["_item"]["value"].substr(results_fuzzy[i]["_item"]["value"].length);
                        /*insert a input field that will hold the current array item's value:*/
                        //b.innerHTML += "<input type='hidden' value='" + arr[i]["value"] + "'>";
                        b.innerHTML += '<input type="hidden" value="' + results_fuzzy[i]["_item"]["value"] + '" data-id=' + results_fuzzy[i]["_item"]["pk"] + '>';
                        //execute a function when someone clicks on the item value (DIV element):
                        b.addEventListener("click", function (e) {
                            /*insert the value for the autocomplete text field:*/
                            // inp.value = this.getElementsByTagName("input")[0].value;
                            user_inp = this.getElementsByTagName("input")[0].value;
                            edit_user_input_based_on_tag(inp, user_inp)
                            id = this.getElementsByTagName("input")[0].dataset.id;
                            /*close the list of autocompleted values,
                            (or any other open lists of autocompleted values:*/
                            closeAllLists();
                            entered_suggestion = true
                            user_inp = get_user_input_value_based_on_tag_type(inp)
                            send_user_input(user_inp, id);
                            // inp.value = "";
                            edit_user_input_based_on_tag(inp, "")
                        });
                        a.appendChild(b);
                    }
                }
            }
        }

        /*Empty suggestion list check*/
        if (count == 0) {

            token_list = val.split(" ");

            query_token_list = token_list.filter(function (e) { return e != ""; });

            if (query_token_list.length == 0) {
                return;
            }

            arr_value_list = [];
            filtered_arr_value = []
            split_val = 1
            while (split_val <= query_token_list.length) {

                val = query_token_list[query_token_list.length - split_val];

                for (i = 0; i < arr.length; i++) {

                    if (is_flow_ended && is_livechat == false) {
                        /*check if the item starts with the same letters as the text field value:*/
                        if (arr[i]["key"].toUpperCase().indexOf(val.toUpperCase()) != -1 && arr_value_list.indexOf(arr[i]["value"]) < 0) {
                            // Creating a dictionary with intent and it's count
                            if (!filtered_arr_value.some(function (e) { return e.key == arr[i]["value"]; })) {
                                filtered_arr_value.push({ "key": arr[i]["value"], "count": arr[i]["count"] })
                                count += 1;
                            }
                        }
                    }
                }
                split_val += 1;
            }

            /* if suggestion list is not empty */
            if (filtered_arr_value.length > 0) {

                // Sorting the intent in descending order
                filtered_arr_value.sort(function (first, second) {
                    return second.count - first.count;
                });

                for (var value in filtered_arr_value) {
                    b = document.createElement("DIV");
                    /*make the matching letters bold:*/
                    b.innerHTML = "" + filtered_arr_value[value]["key"].substr(0, val.length) + "";
                    b.innerHTML += filtered_arr_value[value]["key"].substr(val.length);

                    /*insert a input field that will hold the current array item's value:*/
                    //b.innerHTML += "<input type='hidden' value='" + arr[i]["value"] + "'>";

                    b.innerHTML += '<input type="hidden" value="' + filtered_arr_value[value]["key"] + '" data-id=' + results_fuzzy[i]["_item"]["pk"] + '>';
                    /*execute a function when someone clicks on the item value (DIV element):*/
                    b.addEventListener("click", function (e) {
                        /*insert the value for the autocomplete text field:*/
                        // inp.value = this.getElementsByTagName("input")[0].value;
                        user_inp = this.getElementsByTagName("input")[0].value;
                        edit_user_input_based_on_tag(inp, user_inp)
                        /*close the list of autocompleted values,
                        (or any other open lists of autocompleted values:*/
                        closeAllLists();
                        entered_suggestion = true
                        user_input = get_user_input_value_based_on_tag_type(inp);
                        send_user_input(user_input);
                        // inp.value = "";
                        edit_user_input_based_on_tag(inp, "")
                    });
                    a.appendChild(b);
                }
            }

        }
        if (EASYCHAT_BOT_THEME == "theme_4" && $('.user-input-autocomplete-list-wrapper div').length) {
            $('.user-input-autocomplete-list-wrapper').show()
        }
    }

    function get_suggestion_box_html(inp) {

        var el = document.createElement("DIV");
        el.setAttribute("id", inp.id + "autocomplete-list");
        el.setAttribute("class", "autocomplete-items");
        if (EASYCHAT_BOT_THEME == 'theme_4') {
            $('.easychat-bot-footer-input-wrapper').append(el)
            let suggestions_wrapper = document.createElement("DIV")
            suggestions_wrapper.setAttribute("class", "user-input-autocomplete-list-wrapper");
            suggestions_wrapper.setAttribute("id", "user_input_autocomplete_list_wrapper");
            el.appendChild(suggestions_wrapper)
            return suggestions_wrapper
        } else {
            inp.parentNode.appendChild(el);
        }
        return el;
    }

    function check_and_get_similar_word(val) {
        for (var word_index = 0; word_index < word_mapper_list.length; word_index++) {
            for (var s_index = 0; s_index < word_mapper_list[word_index]["similar_words"].length; s_index++) {
                if (word_mapper_list[word_index]["similar_words"][s_index].toLowerCase() == val.toLowerCase()) {
                    val = word_mapper_list[word_index]["keyword"].toLowerCase();
                }
            }
        }

        return val;
    }

    /*execute a function presses a key on the keyboard:*/
    inp.addEventListener("keydown", function (e) {
        let autocomplete_parent_div = document.getElementById(this.id + "autocomplete-list");
        if (EASYCHAT_BOT_THEME == "theme_4") {
            autocomplete_parent_div = document.getElementById("user_input_autocomplete_list_wrapper");
        }
        if (autocomplete_parent_div) autocomplete_parent_div = autocomplete_parent_div.getElementsByTagName("div");
        if (e.keyCode == 40) {
            /*If the arrow DOWN key is pressed,
            increase the currentFocus variable:*/
            currentFocus++;
            /*and and make the current item more visible:*/
            addActive(autocomplete_parent_div);
        } else if (e.keyCode == 38) { //up
            /*If the arrow UP key is pressed,
            decrease the currentFocus variable:*/
            currentFocus--;
            /*and and make the current item more visible:*/
            addActive(autocomplete_parent_div);
        } else if (e.keyCode == 13) {
            /*If the ENTER key is pressed, prevent the form from being submitted,*/

            e.preventDefault();
            if (currentFocus > -1) {
                /*and simulate a click on the "active" item:*/
                if (autocomplete_parent_div) autocomplete_parent_div[currentFocus].click();
                currentFocus = -1;
            }
        }
    });
    function addActive(x) {
        /*a function to classify an item as "active":*/
        if (!x) return false;
        /*start by removing the "active" class on all items:*/
        removeActive(x);
        if (currentFocus >= x.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = (x.length - 1);
        /*add class "autocomplete-active":*/
        x[currentFocus].classList.add("autocomplete-active");
        if (navigator.userAgent.indexOf("Firefox") != -1) {
            x[currentFocus].scrollIntoView({ behaviour: 'smooth', block: 'nearest' });
        }
        else {
            x[currentFocus].scrollIntoViewIfNeeded();
        }
    }

    function removeActive(x) {
        /*a function to remove the "active" class from all autocomplete items:*/
        for (var i = 0; i < x.length; i++) {
            x[i].classList.remove("autocomplete-active");
        }
    }

    function closeAllLists(elmnt) {
        /*close all autocomplete lists in the document,
        except the one passed as an argument:*/
        var x = document.getElementsByClassName("autocomplete-items");
        for (var i = 0; i < x.length; i++) {
            if (elmnt != x[i] && elmnt != inp) {
                x[i].parentNode.removeChild(x[i]);
            }
        }
    }
    /*execute a function when someone clicks in the document:*/
    document.addEventListener("click", function (e) {
        closeAllLists(e.target);
    });
}

function custom_autocomplete(inp, arr) {
    /*the autocomplete function takes two arguments,
    the text field element and an array of possible autocompleted values:*/
    var currentFocus;
    /*execute a function when someone writes in the text field:*/
    inp.addEventListener("input", function (e) {
        var a, b, i, val = this.value;
        /*close any already open lists of autocompleted values*/
        closeAllLists();
        if (!val) { return false; }
        if (val.length == 2 && is_custom_complete) { get_quotes_suggestions(val) }
        currentFocus = -1;

        a = document.createElement("DIV");
        a.setAttribute("id", this.id + "autocomplete-list");
        a.setAttribute("class", "autocomplete-items");
        /*append the DIV element as a child of the autocomplete container:*/
        this.parentNode.appendChild(a);
        /*for each item in the array...*/
        var count = 0;

        //console.log(arr)
        arr_value_list = []
        arr = code_list
        for (i = 0; i < arr.length; i++) {
            if (is_custom_complete && count < 5 && is_livechat == false) {
                //console.log(arr[i])
                /*check if the item starts with the same letters as the text field value:*/
                if (arr[i]["key"].toUpperCase().indexOf(val.toUpperCase()) != -1 && arr_value_list.indexOf(arr[i]["value"]) < 0) {
                    /*create a DIV element for each matching element:*/
                    b = document.createElement("DIV");
                    arr_value_list.push(arr[i]["value"]);
                    /*make the matching letters bold:*/
                    b.innerHTML = "" + arr[i]["value"].substr(0, val.length) + "";
                    b.innerHTML += arr[i]["value"].substr(val.length);
                    /*insert a input field that will hold the current array item's value:*/
                    b.innerHTML += "<input type='hidden' value='" + arr[i]["value"] + "'>";
                    /*execute a function when someone clicks on the item value (DIV element):*/
                    b.addEventListener("click", function (e) {
                        /*insert the value for the autocomplete text field:*/
                        // inp.value = this.getElementsByTagName("input")[0].value;
                        user_inp = this.getElementsByTagName("input")[0].value;
                        edit_user_input_based_on_tag(inp, user_inp)

                        /*close the list of autocompleted values,
                        (or any other open lists of autocompleted values:*/
                        closeAllLists();
                        send_user_input(user_inp);
                        empty_user_input_based_on_theme();
                        // inp.value = "";
                    });
                    a.appendChild(b);
                    count += 1;
                }
            }
        }

        /*Empty suggestion list check*/
        if (count == 0) {

            token_list = val.split(" ");

            query_token_list = token_list.filter(function (e) { return e != ""; });

            if (query_token_list.length == 0) {
                return;
            }

            val = query_token_list[query_token_list.length - 1];

            arr_value_list = [];

            for (i = 0; i < arr.length; i++) {

                if (is_flow_ended && count < 5 && is_livechat == false) {
                    /*check if the item starts with the same letters as the text field value:*/
                    if (arr[i]["key"].toUpperCase().indexOf(val.toUpperCase()) != -1 && arr_value_list.indexOf(arr[i]["value"]) < 0) {
                        /*create a DIV element for each matching element:*/
                        b = document.createElement("DIV");
                        arr_value_list.push(arr[i]["value"]);
                        /*make the matching letters bold:*/
                        b.innerHTML = "" + arr[i]["value"].substr(0, val.length) + "";
                        b.innerHTML += arr[i]["value"].substr(val.length);
                        /*insert a input field that will hold the current array item's value:*/
                        b.innerHTML += "<input type='hidden' value='" + arr[i]["value"] + "'>";
                        /*execute a function when someone clicks on the item value (DIV element):*/
                        b.addEventListener("click", function (e) {
                            /*insert the value for the autocomplete text field:*/
                            // inp.value = this.getElementsByTagName("input")[0].value;
                            /*close the list of autocompleted values,
                            (or any other open lists of autocompleted values:*/
                            // send_user_input(inp.value);
                            // inp.value = "";
                            user_inp = this.getElementsByTagName("input")[0].value;
                            edit_user_input_based_on_tag(inp, user_inp)
                            /*close the list of autocompleted values,
                            (or any other open lists of autocompleted values:*/
                            closeAllLists();
                            send_user_input(user_inp);
                            empty_user_input_based_on_theme();
                        });
                        a.appendChild(b);
                        count += 1;
                    }
                }
            }
        }
    });
    /*execute a function presses a key on the keyboard:*/
    inp.addEventListener("keydown", function (e) {
        var x = document.getElementById(this.id + "autocomplete-list");
        if (x) x = x.getElementsByTagName("div");
        if (e.keyCode == 40) {
            /*If the arrow DOWN key is pressed,
            increase the currentFocus variable:*/
            currentFocus++;
            /*and and make the current item more visible:*/
            addActive(x);
        } else if (e.keyCode == 38) { //up
            /*If the arrow UP key is pressed,
            decrease the currentFocus variable:*/
            currentFocus--;
            /*and and make the current item more visible:*/
            addActive(x);
        } else if (e.keyCode == 13) {
            /*If the ENTER key is pressed, prevent the form from being submitted,*/

            e.preventDefault();
            if (currentFocus > -1) {
                /*and simulate a click on the "active" item:*/
                if (x) x[currentFocus].click();
                currentFocus = -1;
            }
        }
    });

    function addActive(x) {
        /*a function to classify an item as "active":*/
        if (!x) return false;
        /*start by removing the "active" class on all items:*/
        removeActive(x);
        if (currentFocus >= x.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = (x.length - 1);
        /*add class "autocomplete-active":*/
        x[currentFocus].classList.add("autocomplete-active");
    }

    function removeActive(x) {
        /*a function to remove the "active" class from all autocomplete items:*/
        for (var i = 0; i < x.length; i++) {
            x[i].classList.remove("autocomplete-active");
        }
    }

    function closeAllLists(elmnt) {
        /*close all autocomplete lists in the document,
        except the one passed as an argument:*/
        var x = document.getElementsByClassName("autocomplete-items");
        for (var i = 0; i < x.length; i++) {
            if (elmnt != x[i] && elmnt != inp) {
                x[i].parentNode.removeChild(x[i]);
            }
        }
    }
    /*execute a function when someone clicks in the document:*/
    document.addEventListener("click", function (e) {
        closeAllLists(e.target);
    });
}

function initalize_fuzzy_search(){
    fuzzyhound = new FuzzySearch({ output_limit: 20, output_map: "alias" });
    fuzzyhound.setOptions({
        source: suggestion_list,
        keys: ["key"],
        score_test_fused: true,
        score_per_token: true,
        score_acronym: true,
    })
}

function get_suggestion_list(bot_id, bot_name) {

    try {
        if (is_web_worker_supported) {
            worker_for = new Worker(window.location.protocol + '//' + window.location.host + '/static/EasyChatApp/js/worker.js')

            worker_for.postMessage(JSON.stringify({
                id: 'initialize',
            }))
        } else {
            open_local_db();
            if(suggestion_list.length == 0){
                check_and_get_suggestions_in_index_db()
            }
            initalize_fuzzy_search()

        }
    } catch (err) {
        console.log(err)
    }


    word_mapper_list = []
    autocorrect_bot_replace = []
    try {
        word_mapper_list = JSON.parse(window.localStorage['word_mapper_list'])
        autocorrect_bot_replace = JSON.parse(window.localStorage['autocorrect_bot_replace'])
    } catch (err) {
        console.log(err);
    }

    if (check_element_exists("user_input")) {
        autocomplete(document.getElementById("user_input"), suggestion_list, word_mapper_list);
    }
}



window.onresize = function () {
    changeMiddleContainer();
    resize_chabot_window();
    scroll_to_bottom();
}

function plusImageSlides(n, el) {
    slideIndex = parseInt(el.parentElement.getAttribute("value"))
    slideIndex += n
    el.parentElement.setAttribute("value", slideIndex.toString())
    showSlides(slideIndex, el.parentElement);
}

function showSlides(n, el) {
    var i;
    if(!(el instanceof Element)) return; // If element is not a DOM Object, function is returned
    slideIndex = parseInt(el.getAttribute("value"))
    var c = el.children
    var slides = []
    for (var i = 0; i < c.length; i++) {
        if (c[i].className == "mySlides fade easychat-slider-card") {
            slides.push(c[i])
        } else if (c[i].className == "mySlides fade") {
            slides.push(c[i])
        } else if (c[i].className == "mySlides fade easychat-slider-card easychat-pdf-search-card") {
            slides.push(c[i]);
        }
    }
    //var slides = document.getElementsByClassName("mySlides");
    if (n > slides.length) { el.setAttribute("value", "1") }
    if (n < 1) { el.setAttribute("value", (slides.length).toString()) }
    for (i = 0; i < slides.length; i++) {
        slides[i].style.display = "none";
    }
    slideIndex = parseInt(el.getAttribute("value"))
    slides[slideIndex - 1].style.display = "block";
}

function handle_welcome_page_banner(is_automatic_carousel_enabled, carousel_time) {

    var track = document.querySelector('.easychat-carousel-track');
    var slides = [];
    var track_children = Array.prototype.slice.call(track.children);
    track_children.forEach(function (eachChild) {
        slides.push(eachChild);
    })
    var dots_nav = document.querySelector(".easychat-carousel-nav");
    var dots_nav_children = Array.prototype.slice.call(dots_nav.children);
    var dots = [];
    dots_nav_children.forEach(function (eachChild) {
        dots.push(eachChild);
    });

    var slide_width = slides[0].getBoundingClientRect().width;

    // arranging slides next to one another

    slides.forEach(function (slide, index) {
        slide.style.left = (slide_width + 24) * index + 'px';
    })

    // Handling indicator click
    dots_nav.addEventListener('click', function (e) {

        var targetDot = e.target;
        try {
            targetDot = targetDot.closest('button');
        } catch (err) {

        }


        if (!targetDot) return;

        var currentSlide = track.querySelector('.easychat-current-slide');
        var currentDot = dots_nav.querySelector('.active-slide-indicator');

        var targetIndex = 0;
        for (var i = 0; i < dots.length; ++i) {
            if (dots[i] === targetDot) {
                targetIndex = i;
                break;
            }
        }
        var targetSlide = slides[targetIndex];

        move_to_slide(track, currentSlide, targetSlide);

        update_dots(currentDot, targetDot);
    })
    //automatic carousel movement 
    if (is_automatic_carousel_enabled) {
        setInterval(function () {

            if (!is_welcome_screen_present() && (EASYCHAT_BOT_THEME != "theme_1" && EASYCHAT_BOT_THEME != "theme_2")) {
                return
            }
            var currentSlide = track.querySelector('.easychat-current-slide');
            var currentDot = dots_nav.querySelector('.active-slide-indicator');
            var nextSlide;
            var nextDot;
            if (currentSlide.nextSibling) {
                nextSlide = currentSlide.nextSibling;
                nextDot = currentDot.nextSibling;
            } else {
                nextSlide = currentSlide.parentElement.firstElementChild;
                nextDot = currentDot.parentElement.firstElementChild;
            }


            update_dots(currentDot, nextDot);
            move_to_slide(track, currentSlide, nextSlide);
        }, carousel_time * 1000);
    }


    function move_to_slide(track, currentSlide, targetSlide) {
        track.style.transform = "translateX(-" + targetSlide.style.left + ")";
        currentSlide.classList.remove("easychat-current-slide");
        targetSlide.classList.add("easychat-current-slide");
    }

    function update_dots(currentDot, targetDot) {
        currentDot.classList.remove('active-slide-indicator');
        targetDot.classList.add('active-slide-indicator');
    }


    track.addEventListener('touchstart', handleTouchStart, false);
    track.addEventListener('touchmove', handleTouchMove, false);

    var xDown = null;
    var yDown = null;

    function getTouches(evt) {
        return evt.touches || // browser API
            evt.originalEvent.touches; // jQuery
    }

    function handleTouchStart(evt) {
        const firstTouch = getTouches(evt)[0];
        xDown = firstTouch.clientX;
        yDown = firstTouch.clientY;
    };

    function handleTouchMove(evt) {
        if (!xDown || !yDown) {
            return;
        }

        var xUp = evt.touches[0].clientX;
        var yUp = evt.touches[0].clientY;

        var xDiff = xDown - xUp;
        var yDiff = yDown - yUp;

        if (Math.abs(xDiff) > Math.abs(yDiff)) { /*most significant*/
            if (xDiff > 0) {
                /* right swipe */
                var currentSlide = track.querySelector('.easychat-current-slide');
                var currentDot = dots_nav.querySelector('.active-slide-indicator');
                var nextSlide;
                var nextDot;
                if (currentSlide.nextSibling) {
                    nextSlide = currentSlide.nextSibling;
                    nextDot = currentDot.nextSibling;

                    update_dots(currentDot, nextDot);
                    move_to_slide(track, currentSlide, nextSlide);
                }
            } else {
                /* left swipe */
                var currentSlide = track.querySelector('.easychat-current-slide');
                var currentDot = dots_nav.querySelector('.active-slide-indicator');
                var previousSlide;
                var previousDot;
                if (currentSlide.previousElementSibling) {
                    previousSlide = currentSlide.previousElementSibling;
                    previousDot = currentDot.previousElementSibling;

                    update_dots(currentDot, previousDot);
                    move_to_slide(track, currentSlide, previousSlide);
                }
            }
        }
        /* reset values */
        xDown = null;
        yDown = null;
    };
}

function add_banner_for_theme_three(welcome_banner_list) {

    html = '<div class="easychat-bot-welcome-banner-wrapper"> <div class="easychat-carousel-track-container"><ul class="easychat-carousel-track">'

    for (let i = 0; i < welcome_banner_list.length; i++) {

        if (i == 0) {
            html += '<li class="easychat-carousel-slide easychat-current-slide">'
        } else {
            html += '<li class="easychat-carousel-slide ">'
        }
        img_id = i + 1
        if (welcome_banner_list[i]["action_type"] == "1") {
            html += '<img wb_id="' + welcome_banner_list[i]["welcome_banner_id"] + '" action_type="' + welcome_banner_list[i]["action_type"] + '" vlink="' + welcome_banner_list[i]["redirection_url"] + '" onclick="open_link_banner(this)" src="' + welcome_banner_list[i]["image_url"] + ' "style="border-radius: 8px;cursor:pointer" alt="welcome img" >'
        } else if (welcome_banner_list[i]["action_type"] == "2") {
            html += '<img wb_id="' + welcome_banner_list[i]["welcome_banner_id"] + '" action_type="' + welcome_banner_list[i]["action_type"] + '" intent_name="' + welcome_banner_list[i]["intent_name"] + '" onclick="open_link_banner(this)" src="' + welcome_banner_list[i]["image_url"] + ' "style="border-radius: 8px;cursor:pointer" alt="welcome img" >'
        } else {
            html += '<img wb_id="' + welcome_banner_list[i]["welcome_banner_id"] + '" action_type="' + welcome_banner_list[i]["action_type"] + '" vlink="' + welcome_banner_list[i]["redirection_url"] + '" intent_name="' + welcome_banner_list[i]["intent_pk"] + '" onclick="open_link_banner(this)" src="' + welcome_banner_list[i]["image_url"] + ' "style="border-radius: 8px;cursor:pointer" alt="welcome img" >'
        }
        html += '</li>'
    }

    html += '</ul></div>'
    if (welcome_banner_list.length > 1) {
        html += '<div class="easychat-carousel-nav">'
        html += '<button class="easychat-carousel-indicator active-slide-indicator"></button>'
        for (let i = 1; i < welcome_banner_list.length; i++) {
            html += '<button class="easychat-carousel-indicator"></button>'
        }
        html += '</div>'
    }


    html += '</div>'

    document.getElementById("easychat-bot-welcome-banner-parent").innerHTML += html;

    if (EASYCHAT_BOT_THEME == "theme_1" || EASYCHAT_BOT_THEME == "theme_2") {
        document.getElementById("easychat-bot-welcome-banner-parent").style.display = "block";
    }
}


function add_banner_based_on_theme(welcome_banner_list, is_automatic_carousel_enabled, carousel_time) {
    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4" || EASYCHAT_BOT_THEME == "theme_1" || EASYCHAT_BOT_THEME == "theme_2") {
        add_banner_for_theme_three(welcome_banner_list);
        // Commenting this setTimeout because it was causing welcome banners to overlap for 1 second
        // setTimeout(function () {
            try {
                handle_welcome_page_banner(is_automatic_carousel_enabled, carousel_time);
            } catch (err) {
                console.log(err)
            }
        // }, 1000)
    } else {
        add_banner(welcome_banner_list);
        init_gallery();
        if (is_automatic_carousel_enabled) {
            carousel_timer = setInterval(function () {
                move_gallary_slides(1);
            }, carousel_time * 1000);
        }
    }
}

function add_banner(welcome_banner_list) {

    html = '<div class="galleryContainer"><div class="slideShowContainer" ontouchend="welcome_banner_scroll_mobile(event)" ontouchstart="handle_first_mobile_touch(event)" style="touch-action: none;">';
    html += '<div onclick="move_gallary_slides(-1)" class="nextPrevBtn leftArrow"><span class="arrow arrowLeft"></span></div>';

    if (welcome_banner_list.length > 1) {
        html += '<div onclick="move_gallary_slides(1)" class="nextPrevBtn rightArrow"><span class="arrow arrowRight"></span></div>';
    }

    for (var i = 0; i < welcome_banner_list.length; i++) {

        html += '<div style="cursor: pointer;" class="GallarySlidesimageHolder">';
        if (welcome_banner_list[i]["action_type"] == "1") {
            html += '<img wb_id="' + welcome_banner_list[i]["welcome_banner_id"] + '" action_type="' + welcome_banner_list[i]["action_type"] + '" vlink="' + welcome_banner_list[i]["redirection_url"] + '" onclick="open_link_banner(this)" src="' + welcome_banner_list[i]["image_url"] + '"></div>'
        } else if (welcome_banner_list[i]["action_type"] == "2") {
            html += '<img wb_id="' + welcome_banner_list[i]["welcome_banner_id"] + '" action_type="' + welcome_banner_list[i]["action_type"] + '" intent_name="' + welcome_banner_list[i]["intent_name"] + '" onclick="open_link_banner(this)" src="' + welcome_banner_list[i]["image_url"] + '"></div>'
        } else {
            html += '<img wb_id="' + welcome_banner_list[i]["welcome_banner_id"] + '" action_type="' + welcome_banner_list[i]["action_type"] + '" vlink="' + welcome_banner_list[i]["redirection_url"] + '" intent_name="' + welcome_banner_list[i]["intent_pk"] + '" onclick="open_link_banner(this)" src="' + welcome_banner_list[i]["image_url"] + '"></div>'
        }
    }

    html += "</div>";

    if (welcome_banner_list.length > 1) {
        html += '<div id="GallarydotsContainer"></div>';
    }

    html += '</div>';

    $("#easychat-chat-container").append(html);
}

function open_link_banner(el) {

    var action_type = el.getAttribute("action_type");

    if (action_type == "1") {
        var url = el.getAttribute("vlink");
        var pattern = /^((http|https|ftp):\/\/)/;
        if (!pattern.test(url)) { url = "http://" + url; }
        window.open(url);
    } else if (action_type == "2") {
        var query = el.getAttribute("intent_name").replace(/_/g, " ");
        if (query != "-" && query != null && query != undefined) {
            is_manually_typed_query = false;
            send_user_input(query);
        }
    } else {
        var query = el.getAttribute("intent_name")
        var url = el.getAttribute("vlink");
        var pattern = /^((http|https|ftp):\/\/)/;
        if (!pattern.test(url)) { url = "http://" + url; }

        if (query != "-" && query != null && query != undefined) {
            if (url.split("?").length > 1) {
                url += "&query_question=" + query;
            } else {
                url += "?query_question=" + query;
            }
        }
        window.open(url);

    }

    var src_el = el.getAttribute("src")
    if (!list_banner_img_clicked.includes(src_el) && src_el.toString().trim() != "") {

        var website_visited_url = el.getAttribute("vlink");
        if (website_visited_url == null && website_visited_url == undefined) {
            website_visited_url = "-";
        }

        var wb_id = el.getAttribute("wb_id");

        list_banner_img_clicked.push(el.getAttribute("src"))
        var json_string = JSON.stringify({
            bot_id: bot_id,
            user_id: user_id,
            web_page_visited: website_visited_url,
            preview_source: src_el.toString().trim(),
            wb_id: wb_id
        });

        json_string = encrypt_variable(json_string);
        json_string = encodeURIComponent(json_string);
        var params = 'json_string=' + json_string;
        var xhttp = new XMLHttpRequest();
        xhttp.open("POST", "/chat/save-welcome-banner-click-count/", true);
        xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                response = JSON.parse(this.responseText);
                response = custom_decrypt(response)
                response = JSON.parse(response);
                user_id = response["user_id"];
            }
        }
        xhttp.send(params);
    }

}

function open_link_image(el, img_src) {

    if (!img_src) img_src = el.getAttribute("src")

    window.open(img_src);
}

function is_welcome_screen_present() {
    if (EASYCHAT_BOT_THEME != "theme_3" && EASYCHAT_BOT_THEME != "theme_4") {
        return false
    }
    return $("#easychat-navbar").hasClass("easychat-welcome-home-navbar-div");
}


function remove_scroll_bar_in_welcome_screen() {

    var style = document.createElement("style");
    style.innerHTML = '#easychat-chat-container::-webkit-scrollbar {display: none;}';
    document.head.appendChild(style);

}

function add_scroll_bar_in_welcome_screen() {

    var style = document.createElement("style");
    style.innerHTML = '#easychat-chat-container::-webkit-scrollbar {display: block;}';
    document.head.appendChild(style);
}

function remove_banner_and_fix_navbar() {
    // hidding welcome banner and initial questions
    $(".easychat-bot-welcome-banner-wrapper").css("display", "none");
    $("#top-container").css("background-color", "#fff")
    $(".easychat-bot-message-section-area-div").css("padding", "16px");
    $(".easychat-bot-message-div").css("display", "flex")
    $(".easychat-bot-navbar").removeClass("easychat-welcome-home-navbar-div");
    $(".easychat-slider-wrapper").css("display", "inline-block")
    $(".easychat-bot-welcome-banner-parent").css("display", "none")
    document.getElementById("easychat-bot-welcome-banner-parent").innerHTML = ""

    add_scroll_bar_in_welcome_screen();

    if (is_text_to_speech_required) {
        if (document.getElementById("easychat-bot-mute-unmute-div-welcome-screen")) {
            document.getElementById("easychat-bot-mute-unmute-div-welcome-screen").style.display = "none";
        }
        if(EASYCHAT_BOT_THEME == 'theme_3') {
            mute_unmute_speech(true)
        }
    }
    if (!is_livechat) {
        if (enable_response_form_assist != 'false') {
            if (is_sticky_intent_button_present) {
                setTimeout(function (){
                    $(".easychat-bot-sticky-intent-wrapper").css("display", "flex")
                }, 300)
                $("#img-scroll-to-bottom").css("bottom", "6.7em");
            } else if (is_sticky_intent_menu_present) {
                $(".easychat-bot-sticky-menu-wrapper").css("display", "block")
                $("#img-scroll-to-bottom").css("bottom", "6.7em");
            }
        }
    }
    if (document.getElementsByClassName("easychat-bot-recommendation-wrapper").length) {
        document.getElementsByClassName("easychat-bot-recommendation-wrapper")[0].style.display = "none"
    }

    setTimeout(function (){
        resize_chabot_window();
    }, 400)

    is_welcome_banner_present = false;
    if (EASYCHAT_BOT_THEME == 'theme_4') {
        let element_response = document.querySelectorAll('.easychat-image-intent-recommendation-wrapper')
        element_response.forEach((element, index) => {
            element_response[index].style.paddingLeft = "32px"
        })        
        $('.easychat-bot-ask-query-btn-wrapper').hide()
        $('#bot_frequently_asked_question_wrapper').hide()
        $('#easychat-bot-welcome-banner-parent').hide()
        if (IS_TEXTFIELD_INPUT_ENABLED) {
            $('.easychat-bot-footer-input-wrapper').css("display", "flex")
        }
        $('#easychat-chat-container').removeClass('hide-container-elements')
        $('.easychat-bot-recommendation-wrapper').show()
    }
    resize_chabot_window();
}

function remove_banner_based_on_theme() {

    if (EASYCHAT_BOT_THEME == "theme_3" || EASYCHAT_BOT_THEME == "theme_4") {
        remove_banner_and_fix_navbar();
    } else {
        remove_banner();
    }

}

function remove_banner() {
    
    var elements = document.getElementsByClassName("easychat-bot-welcome-banner-wrapper");
    if (elements) {

        while (elements.length > 0) {
            elements[0].parentNode.removeChild(elements[0]);
        }

        is_welcome_banner_present = false;
    }
}

function remove_feedback_div() {

    var elements = document.getElementsByClassName("easychat-intent-feedback-wrapper");

    for (var i = 0; i < elements.length; i++) {
        if (elements[i].getAttribute("feedback_submitted") != "true") {
            if (EASYCHAT_BOT_THEME == 'theme_1' || EASYCHAT_BOT_THEME == 'theme_2'){
                elements[i].parentNode.removeChild(elements[i]);
            }else{
                elements[i].parentNode.remove();
            }
        }
    }

}

function init_gallery() {

    GallaryslideIndex = 0;
    gallery_slides = document.getElementsByClassName("GallarySlidesimageHolder");
    gallery_slides[GallaryslideIndex].style.opacity = 1;
    for (i = 0; i < gallery_slides.length; i++) { gallery_slides[i].style.display = "none"; }
    gallery_slides[GallaryslideIndex].style.display = "block";

    //disable nextPrevBtn if slide count is one
    if (gallery_slides.length < 2) {
        var nextPrevBtns = document.querySelector(".leftArrow,.rightArrow");
        if (nextPrevBtns != undefined && nextPrevBtns != null) {
            nextPrevBtns.style.display = "none";
            for (i = 0; i < nextPrevBtns.length; i++) {
                nextPrevBtns[i].style.display = "none";
            }
        }
    }

    //add gallery_dots
    gallery_dots = [];
    try {
        var dotsContainer = document.getElementById("GallarydotsContainer"),
            i;

        for (i = 0; i < gallery_slides.length; i++) {
            var dot = document.createElement("span");
            dot.className += " gallary_dots";
            try {
                dotsContainer.append(dot);
            } catch (e) {
                dotsContainer.appendChild(dot);
            }
            dot.setAttribute("onclick", "move_slide(" + i + ")");
            gallery_dots.push(dot);
        }
        gallery_dots[GallaryslideIndex].className += " active";
    } catch (e) { console.log(e) }

    if (EASYCHAT_BOT_THEME == "theme_1" || EASYCHAT_BOT_THEME == "theme_2") {
        if (gallery_slides.length > 1) {
            nextSlideIndex = 1;
            gallery_slides[nextSlideIndex].style.transform = 'translate(67%, 0) scale(0.6, 0.7)';
            gallery_slides[nextSlideIndex].style.display = 'block';
            gallery_slides[nextSlideIndex].style.opacity = '0.3';
        }
        if (gallery_slides.length > 2) {
            lastSlideIndex = gallery_slides.length - 1;
            gallery_slides[lastSlideIndex].style.transform = 'translate(-67%, 0) scale(0.6, 0.7)';
            gallery_slides[lastSlideIndex].style.display = 'block';
            gallery_slides[lastSlideIndex].style.opacity = '0.3';
        }
    }
}

function welcome_banner_scroll_mobile(event) {
    if(event.target.classList.contains('arrow'))
        return;
    var x_up_banner = event.changedTouches[0].screenX;
    var x_diff_banner = x_down_banner - x_up_banner;
    if (x_diff_banner > 0)
        n = 1;
    else
        n = -1;
    if (EASYCHAT_BOT_THEME == 'theme_1' || EASYCHAT_BOT_THEME == 'theme_2') {
        move_slide2(GallaryslideIndex + n);
    } else {
        move_slide(GallaryslideIndex + n);
    }
}

function handle_first_mobile_touch(event) {
    x_down_banner = event.changedTouches[0].screenX;
}

function card_scroll_mobile(event) {
    var x_up_banner = event.changedTouches[0].screenX;
    var x_diff_banner = x_down_banner - x_up_banner;
    var el;
    if (x_diff_banner > 0) {
        n = 1;
        el = document.getElementsByClassName('next-image-video')[0];
    }
    else {
        n = -1;
        el = document.getElementsByClassName('prev-image-video')[0];
    }
    plusImageSlides(n, el);
}

function move_gallary_slides(n) {
    if (is_automatic_carousel_enabled) {
        clearInterval(carousel_timer);
    }

    if (is_welcome_banner_present) {
        if (EASYCHAT_BOT_THEME == 'theme_1' || EASYCHAT_BOT_THEME == 'theme_2') {
            move_slide2(GallaryslideIndex + n);
        } else {
            move_slide(GallaryslideIndex + n);
        }

        if (is_automatic_carousel_enabled) {
            carousel_timer = setInterval(function () {
                move_gallary_slides(1);
            }, carousel_time * 1000)
        }
    }
}

function move_slide(n) {
    var i;
    var current, next;
    var move_slideAnimClass = {
        forCurrent: "",
        forNext: ""
    };

    var slideTextAnimClass;
    for (i = 0; i < gallery_slides.length; i++) {
        gallery_slides[i].style.display = "none";
    }
    if (n > GallaryslideIndex) {
        if (n >= gallery_slides.length) { n = 0; }
        move_slideAnimClass.forCurrent = "moveLeftCurrentSlide";
        move_slideAnimClass.forNext = "moveLeftNextSlide";
        slideTextAnimClass = "slideTextFromTop";
    } else if (n < GallaryslideIndex) {
        if (n < 0) { n = gallery_slides.length - 1; }
        move_slideAnimClass.forCurrent = "moveRightCurrentSlide";
        move_slideAnimClass.forNext = "moveRightPrevSlide";
        slideTextAnimClass = "slideTextFromBottom";
    }

    gallery_slides[n].style.display = "block";

    if (n != GallaryslideIndex) {
        next = gallery_slides[n];
        current = gallery_slides[GallaryslideIndex];
        for (i = 0; i < gallery_slides.length; i++) {
            gallery_slides[i].className = "GallarySlidesimageHolder";
            gallery_slides[i].style.opacity = 0;

            if (gallery_dots.length > 0) {
                gallery_dots[i].className = gallery_dots[i].className.replace(/\bactive\b/g, "");
                document.getElementsByClassName("gallary_dots")[i].className = document.getElementsByClassName("gallary_dots")[i].className.replace(/\bactive\b/g, "");
            }
        }
        current.className += " " + move_slideAnimClass.forCurrent;
        next.className += " " + move_slideAnimClass.forNext;

        if (gallery_dots.length > 0) {
            gallery_dots[n].className = "gallary_dots active"
            document.getElementsByClassName("gallary_dots")[n].className = "gallary_dots active"
        }
        GallaryslideIndex = n;
    }

}


function move_slide2(n) {
    var i;
    var current, next, nextnext, nextnextSlideIndex;

    var gallery_slides_length = gallery_slides.length;
    var move_slideAnimClass = {
        forCurrent: "",
        forNext: "",
        forNextNext: ""
    };

    var slideTextAnimClass;
    for (i = 0; i < gallery_slides_length; i++) {
        gallery_slides[i].style.display = "none";
    }
    if (n > GallaryslideIndex) {
        if (n >= gallery_slides_length) { n = 0; }
        move_slideAnimClass.forCurrent = "moveLeftCurrentSlide";
        move_slideAnimClass.forNext = "moveLeftNextSlide";
        move_slideAnimClass.forNextNext = "moveLeftNextNextSlide";
        slideTextAnimClass = "slideTextFromTop";

        nextnextSlideIndex = n + 1 < gallery_slides_length ? n + 1 : 0;

    } else if (n < GallaryslideIndex) {
        if (n < 0) { n = gallery_slides_length - 1; }
        move_slideAnimClass.forCurrent = "moveRightCurrentSlide";
        move_slideAnimClass.forNext = "moveRightPrevSlide";
        move_slideAnimClass.forNextNext = "moveRightPrevPrevSlide";
        slideTextAnimClass = "slideTextFromBottom";

        nextnextSlideIndex = n - 1 >= 0 ? n - 1 : gallery_slides_length - 1;
    }

    if (gallery_slides_length > 2) {
        gallery_slides[nextnextSlideIndex].style.display = "block";
    }

    gallery_slides[GallaryslideIndex].style.display = "block";

    gallery_slides[n].style.display = "block";

    if (n != GallaryslideIndex) {
        next = gallery_slides[n];
        current = gallery_slides[GallaryslideIndex];
        nextnext = gallery_slides[nextnextSlideIndex];
        for (i = 0; i < gallery_slides.length; i++) {
            gallery_slides[i].className = "GallarySlidesimageHolder";
            gallery_slides[i].style.opacity = 0;
            //gallery_dots[i].className = gallery_dots[i].className.replace(/\bactive\b/g, "");
            //document.getElementsByClassName("gallary_dots")[i].className = document.getElementsByClassName("gallary_dots")[i].className.replace(/\bactive\b/g, "");
        }
        current.className += " " + move_slideAnimClass.forCurrent;
        next.className += " " + move_slideAnimClass.forNext;
        nextnext.className += " " + move_slideAnimClass.forNextNext;
        // gallery_dots[n].className = "gallary_dots active"
        //document.getElementsByClassName("gallary_dots")[n].className = "gallary_dots active"
        GallaryslideIndex = n;
    }
}

// function get_url_vars() {
//     var vars = {};
//     var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value) {
//         vars[key] = value;
//     });
//     return vars;
// }

function create_issue(element) {
    name = document.getElementById("new-issue-name").value;
    document.getElementById("create-issue-error-message").innerHTML = "";

    if (name == "") {
        //showToast("Please enter your name.");
        document.getElementById("create-issue-error-message").innerHTML = "Please enter your name.";
        return;
    }

    if (!/^[a-zA-Z ]*$/.test(name)) {
        // showToast("Please enter a valid name.");
        document.getElementById("create-issue-error-message").innerHTML = "Please enter a valid name.";
        return;
    }

    if (!name.replace(/\s/g, '').length) {
        document.getElementById("create-issue-error-message").innerHTML = "Please enter a valid name.";
        return;
    }

    phone_no = document.getElementById("new-issue-phone").value;
    if (phone_no == "" || phone_no.length != 10) {
        // showToast("Please enter your 10 digits mobile number.");
        document.getElementById("create-issue-error-message").innerHTML = "Please enter your 10 digits mobile number";
        return;
    }

    if (phone_no.length != 10 || !/^\d{10}$/.test(phone_no)) {
        // showToast("Please enter a valid phone no.");
        document.getElementById("create-issue-error-message").innerHTML = "Please enter a valid phone no.";
        return;
    }

    issue = document.getElementById("new-issue-issue").value;
    if (issue == "") {
        // showToast("Please describe your issue.");
        document.getElementById("create-issue-error-message").innerHTML = "Please describe your issue.";
        return;
    }
    if (!issue.replace(/\s/g, '').length) {
        document.getElementById("create-issue-error-message").innerHTML = "Please describe your issue.";
        return;
    }

    priority = document.getElementById("ticket-priority").value;
    if (priority == "") {
        // showToast("Please select the priority.");
        document.getElementById("create-issue-error-message").innerHTML = "Please select the priority.";
        return;
    }

    category = document.getElementById("ticket-category").value;
    if (category == "") {
        // showToast("Please select the category.");
        document.getElementById("create-issue-error-message").innerHTML = "Please select the category.";
        return;
    }

    // bot_id = getUrlVars()["id"]
    url_parameters = get_url_vars();
    var channel_name = url_parameters["channel"]
    if (channel_name == undefined || channel_name == null)
        channel_name = "Web"

    json_string = JSON.stringify({
        name: name,
        phone_no: phone_no,
        email: "",
        issue: issue,
        priority: priority,
        category: category,
        "channel": channel_name
        // bot_id:"bot_id"
    });
    json_string = encrypt_variable(json_string);
    document.getElementById("new-issue-name").value = "";
    document.getElementById("new-issue-phone").value = "";
    document.getElementById("new-issue-issue").value = "";
    document.getElementById("ticket-priority").value = "1";
    document.getElementById("ticket-category").value = "";
    $.ajax({
        url: '/tms/create-issue/',
        type: 'POST',
        data: {
            data: json_string
        },
        success: function (response) {
            response = custom_decrypt(response["response"])
            response = JSON.parse(response);
            if (response["status_code"] == 200 && response["ticket_id"] != "") {

                modal_create_issue.style.display = "none";
                message = "Thank you for reporting your issue. Your Ticket ID is " + response["ticket_id"] + ". Kindly save it for further reference. Our customer service agent will contact you shortly."
                append_bot_text_response(message);
            } else if (response["status_code"] == 305 && response["ticket_id"] != "") {

                modal_create_issue.style.display = "none";
                message = "Your issue has been registred. Your Ticket ID is " + response["ticket_id"] + " Today our office is closed. We will proceed with your issue as soon as possible."
                append_bot_text_response(message);
            } else {

                console.log("Please report this. ", response["status_message"]);
            }

            scroll_to_bottom();
        },
        error: function (xhr, textstatus, errorthrown) {
            console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
        }
    });
    enable_user_input();
}

function schedule_meeting(element) {
    document.getElementById("schedule-error-message").innerHTML = "";
    name = document.getElementById("new-meeting-name").value;

    if (name == "") {
        // showToast("Please enter your name.");
        document.getElementById("schedule-error-message").innerHTML = "Please enter your name";
        return;
    }
    if (!/^[a-zA-Z ]*$/.test(name)) {
        // showToast("Please enter a valid name.");
        document.getElementById("schedule-error-message").innerHTML = "Please enter a valid name";
        return;
    }
    if (!name.replace(/\s/g, '').length) {
        document.getElementById("schedule-error-message").innerHTML = "Please enter a valid name.";
        return;
    }

    phone_no = document.getElementById("new-meeting-phone").value;
    if (phone_no == "" || phone_no.length != 10) {
        // showToast("Please enter your 10 digits mobile number.");
        document.getElementById("schedule-error-message").innerHTML = "Please enter 10 digits mobile number";
        return;
    }

    if (phone_no.length != 10 || !/^\d{10}$/.test(phone_no)) {
        // showToast("Please enter a valid phone no.");
        document.getElementById("schedule-error-message").innerHTML = "Please enter a valid phone no.";
        return;
    }

    //Meeting Date

    meet_date = document.getElementById("new-meeting-date").value;
    if (meet_date == "") {
        // showToast("Please enter meeting date.")
        document.getElementById("schedule-error-message").innerHTML = "Please enter date.";
        return;
    }

    meet_date_year = meet_date.split("-")[0]
    meet_date_month = meet_date.split("-")[1]
    meet_date_date = meet_date.split("-")[2]

    if (meet_date_year < new Date().getFullYear()) {
        document.getElementById("schedule-error-message").innerHTML = "Please enter a valid year.";
        return;
    } else if (meet_date_year == new Date().getFullYear() && meet_date_month < (new Date().getMonth() + 1)) {
        document.getElementById("schedule-error-message").innerHTML = "Please enter a valid month.";
        return;
    } else if (meet_date_year == new Date().getFullYear() && meet_date_month == (new Date().getMonth() + 1) && meet_date_date < new Date().getDate()) {
        document.getElementById("schedule-error-message").innerHTML = "Please enter a valid day.";
        return;
    }

    // Meeting Time
    meet_time = document.getElementById("new-meeting-time").value;
    if (meet_time == "") {
        // showToast("Please enter meeting time.")
        document.getElementById("schedule-error-message").innerHTML = "Please enter meeting time.";
        return;
    }
    if (meet_date_year == new Date().getFullYear() && meet_date_month == (new Date().getMonth() + 1) && meet_date_date == new Date().getDate()) {
        meet_time_hour = meet_time.split(":")[0]
        meet_time_hour = parseInt(meet_time_hour)

        meet_time_minute = meet_time.split(":")[1]
        meet_time_minute = parseInt(meet_time_minute)

        current_hour = new Date().getHours()
        current_minute = new Date().getMinutes()
        if (meet_time_hour < current_hour) {
            // showToast("Please enter valid time.")
            document.getElementById("schedule-error-message").innerHTML = "Please enter valid time.";
            return;
        } else if (meet_time_hour == current_hour && meet_time_minute < current_minute) {
            // showToast("Please enter valid time.");
            document.getElementById("schedule-error-message").innerHTML = "Please enter valid time.";
            return;
        }
    }

    meet_agent_date_time = meet_date + "T" + meet_time

    user_pincode = document.getElementById("new-meeting-pincode").value;

    issue = document.getElementById("new-meeting-issue").value;
    if (issue == "") {
        //showToast("Please describe your issue.");
        document.getElementById("schedule-error-message").innerHTML = "Please describe your issue";
        return;
    }
    if (!issue.replace(/\s/g, '').length) {
        document.getElementById("schedule-error-message").innerHTML = "Please describe your issue";
        return;
    }

    url_parameters = get_url_vars();
    var channel_name = url_parameters["channel"]
    if (channel_name == undefined || channel_name == null)
        channel_name = "Web"

    json_string = JSON.stringify({
        name: name,
        phone_no: phone_no,
        email: "",
        issue: issue,
        meet_agent_date_time: meet_agent_date_time,
        user_pincode: user_pincode,
        "channel": channel_name
    });
    json_string = encrypt_variable(json_string);

    document.getElementById("new-meeting-name").value = "";
    document.getElementById("new-meeting-phone").value = "";
    document.getElementById("new-meeting-date").value = "";
    document.getElementById("new-meeting-time").value = "";
    document.getElementById("new-meeting-pincode").value = "";
    document.getElementById("new-meeting-issue").value = "";

    $.ajax({
        url: '/tms/schedule-meeting/',
        type: 'POST',
        data: {
            data: json_string
        },
        success: function (response) {
            response = custom_decrypt(response["response"])
            response = JSON.parse(response);
            if (response["status_code"] == 200 && response["meeting_id"] != "") {
                modal_schedule_meeting.style.display = "none";
                // appendResponseServer("Thank you for scheduling the meeting. Our agent will contact you soon.",false, "", "", "");
                message = "Thank you for scheduling the meeting. Your Meeting ID is " + response["meeting_id"] + " .Kindly save it for further reference. Our customer service agent will contact you shortly."
                // message = "Thank you for scheduling the meeting. Our agent will contact you soon.";
                append_bot_text_response(message);
            } else {
                // showToast("Unable to schedule meeting due to some internal server error. Kindly report the same", 2000);
                console.log("Please report this. ", response["status_message"]);
            }

            scroll_to_bottom();
        },
        error: function (xhr, textstatus, errorthrown) {
            console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
        }
    });
    enable_user_input();
}

function check_ticket_status(element) {
    document.getElementById("ticket-status-error-message").innerHTML = "";
    ticket_id = document.getElementById("check-ticket-id").value;
    if (ticket_id == "" || !ticket_id.replace(/\s/g, '').length) {
        // showToast("Please enter your ticket id.");
        document.getElementById("ticket-status-error-message").innerHTML = "Please enter your ticket id.";
        return;
    }
    json_string = JSON.stringify({
        ticket_id: ticket_id,
    });
    json_string = encrypt_variable(json_string);

    document.getElementById("check-ticket-id").value = "";

    $.ajax({
        url: '/tms/check-ticket-status/',
        type: 'POST',
        data: {
            data: json_string
        },
        success: function (response) {
            response = custom_decrypt(response["response"])
            response = JSON.parse(response);
            if (response["status_code"] == 200 && response["ticket_exist"] == true) {
                // $('#modal-check-ticket-status').modal('close');
                modal_check_ticket_status.style.display = "none";
                message = response["ticket_status_message_response"]
                append_bot_text_response(message);
            } else if (response["ticket_exist"] == false) {
                // $('#modal-check-ticket-status').modal('close');
                modal_check_ticket_status.style.display = "none";
                message = "Sorry, no such ticket found. Please check your Ticket ID and try again."
                append_bot_text_response(message);
            } else {
                showToast("Unable to get your ticket due to some internal server error. Kindly report the same", 2000);
                console.log("Please report this. ", response["status_message"]);
            }
            scroll_to_bottom();
        },
        error: function (xhr, textstatus, errorthrown) {
            console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
        }
    });
    enable_user_input();
}

function check_meeting_status(element) {
    document.getElementById("meeting-status-error-message").innerHTML = "";
    meeting_id = document.getElementById("check-meeting-id").value;
    if (meeting_id == "" || !meeting_id.replace(/\s/g, '').length) {
        // showToast("Please enter your meeting id.");
        document.getElementById("meeting-status-error-message").innerHTML = "Please enter your meeting id.";
        return;
    }
    json_string = JSON.stringify({
        meeting_id: meeting_id,
    });
    json_string = encrypt_variable(json_string);

    document.getElementById("check-meeting-id").value = "";

    $.ajax({
        url: '/tms/check-meeting-status/',
        type: 'POST',
        data: {
            data: json_string
        },
        success: function (response) {
            response = custom_decrypt(response["response"])
            response = JSON.parse(response);
            if (response["status_code"] == 200 && response["meeting_exist"] == true) {
                // $('#modal-check-meeting-status').modal('close');
                modal_check_meeting_status.style.display = "none";
                message = response["meeting_status_message_response"]
                append_bot_text_response(message);
            } else if (response["meeting_exist"] == false) {
                // $('#modal-check-meeting-status').modal('close');
                modal_check_meeting_status.style.display = "none";
                message = "Sorry, no such meeting found. Please check your Meeting ID and try again."
                append_bot_text_response(message);
            } else {
                showToast("Unable to submit your issue due to some internal server error. Kindly report the same", 2000);
                console.log("Please report this. ", response["status_message"]);
            }
            scroll_to_bottom();
        },
        error: function (xhr, textstatus, errorthrown) {
            console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
        }
    });
    enable_user_input();
}

$(document).ready(function () {
    $(':input').on('focus', function () {
        $(this).attr('autocomplete', 'off');
    });

    if (BOT_THEME_COLOR.toLowerCase() == "#ffffff") {
        USER_MESSAGE_COLOR = WHITE_THEME_COLOR;
    }

    document.getElementById("user_input").onkeyup = spell_check;
    if (get_browser_name() == "safari") {
        recognition = null;
        mic_access = false;
        hide_mic_icon();
    }

});

// var mark_offline_var = false;
window.onbeforeunload = function (e) {

    cancel_text_to_speech()
    // clear_userData()
    if (window.localStorage) {
        // flag the page as being unloading
        window.localStorage['myUnloadEventFlag'] = new Date().getTime();
    }
}

document.addEventListener("visibilitychange", function () {

    if (document.hidden) {
        cancel_text_to_speech();
    }
    try {
        if(!document.hidden) {

            webkit.messageHandlers.reloadChatbotForLiveChat.postMessage('reload_chatbot_for_livechat');
        }
    } catch(err) {}
}, false);



function open_close_header_menu_in_mobile(event) {
    event.stopPropagation();
    event.preventDefault();
    $('#bot_header_dropdown_content').toggleClass('is-active');

}


function clear_userData(end_message, agent_inactivity_text_message="") {

    var url_parameters = get_url_vars();
    var bot_id = url_parameters["id"];

    var json_string = JSON.stringify({
        user_id: user_id,
        bot_id: bot_id,
    });
    json_string = encrypt_variable(json_string);
    json_string = encodeURIComponent(json_string);
    var xhttp = new XMLHttpRequest();
    var params = 'json_string=' + json_string;
    xhttp.open("POST", CLEAR_API_URL, true);
    xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            response = JSON.parse(this.responseText);
        }
    }
    xhttp.send(params);

    clear_livechat_data(end_message, agent_inactivity_text_message);
}

function detectIEEdge() {
    var ua = window.navigator.userAgent;
    var msie = ua.indexOf('MSIE ');
    if (msie > 0) {
        // IE 10 or older => return version number
        return true;
    }
    var trident = ua.indexOf('Trident/');
    if (trident > 0) {
        // IE 11 => return version number
        var rv = ua.indexOf('rv:');
        return true;
    }
    var edge = ua.indexOf('Edge/');
    if (edge > 0) {
        // Edge => return version number
        return false;
    }
    // other browser
    return false;
}

// ############## NPS  FeedBack js  END #######################
// ############## Height Adjustment #################

// ############## Cobrowsing Integration Start ####################

function screenshare_with_agent(element) {
    element.innerHTML = "Connecting...";
    document.getElementById("connect-agent-status-error-message").innerHTML = "";
    var full_name = document.getElementById("connect-agent-name").value;
    var mobile_number = document.getElementById("connect-agent-phone").value;
    var regName = /^[a-zA-Z]+ [a-zA-Z]+$/;
    var regMob = /^[6-9]{1}[0-9]{9}$/;

    if (!regName.test(full_name)) {
        document.getElementById("connect-agent-status-error-message").innerHTML = "Please enter full name";
        return;
    }

    if (!regMob.test(mobile_number)) {
        document.getElementById("connect-agent-status-error-message").innerHTML = "Please enter valid 10-digit mobile number";
        return;
    }

    parent.postMessage({
        event_id: 'connect-with-agent',
        data: {
            "full_name": full_name,
            "mobile_number": mobile_number
        }
    }, "*");

    document.getElementById("modal-connect-with-agent").style.display = "none";
}

// function append_connect_with_agent(){
//     var recommendations_html = '<div class="easychat-recommendation-wrapper" align="left">';
//     if(window.EASYCHAT_EASYASSIST_ENABLED=="True"){
//      recommendations_html+= "<div class=\"easychat-recommendation\" onmouseover='custom_button_change(this)' onmouseout='custom_button_change_normal(this)' style=\"border: 0.05em solid "+BOT_THEME_COLOR+";color: "+BOT_THEME_COLOR+"\" onclick=\"show_connect_with_agent_modal(this)\">Connect with expert</div>";
//     }else if(window.EASYCHAT_LIVECHAT_ENABLED=="True"){
//      recommendations_html+= "<div class=\"easychat-recommendation\" onmouseover='custom_button_change(this)' onmouseout='custom_button_change_normal(this)' style=\"border: 0.05em solid "+BOT_THEME_COLOR+";color: "+BOT_THEME_COLOR+"\" onclick=\"append_livechat_response(this)\">Chat with expert</div>";
//     }
//     recommendations_html+="</div>";
//     document.getElementById("easychat-chat-container").innerHTML += recommendations_html;
// }

// ############## Cobrowsing Integration End ########################

window.addEventListener('message', handle_parent_message, false);

function handle_parent_message(event) {
    try {
        data = JSON.parse(event.data);

        if ('scope' in data) {
            return;
        }

        console.log(data);
        if (data.attachment == "None" || data.attachment == undefined) {
            if (data.message != undefined) {
                append_bot_text_response(data.message);
            }
        } else {
            var html = '<a href="' + data.attachment + '" target="_blank"><img src="/static/EasyAssistApp/img/documents2.png" style="height: 100%;width: 100%;border-radius: 1em;object-fit: contain;"></a>';
            $("#easychat-chat-container").append('<div style="width:98%;display:inline-block;"><div class="easychat-livechat-customer-attachment" style="float:left;">' + html + '<div class="easychat-livechat-message">' + data.message + '</div></div></div>');
        }
        scroll_to_bottom();
        is_cobrowsing_chat = true;
    } catch (err) { }
}

function get_cross_button_svg_form() {
    var svg = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\
    <path d="M3.19165 3L12.8082 13" stroke="black" stroke-width="1.73614" stroke-linecap="round" stroke-linejoin="round"/>\
    <path d="M12.8083 3L3.19183 13" stroke="black" stroke-width="1.73614" stroke-linecap="round" stroke-linejoin="round"/>\
    </svg>'
    return svg;
}
function get_cross_button_svg() {
    var svg = '<svg width="8" height="8" class="livechat-cross-btn-svg" viewBox="0 0 8 8" fill="' + BOT_THEME_COLOR + '" xmlns="http://www.w3.org/2000/svg"><path d="M5.1875 3.9875L7.8875 1.3125C8.0375 1.1625 8.0375 0.8875 7.8875 0.7375L7.2625 0.1125C7.1125 -0.0375 6.8375 -0.0375 6.6875 0.1125L4.0125 2.8125L1.3125 0.1125C1.1625 -0.0375 0.8875 -0.0375 0.7375 0.1125L0.1125 0.7375C-0.0375 0.8875 -0.0375 1.1625 0.1125 1.3125L2.8125 3.9875L0.1125 6.6875C-0.0375 6.8375 -0.0375 7.1125 0.1125 7.2625L0.7375 7.8875C0.8875 8.0375 1.1625 8.0375 1.3125 7.8875L4.0125 5.1875L6.6875 7.8875C6.8375 8.0375 7.1125 8.0375 7.2625 7.8875L7.8875 7.2625C8.0375 7.1125 8.0375 6.8375 7.8875 6.6875L5.1875 3.9875Z" ></path> </svg>'
    return svg;
}
function change_span_name_to_file_name_livechat(el) {

    if (user_has_uploaded_previous_file == true) {
        if (el.files[0] != undefined || el.files[0] != null) {
            var file_ext = el.files[0].name.split(".");
            file_ext = el.files[0].name.split(".")[file_ext.length - 1];
            var file_name_malicious = false
            var check_file_more_than_one_fullstop = el.files[0].name.replace(" ", "").split(".");
            if (check_file_more_than_one_fullstop.length > 2) {
                file_name_malicious = true
            }

            allowed_file_extensions = ["png", "PNG", "JPG", "JPEG", "jpg", "jpeg", "svg", "bmp", "gif", "tiff", "exif", "jfif", "WEBM", "MPG", "MP2", "MPEG", "MPE", "MPV", "OGG", "MP4", "M4P", "M4V", "AVI", "WMV", "MOV", "QT", "FLV", "SWF", "AVCHD", "pdf", "docs", "docx", "doc", "PDF"]
            if (file_name_malicious == false && allowed_file_extensions.indexOf(file_ext) != -1) {

                var html =
                    '<div class="easychat-user-message-div"><div id ="livechat-user-upload-attachment-div"class="easychat-drag-drop-after-select" style="background-color: white;padding: 1em;box-shadow: rgba(0, 0, 0, 0.2) 1px 1px 6px;border-radius: 1em;margin-top: .7em; width:85%; display:flex;float:right"">'

                html += '<span> ' + FILE_ICON_SVG + '</span>'

                html += '<span id="easychat-drag-drop-alert-msg" style="width: 60%;word-break: break-all;padding-top: .5em;vertical-align: middle;margin-left: 11px;">Error Message</span>\
           <button onclick="save_attachment_to_data_models_livechat()" id="easychat-drag-drop-upload-btn" style="background-color:' + BOT_THEME_COLOR + ';display: inline-block;float: right;padding: .5em;border: none;color: white;border-radius: 5px;cursor:pointer;margin-left:auto;">' + UPLOAD_TEXT + '</button>\
           <div style="width:100%;float:left;display:none;" id="easychat-dragdropbottyping-loader"><img src="' + EASYCHAT_IMG_PATH + 'preloader.svg" style="height:3em;"></div>\
       </div></div></div>';

                scroll_to_bottom()

                if (el.files[0].size <= 5 * 1024 * 1024) {
                    $("#easychat-chat-container").append(html);
                    document.getElementsByClassName("easychat-drag-drop-after-select")[document.getElementsByClassName('easychat-drag-drop-after-select').length - 1].style.backgroundColor = "white"
                    document.getElementById("easychat-drag-drop-alert-msg").style.fontSize = "unset"
                    document.getElementsByClassName("easychat-drag-drop-after-select")[document.getElementsByClassName('easychat-drag-drop-after-select').length - 1].style.padding = "1em"
                    document.getElementsByClassName("easychat-drag-drop-after-select")[document.getElementsByClassName('easychat-drag-drop-after-select').length - 1].style.boxShadow = "1px 1px 6px rgba(0, 0, 0, 0.2)"
                    document.getElementsByClassName("easychat-drag-drop-after-select")[document.getElementsByClassName('easychat-drag-drop-after-select').length - 1].style.borderRadius = "1em"
                    document.getElementById("easychat-drag-drop-alert-msg").style.display = "inline-block"
                    document.getElementById("easychat-drag-drop-alert-msg").style.color = "black"
                    file_name = el.files[0].name.split(".")
                    file_length = file_name.length
                    file_ext = parseInt(parseInt(file_length) - 1)
                    if (el.files[0].name.length >= 15) {
                        file_name_mod = file_name[0].slice(0, 15) + "... ." + file_name[file_name.length - 1]
                    } else {
                        file_name_mod = el.files[0].name
                    }
                    if (EASYCHAT_BOT_THEME == 'theme_2') {
                        document.getElementById("easychat-drag-drop-alert-msg").innerHTML = file_name_mod + ' <div onclick="remove_file_from_attachment_livechat()" id="easychat-livechat-remove-attachment" class="easychat-dragdropAlertMsgClose__XPS" style="color: ' + BOT_THEME_COLOR + ';width:20px;height:20px;position:relative;margin-left:5px;">' + get_cross_button_svg() + '</div>'
                    }
                    else {
                        document.getElementById("easychat-drag-drop-alert-msg").innerHTML = file_name_mod + ' <span onclick="remove_file_from_attachment_livechat()" id="easychat-livechat-remove-attachment" class="easychat-dragdropAlertMsgClose__XPS" style="color: ' + BOT_THEME_COLOR + ';">' + get_cross_button_svg() + '</span>'
                    }
                    document.getElementById("easychat-drag-drop-upload-btn").style.display = "inline-block"
                    setTimeout(function () {
                        scroll_to_bottom();
                    }, 300);
                    document.getElementById("easychat-img-div").style.display = "none"
                    document.getElementById("easychat-img-div-previous").style.display = "flex"
                    user_has_uploaded_previous_file = false


                } else {
                    // document.getElementById("easychat-drag-drop-alert-msg").style.display = "inline-block"
                    // document.getElementById("easychat-drag-drop-alert-msg").style.fontSize = "unset"
                    // document.getElementById("easychat-drag-drop-alert-msg").style.color = "red"
                    // document.getElementById("easychat-drag-drop-alert-msg").textContent = "Please Select a file < 5MB*"
                    // try{
                    //  document.getElementsByClassName('easychat-drag-drop-after-select')[docume,nt.getElementsByClassName('easychat-drag-drop-after-select').length - 1].style.width = '55%';
                    //  document.getElementsByClassName('easychat-drag-drop-after-select')[document.getElementsByClassName('easychat-drag-drop-after-select').length - 1].style.textAlign = 'center';
                    //  }catch(err){}
                    // document.getElementById("easychat-drag-drop-upload-btn").style.display = "none"
                    // document.getElementById("easychat-chat-container").classList.remove("easychat-drag-drop-after-select");
                    // console.log(document.getElementById("easychat-chat-container").classList)
                    
                    append_system_text_response(LIVECHAT_EXCEED_FILE_SIZE_TEXT);
                    save_customer_chat(LIVECHAT_EXCEED_FILE_SIZE_TEXT, livechat_session_id, "System", "", "", "", "");
                    scroll_to_bottom()

                }
            } else {
                playSound(STATIC_MP3_PATH + '/juntos1.mov');
                append_system_text_response(LIVECHAT_VALID_FILE_TEXT);
                save_customer_chat(LIVECHAT_VALID_FILE_TEXT, livechat_session_id, "System", "", "", "", "");
                scroll_to_bottom()
                document.getElementById("easychat-livechat-uploadfile").value = "";
            }
        }
    }


}


function save_attachment_to_data_models_livechat() {


    if (EASYCHAT_BOT_THEME == "theme_1") {
        var uploaded_attachment_container = document.getElementById("livechat-user-upload-attachment-div");
        document.getElementById("easychat-drag-drop-upload-btn").remove();
        document.getElementById("easychat-livechat-remove-attachment").remove();

        html = '<div class="upload-file-loader" style="display:block;">\
                <div class="progressbar" data-animate="false">\
                    <button class="delete-choose-file" onclick="stop_uploading_file_livechat()">'
            + FILE_LOADER_SVG +
            '</button>\
                    <div class="circle" data-percent="100">\
                        <div class="circle-progress-value"></div>\
                    </div>\
                    </div>';
        uploaded_attachment_container.innerHTML += html;
    }

    disable_user_input();
    var upload_attachment_data = document.querySelector('#easychat-livechat-uploadfile').files[0]

    var reader = new FileReader();
    reader.readAsDataURL(upload_attachment_data);
    reader.onload = function () {

        base64_str = reader.result.split(",")[1];

        uploaded_file = [];
        uploaded_file.push({
            "filename": upload_attachment_data.name,
            "base64_file": base64_str,
            "user_id": user_id
        });

        upload_livechat_attachment();
    };

    reader.onerror = function (error) {
        console.log('Error: ', error);
    };
}

function upload_livechat_attachment() {
    var attached_file_src = "";

    var json_string = JSON.stringify(uploaded_file)
    json_string = encrypt_variable(json_string)

    encrypted_data = {
        "Request": json_string
    }

    var params = JSON.stringify(encrypted_data);

    xhttp_livechat_attachment = new XMLHttpRequest();
    xhttp_livechat_attachment.open("POST", "/chat/upload-attachment/", true);
    xhttp_livechat_attachment.setRequestHeader('Content-Type', 'application/json');

    if (EASYCHAT_BOT_THEME != "theme_2") {
        var progress_circle = $('.circle');

        progress_circle.circleProgress({
            startAngle: -Math.PI / 2,
            value: 0.0,
            size: 40,
            thickness: 4,
            emptyFill: "#eeeaef",
            fill: { color: BOT_THEME_COLOR }
        });

        xhttp_livechat_attachment.upload.onprogress = function (e) {
            let upload_value = (e.loaded / e.total).toFixed(2);
            progress_circle.circleProgress('value', upload_value).on('circle-animation-progress', function (event, progress, stepValue) {
                $('.circle-progress-value').text((stepValue * 100).toFixed(0) + "%");
            });
        };
    }

    xhttp_livechat_attachment.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {

            response = this.response
            response = JSON.parse(response)
            response = custom_decrypt(response)
            response = JSON.parse(response);
            if (response.status == 200) {
                attached_file_src = response.src;
                attached_preview_file_src = window.location.origin + response['preview_file_path']
                attached_file_name = response.name;
                try {
                    thumbnail_url = response.thumbnail_url;
                    preview_thumbnail_url = window.location.origin + response.preview_thumbnail_url;
                } catch (err) {
                    thumbnail_url = "";
                    preview_thumbnail_url = "";
                }
                var html = get_file_path_html(attached_file_src)
                document.getElementsByClassName("easychat-drag-drop-after-select")[0].parentNode.remove()
                playSound(STATIC_MP3_PATH + '/juntos1.mov');
                // append_user_input("Your attachment has been uploaded")
                append_user_attachment_preview(attached_file_name, response['preview_file_path'], preview_thumbnail_url)
                scroll_to_bottom()
                if (thumbnail_url == "" || thumbnail_url == undefined) {
                    send_message_to_server("", user_id, bot_id, bot_name, "", attached_file_src, "", attached_preview_file_src);
                } else {
                    send_message_to_server("", user_id, bot_id, bot_name, "", attached_file_src, thumbnail_url, attached_preview_file_src);
                }
                document.getElementById("easychat-livechat-uploadfile").value = ""
                enable_user_input();
                user_has_uploaded_previous_file = true
                document.getElementById("easychat-img-div").style.display = "flex"
                document.getElementById("easychat-img-div-previous").style.display = "none"
            } else {
                playSound(STATIC_MP3_PATH + '/juntos1.mov');
                append_user_input(LIVECHAT_MALICIOUS_FILE_TEXT);
            }
        }
    }
    xhttp_livechat_attachment.send(params);
}

function remove_file_from_attachment_livechat() {
    document.getElementById("easychat-drag-drop-alert-msg").innerHTML = ""
    document.getElementById("easychat-livechat-uploadfile").value = ""
    if (document.getElementById("easychat-drag-drop-upload-btn")) {
        document.getElementById("easychat-drag-drop-upload-btn").style.display = "none"
    }
    document.getElementsByClassName("easychat-drag-drop-after-select")[0].parentNode.style.display = "none";
    document.getElementsByClassName("easychat-drag-drop-after-select")[0].style.backgroundColor = "unset"
    document.getElementsByClassName("easychat-drag-drop-after-select")[0].style.padding = "0"
    document.getElementsByClassName("easychat-drag-drop-after-select")[0].style.boxShadow = "unset"
    document.getElementsByClassName("easychat-drag-drop-after-select")[0].style.borderRadius = "unset"
    document.getElementById("easychat-dragdropbottyping-loader").style.display = "none"
    document.getElementsByClassName("easychat-drag-drop-after-select")[0].remove()
    document.getElementById("easychat-img-div-previous").style.display = "none";
    document.getElementById("easychat-img-div").style.display = "flex";
    user_has_uploaded_previous_file = true;
}

function stop_uploading_file_livechat() {
    xhttp_livechat_attachment.abort();
    document.getElementsByClassName("upload-file-loader")[0].style.display = "none";
    remove_file_from_attachment_livechat();
}

function append_user_response(user_input, time) {
    var current_text_direction = get_text_direction()
    html = '<div class="easychat-user-message-div"><div class="easychat-message-animation easychat-user-message easychat-user-message-line" style="direction: ' + current_text_direction + ';background-color:' + BOT_THEME_COLOR + ';color: ' + USER_MESSAGE_COLOR + '">' + user_input + '<span class="message-time-user">' + time + '&nbsp;&nbsp;<div style="display:inline-block;" ><img class="doubletick_easychat" src="' + EASYCHAT_IMG_PATH + 'doubletick_blue.svg" style="height:1.5em;"></div></span></div></div>';
    $("#easychat-chat-container").append(html);

}

function get_text_direction() {
    if (typeof pointer_direction === 'undefined') {
        pointer_direction = 'ltr'
    }

    return pointer_direction
}
function append_bot_response_livechat(agent_response, time) {
    var html = '<div class="easychat-bot-message-div" ><div class="easychat-bot-message easychat-bot-message-line" style="color: ' + BOT_MESSAGE_COLOR + '; word-break: break-word;box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2) !important;" ><div class="easychat-show-less-text">' + agent_response + '</div>'
    html += '<span class="message-time-bot">' + time + '</span></div></div>'
    // html += '<div style="margin-left: 45px;color: #757575;font-size: 10px">'+time+'</div> '
    $("#easychat-chat-container").append(html);
}

function sleep(milliseconds) {

    const date = Date.now();
    let currentDate = null;
    do {
        currentDate = Date.now();
    } while (currentDate - date < milliseconds);
}

window.onclick = function (event) {
    var drop_btn_matches = event.target.matches ? event.target.matches('.dropbtn') : event.target.msMatchesSelector('.dropbtn');
    var drop_search_matches = event.target.matches ? event.target.matches('.dropdown-search') : event.target.msMatchesSelector('.dropdown-search');

    if (!drop_btn_matches && !drop_search_matches) {
        $(".easychat-widget-dropdown-content").removeClass("easychat-display-dropdown");
    }
}

////////////////////////// OPEN LOCAL DB FOR SUGGESTIONS START/////////////////////////////
function open_local_db() {
    window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
    window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction || { READ_WRITE: "readwrite" };
    window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange;

    if (!window.indexedDB) {
        console.log("Your browser doesn't support a stable version of IndexedDB.");
        is_indexed_db_supported = false;
        return;
    }

    var openRequest = window.indexedDB.open(db_name, 1);

    openRequest.onerror = function () {
        is_indexed_db_supported = false
        console.error("Error", openRequest.error);
    };

    openRequest.onsuccess = function (event) {
        db = event.target.result;
        get_messages_from_local()
    };
}

function get_object_store(store_name, mode) {
    try {
        var tx = db.transaction(store_name, mode);
        return tx.objectStore(store_name);
    } catch (err) {
        console.log(err);
        return -1
    }
}
function get_messages_from_local() {
    try {
        var suggestion_list_store = get_object_store(table_name, 'readwrite');
        var index = suggestion_list_store.index('table_index');
        var key = IDBKeyRange.only(table_index);
        var data = []
        index.openCursor(key, "next").onsuccess = function (event) {
            var cursor = event.target.result;
            if (cursor) {
                is_data_present = true;
                data.push(cursor.value)
                cursor.continue();
                suggestion_list = data[0]['suggestion_list']

                if (is_web_worker_supported) {
                    worker_for.postMessage(JSON.stringify({
                        id: 'update_options',
                        value: suggestion_list,
                    }))
                } else {
                    fuzzyhound.setOptions({
                        source: suggestion_list,
                        keys: ["key"],
                        score_test_fused: true,
                        score_per_token: true,
                        score_acronym: true,
                    })
                }
            }
        };
    } catch (err) {
        console.log(err);
    }
}
////////////////////////// OPEN LOCAL DB FOR SUGGESTIONS END /////////////////////////////


///////////////////////// EASYCHAT FEEDBACK START ////////////////////////
function submit_button_text() {
    if (csat_feedback_form_enabled == true) {
        document.getElementById("submit-btn").innerHTML = "Next"
    } else {
        document.getElementById("submit-btn").innerHTML = "Submit"
    }
}

$('#feedback-value').on('input', function () {
    feedbackValueFunc();
});
var range = document.getElementById('feedback-value');
var rangeV = document.getElementById('rangeV');

function feedbackValueFunc(el) {

    if (el.id == 'angry-emoji-div') {
        document.getElementById('angry-emoji-div').src = EASYCHAT_IMG_PATH + 'angry-emoji-animate.gif';
        document.getElementById('sad-emoji-div').src = EASYCHAT_IMG_PATH + 'sad-emoji.svg';
        document.getElementById('happy-emoji-div').src = EASYCHAT_IMG_PATH + 'happy-emoji.svg';
        if (document.getElementById('unhappy-emoji-div')) {
            document.getElementById('unhappy-emoji-div').src = EASYCHAT_IMG_PATH + 'unhappy-emoji.svg';
        }
        document.getElementById('inlove-emoji-div').src = EASYCHAT_IMG_PATH + 'in-love-emoji.svg';
        document.getElementById('angry-emoji-div').style.width = '52px';
        document.getElementById('angry-emoji-div').style.height = '52px';
        contentvalue = 1

    } else {
        document.getElementById('angry-emoji-div').style.width = '45px';
        document.getElementById('angry-emoji-div').style.height = '45px';
    }

    if (el.id == 'sad-emoji-div') {
        document.getElementById('sad-emoji-div').src = EASYCHAT_IMG_PATH + 'sad-emoji-animate.gif';
        document.getElementById('angry-emoji-div').src = EASYCHAT_IMG_PATH + 'angry-emoji.svg';
        if (document.getElementById('unhappy-emoji-div')) {
            document.getElementById('unhappy-emoji-div').src = EASYCHAT_IMG_PATH + 'unhappy-emoji.svg';
        }
        document.getElementById('happy-emoji-div').src = EASYCHAT_IMG_PATH + 'happy-emoji.svg';
        document.getElementById('inlove-emoji-div').src = EASYCHAT_IMG_PATH + 'in-love-emoji.svg';
        document.getElementById('sad-emoji-div').style.width = '52px';
        document.getElementById('sad-emoji-div').style.height = '52px';
        contentvalue = 2
    } else {
        document.getElementById('sad-emoji-div').style.width = '45px';
        document.getElementById('sad-emoji-div').style.height = '45px';
    }

    if (el.id == 'unhappy-emoji-div') {
        document.getElementById('sad-emoji-div').src = EASYCHAT_IMG_PATH + 'sad-emoji.svg';
        document.getElementById('angry-emoji-div').src = EASYCHAT_IMG_PATH + 'angry-emoji.svg';
        document.getElementById('unhappy-emoji-div').src = EASYCHAT_IMG_PATH + 'unhappy-emoji-animate.gif';
        document.getElementById('happy-emoji-div').src = EASYCHAT_IMG_PATH + 'happy-emoji.svg';
        document.getElementById('inlove-emoji-div').src = EASYCHAT_IMG_PATH + 'in-love-emoji.svg';
        document.getElementById('unhappy-emoji-div').style.width = '52px';
        document.getElementById('unhappy-emoji-div').style.height = '52px';
        contentvalue = 3
    } else {
        if (document.getElementById('unhappy-emoji-div')) {
            document.getElementById('unhappy-emoji-div').style.width = '45px';
            document.getElementById('unhappy-emoji-div').style.height = '45px';
        }
    }


    if (el.id == 'happy-emoji-div') {
        document.getElementById('happy-emoji-div').src = EASYCHAT_IMG_PATH + 'happy-emoji-animate.gif';

        document.getElementById('angry-emoji-div').src = EASYCHAT_IMG_PATH + 'angry-emoji.svg';

        if (document.getElementById('unhappy-emoji-div')) {
            document.getElementById('unhappy-emoji-div').src = EASYCHAT_IMG_PATH + 'unhappy-emoji.svg';
            contentvalue = 4
        } else {
            contentvalue = 3
        }

        document.getElementById('sad-emoji-div').src = EASYCHAT_IMG_PATH + 'sad-emoji.svg';

        document.getElementById('inlove-emoji-div').src = EASYCHAT_IMG_PATH + 'in-love-emoji.svg';
        document.getElementById('happy-emoji-div').style.width = '52px';
        document.getElementById('happy-emoji-div').style.height = '52px';

    } else {
        document.getElementById('happy-emoji-div').style.width = '45px';
        document.getElementById('happy-emoji-div').style.height = '45px';
    }

    if (el.id == 'inlove-emoji-div') {
        document.getElementById('inlove-emoji-div').src = EASYCHAT_IMG_PATH + 'in-love-emoji-animate.gif';
        document.getElementById('angry-emoji-div').src = EASYCHAT_IMG_PATH + 'angry-emoji.svg';

        if (document.getElementById('unhappy-emoji-div')) {
            document.getElementById('unhappy-emoji-div').src = EASYCHAT_IMG_PATH + 'unhappy-emoji.svg';
            contentvalue = 5
        } else {
            contentvalue = 4
        }
        document.getElementById('sad-emoji-div').src = EASYCHAT_IMG_PATH + 'sad-emoji.svg';
        document.getElementById('happy-emoji-div').src = EASYCHAT_IMG_PATH + 'happy-emoji.svg';
        document.getElementById('inlove-emoji-div').style.width = '52px';
        document.getElementById('inlove-emoji-div').style.height = '52px';
    } else {
        document.getElementById('inlove-emoji-div').style.width = '45px';
        document.getElementById('inlove-emoji-div').style.height = '45px';
    }
}

function clicked_on_emoji(element) {
    element_classname = element.className
    rating_value = 1

    if (element_classname == "quarter-rating") {
        rating_value = 1
    }
    else if (element_classname == "half-rating") {
        rating_value = 2
    }
    else if (document.getElementById("unhappy-emoji-div")) {
        if (element_classname == "three-quarter-rating") {
            rating_value = 3
        }
        else if (element_classname == "four-quarter-rating") {
            rating_value = 4
        } else {
            rating_value = 5
        }
    } else {

        if (element_classname == "three-quarter-rating") {
            rating_value = 3
        }
        else {
            rating_value = 4
        }

    }
    contentvalue = rating_value

    submit_feedback();
}


///////////////////////// EASYCHAT FEEDBACK END ////////////////////////

///////////////////////// GET CLIENT LOCATION DETAILS START ////////////////////////

//Get the latitude and the longitude;
function location_success(position) {
    var lat = position.coords.latitude;
    var lng = position.coords.longitude;
    get_location_with_coordinates(lat, lng);
}

function location_error() {
    console.log("Geocoder failed");
    client_location_city = null;
    client_location_state = null;
    client_location_pincode = null;
}

function initialize_client_location() {
    try {
        geocoder = new google.maps.Geocoder();

        if (navigator.geolocation) {

            navigator.geolocation.getCurrentPosition(location_success, location_error);
        }
    } catch (err) {

        console.log("Geo-location not provided " + err) // debugging purpose
    }
}

function get_location_with_coordinates(lat, lng) {

    var latlng = new google.maps.LatLng(lat, lng);
    geocoder.geocode({ 'latLng': latlng }, function (results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
            if (results[0]) {
                city = results[0].address_components[results[0].address_components.length - 5]['long_name'];
                state = results[0].address_components[results[0].address_components.length - 3]['long_name'];
                pincode = results[0].address_components[results[0].address_components.length - 1]['long_name'];
                client_location_city = city;
                client_location_state = state;
                client_location_pincode = pincode;
            }
            else {
                console.log("address not found");
            }
        } else {
            console.log("Geocoder failed due to: " + status);
        }
    });
}

function mute_unmute_speech_for_welcome_screen(only_update_icon=false) {

      if(!is_text_to_speech_required) return;
        var unmute_icon = document.getElementById('easychat-unmute-icon');
        var mute_icon = document.getElementById('easychat-mute-icon');

        var welcome_screen_unmute_icon = document.getElementById('welcome-screen-easychat-unmute-icon');
        var welcome_screen_mute_icon = document.getElementById('welcome-screen-easychat-mute-icon');
        if(only_update_icon) {
            if(is_mute()) {
                welcome_screen_unmute_icon.style.display = 'none';
                welcome_screen_mute_icon.style.display = 'block';
            } else {
                welcome_screen_unmute_icon.style.display = 'block';
                welcome_screen_mute_icon.style.display = 'none';
            }
            return;
        }
        if (!is_mute()) {
            unmute_icon.style.display = 'none';
            mute_icon.style.display = 'block';

            welcome_screen_unmute_icon.style.display = 'none';
            welcome_screen_mute_icon.style.display = 'block';

            // if (speech_synthesis_instance) speech_synthesis_instance.cancel();
            cancel_text_to_speech()

            document.getElementById('tooltiptext-speaker-welcome-screen').innerHTML = UNMUTE_TEXT;
        } else {
            unmute_icon.style.display = 'block';
            mute_icon.style.display = 'none';
            welcome_screen_unmute_icon.style.display = 'block';
            welcome_screen_mute_icon.style.display = 'none';

            document.getElementById('tooltiptext-speaker-welcome-screen').innerHTML = MUTE_TEXT;
        }
        if(only_update_icon) return;
        is_text_to_speech_muted = !is_text_to_speech_muted
}

function mute_unmute_speech(only_update_icon=false) {
    var unmute_icon = document.getElementById('easychat-unmute-icon');
    var mute_icon = document.getElementById('easychat-mute-icon');
    if(only_update_icon) {
        if(is_mute()) {
            unmute_icon.style.display = 'none';
            mute_icon.style.display = 'block';
        } else {
            unmute_icon.style.display = 'block';
            mute_icon.style.display = 'none';
        }
        return;
    }
    if (!is_mute()) {
        unmute_icon.style.display = 'none';
        mute_icon.style.display = 'block';

        // if (speech_synthesis_instance) speech_synthesis_instance.cancel();
        cancel_text_to_speech()

        document.getElementById('tooltiptext-speaker').innerHTML = UNMUTE_TEXT;
    } else {
        unmute_icon.style.display = 'block';
        mute_icon.style.display = 'none';

        document.getElementById('tooltiptext-speaker').innerHTML = MUTE_TEXT;
    }
    is_text_to_speech_muted = !is_text_to_speech_muted;
}

function mute_unmute_for_mobile_device() {

    var unmute_icon = document.getElementById('bot-header-dropdown-unmute-icon');
    var mute_icon = document.getElementById('bot-header-dropdown-mute-icon');
    var unmute_text = document.getElementById('bot-header-dropdown-unmute-text');
    var mute_text = document.getElementById('bot-header-dropdown-mute-text');

    if (!is_mute_mobile()) {
        unmute_icon.style.display = 'none';
        mute_icon.style.display = 'flex';
        unmute_text.style.display = 'none';
        mute_text.style.display = 'flex';

        // if (speech_synthesis_instance) speech_synthesis_instance.cancel();
        cancel_text_to_speech()

    } else {
        unmute_icon.style.display = 'flex';
        mute_icon.style.display = 'none';
        unmute_text.style.display = 'flex';
        mute_text.style.display = 'none';
    }
    is_text_to_speech_muted = !is_text_to_speech_muted
}

function is_mute_mobile() {
    try {
        if (is_livechat_enabled()) {
            return true
        }
        // currently this is only fr theme 3
        return is_text_to_speech_muted
    } catch (err) {
        return !is_text_to_speech_required;
    }
}

function is_mute() {
    if(!is_text_to_speech_required) return true;
    return is_text_to_speech_muted;
}
///////////////////////// GET CLIENT LOCATION DETAILS END ////////////////////////

//////// Polyfil for repeat method of string type object ////////////
if (!String.prototype.repeat) {
    String.prototype.repeat = function (count) {
        'use strict';
        if (this == null)
            throw new TypeError('can\'t convert ' + this + ' to object');

        var str = '' + this;
        // To convert string to integer.
        count = +count;
        // Check NaN
        if (count != count)
            count = 0;

        if (count < 0)
            throw new RangeError('repeat count must be non-negative');

        if (count == Infinity)
            throw new RangeError('repeat count must be less than infinity');

        count = Math.floor(count);
        if (str.length == 0 || count == 0)
            return '';

        // Ensuring count is a 31-bit integer allows us to heavily optimize the
        // main part. But anyway, most current (August 2014) browsers can't handle
        // strings 1 << 28 chars or longer, so:
        if (str.length * count >= 1 << 28)
            throw new RangeError('repeat count must not overflow maximum string size');

        var maxCount = str.length * count;
        count = Math.floor(Math.log(count) / Math.log(2));
        while (count) {
            str += str;
            count--;
        }
        str += str.substring(0, maxCount - str.length);
        return str;
    }
}
/////// End polyfil for repeat method of string type object /////////////////////

////// Includes Polyfill ////
if (!String.prototype.includes) {
    String.prototype.includes = function (search, start) {
        'use strict';

        if (search instanceof RegExp) {
            throw TypeError('first argument must not be a RegExp');
        }
        if (start === undefined) { start = 0; }
        return this.indexOf(search, start) !== -1;
    };
}
////// End Includes polyfill ///////

// ScrollBy polyfill //
if (!window.scrollBy) {
    window.scrollBy = function (x, y) {
        if (x) $('html, body').scrollLeft($(window).scrollLeft() + x);
        if (y) $('html, body').scrollTop($(window).scrollTop() + y);
    };
}

if (!Element.prototype.scrollBy) {
    Element.prototype.scrollBy = function (x, y) {
        if (x) $(this).scrollLeft($(this).scrollLeft() + x);
        if (y) $(this).scrollTop($(this).scrollTop() + y);
    };
}

// ScrollBy Polyfill //

// Speaker functions //
function handleMicIconOn(element) {
    element.style.display = "none";
    element.nextElementSibling.style.display = "block";
    cancel_text_to_speech();
    is_text_to_speech_muted = true
}
function handleMicIconOff(element) {
    element.style.display = "none";
    element.previousElementSibling.style.display = "block";
    is_text_to_speech_muted = false;
    if($("#bot_frequently_questions_answer").is(':visible')) {
        text_to_speech($('#faq_text_response').text())
        return;
    }
    text_to_speech(element.parentElement.parentElement.getElementsByClassName("easychat-show-less-text")[0].innerText);
}
// Speaker function end //

// Spell check while typing function //
function position_cursor() {

    const el = document.getElementById('user_input');
    const selection = window.getSelection();
    const range = document.createRange();
    selection.removeAllRanges();
    range.selectNodeContents(el);
    range.collapse(false);
    selection.addRange(range);
    el.focus();


}

function call_spell_check_api(word, sentence_list) {
    $.ajax({
        type: "GET",
        url: SPELL_CHECK_API_ENDPOINT + "?word=" + word + "&spell_check_id=" + SPELL_CHECK_ID,
        dataType: 'json',
        success: function (result) {
            if (result.status == 200) {
                if (word != result.corrected_word) {
                    var final_sentence = "";

                    if (SPELL_CHECK_WHITELISTED_SPECIAL_CHARS.includes(word[word.length - 1])) {
                        result.corrected_word += word[word.length - 1];
                    }

                    sentence_list[sentence_list.length - 1] = result.corrected_word;
                    final_sentence = sentence_list.join(" ") + " ";

                    edit_user_input_based_on_theme(final_sentence);

                    is_cancel_corrected_word = true;
                    previous_word = word;

                }
            } else {
                console.log("Spell check API failed: " + JSON.stringify(result) + " Please report this error.");
                is_cancel_corrected_word = false;
            }
        },
        error: function (xhr, textstatus, errorthrown) {
            console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
        }
    });
}

function spell_check(e) {

    // Disabling spell check in other language when phonetic typing is enabled as it is conflicting with phonetic typing
    if (SELECTED_LANGUAGE != "en" && IS_PHONETIC_TYPING_ENABLED.toString().toLowerCase() == "true") {
        return;
    }

    var is_space_entered = false;
    if (e.keyCode == 229) {
        if (e.target.tagName == "INPUT") {
            if (e.target.value.charAt(e.target.selectionStart - 1).charCodeAt() == 32) {
                is_space_entered = true;
            }
        } else {
            if (e.target.innerText.charAt(e.target.innerText.length - 1).charCodeAt() == 32) {
                is_space_entered = true;
            };
        }
    }

    if ((e.keyCode == 32 || is_space_entered) && is_spell_check_while_typing_enabled && !is_backspace_clicked) {
        var sentence = "";
        var last_word = "";
        if (e.target.tagName == "INPUT") {
            sentence = e.target.value.trim().split(" ");
        } else {
            sentence = e.target.innerText.trim().split(" ");
        }

        last_word = sentence[sentence.length - 1];

        if (last_word != "" && !(WORDS_LIST.includes(last_word.toLowerCase()))) {
            call_spell_check_api(last_word, sentence);
        } else {
            is_cancel_corrected_word = false;
        }
    } else if (e.keyCode == 8 && is_cancel_corrected_word) {

        is_cancel_corrected_word = false;
        is_backspace_clicked = true;

        var sentence = "";
        var final_sentence = "";

        if (e.target.tagName == "INPUT") {
            sentence = e.target.value.trim().split(" ");
        } else {
            sentence = e.target.innerText.trim().split(" ");
        }

        sentence[sentence.length - 1] = previous_word;
        final_sentence = sentence.join(" ");

        edit_user_input_based_on_theme(final_sentence);

    } else {
        is_backspace_clicked = false;
        is_cancel_corrected_word = false;
    }
}

function handle_enable_response_form_assist() {
    if (enable_response_form_assist == 'false') {
        if (EASYCHAT_BOT_THEME == "theme_1") {
            $('#user_actions_div').hide();
            $('#easychat-sticky').hide();
        } else if (EASYCHAT_BOT_THEME == "theme_2") {
            $('#easychat-footer').hide();
            $('#easychat-sticky').hide();
        } else if (EASYCHAT_BOT_THEME == "theme_3") {
            if (!$('.easychat-bot-language-div').length) {
                $('#user_actions_div').hide();
            } else {
                $('.easychat-bot-sticky-menu-wrapper').hide()
                $('#user_actions_div').addClass('form-assist-disabled')
                $('#user_input').hide()
                $('#user_input_placeholder_text').hide()
                if (!$('#form_assist_mic_button_fix').length) {
                    let html = '<div id="form_assist_mic_button_fix"></div>'
                    $('#easychat-query-mic-send-icon-wrapper').append(html)
                }
            }
        }
        resize_chabot_window();
    }
}

// Update dependent fields form widget 

function update_dependent_fields(form_fields_list, index, selected_option, form_id) {

    let field_ids = form_fields_list[index].dependent_field_ids;

    field_ids = field_ids.split('$$$');

    let url_parameters = get_url_vars();
    let bot_id = url_parameters["id"];
    let channel_name = url_parameters["channel"]
    if (channel_name == undefined || channel_name == null)
        channel_name = "Web"
    let user_id = get_easychat_user_id();

    field_ids.forEach(function (field_id) {
        var json_string = JSON.stringify({
            field_id: field_id,
            selected_option: selected_option,
            bot_id: bot_id,
            channel_name: channel_name,
            user_id: user_id,
            web_page_source: decodeURIComponent(url_parameters["web_page_source"]),
        });
        json_string = encrypt_variable(json_string);
        json_string = encodeURIComponent(json_string);

        var xhttp = new XMLHttpRequest();
        var params = 'json_string=' + json_string
        xhttp.open("POST", "/chat/update-form-widget-dependent-fields/", true);
        xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                response = JSON.parse(this.responseText);
                response = custom_decrypt(response)
                response = JSON.parse(response);
                if (response['status'] == 200) {
                    var field_id = response["field_id"];
                    let input_type;
                    let current_field_index;
                    for (let i = 0; i < form_fields_list.length; i++) {
                        if (field_id == form_fields_list[i].field_id_num) {
                            input_type = form_fields_list[i].input_type;
                            current_field_index = i;
                            break;
                        }
                    }

                    var temp_field_id = form_id + "_" + field_id

                    if (input_type == 'dropdown_list') {
                        let options = response['options'].split('$$$')
                        $('#input-' + temp_field_id).children().remove();
                        for (let i = 0; i < options.length; i++) {
                            $('#input-' + temp_field_id).append('<option value="' + options[i] + '">' + options[i] + '</option>');
                        }
                        $('#input-' + temp_field_id).val('').trigger('change');
                    } else if (input_type == 'radio') {
                        add_dependent_radio_field(form_fields_list, field_id, current_field_index, response['options'], form_id)
                    } else if (input_type == 'text_field') {
                        $('#input-' + temp_field_id).val(response['text_field_value']).trigger('keyup');
                        $('#input-' + temp_field_id).trigger("focusout");
                    } else if (input_type == 'checkbox') {
                        add_dependent_checkbox_field(form_fields_list, field_id, current_field_index, response['options'], form_id);
                    } else if (input_type == 'range') {
                        add_dependent_range_field(form_fields_list, field_id, current_field_index, form_id)
                    } else if (input_type == 'phone_number') {

                        var set_country = $('#country_phone_number_input-' + temp_field_id).intlTelInput("setCountry", response["phone_widget_data"][0])
                        if (set_country == null) {
                            $('#country_phone_number_input-' + temp_field_id).intlTelInput("setCountry", "in")
                        }

                        $('#country_phone_number_input-' + temp_field_id).val(response["phone_widget_data"][1]).trigger('keyup');
                        $('#country_phone_number_input-' + temp_field_id).trigger("focusout");

                    }
                }
            }
        }
        xhttp.send(params);
    })
}

function add_dependent_checkbox_field(form_fields_list, field_id, current_field_index, options, form_id) {
    var temp_field_id = form_id + "_" + field_id;
    let checkboxes = document.querySelectorAll('.cls-' + temp_field_id)
    checkboxes.forEach(function (checkbox) {
        if (checkbox.checked) {
            $(checkbox).prop("checked", false).trigger("change");
        }
    });
    $('#parent-input-' + temp_field_id).html('')
    let html = ''
    let optional_html = ''
    if (form_fields_list[current_field_index].optional == 'false') {
        optional_html = '<span style="color: red;">*</span>'
    }
    html = '<label for="' + temp_field_id + '">' + form_fields_list[current_field_index].label_name + optional_html + '</label>'
    html += get_form_checkbox_html(temp_field_id, options)
    $('#parent-input-' + temp_field_id).html(html);
    if (form_fields_list[current_field_index].is_dependent == 'true') {
        let checkboxes = document.querySelectorAll('.cls-' + temp_field_id)
        checkboxes.forEach(function (checkbox) {
            checkbox.addEventListener('change', function () {
                let checked_checkboxes = []
                for (let j = 0; j < checkboxes.length; j++) {
                    if (checkboxes[j].checked) {
                        checked_checkboxes.push(checkboxes[j].value)
                    }
                }
                checked_checkboxes = checked_checkboxes.join('$$$');
                update_dependent_fields(form_fields_list, current_field_index, checked_checkboxes, form_id);
            });
        });
        update_dependent_fields(form_fields_list, current_field_index, '', form_id);
    }
}

function add_dependent_radio_field(form_fields_list, field_id, current_field_index, options, form_id) {
    var temp_field_id = form_id + "_" + field_id
    $('#parent-input-' + temp_field_id).html('')
    let html = ''
    let optional_html = ''
    if (form_fields_list[current_field_index].optional == 'false') {
        optional_html = '<span style="color: red;">*</span>'
    }
    html = '<label for="' + temp_field_id + '">' + form_fields_list[current_field_index].label_name + optional_html + '</label>'
    html += '<input type="radio" class="easychat-radio" name="radio_button-' + temp_field_id + '" onchange="handleFormRadio(this,\'' + temp_field_id + '\')" onclick="update_answers_filled(this)" data-type="radio"  id="easychat-radio-' + temp_field_id + '-"  value="">'
    html += get_form_radio_html(temp_field_id, options)
    $('#parent-input-' + temp_field_id).html(html);
    $("#easychat-radio-" + temp_field_id + "-").prop("checked", true).trigger("click");
    if (form_fields_list[current_field_index].is_dependent == 'true') {
        $('input[name=radio_button-' + temp_field_id + ']').on("change", function () {
            update_dependent_fields(form_fields_list, current_field_index, this.value, form_id);
        });
        update_dependent_fields(form_fields_list, current_field_index, '', form_id);
    }
}

function add_dependent_range_field(form_fields_list, field_id, current_field_index, form_id) {
    var temp_field_id = form_id + "_" + field_id;
    $('#parent-input-' + temp_field_id).html('')
    let html = ''
    let optional_html = ''
    if (form_fields_list[current_field_index].optional == 'false') {
        optional_html = '<span style="color: red;">*</span>'
    }
    html = '<label for="' + temp_field_id + '">' + form_fields_list[current_field_index].label_name + optional_html + '</label>'
    let range_values = response['range_slider_min_value'] + '-' + response['range_slider_max_value']
    if (form_fields_list[current_field_index].range_type.includes('Single')) {
        html += get_form_append_single_bot_range_slider("input-" + temp_field_id, range_values);
        $('#parent-input-' + temp_field_id).html(html);
        form_range_slider_initializations("input-" + temp_field_id);
        if (form_fields_list[current_field_index].is_dependent == 'true') {
            $('#easychat-single-range-input-' + temp_field_id).on("change", function () {
                setTimeout(function () {
                    update_dependent_fields(form_fields_list, current_field_index, $('#easychat-single-range-input-' + temp_field_id).val(), form_id);
                }, 100)
            })
            update_dependent_fields(form_fields_list, current_field_index, '', form_id);
        }
    } else {
        html += get_form_append_multi_bot_range_slider("input-" + temp_field_id, range_values)
        $('#parent-input-' + temp_field_id).html(html);
        form_multi_range_slider_initializations("input-" + temp_field_id);
        if (form_fields_list[current_field_index].is_dependent == 'true') {
            $('#js-range-slider-' + temp_field_id).on("change", function () {
                setTimeout(function () {
                    let range_min_value = $('#easychat-bot-range-min-selected-value-input-' + temp_field_id).val()
                    let range_max_value = $('#easychat-bot-range-max-selected-value-input-' + temp_field_id).val()
                    let range_values = range_min_value + '$$$' + range_max_value
                    update_dependent_fields(form_fields_list, current_field_index, range_values, form_id)
                }, 100)
            })
            update_dependent_fields(form_fields_list, current_field_index, '', form_id);
        }
    }
}

///////////////////////////////// Theme 4 Specific functions start /////////////////////////////////

function append_faq_intents(faq_intents) {
    if (faq_intents && faq_intents.length) {
        let html = '<div class="easychat-bot-frequently-asked-questions-wrapper" id="bot_frequently_asked_question_wrapper">\
        <div class="frequently-asked-questions-main-header ">\
            <button class="frequently-asked-questions-back-btn" id="frequently_asked_questions_back_btn" onclick="view_less_faq_intents()">\
                <svg class="rotate-in-rtl" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\
                    <path\
                        d="M7.19702 11.6798C7.1965 11.256 7.37851 10.8526 7.69653 10.5725L14.8383 4.28957C15.3305 3.87655 16.0624 3.93201 16.4867 4.41448C16.9111 4.89694 16.8727 5.62993 16.4002 6.0654L10.155 11.5594C10.1203 11.5898 10.1005 11.6337 10.1005 11.6798C10.1005 11.7259 10.1203 11.7698 10.155 11.8002L16.4002 17.2942C16.729 17.57 16.8825 18.0023 16.8014 18.4237C16.7204 18.8451 16.4174 19.1896 16.0098 19.3238C15.6022 19.458 15.1538 19.3608 14.8383 19.07L7.6991 12.789C7.3803 12.5084 7.19743 12.1044 7.19702 11.6798Z"\
                        fill=" ' + BOT_THEME_COLOR + '" />\
                </svg>\
            </button>\
            <span class="frequently-asked-questions-main-header-text">' + FAQ_TEXT + '</span>\
            <div id="faq_tooltip_div" class="tooltip-custom" style="width: 20px; height: 16px;">\
                <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">\
                    <path\
                        d="M8.41216 2.20923C11.8866 2.20923 14.703 5.02626 14.703 8.50005C14.703 11.9738 11.8866 14.7909 8.41216 14.7909C4.93774 14.7909 2.12134 11.9738 2.12134 8.50005C2.12134 5.02626 4.93774 2.20923 8.41216 2.20923ZM8.41216 10.7018C8.06472 10.7018 7.78307 10.9835 7.78307 11.3309C7.78307 11.6783 8.06472 11.96 8.41216 11.96C8.75959 11.96 9.04124 11.6783 9.04124 11.3309C9.04124 10.9835 8.75959 10.7018 8.41216 10.7018ZM8.41216 5.19737C7.45672 5.19737 6.68218 5.9719 6.68218 6.92734C6.68218 7.18792 6.89342 7.39915 7.15399 7.39915C7.39285 7.39915 7.59025 7.22165 7.6215 6.99136L7.6258 6.92734C7.6258 6.49305 7.97786 6.14099 8.41216 6.14099C8.84645 6.14099 9.19851 6.49305 9.19851 6.92734C9.19851 7.2663 9.11358 7.43391 8.79281 7.7654L8.70762 7.85188C8.15522 8.40428 7.94034 8.76241 7.94034 9.44367C7.94034 9.70424 8.15158 9.91548 8.41216 9.91548C8.67273 9.91548 8.88397 9.70424 8.88397 9.44367C8.88397 9.10471 8.96889 8.9371 9.28966 8.60561L9.37486 8.51913C9.92726 7.96673 10.1421 7.6086 10.1421 6.92734C10.1421 5.9719 9.36759 5.19737 8.41216 5.19737Z"\
                        fill="#243762" />\
                </svg>\
                <span class="tooltiptext-custom tooltip-top-custom"\
                    id="tooltip-frequently-questions-text">' + FAQ_TOOLTIP + '</span>\
            </div>\
        </div>\
        <div class="easychat-bot-frequently-asked-questions-search-container">\
            <input type="text" class="easychat-bot-frequently-asked-questions-search"\
                id="frequently_asked_questions_input" autocomplete="off" placeholder="' + SEARCH_HERE_TEXT + '"\
                onkeyup="frequently_asked_question_search()">\
            <svg class="frequently-asked-questions-search-icon" width="24" height="24" viewBox="0 0 24 24"\
                fill="#CBCACA" xmlns="http://www.w3.org/2000/svg">\
                <path fill-rule="evenodd" clip-rule="evenodd"\
                    d="M13.8563 14.9043L17.7357 18.7827C18.0259 19.0724 18.496 19.0724 18.7862 18.7827C19.0713 18.4906 19.0713 18.0246 18.7862 17.7324L14.9068 13.854C16.6639 11.5449 16.3309 8.26951 14.145 6.36104C11.9591 4.45258 8.66785 4.56373 6.61573 6.61531C4.56362 8.6669 4.45244 11.9573 6.36139 14.1426C8.27035 16.328 11.5465 16.6609 13.8563 14.9043ZM6.52409 10.5352C6.52409 8.32072 8.31976 6.52551 10.5348 6.52551C12.7488 6.52813 14.5429 8.3218 14.5456 10.5352C14.5456 12.7497 12.7499 14.5449 10.5348 14.5449C8.31976 14.5449 6.52409 12.7497 6.52409 10.5352Z" />\
            </svg>\
        </div>\
        <ul class="easychat-bot-frequently-asked-question-items-wrapper"\
            id="bot_frequently_asked_question_items_wrapper">'
        let faq_intent_style = ''
        for(var i=0; i<faq_intents.length; i++) {
            if (i == 5) {
                faq_intent_style = 'style="display: none;"'
            }
            html += '<li class="easychat-bot-frequently-asked-question-item" ' + faq_intent_style + ' onclick="show_faq_answer(' + faq_intents[i].id + ')">\
                        <a href="#" id="faq_intent_name_'+faq_intents[i].id+'">\
                            ' + faq_intents[i].name + '\
                        </a>\
                        <span>\
                            <svg class="rotate-in-rtl" width="12" height="12" viewBox="0 0 12 12" fill="none"\
                                xmlns="http://www.w3.org/2000/svg">\
                                <path\
                                    d="M4.23123 2.21967C3.92292 2.51256 3.92292 2.98744 4.23123 3.28033L7.09404 6L4.23123 8.71967C3.92292 9.01256 3.92292 9.48744 4.23123 9.78033C4.53954 10.0732 5.03941 10.0732 5.34772 9.78033L8.76877 6.53033C9.07708 6.23744 9.07708 5.76256 8.76877 5.46967L5.34772 2.21967C5.03941 1.92678 4.53954 1.92678 4.23123 2.21967Z"\
                                    fill="#7B7A7B" />\
                            </svg>\
                        </span>\
                    </li>'
        }
        html += '<li class="easychat-bot-frequently-asked-question-item-no-data-found" id="frequently_asked_question_no_data_found">\
                    ' + NO_RESULT_FOUND + '\
                </li>'
        if (faq_intents.length > 5) {
            html += '<li class="easychat-bot-frequently-asked-question-view-all-btn-wrapper">\
                        <button class="easychat-bot-frequently-asked-question-view-all-btn" id="frequently_asked_question_view_all_btn" onclick="view_all_faq_intents(this)">' + VIEW_ALL_TEXT + '</button>\
                    </li>'
        }
        html += '</ul></div>'
        $("#easychat-chat-container").append(html)
    }
}

function show_faq_answer(intent_id) {
    $('#faq_loader').show()
    entered_suggestion = true;
    is_manually_typed_query = false;
    is_conversaion_started = true;
    send_message_to_server(intent_id, user_id, bot_id, bot_name, "None", "", "", "", true);
}

function get_mic_icon_html_theme_four(append_in_faq=false){
    if (!is_text_to_speech_required) return '';
    let is_speech_muted = is_mute()
    let unmute_display = is_speech_muted ? "none" : "block";
    let mute_display = is_speech_muted ? "block" : "none";
    $('.bot-frequently-questions-answer-back-arrow-div .bot-mute-unmute-response-wrapper').remove()
    if (!append_in_faq && document.getElementsByClassName("bot-mute-unmute-response-wrapper").length) {
        document.getElementsByClassName("bot-mute-unmute-response-wrapper")[0].remove();
    }
    return '<div class="bot-mute-unmute-response-wrapper">\
                <div class="bot-mic-icon-on" onclick="handleMicIconOn(this)" id="easychat-unmute-icon" style="display: ' + unmute_display + ';">\
                    <svg class="rotate-in-rtl" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M11.1053 4.64651L6.47368 8.85289L4.24836 8.8529C3.39441 8.8529 3.06031 9.65412 3 10.0547L3.09046 13.6602C3.16283 14.6217 3.83224 14.862 4.15789 14.862H6.47368L11.6842 19.6693C13.0737 20.6308 13.807 19.2687 14 18.4675V5.24742C13.5368 3.32451 11.8772 4.0456 11.1053 4.64651ZM15.5733 8.38319C15.914 8.14755 16.3812 8.23268 16.6168 8.57333C17.0532 9.20412 17.558 10.2723 17.7067 11.5008C17.8577 12.7477 17.6426 14.1954 16.5771 15.479C16.3125 15.7977 15.8397 15.8416 15.521 15.5771C15.2023 15.3125 15.1584 14.8397 15.4229 14.521C16.1685 13.6228 16.3308 12.6159 16.2176 11.681C16.1022 10.7277 15.7015 9.88679 15.3832 9.42667C15.1475 9.08602 15.2327 8.61883 15.5733 8.38319ZM18.5771 5.52097C18.3125 5.20225 17.8397 5.15835 17.521 5.42291C17.2023 5.68748 17.1584 6.16032 17.4229 6.47903C18.785 8.11987 20.7598 12.692 17.3832 17.5733C17.1475 17.914 17.2327 18.3812 17.5733 18.6168C17.914 18.8525 18.3812 18.7673 18.6168 18.4267C22.4846 12.8353 20.2335 7.51649 18.5771 5.52097Z" fill="#0088F5"/>\
                        </svg>\
                </div>\
                <div class="bot-mic-icon-off" onclick="handleMicIconOff(this)" id="easychat-mute-icon" style="display: ' + mute_display + ';">\
                    <svg class="rotate-in-rtl" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M8.24458 7.24458L6.47368 8.85289L4.24836 8.8529C3.39441 8.8529 3.06031 9.65412 3 10.0547L3.09046 13.6602C3.16283 14.6217 3.83224 14.862 4.15789 14.862H6.47368L11.6842 19.6693C13.0737 20.6308 13.807 19.2687 14 18.4675V13L8.24458 7.24458ZM15.467 14.4669C15.4525 14.485 15.4378 14.503 15.4229 14.521C15.1584 14.8397 15.2023 15.3125 15.521 15.5771C15.8217 15.8267 16.2596 15.8017 16.5304 15.5304L15.467 14.4669ZM17.3472 14.2258L16.1602 13.0389C16.263 12.5829 16.2712 12.1239 16.2176 11.681C16.1022 10.7277 15.7015 9.88679 15.3832 9.42667C15.1475 9.08602 15.2327 8.61883 15.5733 8.38319C15.914 8.14755 16.3812 8.23268 16.6168 8.57333C17.0532 9.20412 17.558 10.2723 17.7067 11.5008C17.81 12.3541 17.7419 13.3014 17.3472 14.2258ZM17.8479 16.8479C17.7057 17.0887 17.5511 17.3306 17.3832 17.5733C17.1475 17.914 17.2327 18.3812 17.5733 18.6168C17.914 18.8525 18.3812 18.7673 18.6168 18.4267C18.7294 18.2639 18.8368 18.1014 18.9392 17.9392L17.8479 16.8479ZM19.6918 16.5705L18.5518 15.4305C20.1875 11.4003 18.583 7.87653 17.4229 6.47903C17.1584 6.16032 17.2023 5.68748 17.521 5.42291C17.8397 5.15835 18.3125 5.20225 18.5771 5.52097C20.0488 7.29396 21.9899 11.6904 19.6918 16.5705ZM14 10.8787L9.35627 6.23494L11.1053 4.64651C11.8772 4.0456 13.5368 3.32451 14 5.24742V10.8787Z" fill="#FF4C40"/>\
                        <line x1="4.06066" y1="4" x2="19.9706" y2="19.9099" stroke="#FF4C40" stroke-width="1.5" stroke-linecap="round"/>\
                        </svg>\
                </div>\
            </div>'
}

function get_livechat_bot_response_theme_four(text_response, time, other_info) {
    return '<div class="easychat-bot-message-div">\
                <div class="bot-agent-name-text-wrapper">\
                ' + other_info.agent_name + '\
                </div>\
                <div class="easychat-bot-message-wrapper">\
                    <div class="easychat-bot-message-icon-div">\
                        <div class="easychat-bot-message-owner-name">\
                            ' + get_user_initial(other_info.agent_name) + '\
                        </div>\
                    </div>\
                    <div id="easychat-bot-message-' + bot_message_index + '" class="easychat-bot-message-text-container" style="flex-direction: column;">\
                        <div class="easychat-bot-message-text-div">\
                            <div class="easychat-show-less-text">'+ text_response + '</div>\
                            <div class="view_more_wrapper" style="display:none ">\
                                <div style="float:right;cursor: pointer; color:' + BOT_THEME_COLOR + '; " onclick="viewMore(this)">' + READ_MORE + '</div>\
                            </div>\
                        </div>\
                        <div class="easychat-bot-message-time-div">\
                            <span>' + time + '</span>\
                        </div>\
                    </div>\
                </div>\
            </div>'
}

function get_recomendations_menu_for_theme_four(recommendations_list) {

    recommendations_html = '<div class="easychat-recommendation-wrapper-menu"  align="left">';
    recommendations_html += '<div class="bot-quick-recommendation-menu-format-content-div">'
    let recommendations_unique_id = generate_random_string(4)
    let recommendation_menu_style = ''
    for (var i = 0; i < recommendations_list.length; i++) {
        if (i == 4) {
            recommendation_menu_style = "style='display: none;'"
        }
        var rec_name = recommendations_list[i].name ? recommendations_list[i].name : recommendations_list[i];
        recommendations_html += "<div name=" + recommendations_unique_id + " class=\"easychat-recommendation-menu\" " + recommendation_menu_style + " data-id=" + recommendations_list[i].id + " onclick=\"send_selected_recommendation(this)\">" + rec_name + "</div>";
    }
    if(recommendations_list.length > 4) {
        recommendations_html += "<div name=" + recommendations_unique_id + " class='recommendation-menu-format-item-load-more' style='color: " + BOT_THEME_COLOR + "'onclick='view_all_intent_recommendations(this)'>\
                                        " + VIEW_ALL_TEXT + " </span>\
                                </div>"
    }
    recommendations_html += "</div>";

    recommendations_html += "</div>";
    return recommendations_html;
}

function view_all_intent_recommendations(el) {
    if (EASYCHAT_BOT_THEME != 'theme_4') return;
    $("[name='" + $(el).attr("name") + "']").css('display', 'inline-flex')
    $(el).hide()
}

function view_all_faq_intents(el) {
    $("#bot_frequently_asked_question_wrapper").addClass("show-all-frequently-questions")
    $(".easychat-bot-frequently-asked-question-item").show()
    $(el).hide()
    $('#frequently_asked_questions_input').keyup()
}

function view_less_faq_intents() {
    $("#bot_frequently_asked_question_wrapper").removeClass("show-all-frequently-questions")
    $(".easychat-bot-frequently-asked-question-item").hide()
    $('.easychat-bot-frequently-asked-question-item').slice(0, 5).show();
    $('#frequently_asked_question_view_all_btn').show()
    $('#frequently_asked_questions_input').keyup()
    scroll_to_bottom()
}

function display_faq_intent_response(response, intent_pk) {
    $('#bot_frequently_questions_answer').show()
    $('#faq_intent_name').html($('#faq_intent_name_' + intent_pk).html())
    $('#faq_text_response').html(response.response.text_response.text)
    $('#faq_media_response').empty();
    window.clearTimeout(bot_message_delay_timer);
    if("is_feedback_required" in response["response"] && response["response"]["is_feedback_required"]) {
        $('.bot-frequently-answer-feedback-wrapper').remove()
        let faq_feedback_html = get_faq_intent_feedback_wrapper(response["response"]["feedback_id"])
        $('#bot_frequently_questions_answer').append(faq_feedback_html)
    }
    if(is_text_to_speech_required) {
        text_to_speech(response.response.speech_response.text)
        $('.bot-frequently-questions-answer-back-arrow-div').append(get_mic_icon_html_theme_four(true))
    }
    let cards = response.response.cards;
    let videos = response.response.videos;
    let images = response.response.images;
    let tables = response.response.tables;
    if (cards.length > 0) {
        append_bot_slider_cards(cards, true);
    }
    if (tables != undefined && tables != null && tables.length > 0) {
        append_bot_tables(tables, true);
    }
    if (images.length > 0) {
        append_bot_slider_images(images, null, true);
    }
    if (videos.length > 0) {
        append_bot_slider_videos(videos, true);
    }
}

function frequently_asked_question_search() {
    let input, filter, searchValue, i, txtValue;
    input = document.getElementById("frequently_asked_questions_input");
    filter = input.value.toUpperCase().trim();
    $('.easychat-bot-frequently-asked-question-view-all-btn-wrapper').hide()
    if (filter == "") {
        $("#frequently_asked_question_no_data_found").hide()
        if ($("#bot_frequently_asked_question_wrapper").hasClass("show-all-frequently-questions")) {
            $(".easychat-bot-frequently-asked-question-item").show()
            return;
        }
        $(".easychat-bot-frequently-asked-question-item").hide()
        $('.easychat-bot-frequently-asked-question-item').slice(0, 5).show();
        if($('.easychat-bot-frequently-asked-question-item').length > 5) {
            $('.easychat-bot-frequently-asked-question-view-all-btn-wrapper').css('display', 'flex')
        }
        return;
    }
    searchValue = document.querySelectorAll('.easychat-bot-frequently-asked-question-item a');
    let count = 0
    for (i = 0; i < searchValue.length; i++) {
        txtValue = searchValue[i].textContent || searchValue[i].innerText;
        if (txtValue.toUpperCase().indexOf(filter) > -1) {
            searchValue[i].parentElement.style.display = "";
            count++;
        } else {
            searchValue[i].parentElement.style.display = "none";
        }
    }
    if (count == 0) {
        document.getElementById('frequently_asked_question_no_data_found').style.display = "flex";
    } else {
        document.getElementById('frequently_asked_question_no_data_found').style.display = "none";
    }
}

function switch_to_conversation_screen() {
    if(EASYCHAT_BOT_THEME != "theme_4") return;
    let element_response = document.querySelectorAll('.easychat-image-intent-recommendation-wrapper')
    element_response.forEach((element, index) => {
        element_response[index].style.paddingLeft = "32px"
    })
    setTimeout(function() {
        $("#user_input").focus();
    }, 0)
    remove_banner_and_fix_navbar()
    update_mute_icon();
    $('#easychat-chat-container').scroll()
}

function update_mute_icon() {
    if(EASYCHAT_BOT_THEME != 'theme_4') return;
    if(is_text_to_speech_muted) {
        $('#easychat-unmute-icon').hide()
        $('#easychat-mute-icon').show()
    } else {
        $('#easychat-unmute-icon').show()
        $('#easychat-mute-icon').hide()
    }
}

function get_faq_intent_feedback_wrapper(feedback_id) {
    let faq_feedback_html = '<div class="bot-frequently-answer-feedback-wrapper">\
                <div class="bot-frequently-answer-feedback-header-1">\
                    ' + WAS_IT_HELPFUL_TEXT + '\
                </div>\
                <div class="bot-frequently-answer-feedback-header-2">\
                    ' + CSAT_FORM_TEXT.split(RESPONSE_SENTENCE_SEPARATOR)[1] + '\
                </div>\
                <div class="bot-frequently-answer-feedback-thumbs-wrapper">\
                    <label class="frequently-answer-feedback-thumbs-up">\
                            <input type="radio" name="feedback-thumbs" id="frequently_answer_feedback_thumbs_up" onclick="send_faq_feedback(' + feedback_id + ',1,\'\')">\
                            <svg width="28" height="28" viewBox="0 0 28 28" fill="#CBCACA" xmlns="http://www.w3.org/2000/svg">\
                                <path d="M0.666687 14.8333C0.666687 14.505 0.733181 14.1799 0.862372 13.8766C0.991563 13.5733 1.18092 13.2977 1.41964 13.0655C1.65835 12.8334 1.94175 12.6492 2.25364 12.5236C2.56554 12.398 2.89982 12.3333 3.23742 12.3333C3.57501 12.3333 3.9093 12.398 4.22119 12.5236C4.53309 12.6492 4.81648 12.8334 5.0552 13.0655C5.29391 13.2977 5.48327 13.5733 5.61246 13.8766C5.74165 14.1799 5.80814 14.505 5.80814 14.8333V24.8333C5.80814 25.4963 5.5373 26.1322 5.0552 26.6011C4.57309 27.0699 3.91922 27.3333 3.23742 27.3333C2.55562 27.3333 1.90174 27.0699 1.41964 26.6011C0.937531 26.1322 0.666687 25.4963 0.666687 24.8333V14.8333ZM7.52196 14.555V23.605C7.52167 24.2244 7.69886 24.8317 8.03367 25.3586C8.36848 25.8856 8.84766 26.3114 9.41745 26.5883L9.50314 26.63C10.4541 27.0922 11.5026 27.333 12.5657 27.3333H21.8478C22.6405 27.3336 23.4088 27.0667 24.0219 26.5781C24.6349 26.0894 25.0549 25.4092 25.2103 24.6533L27.2669 14.6533C27.3663 14.1697 27.3541 13.6708 27.2312 13.1924C27.1084 12.7139 26.8779 12.268 26.5564 11.8866C26.235 11.5053 25.8305 11.1981 25.3722 10.9871C24.9139 10.7761 24.4131 10.6667 23.9061 10.6666H17.8049V3.99996C17.8049 3.1159 17.4438 2.26806 16.8009 1.64294C16.1581 1.01782 15.2863 0.666626 14.3772 0.666626C13.9227 0.666626 13.4868 0.842221 13.1654 1.15478C12.844 1.46734 12.6634 1.89127 12.6634 2.33329V3.44496C12.6634 4.88743 12.1823 6.29098 11.2924 7.44496L8.89302 10.555C8.00305 11.7089 7.52196 13.1125 7.52196 14.555Z" />\
                                </svg>\
                    </label>\
                    <label class="frequently-answer-feedback-thumbs-down">\
                            <input type="radio" name="feedback-thumbs" id="frequently_answer_feedback_thumbs_down" onclick="send_faq_feedback(' + feedback_id + ',-1,\'\')">\
                            <svg width="28" height="28" viewBox="0 0 28 28" fill="#CBCACA" xmlns="http://www.w3.org/2000/svg">\
                                <path d="M27.3334 13.1666C27.3334 13.8297 27.0625 14.4656 26.5805 14.9344C26.0984 15.4032 25.4445 15.6666 24.7628 15.6666C24.081 15.6666 23.4272 15.4032 22.9451 14.9344C22.4631 14.4656 22.1922 13.8297 22.1922 13.1666V3.16663C22.1922 2.50359 22.4631 1.8677 22.9451 1.39886C23.4272 0.930019 24.081 0.666627 24.7628 0.666627C25.4445 0.666627 26.0984 0.930019 26.5805 1.39886C27.0625 1.8677 27.3334 2.50359 27.3334 3.16663V13.1666ZM20.4785 13.445V4.39496C20.479 3.7757 20.302 3.16855 19.9676 2.64161C19.6331 2.11466 19.1543 1.68875 18.5849 1.41163L18.4992 1.36996C17.5467 0.906988 16.4964 0.666179 15.4316 0.666627H6.15191C5.35927 0.666321 4.59103 0.933212 3.97798 1.42186C3.36493 1.91051 2.94497 2.5907 2.78962 3.34663L0.733166 13.3466C0.633759 13.8303 0.645967 14.3294 0.768906 14.808C0.891846 15.2865 1.12245 15.7325 1.4441 16.1139C1.76574 16.4953 2.1704 16.8025 2.6289 17.0133C3.08739 17.2242 3.58829 17.3335 4.09546 17.3333H10.1963V24C10.1963 24.884 10.5574 25.7319 11.2001 26.357C11.8429 26.9821 12.7147 27.3333 13.6237 27.3333C14.0782 27.3333 14.5141 27.1577 14.8355 26.8451C15.1568 26.5326 15.3374 26.1087 15.3374 25.6666V24.555C15.3374 23.1125 15.8184 21.7089 16.7084 20.555L19.1075 17.445C19.9975 16.291 20.4785 14.8874 20.4785 13.445Z"/>\
                                </svg>\
                    </label>\
                </div>\
            </div>'
    return faq_feedback_html
}

function get_faq_feedback_options(feedback_id, feedback_type) {
    var feedback_html;
    if (feedback_type == 1) {
        feedback_html = '<div class="bot-thumbs-up-response-div">\
                            <div class="bot-thumbs-up-response-header">\
                                ' + FEEDBACK_TEXT + '\
                            </div>\
                            <div id="faq_feedback_error_text" class="bot-frequently-answer-error">\
                                ' + FEEDBACK_ERROR_TEXT + '\
                            </div>'
        positive_feedback_options_value_list = ["Easy Communication", "Fully Satisfied", "Quick Response", "Query Resolved Quickly", "Good Experience"]
        positive_feedback_label_text_list = [POSITIVE_FEEDBACK_1, POSITIVE_FEEDBACK_2, POSITIVE_FEEDBACK_3, POSITIVE_FEEDBACK_4, POSITIVE_FEEDBACK_5]
        feedback_html += '<div class="bot-thumbs-up-response-options-wrapper">'
        for (var i = 0; i < positive_feedback_label_text_list.length; i++) {
            value = positive_feedback_options_value_list[i]
            label_text = positive_feedback_label_text_list[i]
            id = "positive_feedback" + i
            feedback_html += '<div class="bot-thumbs-up-response-option-item">\
                        <input id="' + id + '" type="radio" name="faq-feedback-radio" value="' + value + '" onclick="feedback_radio_checked()">\
                        <label for="' + id + '" >' + label_text + '</label> \
                    </div>'
        }
        feedback_html += '</div>'
    } else if (feedback_type == -1) {
        feedback_html = '<div class="bot-thumbs-down-response-div">\
                            <div class="bot-thumbs-up-response-header">\
                                ' + FEEDBACK_TEXT + '\
                            </div>\
                            <div id="faq_feedback_error_text" class="bot-frequently-answer-error">\
                                ' + FEEDBACK_ERROR_TEXT + '\
                            </div>'
        negative_feedback_options_value_list = ["Inappropriate Answer", "Response is slow", "Need more information", "I couldn’t find what I was looking for", "Content is too complicated"]
        negative_feedback_label_text_list = [NEGATIVE_FEEDBACK_1, NEGATIVE_FEEDBACK_2, NEGATIVE_FEEDBACK_3, NEGATIVE_FEEDBACK_4, NEGATIVE_FEEDBACK_5]
        feedback_html += '<div class="bot-thumbs-up-response-options-wrapper">'
        for (var i = 0; i < negative_feedback_label_text_list.length; i++) {
            value = negative_feedback_options_value_list[i]
            label_text = negative_feedback_label_text_list[i]
            id = "negative_feedback" + i
            feedback_html += '<div class="bot-thumbs-up-response-option-item">\
                        <input id="' + id + '" type="radio" name="faq-feedback-radio" value="' + value + '" onclick="feedback_radio_checked()">\
                        <label for="' + id + '" >' + label_text + '</label> \
                    </div>'

        }
        feedback_html += '</div>'
    }
    feedback_html += '<div class="bot-thumbs-response-btn-wrapper">\
                <button onclick="skip_faq_feedback()" class="bot-thumbs-response-skip-btn"> ' + SKIP_TEXT + '</button>\
                <button style="background: ' + BOT_THEME_COLOR + '" class="bot-thumbs-response-submit-btn" onclick="send_faq_feedback('+feedback_id+', '+feedback_type+', \'\', true);">\
                ' + SUBMIT_TEXT + '\
                </button>\
            </div></div>'
    return feedback_html
}

function send_faq_feedback(feedback_id, feedback_type, feedback_cmt, is_feedback_submitted=false) {
    if (is_feedback_submitted) {
        if($("input[name='faq-feedback-radio']:checked").val()) {
            feedback_cmt = $("input[name='faq-feedback-radio']:checked").val().trim();
        } else {
            $('#faq_feedback_error_text').show();
            let objDiv = document.getElementById("bot_frequently_questions_answer");
            objDiv.scrollTop = objDiv.scrollHeight;
            return;
        }
    }
    $('#faq_feedback_error_text').hide();
    easychat_send_feedback_message_to_server(feedback_id, feedback_type, feedback_cmt);
    if (is_feedback_submitted) {
        $('.bot-frequently-answer-feedback-header-1').text(SUCCESS_FEEDBACK_TEXT)
        $('.bot-frequently-answer-feedback-header-2, .bot-frequently-answer-feedback-thumbs-wrapper, .bot-thumbs-down-response-div, .bot-thumbs-up-response-div').remove()
        let objDiv = document.getElementById("bot_frequently_questions_answer");
        objDiv.scrollTop = objDiv.scrollHeight;
        return;
    }
    $('.bot-thumbs-up-response-div, .bot-thumbs-down-response-div').remove()
    $('.bot-frequently-answer-feedback-wrapper').append(get_faq_feedback_options(feedback_id, feedback_type))
    let objDiv = document.getElementById("bot_frequently_questions_answer");
    objDiv.scrollTop = objDiv.scrollHeight;        
}

function get_theme_four_submitted_form_html(form_id) {
    let form_submitted_html = '<div class = "easychat-bot-form-submit-data-wrapper"><div class="bot-form-submit-data-header">' + widget_form_name + '</div>';
    form_submitted_html += '<div class="bot-form-widget-data-container">'
    let form_data = {};
    for (let i = 0; i < form_fields_length; ++i) {
        let id = i
        if (form_fields[i].field_id_num) {
            id = form_id + "_" + form_fields[i].field_id_num;
        }
        form_submitted_html += '<div class="bot-form-widget-data-item-div">'
        form_submitted_html += '<div class="bot-form-widget-label-div">' + form_fields[i].label_name + '</div>'

        let input_val = answers_filled['parent-input-' + id]['value'];
        if (input_val == undefined)
            input_val = ""

        if (Array.isArray(input_val)) {
            for (let j = 0; j < input_val.length; ++j) {
                form_submitted_html += '<div class="bot-form-widget-label-value-div">' + sanitizeHTML(input_val[j]) + '</div>';
            }
        } else {
            let value = input_val;
            if (answers_filled['parent-input-' + id]['type'] == 'file_attach') {
                value = input_val.split('/');
                value = value[value.length - 1];
            }
            if (answers_filled['parent-input-' + id]['type'] == 'phone_number') {
                form_submitted_html += '<div class="bot-form-widget-label-value-div">'
            } else {
                form_submitted_html += '<div class="bot-form-widget-label-value-div">'
            }
            form_submitted_html += sanitizeHTML(value) + '</div>';
        }
        form_data[form_fields[i].label_name] = [answers_filled['parent-input-' + id]['type'], input_val];
        form_submitted_html += '</div>';
    }
    form_data_misdashboard = JSON.stringify([widget_form_name, form_data])
    form_submitted_html += '</div>';
    $('#easychat-chat-container').append(form_submitted_html);
    return form_data_misdashboard, form_data
}

function skip_faq_feedback() {
    $('.bot-frequently-answer-feedback-wrapper').remove()
}

///////////////////////////////// Theme 4 Specific functions End /////////////////////////////////

function check_element_exists(id) {
    return document.getElementById(id) ? true: false
}

function disable_footer_widget_response_theme_1(){
    try{
        document.getElementById("tooltiptext-microphone").style.display = "none";
        document.getElementById("easychat-mic-svg").classList.add("red_dnd_cursor");
        document.getElementById("img-submit-query").classList.add("red_dnd_cursor");
        document.getElementById("tooltiptext-send").style.display = "none";
    } catch(err) {
        console.log(err);
    }

}

function enable_footer_widget_response_theme_1(){
    try{
        $("#tooltiptext-microphone").css('display', 'flex');
        $("#tooltiptext-send").css('display', 'flex');
        document.getElementById("easychat-mic-svg").classList.remove("red_dnd_cursor");
        document.getElementById("img-submit-query").classList.remove("red_dnd_cursor");
    } catch(err) {
        console.log(err);
    }
}

function disable_footer_widget_response_theme_2(){
    try{
        document.getElementById("tooltiptext-mic").style.display = "none";
        document.getElementById("tooltiptext-send").style.display = "none";
        document.getElementById("easychat-mic-svg-theme2").classList.add("red_dnd_cursor");
        $("#easychat-mic-svg-theme2").css("opacity", ".5");
        document.getElementById("easychat-footer").classList.add("remove-border");
        document.getElementById("img-submit-query").classList.add("red_dnd_cursor");
        document.getElementById("user_input").classList.add("change-input-color");
    } catch(err) {
        console.log(err);
    }
}

function enable_footer_widget_response_theme_2(){
    try{
        $("#tooltiptext-mic").css('display', 'flex');
        $("#tooltiptext-send").css('display', 'flex');
        document.getElementById("easychat-mic-svg-theme2").classList.remove("red_dnd_cursor");
        $("#easychat-mic-svg-theme2").css("opacity", "1");
        document.getElementById("easychat-footer").classList.remove("remove-border");
        document.getElementById("img-submit-query").classList.remove("red_dnd_cursor");
        document.getElementById("user_input").classList.remove("change-input-color");
    } catch(err) {
        console.log(err);
    }
}

function disable_footer_widget_response_theme3_and_theme4(){
    try{
        if(EASYCHAT_BOT_THEME=="theme_3"){
            document.getElementById("user_input_div").classList.add("red_dnd_cursor");
            $("#easychat-query-mic-send-icon-wrapper").css("opacity", ".5");
        } else {
            $(".easychat-bot-user-input-div").addClass("red_dnd_cursor");
            $("#easychat-mic-svg_theme_4").addClass("red_dnd_cursor");
        }
        document.getElementById("easychat-query-mic-send-icon-wrapper").classList.add("red_dnd_cursor");
        document.getElementById("tooltip-mic-send-text").style.display = "none";
    } catch(err) {
        console.log(err);
    }
}

function enable_footer_widget_response_theme3_and_theme4(){
    try{
        if (EASYCHAT_BOT_THEME == "theme_3") {
            document.getElementById("user_input_div").classList.remove("red_dnd_cursor");
            $("#easychat-query-mic-send-icon-wrapper").css("opacity", "1");
        } else {
            $(".easychat-bot-user-input-div").removeClass("red_dnd_cursor");
            $("#easychat-mic-svg_theme_4").removeClass("red_dnd_cursor");
        }
        document.getElementById("easychat-query-mic-send-icon-wrapper").classList.remove("red_dnd_cursor");
        document.getElementById("tooltip-mic-send-text").style.display = "flex";
    } catch(err) {
        console.log(err);
    }
}

function get_browser_name() {
    try {
        let user_agent = navigator.userAgent;

        if (user_agent.match(/chrome|chromium|crios/i)) {
            return "chrome";
        } else if (user_agent.match(/firefox|fxios/i)) {
            return "firefox";
        } else if (user_agent.match(/safari/i)) {
            return "safari";
        } else if (user_agent.match(/opr\//i)) {
            return "opera";
        } else if (user_agent.match(/edg/i)) {
            return "edge";
        } else {
            return "none";
        }
    } catch (err) {
        return "none";
    }
}
//////////////// Scroll language dropdown with keyboard Start
if(document.querySelector('.bot-language-main-container') != null){
    if (document.querySelector('.bot-language-main-container').innerHTML.trim() !== ""){
        const language_dropdown_menu = document.querySelector('.language-dropdown-items')
        const language_dropdown_items = language_dropdown_menu.children
        let dropdown_index = -1
    
        document.addEventListener('keydown', function(e){
            if (document.querySelector(".language-dropdown-content").classList.contains('is-active')) {
                e.preventDefault();
                if(e.keyCode == 40){
                    if(dropdown_index < language_dropdown_items.length -1){
                        dropdown_index++
                        language_dropdown_items[dropdown_index].setAttribute("tabindex", dropdown_index);
                        language_dropdown_items[dropdown_index].focus();
                    }
                } else if(e.keyCode == 38){
                    if(dropdown_index > 0){
                        dropdown_index--
                        language_dropdown_items[dropdown_index].focus()
                    }
                }
                if (e.keyCode == 13) {
                    var language_selected =  language_dropdown_items[dropdown_index];
                    language_selected.click();
                }
            }
        });
    }
}
//////////////// Scroll language dropdown with keyboard EnD 

// ####################################### ####################################### #######################################