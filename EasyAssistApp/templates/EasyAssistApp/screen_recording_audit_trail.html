{% extends 'EasyAssistApp/console.html' %}
{% block content %}
{% load static %}
{% load easyassist_custom_filters %}

<style type="text/css">
.cobrowse-msg {
    display: flex;
    align-items: flex-end;
    margin-bottom: 10px;
}

.cobrowse-msg-img {
    width: 50px;
    height: 50px;
    margin-right: 10px;
    background: #ddd;
    background-repeat: no-repeat;
    background-position: center;
    background-size: cover;
    border-radius: 50%;
}

.cobrowse-msg-bubble {
    max-width: 450px;
    padding: 15px;
    border-radius: 15px;
    background: aliceblue;
    max-width: 50%;
}

.cobrowse-msg-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.cobrowse-msg-info-name {
    margin-right: 10px;
}

.cobrowse-msg-info-time {
    font-size: 0.85em;
}

.right-cobrowse-msg {
    flex-direction: row-reverse;
}

.right-cobrowse-msg .cobrowse-msg-bubble {
    border-bottom-right-radius: 0;
}

.left-cobrowse-msg .cobrowse-msg-bubble {
    border-bottom-left-radius: 0;
}

#dataTable td a img:hover {
    transform: scale(1.2);
}

#modal-mis-filter label {
    font-size: 13px;
}
</style>
<!-- Begin Page Content -->
<div class="container-fluid">
    <!-- Page Heading -->
    <!-- DataTales Example -->
    <div class="row rectangle-btn-parent" style="margin: 0px 0px 10px 0px;">
        {% if access_token_obj.allow_video_meeting_only == False %}
        <div class="col-md pd-l ">
            <a class="rectangle-btn" href="/easy-assist/sales-ai/support-history/"> Attended Leads </a>
        </div>
        {% endif %}

        {% if access_token_obj.allow_video_meeting_only == False %}
        <div class="col-md pd-l">
            <a class="rectangle-btn " href="/easy-assist/sales-ai/unattended-leads/"> Unattended Leads </a>
        </div>
        {% endif %}

        {% if access_token_obj.allow_video_meeting_only == False and access_token_obj.show_verification_code_modal == True %}
        <div class="col-md pd-l">
            <a class="rectangle-btn " href="/easy-assist/sales-ai/declined-leads/"> Declined Leads </a>
        </div>
        {% endif %}

        {% if access_token_obj.enable_followup_leads_tab == True %}
        {% if access_token_obj.allow_video_meeting_only == False %}
        {% if cobrowse_agent.role == "agent" and cobrowse_agent.assign_followup_leads or cobrowse_agent.role != "agent" %}
        <div class="col-md pd-l">
            <a class="rectangle-btn " href="/easy-assist/sales-ai/followup-leads/"> Follow-up Leads </a>
        </div>
        {% endif %}
        {% endif %}
        {% endif %}

        {% if access_token_obj.allow_video_meeting_only == False %}
        <div class="col-md pd-l">
            <a class="rectangle-btn " href="/easy-assist/sales-ai/manually-converted-leads/">Manually Converted Leads</a>
        </div>
        {% endif %}

        {% if access_token_obj.allow_video_meeting_only == False %}
        {% if access_token_obj.allow_screen_recording == True %}
        <div class="col-md pd-l">
            <a class="rectangle-btn " href="/easy-assist/sales-ai/screen-recording-audit-trail/"> Screen Recording </a>
        </div>
        {% endif %}
        {% endif %}
    </div>

    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <div class="row">
                <div class="col-sm-7">
                    <h6 class="m-0 font-weight-bold text-primary heading-text-primary">Screen Recording</h6>
                </div>
                {% if is_audit_trail_empty == False %}
                <div class="col-sm-5" style="text-align: right;">
                    {% if screen_recording_objs|length %}
                    {% if cobrowse_agent.role == "admin" or cobrowse_agent.role == "supervisor" or cobrowse_agent.role == "admin_ally"  %}
                    <button class="btn btn-info btn-width-100" style="width: 120px;" data-toggle="modal" data-target="#modal-mis-filter">Export</button>
                    {% endif %}
                    {% endif %}
                    <button class="btn btn-white-border btn-width-100" data-toggle="modal" data-target="#apply_filter_modal">Filter</button>
                </div>
                {% endif %}
            </div>
        </div>
        <div class="card-body">
            <div class="row filter-result-div" id="applied-filter-div" style="display: none;">
                <div class="filter-items-container" id="applied-filter-result-container">
                </div>
                <div class="filtered-result-text-heading">
                    Filtered Results
                </div>
            </div>

            <div class="table-responsive screen-recording-audit-trail-table">
                <table class="table table-bordered" id="dataTable" style="width: 100%; border-spacing: 0px;">
                    <thead>
                        <tr>
                            <th scope="col">Customer Details</th>
                            {% if cobrowse_agent.role != "agent" %}
                            <th scope="col">Agent</th>
                            {% endif %}
                            {% if cobrowse_agent.role == "admin_ally" %}  
                            <th scope="col">Supervisors</th>   
                            {% endif %}
                            <th scope="col">Recording Date</th>
                            <th scope="col">Recording Start Time</th>
                            <th scope="col">Recording Duration</th>
                            <th scope="col">Recorded File</th>
                            <th scope="col">Expires(in days)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for screen_recording_obj in screen_recording_objs %}
                        <tr>
                            {% if screen_recording_obj.cobrowse_io.is_lead %}
                                <td>{{ screen_recording_obj.cobrowse_io.get_sync_data|safe }}</td>
                            {% else %}
                                <td>
                                    Name: {{ screen_recording_obj.cobrowse_io.full_name }}
                                <br> Mobile Number: {{ screen_recording_obj.cobrowse_io.mobile_number|mask_data }}
                                </td>
                            {% endif %}
                            {% if cobrowse_agent.role != "agent" %}
                            <td>
                                {{ screen_recording_obj.agent.user.username }}
                            </td>
                            {% endif %}
                            {% if cobrowse_agent.role == "admin_ally" %}
                            <td>
                            <div data-toggle="tooltip" title="{{ screen_recording_obj.agent.get_supervisors }}" data-placement="bottom" class="easyassist-supervisor-list-ellips">
                                        {% if screen_recording_obj.agent.get_supervisors %}
                                            {{ screen_recording_obj.agent.get_supervisors}}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </div>
                            </td>
                            {% endif %}

                            <td>
                                {{ screen_recording_obj.recording_started | date:"d-M-Y" }}
                            </td>
                            <td>
                                {{ screen_recording_obj.recording_started | time:"h:i A" }}
                            </td>
                            <td>
                                {{ screen_recording_obj.get_screen_recording_duration }}
                            </td>
                            <td>
                                <a href="/easy-assist/download-file/{{ screen_recording_obj.recorded_file }}" download>
                                    {% if request.user.enable_s3_bucket %}
                                    <img alt="Download icon" src="https://static.allincall.in/static/EasyAssistApp/icons/download.svg">
                                    {% else %}
                                    <img alt="Download icon" src="{% static 'EasyAssistApp/icons/download.svg' %}">
                                    {% endif %}
                                </a>    
                                    &nbsp;&nbsp;&nbsp;&nbsp;
                            </td>
                            <td>
                                {% if screen_recording_obj.get_recording_expiration_time == "Today" or screen_recording_obj.get_recording_expiration_time <= 5 %}
                                    <p style="color:red;">{{screen_recording_obj.get_recording_expiration_time}}</p>
                                {% else %}
                                    <p style="color:green;">{{screen_recording_obj.get_recording_expiration_time}}</p>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% if total_screen_recording_objs > 0 %}
            <div class="row mt-3">
                <div class="col-md-6 col-sm-12 show-pagination-entry-container" filter_default_text="Showing {{start_point}} to {{end_point}} of {{total_screen_recording_objs}} entries" start_point="{{start_point}}" end_point="{{end_point}}">
                    Showing {{start_point}} to {{end_point}} of {{total_screen_recording_objs}} entries
                </div>
                <div class="col-md-6 col-sm-12">
                    <div class="d-flex justify-content-end">
                        <nav aria-label="Page navigation example">
                          <ul class="pagination">

                            {% if screen_recording_objs.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" onclick="load_more_page('{{ screen_recording_objs.previous_page_number }}');" href="javascript:void(0)" aria-label="Previous">
                                        <span aria-hidden="true">Previous</span>
                                        <span class="sr-only">Previous</span>
                                    </a>
                                </li>
                            {% else %}
                                <li class="disabled page-item"><span>
                                    <a class="page-link" href="javascript:void(0)" aria-label="Previous">
                                        <span aria-hidden="true">Previous</span>
                                        <span class="sr-only">Previous</span>
                                    </a>
                                </li>
                            {% endif %}

                            {% if screen_recording_objs.number|add:'-4' > 1 %}
                                <li class="page-item">
                                    <a class="page-link" onclick="load_more_page('{{ screen_recording_objs.number|add:'-5' }}');" href="javascript:void(0)">&hellip;</a>
                                </li>
                            {% endif %}

                            {% for i in screen_recording_objs.paginator.page_range %}
                                {% if screen_recording_objs.number == i %}
                                    <li class="active purple darken-3 page-item">
                                        <a onclick="load_more_page('{{ i }}');" href="javascript:void(0)" class="page-link">{{ i }}</a>
                                    </li>
                                {% elif i > screen_recording_objs.number|add:'-5' and i < screen_recording_objs.number|add:'5' %}
                                    <li class="page-item">
                                        <a href="javascript:void(0)" onclick="load_more_page('{{ i }}');" class="page-link">{{ i }}</a>
                                    </li>
                                {% endif %}
                            {% endfor %}

                            {% if screen_recording_objs.paginator.num_pages > screen_recording_objs.number|add:'4' %}
                                <li class="page-item">
                                    <a href="javascript:void(0)" onclick="load_more_page('{{ screen_recording_objs.number|add:'5' }}');" class="page-link">&hellip;</a>
                                </li>
                            {% endif %}

                            {% if screen_recording_objs.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="javascript:void(0)" onclick="load_more_page('{{ screen_recording_objs.next_page_number }}');" aria-label="Next">
                                        <span aria-hidden="true">Next</span>
                                        <span class="sr-only">Next</span>
                                    </a>
                                </li>
                            {% else %}
                                <li class="disabled page-item">
                                    <a class="page-link" href="javascript:void(0)" aria-label="Next">
                                        <span aria-hidden="true">Next</span>
                                        <span class="sr-only">Next</span>
                                    </a>
                                </li>
                            {% endif %}
                          </ul>
                        </nav>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<div class="modal fade" id="apply_filter_modal" tabindex="-1" role="dialog" aria-labelledby="apply_filter_modal_modal_label" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="apply_filter_modal_modal_label">Apply custom filter</h5>
            </div>
            <div class="modal-body">
                <div class="row filter-header-row">
                    <div class="col-md-4 col-sm-12 filter-mb-sm-4">
                        <select class="form-control" onchange="show_filter_options(this)" id="selected-filter-parameter" style="width: 100%!important;">
                            <option value="None">Select Filter</option>
                            {% if cobrowse_agent.role != "agent" %}
                            <option value="agent">Agent</option>
                            {% endif %}
                            {% if cobrowse_agent.role == "admin_ally" %}
                            <option value="supervisor">Supervisor</option>
                            {% endif %}
                            <option value="startdate">Start Date</option>
                            <option value="enddate">End Date</option>
                        </select>
                    </div>
                    <div class="col-md-5 col-sm-12 filter-mb-sm-4 easyassist-multiselect-dropdown-container" id="selected-filter-container">
                        <select class="form-control" style="display:none;" id="selected-agent-filter" multiple>
                            {% for agent in agents %}
                            <option value="{{ agent.user.username }}">{{ agent.user.username }}</option>
                            {% endfor %}
                        </select>
                        {% if cobrowse_agent.role == "admin_ally" %}
                        <select class="form-control" style="display:none;" id="selected-supervisor-filter" multiple>
                            {% for supervisor in supervisors %}
                            <option value="{{ supervisor.user.username }}">{{ supervisor.user.username }}</option>
                            {% endfor %}
                        </select>
                        {% endif %}
                        <input id="filter-start-date" placeholder="Start Date" style="display:none;" class="filter-parameter form-control datepicker" autocomplete="off" data-date-format="dd-mm-yyyy">
                        <input id="filter-end-date" placeholder="End Date" style="display:none;" class="filter-parameter form-control datepicker" autocomplete="off" data-date-format="dd-mm-yyyy">
                    </div>
                    <div class="col-md-3 col-sm-12" style="align-items: center; display: flex;">
                        <button class="btn btn-success btn-icon-split" type="button" id="add-filter-btn" onclick="add_new_filter_parameter(this)" style="width: 100%;justify-content: start;" disabled>
                            <span class="icon text-white-50">
                                <svg width="19" height="14" viewBox="0 0 19 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M6.03809 11.0455L1.53383 6.69202L0 8.16406L6.03809 14L19 1.47204L17.477 0L6.03809 11.0455Z" fill="white"/>
                                </svg>
                            </span>
                            <span class="text" style="width: 100%;">Add</span>
                        </button>
                    </div>
                </div>
                <div class="row" id="tbody-filter-parameters">

                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                <button id="reset_filter" class="btn btn-white-border" style="display: none;" disabled onclick="reset_screen_recording_filter(this)">Reset</button>
                <button id="apply_filter_confirm" class="btn btn-primary" disabled onclick="apply_screen_recording_filter(this)">Submit</button>
            </div>
        </div>
    </div>
</div>

<!-- ********************************* Export data -->
<div class="modal fade client-location-details" id="modal-mis-filter" tabindex="-1" role="dialog" aria-labelledby="client_location_details_label" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="export_mis_lable">Export Support History</h5>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-12">
                        <h6 style="color: #3e95cd">Select date range</h6>
                        <select id="select-date-range" class="form-control" onchange="check_select_date_range(this)">
                            <option value="0" selected="selected">Choose date range</option>
                            <option value="1">Last day</option>
                            <option value="2">Last 7 days</option>
                            <option value="3">Last 1 month</option>
                            <option value="4">Custom Range</option>
                        </select>
                    </div>
                    <div class="col-sm-6 mt-4" id="from-date-div" style="display: none;">
                        <h6 style="color: #3e95cd">From Date</h6>
                        <input id="startdate" placeholder="From Date" class="filter-parameter form-control datepicker" autocomplete="off" data-date-format="dd-mm-yyyy">
                    </div>
                    <div class="col-sm-6 mt-4" id="to-date-div" style="display: none;">
                        <h6 style="color: #3e95cd">To Date</h6>
                        <input id="enddate" placeholder="To Date" class="filter-parameter form-control datepicker" autocomplete="off" data-date-format="dd-mm-yyyy">
                    </div>
                    <div class="col-sm-12" id="email-id-div" style="display:none; padding-top: 25px;">
                        <h6 style="color: #3e95cd">Email ID*</h6>
                        <textarea class="form-control" id="filter-data-email" style="height:10em;">{{ request.user.email }}</textarea>
                        <span><br><b>Note: You will receive the screen recording data dump on the above email ID within 24 hours.</b></span>
                    </div>
                    <div class="col-sm-12 mt-3" id="general-error-message">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-info" type="button" onclick="export_screen_recording_history(this)">Export</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
window.is_filter_applied = false;
window.custom_filter_option_dropdown = null;
window.applied_filter_key_value_map = {};

window.onload = function() {
    {% if screen_recording_objs|length %}
    $("#dataTable").DataTable({
        "ordering": false,
        "bPaginate": false,
        "bInfo": false,
    });
    {% else %}
    $("#dataTable").DataTable({
        "ordering": false,
        "bPaginate": false,
        "bInfo": false,
        "searching": false,
    });
    {% endif %}
};

function show_filter_options(element) {
    $("#selected-agent-filter").next().hide();
    if(document.querySelector("#selected-supervisor-filter")){
        $("#selected-supervisor-filter").next().hide();
    }
    document.getElementById("filter-start-date").style.display = "none";
    document.getElementById("filter-end-date").style.display = "none";

    if (element.value == "None") {
        document.getElementById("add-filter-btn").disabled = true;
    } else {

        document.getElementById("selected-filter-container").style.display = "block";

        filter_parameters = document.getElementsByClassName("filter-parameter");
        for (var index = 0; index < filter_parameters.length; index++) {
            filter_parameters[index].style.display = "none";
        }
        if (element.value == "agent") {
            $("#selected-agent-filter").next().show();
        } else if (element.value == "supervisor") {
            $("#selected-supervisor-filter").next().show();
        } else if (element.value == "startdate") {
            document.getElementById("filter-start-date").style.display = "block";
        } else if (element.value == "enddate") {
            document.getElementById("filter-end-date").style.display = "block";
        } else {
            show_easyassist_toast("Please select valid filter");
        }
        document.getElementById("reset_filter").removeAttribute("disabled");
        document.getElementById("reset_filter").style.display = "block";
        document.getElementById("add-filter-btn").disabled = false;
    }
}

function add_new_filter_parameter() {
    var filter_key = null;
    var filter_value = null;
    element = document.getElementById("selected-filter-parameter");
    if (element.value == "None") {
        show_easyassist_toast("Please select valid filter parameter");
    } else {
        var value = "None";
        var key = element.value;
        if (element.value == "agent") {
            value = $("#selected-agent-filter").val();
            if (value.length == 0) {
                show_easyassist_toast(NO_AGENT_SELECTED_TOAST);
                return;
            }
            filter_key = "Agent"
            filter_value = value;
        } else if (element.value == "supervisor") {
            value = $("#selected-supervisor-filter").val();
            if (value.length == 0) {
                show_easyassist_toast(NO_SUPERVISOR_SELECTED_TOAST);
                return;
            }
            filter_key = "Supervisor"
            filter_value = value;
        } else if (element.value == "startdate") {
            value = document.getElementById("filter-start-date").value;

            if (value == "") {
                show_easyassist_toast(EMPTY_START_DATE_ERROR_TOAST);
                return;
            }

            var formatted_start_date = get_iso_formatted_date(value);
            if (applied_filter_key_value_map['enddate'] != null) {
                var formatted_end_date = get_iso_formatted_date(applied_filter_key_value_map['enddate'][0]);
                if (formatted_end_date < formatted_start_date) {
                    show_easyassist_toast(INVALID_START_DATE_ERROR_TOAST);
                    return;
                }
            }

            var today = get_today_date();
            if (formatted_start_date > today || formatted_start_date.length > 10) {
                show_easyassist_toast("Please select valid date");
                return;
            }

            filter_key = "Start Date"
            filter_value = [value];
        } else if (element.value == "enddate") {
            value = document.getElementById("filter-end-date").value;
            if (value == "") {
                show_easyassist_toast(EMPTY_END_DATE_ERROR_TOAST);
                return;
            }

            var formatted_end_date = get_iso_formatted_date(value);
            if (applied_filter_key_value_map['startdate'] != null) {
                var formatted_start_date = get_iso_formatted_date(applied_filter_key_value_map['startdate'][0]);
                if (formatted_start_date > formatted_end_date) {
                    show_easyassist_toast(INVALID_START_DATE_ERROR_TOAST);
                    return;
                }
            }

            var today = get_today_date();
            if (formatted_end_date > today || formatted_end_date.length > 10) {
                show_easyassist_toast("Please select valid date");
                return;
            }

            filter_key = "End Date";
            filter_value = [value];
        } else {
            show_easyassist_toast("Please select valid filter parameter");
        }

        if(check_filter_already_applied(applied_filter_key_value_map[key], filter_value)) {
            show_easyassist_toast(filter_key + " filter already applied");
            return;
        }

        if (applied_filter_key_value_map[key] != null) {
            applied_filter_key_value_map[key] = filter_value;
            update_applied_filter_by_key(key, filter_value);
            return;
        }
        applied_filter_key_value_map[key] = filter_value;

        var filter_chip_html = "";
        filter_chip_html = generate_filter_chips(filter_key, filter_value);

        var html_filter = [
            '<div class="col-md-12 filter-parameter-column" filter-key="' + key + '" filter-data=\'' + JSON.stringify(filter_value) + '\' style="padding: 1em;border-bottom: 1px solid #E6E6E6;">',
                '<div class="row filter-custom-row">',
                    '<div class="col-md-2 filter-mb-sm-2 filter-flex-column">',
                        '<span class="filter-text">' + filter_key + '</span>',
                        '<button type="button" class="btn remove-filter-row-btn filter-show-on-mobile" onclick="remove_selected_filter_parameter(this)">',
                            '<svg width="16" height="18" viewBox="0 0 16 18" fill="none" xmlns="http://www.w3.org/2000/svg">',
                                '<path d="M8 0C9.49884 0 10.7237 1.20574 10.8064 2.72496L10.8108 2.88889H15.3514C15.7096 2.88889 16 3.18737 16 3.55556C16 3.89306 15.756 4.17199 15.4394 4.21614L15.3514 4.22222H14.6629L13.5558 15.7948C13.441 16.994 12.4959 17.92 11.3406 17.9951L11.1888 18H4.81118C3.63878 18 2.64965 17.124 2.46385 15.9497L2.44423 15.7948L1.33622 4.22222H0.648649C0.320263 4.22222 0.0488727 3.97142 0.00592144 3.64602L0 3.55556C0 3.21805 0.244025 2.93912 0.560631 2.89497L0.648649 2.88889H5.18919C5.18919 1.2934 6.44763 0 8 0ZM13.3596 4.22222H2.63957L3.73529 15.6643C3.7861 16.1952 4.19488 16.6083 4.70127 16.661L4.81118 16.6667H11.1888C11.7078 16.6667 12.1478 16.289 12.2484 15.7762L12.2647 15.6643L13.3596 4.22222ZM9.51351 6.66667C9.8419 6.66667 10.1133 6.91747 10.1562 7.24287L10.1622 7.33333V13.5556C10.1622 13.9237 9.87175 14.2222 9.51351 14.2222C9.18513 14.2222 8.91374 13.9714 8.87079 13.646L8.86487 13.5556V7.33333C8.86487 6.96514 9.15528 6.66667 9.51351 6.66667ZM6.48649 6.66667C6.81487 6.66667 7.08626 6.91747 7.12921 7.24287L7.13514 7.33333V13.5556C7.13514 13.9237 6.84473 14.2222 6.48649 14.2222C6.1581 14.2222 5.88671 13.9714 5.84376 13.646L5.83784 13.5556V7.33333C5.83784 6.96514 6.12825 6.66667 6.48649 6.66667ZM8 1.33333C7.2059 1.33333 6.55464 1.96188 6.4915 2.76131L6.48649 2.88889H9.51351C9.51351 2.02978 8.83589 1.33333 8 1.33333Z" fill="#757575"/>',
                            '</svg>',
                        '</button>',
                    '</div>',
                    '<div class="col-md-8 filter-chip-column">',
                        filter_chip_html,
                    '</div>',
                    '<div class="col-md-2 filter-hide-on-mobile">',
                        '<button type="button" class="btn remove-filter-row-btn" onclick="remove_selected_filter_parameter(this)">',
                            '<svg width="16" height="18" viewBox="0 0 16 18" fill="none" xmlns="http://www.w3.org/2000/svg">',
                                '<path d="M8 0C9.49884 0 10.7237 1.20574 10.8064 2.72496L10.8108 2.88889H15.3514C15.7096 2.88889 16 3.18737 16 3.55556C16 3.89306 15.756 4.17199 15.4394 4.21614L15.3514 4.22222H14.6629L13.5558 15.7948C13.441 16.994 12.4959 17.92 11.3406 17.9951L11.1888 18H4.81118C3.63878 18 2.64965 17.124 2.46385 15.9497L2.44423 15.7948L1.33622 4.22222H0.648649C0.320263 4.22222 0.0488727 3.97142 0.00592144 3.64602L0 3.55556C0 3.21805 0.244025 2.93912 0.560631 2.89497L0.648649 2.88889H5.18919C5.18919 1.2934 6.44763 0 8 0ZM13.3596 4.22222H2.63957L3.73529 15.6643C3.7861 16.1952 4.19488 16.6083 4.70127 16.661L4.81118 16.6667H11.1888C11.7078 16.6667 12.1478 16.289 12.2484 15.7762L12.2647 15.6643L13.3596 4.22222ZM9.51351 6.66667C9.8419 6.66667 10.1133 6.91747 10.1562 7.24287L10.1622 7.33333V13.5556C10.1622 13.9237 9.87175 14.2222 9.51351 14.2222C9.18513 14.2222 8.91374 13.9714 8.87079 13.646L8.86487 13.5556V7.33333C8.86487 6.96514 9.15528 6.66667 9.51351 6.66667ZM6.48649 6.66667C6.81487 6.66667 7.08626 6.91747 7.12921 7.24287L7.13514 7.33333V13.5556C7.13514 13.9237 6.84473 14.2222 6.48649 14.2222C6.1581 14.2222 5.88671 13.9714 5.84376 13.646L5.83784 13.5556V7.33333C5.83784 6.96514 6.12825 6.66667 6.48649 6.66667ZM8 1.33333C7.2059 1.33333 6.55464 1.96188 6.4915 2.76131L6.48649 2.88889H9.51351C9.51351 2.02978 8.83589 1.33333 8 1.33333Z" fill="#EE2525"/>',
                            '</svg>',
                        '</button>',
                    '</div>',
                '</div>',
            '</div>',
        ].join('');

        document.getElementById("tbody-filter-parameters").innerHTML += html_filter;
        document.getElementById("apply_filter_confirm").removeAttribute("disabled");
        document.getElementById("reset_filter").removeAttribute("disabled");
        document.getElementById("reset_filter").style.display = "block";
        scrollToBottom();
    }
}

function remove_selected_filter_parameter(element){
    remove_element = $(element).closest('.filter-parameter-column')[0];
    var filter_element = $(remove_element).attr("filter-key");
    applied_filter_key_value_map[filter_element] = null;

    remove_element.parentElement.removeChild(remove_element);
    if(document.getElementsByClassName("tr-filter-parameters").length <= 0){
        document.getElementById("apply_filter_confirm").setAttribute("disabled", "disabled");
        if(!is_filter_applied) {
            document.getElementById("reset_filter").setAttribute("disabled", "disabled");
        }
    }
}

function apply_screen_recording_filter(element) {
    selected_filter_parameters = document.getElementsByClassName("filter-parameter-column");
    var key_value = '';
    
    for(var idx = 0; idx < selected_filter_parameters.length; idx ++) {
        var filter_key = selected_filter_parameters[idx].getAttribute('filter-key');
        var filter_data = selected_filter_parameters[idx].getAttribute('filter-data');

        filter_data = JSON.parse(filter_data);

        for(var index = 0; index < filter_data.length; index ++) {
            key_value += filter_key + "=" + filter_data[index] + "&";
        }
    }

    window.location = window.location.protocol + "//" + window.location.host + window.location.pathname + "?" + key_value;
}

function reset_screen_recording_filter() {
    document.getElementById("tbody-filter-parameters").innerHTML = "";
    document.getElementById("reset_filter").setAttribute("disabled", "disabled");
    document.getElementById("apply_filter_confirm").setAttribute("disabled", "disabled");
    custom_filter_option_dropdown.update_value("None");
    $("#selected-agent-filter").val("").multiselect('refresh');
    if(document.querySelector("#selected-supervisor-filter")){
        $("#selected-supervisor-filter").val("").multiselect('refresh');
    }

    $('#filter-start-date').val("").datepicker("update");
    $('#filter-end-date').val("").datepicker("update");
    initialize_custom_filter_map();
}


function check_select_date_range(element){
    general_error_message = document.getElementById("general-error-message");
    general_error_message.innerHTML = "";

    if(element.value == "0") {
        general_error_message.innerHTML = "Please select valid date range filter";
    } else {
        general_error_message.innerHTML = "";
    }

    if(element.value=="4"){
        document.getElementById("from-date-div").style.display="block";
        document.getElementById("to-date-div").style.display="block";
        document.getElementById("email-id-div").style.display="block";
    }else{
        document.getElementById("from-date-div").style.display="none";
        document.getElementById("to-date-div").style.display="none";
        document.getElementById("email-id-div").style.display="none";
    }
}

$(document).ready(function() {
    initialize_custom_filter_map();
    initialize_custom_dropdown();
    initialize_custom_tabs();
    activate_support_history_sidebar();
    update_applied_filter();

    $('#selected-agent-filter').multiselect({
        nonSelectedText: 'Select Agent',
        enableFiltering: true,
        enableCaseInsensitiveFiltering: true,
        includeSelectAllOption: true
    });
    $("#selected-agent-filter").next().hide();
    if(document.querySelector("#selected-supervisor-filter")){
        $('#selected-supervisor-filter').multiselect({
            nonSelectedText: 'Select Supervisor',
            enableFiltering: true,
            enableCaseInsensitiveFiltering: true,
            includeSelectAllOption: true
        });
        $("#selected-supervisor-filter").next().hide();
    }
});

function initialize_custom_dropdown() {
    var console_theme_color = getComputedStyle(document.body).getPropertyValue('--color_rgb');
    $("#selected-agent-filter")[0].selectedIndex = -1;
    if(document.querySelector("#selected-supervisor-filter")){
        $("#selected-supervisor-filter")[0].selectedIndex = -1;
    }
    
    custom_filter_option_dropdown = new EasyassistCustomSelect("#selected-filter-parameter", "Select One", console_theme_color);
}

function initialize_custom_filter_map() {
    applied_filter_key_value_map = {
        'title': null,
        'agent': null,
        'startdate': null,
        'enddate': null,
    }
}
</script>
{% endblock %}
