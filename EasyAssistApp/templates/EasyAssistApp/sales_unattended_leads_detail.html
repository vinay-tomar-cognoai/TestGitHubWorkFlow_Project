{% extends 'EasyAssistApp/console.html' %} {% block content %} {% load static %}
{% load easyassist_custom_filters %}

<style type="text/css">
.easychat-bot-message-div {
    margin-top: 0em;
    width: 100%;
    display: inline-block;
}

.message-time-user {
    font-size: 11px;
    float: right;
    text-align: right;
    margin-left: 20px;
    color: white;
    padding: 0.5em 0em 0em 0.5em;
}

.message-time-bot {
    font-size: 11px;
    text-align: right;
    width: 100%;
    float: right;
    padding: 0.5em 0em 0em 0.5em;
}

.easychat-bot-message {
    box-shadow: 1px 1px 6px rgba(0, 0, 0, 0.2);
    float: left;
    width: fit-content;
    height: auto;
    font-size: 14px;
    color: #262626;
    border-radius: 0px 10px 10px 10px;
    background-color: #ffffff;
    padding-bottom: 10px;
    word-wrap: break-word;
    display: inline-block;
}

@media screen and (min-width: 425px) {
    .easychat-bot-message {
        width: fit-content;
        max-width: 80%;
    }
}

.easychat-bot-message-line {
    line-height: 20px;
    padding: 0.8em 0.5em 0.8em 0.5em;
}

.easychat-user-message-div {
    margin: 0em 0em 0em 0em;
    width: 100%;
    display: inline-block;
}

.easychat-user-message {
    box-shadow: -1px 1px 5px rgba(0, 0, 0, 0.2);
    float: right;
    height: auto;
    max-width: 80%;
    font-size: 14px;
    color: white;
    border-radius: 10px 0px 10px 10px;
    word-wrap: break-word;
    display: inline-block;
    margin-right: 0.3em;
}

.easychat-user-message-line {
    line-height: 16px;
    padding: 0.8em 0.7em 0.8em 0.8em !important;
}

.easychat-livechat-customer-attachment {
    width: 50%;
    float: left;
    background-color: #ffffff;
    margin: 1em 0px 3px 0px;
    padding: 4px 4px 1px 4px;
    border-radius: 0em 1em 1em 1em;
    box-shadow: 1px 1px 6px rgba(0, 0, 0, 0.2);
}

.easychat-livechat-message {
    height: fit-content;
    padding: 6px;
    word-wrap: break-word;
}

#modal-mis-filter label {
    font-size: 13px;
}

#predefined-remarks-buttons-list,
#predefined-sub-remarks-buttons-list {
  padding: 0px;
  margin-bottom: 15px !important;
  overflow-y: auto;
  white-space: nowrap;
}

.predefined-remarks-button {
    border-radius: 100px;
    font: normal 14px "Silka", Sans-Serif;
    line-height: 14px;
    box-shadow: none !important;
    color:  #0254D7 !important;
    background: rgba(2, 84, 215, 0.07);
    height: 30px;
  }
  .predefined-remarks-button:hover {
    transform: none !important;
    box-shadow: none !important;
    transition: none !important;
  }
  
  .predefined-remarks-button-clicked {
    background-color: #0254D7 !important;
    color: #fff !important;
  }
  
  {% if access_token_obj.cobrowsing_console_theme_color != None %}
  .predefined-remarks-button {
    color:  var(--color_rgb) !important;
    background-color: var(--color_rgba_8) !important;
    height: 30px;
  }
  
  .predefined-remarks-button-clicked {
    background-color: var(--color_rgb) !important;
    color: #fff !important;
  }
  {% endif %}
  
  .predefined-remarks-list-item:last-child{
    padding-right: 0px;
  }
  
  #predefined-remarks-buttons-list::-webkit-scrollbar {
    width: 8px;
    height: 5px;
  }
  
  #predefined-remarks-buttons-list::-webkit-scrollbar-track {
    background: transparent;
  }
  
  #predefined-remarks-buttons-list::-webkit-scrollbar-thumb {
    background: #c1c2c9;
    border-radius: 10px;
  }
  .predefined-remarks-list-item {
    display: inline-block;
    padding: 8px 12px 8px 0px;
    margin-bottom: 15px;
  }

.toast-message{
    align-items: center;
    justify-content: center;
    background: #EDF7ED;
    box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.15);
    border-radius: 4px;
    min-width: 250px;
    height: 2.5rem;
    color: #1E4626;
    text-align: center;
    padding: 8px;
    position: fixed;
    left: 40%;
    top: 10px;
    display: none;
    z-index: 5000;
}
.toast-container{
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
}

@media (max-width:929px){
    .toast-message{
        min-width: 150px;
        position: fixed;
        left: 25%;
        top: 10px;
        font-size: 12px;
    }
}

@media (max-width:520px){
    .toast-message{
        min-width: 150px;
        position: fixed;
        left: 18%;
        top: 10px;
        font-size: 12px;
    }
}

.tooltip-container-for-convert-icon {
    cursor: pointer;
    position: relative;
    display: inline-block;
}

.tooltip-text-for-convert {
    opacity: 0;
    z-index: 99;
    color: #ffffff;
    width: 65px;
    display: block;
    font-size: 14px;
    border-radius: 3px;
    padding:0 3px;
    background: rgba(51,51,51,0.9);
    box-shadow: 0 0 3px rgba(0,0,0,0.5);
    position: absolute;
    right: -14px;
    bottom: 35px;
}

.tooltip-text-for-convert:before,.tooltip-text-for-convert:after {
    content: '';
    border-left: 7px solid transparent;
    border-right: 7px solid transparent;
    border-top: 7px solid rgba(51,51,51,0.9);
    position: absolute;
    bottom: -7px;
    left: 39%;
}

.tooltip-container-for-convert-icon:hover .tooltip-text-for-convert,a:hover .tooltip-text-for-convert {
    opacity: 1;
}

</style>
<!-- Begin Page Content -->
<div class="container-fluid">
    <!-- Page Heading -->
    <!-- DataTales Example -->
    <div class="row rectangle-btn-parent" style="margin: 0px 0px 10px 0px;">
        {% if access_token_obj.allow_video_meeting_only == False %}
        <div class="col-md pd-l ">
            <a class="rectangle-btn" href="/easy-assist/sales-ai/support-history/"> Attended Leads </a>
        </div>
        {% endif %}

        {% if access_token_obj.allow_video_meeting_only == False %}
        <div class="col-md pd-l">
            <a class="rectangle-btn " href="/easy-assist/sales-ai/unattended-leads/"> Unattended Leads </a>
        </div>
        {% endif %}

        {% if access_token_obj.allow_video_meeting_only == False and access_token_obj.show_verification_code_modal == True %}
        <div class="col-md pd-l">
            <a class="rectangle-btn " href="/easy-assist/sales-ai/declined-leads/"> Declined Leads </a>
        </div>
        {% endif %}

        {% if access_token_obj.enable_followup_leads_tab == True %}
        {% if access_token_obj.allow_video_meeting_only == False %}
        {% if cobrowse_agent.role == "agent" and cobrowse_agent.assign_followup_leads or cobrowse_agent.role != "agent" %}
        <div class="col-md pd-l">
            <a class="rectangle-btn " href="/easy-assist/sales-ai/followup-leads/"> Follow-up Leads </a>
        </div>
        {% endif %}
        {% endif %}
        {% endif %}

        {% if access_token_obj.allow_video_meeting_only == False %}
        <div class="col-md pd-l">
            <a class="rectangle-btn " href="/easy-assist/sales-ai/manually-converted-leads/">Manually Converted Leads</a>
        </div>
        {% endif %}

        {% if access_token_obj.allow_video_meeting_only == False %}
        {% if access_token_obj.allow_screen_recording == True %}
        <div class="col-md pd-l">
            <a class="rectangle-btn " href="/easy-assist/sales-ai/screen-recording-audit-trail/"> Screen Recording </a>
        </div>
        {% endif %}
        {% endif %}
    </div>

    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <div class="row align-items-center">
                <div class="col-sm-4">
                    <h6 class="m-0 font-weight-bold text-primary heading-text-primary">Unattended Leads
                        <span data-toggle="tooltip" data-placement="top" title="" data-original-title="Sessions unattended by the Agents."><i class="fas fa-info-circle"></i></span>
                    </h6>
                </div>
                {% if is_unattended_leads_empty == False %}
                <div class="col-sm-8 d-flex justify-content-end card-header-left-div">
                    <div class="form-group has-search d-flex mb-0 mr-2">
                        <span class="fa fa-search form-control-feedback"></span>
                        <input type="text" id="custom-agent-table-search" class="custom-table-search form-control" placeholder="Search" aria-controls="support-history-table">
                    </div>
                    {% if cobrowse_agent.role == "admin" or cobrowse_agent.role == "supervisor" or cobrowse_agent.role == "admin_ally" %}
                        {% if cobrowse_io_objs %}
                         <button class="btn btn-info btn-width-100" style="width: 120px;" data-toggle="modal" data-target="#modal-mis-filter">Export</button>
                         {% endif %}
                    {% endif %}
                    <button class="btn btn-white-border btn-width-100" data-toggle="modal" data-target="#apply_filter_modal">Filter</button>
                </div>
                {% endif %}
            </div>
            <h6 class="m-0 font-weight-bold text-primary"></h6>
        </div>
        <div class="card-body">
            <div class="row filter-result-div" id="applied-filter-div" style="display: none;">
                <div class="filter-items-container" id="applied-filter-result-container">
                </div>
                <div class="filtered-result-text-heading">
                    Filtered Results
                </div>
            </div>

            {% if is_filter_applied %}
            <div class="table-responsive support-history-table-unattended">
                <table class="table table-bordered" style="width: 100%; border-spacing: 0px;" id="support-history-table">
                    <thead>
                        <tr>
                            <th scope="col">Customer Details</th>
                            <th scope="col">SR Date & Time</th>
                            {% if cobrowse_agent.role != "agent" %}
                            <th scope="col">Agent</th>
                                {% if access_token_obj.enable_auto_assign_unattended_lead %}
                                    <th scope="col">Auto Assigned Agent</th>
                                    <th scope="col" class="text-center unattended-lead-transfer-count-header">Assigned Agents</th>
                                {% endif %}
                            {% endif %}
                            {% if cobrowse_agent.role == "admin_ally" %}  
                            <th scope="col">Supervisors</th>   
                            {% endif %}
                            <th scope="col">Remarks</th>

                            {% if access_token_obj.enable_predefined_remarks %}
                            {% if access_token_obj.enable_predefined_subremarks %}
                            <th scope="col">Sub-Remarks</th>
                            {% endif %}
                            {% endif %}

                            {% if access_token_obj.enable_predefined_remarks %}
                            <th scope="col">Comments</th>
                            {% endif %}
                            <th scope="col" style="text-align: center;">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for cobrowse_io_obj in cobrowse_io_objs %}
                        <tr>
                            {% if cobrowse_io_obj.is_lead %}
                                <td>{{ cobrowse_io_obj.get_sync_data|safe }}</td>
                            {% else %}
                                <td>
                                    Name: {{ cobrowse_io_obj.full_name }}
                                <br> Mobile Number: {{ cobrowse_io_obj.mobile_number|mask_data }}
                                <br> Initiated:    
                                    {% if cobrowse_io_obj.lead_initiated_by == 'floating_button' %}
                                        Floating Button
                                    {% elif cobrowse_io_obj.lead_initiated_by == 'greeting_bubble' %}
                                        Greeting Bubble
                                    {% elif cobrowse_io_obj.lead_initiated_by == 'icon' %}
                                        Icon
                                    {% elif cobrowse_io_obj.lead_initiated_by == 'exit_intent' %}
                                        Exit Intent
                                    {% elif cobrowse_io_obj.lead_initiated_by == 'inactivity_popup' %}
                                        Inactivity Pop-up
                                    {% else %}
                                        - 
                                    {% endif %}
                                </td>
                            {% endif %}
                            <td>{{ cobrowse_io_obj.request_datetime | date:"d-M-Y, h:i A" }}</td>
                            
                            {% if cobrowse_agent.role != "agent" %} 
                                {% if cobrowse_io_obj.main_primary_agent %}
                                    <td>{{ cobrowse_io_obj.main_primary_agent.user.username }}</td>
                                {% elif cobrowse_io_obj.agent %}
                                    <td>{{ cobrowse_io_obj.agent.user.username }}</td>
                                {% else %}
                                    <td>No agent</td>
                                {% endif %}
                                {% if access_token_obj.enable_auto_assign_unattended_lead %}
                                    <td>{{ cobrowse_io_obj.get_auto_assigned_agents }}</td>
                                    <td class="text-center unattended-lead-transfer-count-header">
                                        {% if cobrowse_io_obj.get_unattended_lead_transfer_audit_trail %}
                                            <div class="unattended-lead-transfer-count-div" data-toggle="tooltip" data-placement="right" title="Click to view Auto Assign Audit Trail.">
                                                <button class="btn btn-info unattended-lead-transfer-count-btn"
                                                onclick="open_agent_audit_trail_modal({{cobrowse_io_obj.get_unattended_lead_transfer_audit_trail | safe}})"
                                                style="color: white;"> {{ cobrowse_io_obj.get_unattended_lead_transfer_audit_trail | length }} </button>
                                            </div>
                                        {% else %}
                                            -
                                        {% endif %}
                                    </td>
                                {% endif %}
                            {% endif %}
                            {% if cobrowse_agent.role == "admin_ally" %}
                            <td>
                            <div data-toggle="tooltip" title="{{ cobrowse_io_obj.agent.get_supervisors }}" data-placement="bottom" class="easyassist-supervisor-list-ellips">
                                        {% if cobrowse_io_obj.agent.get_supervisors %}
                                            {{ cobrowse_io_obj.agent.get_supervisors}}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </div>
                            </td>
                            {% endif %}

                            {% if cobrowse_io_obj.get_cobrowsing_session_closing_comments %}
                                <td style="max-width: 300px;">{{ cobrowse_io_obj.get_cobrowsing_session_closing_comments.0.agent_comments }}</td>
                            {% else %}
                                <td>Not provided</td>
                            {% endif %}

                            {% if access_token_obj.enable_predefined_remarks %}
                            {% if access_token_obj.enable_predefined_subremarks %}
                            {% if cobrowse_io_obj.get_cobrowsing_session_closing_comments %}
                                {% if cobrowse_io_obj.get_cobrowsing_session_closing_comments.0.agent_subcomments %}

                                    <td style="max-width: 300px;">
                                        {{ cobrowse_io_obj.get_cobrowsing_session_closing_comments.0.agent_subcomments }}
                                    </td>
                                {% else %}
                                    <td>-</td>
                                {% endif %}
                            {% else %}
                                <td>Not provided</td>
                            {% endif %}
                            {% endif %}
                            {% endif %}

                            {% if access_token_obj.enable_predefined_remarks %}
                            {% if cobrowse_io_obj.get_cobrowsing_session_closing_comments %}
                            {% if cobrowse_io_obj.get_cobrowsing_session_closing_comments.0.comment_desc %}
                                <td style="max-width: 300px;">{{ cobrowse_io_obj.get_cobrowsing_session_closing_comments.0.comment_desc }}</td>
                            {% else %}
                                <td>-</td>
                            {% endif %}
                            {% else %}
                                <td>Not provided</td>
                            {% endif %}
                            {% endif %}
                            <td class="align-middle">
                                <div class="convert-icon-svg" style="text-align: center;  cursor: pointer;">
                                   <div class="tooltip-container-for-convert-icon">
                                      <svg onclick="check_is_lead_manually_converted('{{ cobrowse_io_obj.pk }}')" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                         <path fill-rule="evenodd" clip-rule="evenodd" d="M5.09753 0.0773951C5.01666 0.127298 3.86367 1.00603 2.53526 2.03008C0.98425 3.22583 0.0954286 3.93966 0.0512647 4.02503C-0.0460478 4.21312 -0.00125805 4.47845 0.155417 4.64192C0.32568 4.81955 4.95918 8.38932 5.15045 8.49019C5.33886 8.5896 5.51154 8.55444 5.61587 8.39544C5.68163 8.29527 5.69343 8.11134 5.70581 6.99365L5.72002 5.70712H9.46596C13.5785 5.70712 13.6135 5.70904 14.3542 5.97692C14.9323 6.186 15.4176 6.5057 15.9056 6.99887C16.4296 7.52855 16.7081 7.98143 16.9447 8.68878C17.1401 9.27256 17.2982 9.53293 17.5719 9.7211C18.3039 10.2244 19.233 10.0083 19.6561 9.2365C19.8009 8.97238 19.8154 8.91376 19.8158 8.58871C19.8161 8.29103 19.7876 8.14722 19.6451 7.72843C18.8094 5.27211 16.8101 3.51895 14.2235 2.97422C13.741 2.87262 13.7094 2.87182 9.72879 2.8581L5.72002 2.8443L5.70576 1.55366C5.69222 0.324407 5.68708 0.257036 5.59772 0.136993C5.47958 -0.0216957 5.29394 -0.0438101 5.09753 0.0773951ZM1.15469 10.0705C0.705365 10.2276 0.386875 10.556 0.235609 11.0182C0.134363 11.3276 0.167933 11.6789 0.351338 12.2304C0.76352 13.4698 1.54725 14.6269 2.53146 15.4492C3.48756 16.2481 4.51316 16.7434 5.78095 17.0185C6.21767 17.1132 6.32071 17.1159 10.2622 17.1318L14.2964 17.1481V18.4014C14.2964 19.4639 14.3074 19.678 14.3687 19.8072C14.4509 19.9803 14.6057 20.0412 14.7886 19.9722C14.8987 19.9306 19.1151 16.7122 19.655 16.2576C20.0556 15.9202 20.1089 15.586 19.8067 15.3053C19.4823 15.0041 14.9276 11.537 14.7804 11.4792C14.6286 11.4197 14.6013 11.4206 14.4971 11.4888C14.4337 11.5303 14.3626 11.6148 14.339 11.6766C14.3156 11.7383 14.2964 12.3504 14.2964 13.0368V14.2849H10.5474C6.43148 14.2849 6.39679 14.2829 5.65606 14.0151C5.07795 13.806 4.59264 13.4863 4.10469 12.9931C3.58384 12.4666 3.31028 12.0223 3.06456 11.3039C2.96559 11.0146 2.82666 10.6929 2.75581 10.5892C2.42458 10.1042 1.71546 9.87443 1.15469 10.0705Z" fill="{{ console_color.hex }}"/>
                                      </svg>
                                      <span class="tooltip-text-for-convert">Convert</span>
                                   </div>
                                </div>
                             </td>
                        </tr>
                        <!-- Product Infomation Start -->
                        <ul class="navbar-nav bg-gradient-light sidebar sidebar-dark accordion product-session-details" id="accordionSidebar-{{ cobrowse_io_obj.pk }}" style="overflow-y: scroll;max-height: 100vh;">
                            <a class="sidebar-brand" href="javascript:void(0)">
                                <div class="text-dark mx-3">Session Details<i class="fas fa-window-close text-dark" style="float:right;" onclick="hide_right_sidenav(this)"></i></div>
                            </a>
                            <div style="padding:0.5em;">
                                <div><b>Customer Details</b>
                                    <hr>
                                </div>
                                {% if cobrowse_io_obj.is_lead %}
                                <p>{{ cobrowse_io_obj.get_sync_data|safe }}</p>
                                {% else %}
                                <p><b>Name:</b> {{ cobrowse_io_obj.full_name }}</p>
                                <p><b>Mobile Number:</b> {{ cobrowse_io_obj.mobile_number|mask_data }}</p>
                                {% endif %}
                                <p><b>Request Date & Time:</b> {{ cobrowse_io_obj.request_datetime | date:"d-M-Y, h:i A"}}</p>
                                {% if cobrowse_io_obj.role != "agent" %} {% if cobrowse_io_obj.agent_rating != None %}
                                <p>NPS: {{ cobrowse_io_obj.agent_rating }}</p>
                                {% endif %} {% if cobrowse_io_obj.client_comments %}
                                <p>Comments: {{ cobrowse_io_obj.client_comments }}</p>
                                {% endif %} {% endif %}
                                <div>
                                    <hr><b>Product Details</b>
                                    <hr>
                                </div>
                                <p><b>Name:</b> <u><a href="{{ cobrowse_io_obj.product_url }}" target="_blank">{{ cobrowse_io_obj.product_name }}</a></u> </p>
                                <p><b>Description:</b> {{ cobrowse_io_obj.product_description|slice:":100" }}</p>
                                <button class="btn btn-info" data-toggle="modal" data-target="#see_agent_comments" onclick="show_agents_comment_for_session('{{ cobrowse_io_obj.pk }}')">Agent(s) Comment</button><br><br>
                            </div>
                        </ul>
                        <!-- Product Information End -->
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% if total_cobrowse_objs > 0 %}
            <div class="row mt-3">
                <div class="col-md-6 col-sm-12 show-pagination-entry-container" filter_default_text="Showing {{start_point}} to {{end_point}} of {{total_cobrowse_objs}} entries" start_point="{{start_point}}" end_point="{{end_point}}">
                    Showing {{start_point}} to {{end_point}} of {{total_cobrowse_objs}} entries
                </div>
                <div class="col-md-6 col-sm-12">
                    <div class="d-flex justify-content-end">
                        <nav aria-label="Page navigation example">
                          <ul class="pagination">

                            {% if cobrowse_io_objs.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" onclick="load_more_page('{{ cobrowse_io_objs.previous_page_number }}');" href="javascript:void(0)" aria-label="Previous">
                                        <span aria-hidden="true">Previous</span>
                                        <span class="sr-only">Previous</span>
                                    </a>
                                </li>
                            {% else %}
                                <li class="disabled page-item"><span>
                                    <a class="page-link" href="javascript:void(0)" aria-label="Previous">
                                        <span aria-hidden="true">Previous</span>
                                        <span class="sr-only">Previous</span>
                                    </a>
                                </li>
                            {% endif %}

                            {% if cobrowse_io_objs.number|add:'-4' > 1 %}
                                <li class="page-item">
                                    <a class="page-link" onclick="load_more_page('{{ cobrowse_io_objs.number|add:'-5' }}');" href="javascript:void(0)">&hellip;</a>
                                </li>
                            {% endif %}

                            {% for i in cobrowse_io_objs.paginator.page_range %}
                                {% if cobrowse_io_objs.number == i %}
                                    <li class="active purple darken-3 page-item">
                                        <a onclick="load_more_page('{{ i }}');" href="javascript:void(0)" class="page-link">{{ i }}</a>
                                    </li>
                                {% elif i > cobrowse_io_objs.number|add:'-5' and i < cobrowse_io_objs.number|add:'5' %}
                                    <li class="page-item">
                                        <a href="javascript:void(0)" onclick="load_more_page('{{ i }}');" class="page-link">{{ i }}</a>
                                    </li>
                                {% endif %}
                            {% endfor %}

                            {% if cobrowse_io_objs.paginator.num_pages > cobrowse_io_objs.number|add:'4' %}
                                <li class="page-item">
                                    <a href="javascript:void(0)" onclick="load_more_page('{{ cobrowse_io_objs.number|add:'5' }}');" class="page-link">&hellip;</a>
                                </li>
                            {% endif %}

                            {% if cobrowse_io_objs.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="javascript:void(0)" onclick="load_more_page('{{ cobrowse_io_objs.next_page_number }}');" aria-label="Next">
                                        <span aria-hidden="true">Next</span>
                                        <span class="sr-only">Next</span>
                                    </a>
                                </li>
                            {% else %}
                                <li class="disabled page-item">
                                    <a class="page-link" href="javascript:void(0)" aria-label="Next">
                                        <span aria-hidden="true">Next</span>
                                        <span class="sr-only">Next</span>
                                    </a>
                                </li>
                            {% endif %}
                          </ul>
                        </nav>
                    </div>
                </div>
            </div>
            {% endif %}
            {% else %}
            <p><b>Please apply filter to see the support history details.</b></p>
            {% endif %}
        </div>
    </div>
</div>
<div class="modal fade" id="see_agent_comments" tabindex="-1" role="dialog" aria-labelledby="see_agent_comments_modal_label" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="see_agent_comments_modal_label">Agent(s) comments</h5>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-12">
                        <table class="table table-borderless" style="max-height: 305px;overflow-y: scroll;">
                            <thead>
                                <tr>
                                    <th scope="col">Agent</th>
                                    <th scope="col">Comments</th>
                                    <th scope="col">Date & Time</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-agent-comments-details"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer"></div>
        </div>
    </div>
</div>
<div class="modal fade" id="apply_filter_modal" tabindex="-1" role="dialog" aria-labelledby="apply_filter_modal_modal_label" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="apply_filter_modal_modal_label">Apply Custom Filter</h5>
            </div>
            <div class="modal-body">
                <div class="row filter-header-row">
                    <div class="col-md-4 col-sm-12 filter-mb-sm-4">
                        <select class="form-control" onchange="show_filter_options(this)" id="selected-filter-parameter" style="width: 100%!important;">
                            <option value="None">Select Filter</option>
                            <option value="title">Title</option>
                            {% if cobrowse_agent.role != "agent" %}
                            <option value="agent">Agent</option>
                            {% endif %}
                            {% if cobrowse_agent.role == "admin_ally" %}
                            <option value="supervisor">Supervisor</option>
                            {% endif %}
                            <option value="startdate">Start Date</option>
                            <option value="enddate">End Date</option>
                            <option value="lead-type">Lead-Type</option>
                        </select>
                    </div>
                    <div class="col-md-5 col-sm-12 filter-mb-sm-4 easyassist-multiselect-dropdown-container" id="selected-filter-container">
                        <select class="form-control" style="display:none;" id="selected-title-filter">
                            {% for page_title in title_list %}
                            <option value="{{ page_title }}">{{ page_title }}</option>
                            {% endfor %}
                        </select>
                        <select class="form-control" style="display:none;" id="selected-agent-filter" multiple>
                            {% for agent in agents %}
                            <option value="{{ agent.user.username }}">{{ agent.user.username }}</option>
                            {% endfor %}
                        </select>
                        {% if cobrowse_agent.role == "admin_ally" %}
                        <select class="form-control" style="display:none;" id="selected-supervisor-filter" multiple>
                            {% for supervisor in supervisors %}
                            <option value="{{ supervisor.user.username }}">{{ supervisor.user.username }}</option>
                            {% endfor %}
                        </select>
                        {% endif %}

                        <input id="filter-start-date" placeholder="Start Date" style="display:none;" class="filter-parameter form-control datepicker" autocomplete="off" data-date-format="dd-mm-yyyy">
                        <input id="filter-end-date" placeholder="End Date" style="display:none;" class="filter-parameter form-control datepicker" autocomplete="off" data-date-format="dd-mm-yyyy">
                        <select class="form-control" style="display:none;" id="selected-lead-type-filter">
                            <option value="all">All</option>
                            <option value="inbound">Inbound</option>
                            <option value="outbound">Outbound</option>
                            <option value="reverse">Reverse</option>
                            <option value="drop-link">Drop Link</option>
                            <option value="modified-inbound">Modified Inbound</option>
                        </select>
                    </div>
                    <div class="col-md-3 col-sm-12" style="align-items: center; display: flex;">
                        <button class="btn btn-success btn-icon-split" type="button" id="add-filter-btn" onclick="add_new_filter_parameter(this)" style="width: 100%;justify-content: start;" disabled>
                            <span class="icon text-white-50">
                                <svg width="19" height="14" viewBox="0 0 19 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M6.03809 11.0455L1.53383 6.69202L0 8.16406L6.03809 14L19 1.47204L17.477 0L6.03809 11.0455Z" fill="white"/>
                                </svg>
                            </span>
                            <span class="text" style="width: 100%;">Add</span>
                        </button>
                    </div>
                </div>
                <div class="row" id="tbody-filter-parameters">

                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                <button id="reset_filter" class="btn btn-white-border" style="display: none;" disabled onclick="reset_unattended_leads_filter(this)">Reset</button>
                <button id="apply_filter_confirm" class="btn btn-primary" disabled onclick="apply_unattended_leads_filter(this)">Submit</button>
            </div>
        </div>
    </div>
</div>

<!-- ********************************* Export data -->
<div class="modal fade client-location-details" id="modal-mis-filter" tabindex="-1" role="dialog" aria-labelledby="client_location_details_label" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="export_mis_lable">Export Unattended Leads</h5>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-12">
                        <h6 style="color: #3e95cd">Select date range</h6>
                        <select id="select-date-range" class="form-control" onchange="check_select_date_range(this)">
                            <option value="0" selected="selected">Choose date range</option>
                            <option value="1">Last day</option>
                            <option value="2">Last 7 days</option>
                            <option value="3">Last 1 month</option>
                            <option value="4">Custom Range</option>
                        </select>
                    </div>
                    <div class="col-sm-6 mt-4" id="from-date-div" style="display: none;">
                        <h6 style="color: #3e95cd">From Date</h6>
                        <input id="startdate" placeholder="From Date" class="filter-parameter form-control datepicker" autocomplete="off" data-date-format="dd-mm-yyyy">
                    </div>
                    <div class="col-sm-6 mt-4" id="to-date-div" style="display: none;">
                        <h6 style="color: #3e95cd">To Date</h6>
                        <input id="enddate" placeholder="To Date" class="filter-parameter form-control datepicker" autocomplete="off" data-date-format="dd-mm-yyyy">
                    </div>
                    <div class="col-sm-12" id="email-id-div" style="display:none; padding-top: 25px;">
                        <h6 style="color: #3e95cd">Email ID*</h6>
                        <textarea class="form-control" id="filter-data-email" style="height:10em;">{{ request.user.email }}</textarea>
                        <span><br><b>Note: You will receive the unattended leads data dump on the above email ID within 24 hours.</b></span>
                    </div>
                    <div class="col-sm-12 mt-3" id="general-error-message">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-info" type="button" onclick="export_unattended_leads(this)">Export</button>
            </div>
        </div>
    </div>
</div>

<!-- Manually converted lead modal -->
<div class="modal fade" id="convert-lead-manually-modal" tabindex="-1" role="dialog" aria-labelledby="manual_converion_modal_label" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" style="width: 411px;" role="document">
        <div class="modal-content">
            <div class="modal-header" style="padding:10px 16px;">
                <h5 class="modal-title" id="manual_converion_modal_label">Convert Lead Manually</h5>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-12">
                        <div class="checkbox-btn-container-item" style="display: inline-flex; align-items: baseline; gap: 5px;">
                            <input type="checkbox" id="mask-successfull-cobrowsing-session" checked>
                            <label for="mask-successfull-cobrowsing-session" style="word-break: break-word;"><span>{{ access_token_obj.lead_conversion_checkbox_text }}</span></label>
                        </div>
                    </div>
                    <div class="col-12">
                        <label for="manual-conversion-remarks">
                            {% if not access_token_obj.predefined_remarks_optional %}
                                Remarks<sup style="color:red">*</sup>
                            {% else %}
                                Remarks
                            {% endif %}
                        </label>
                        <div class="row">
                            {% if access_token_obj.enable_predefined_remarks %}
                            <div class="col-12 mt-2">
                                <div>
                                    <select id="manual-conversion-remarks" onchange="show_comments_textbox(this)">
                                        {% for predefined_remark in predefined_remarks %}
                                        <option value="{{ predefined_remark.remark }}">{{ predefined_remark.remark }}</option>
                                        {% endfor %}
                                        <option value="others">Others</option>
                                    </select>
                                </div>
                                <span class="close-session-error" id="manual-conversion-remarks-error" style="margin-left: 1em;"></span>
                            </div>
                            {% if access_token_obj.enable_predefined_subremarks %}
                            <div class="col-12 mt-2 subremarks-container" style="display: none;">
                                <label for="manual-conversion-subremarks" class='mt-3'>
                                    Sub-Remarks
                                    {%if not access_token_obj.predefined_remarks_optional %}
                                        <sup style='color: red;'>*</sup>
                                    {% endif %}
                                </label>
                                <div>
                                    <select id="manual-conversion-subremarks" onchange="show_comments_textbox(this)">
                                        <option value="None">None</option>
                                    </select>
                                </div>
                            </div>
                            {% endif %}
                            <div class="col-12 mt-4">
                                <label for="manual-conversion-remarks-text">Comments</label>
                                <textarea class="form-control close-session-remarks-text" style="max-height: 80px;" id="manual-conversion-remarks-text" placeholder="" disabled></textarea>
                                <span class="close-session-error" id="manual-conversion-text-error"></span>
                            </div>
                            {% elif access_token_obj.enable_predefined_remarks_with_buttons %}
                            <div class="col-12 mt-2">
                                <textarea class="form-control close-session-remarks-text" style="max-height: 80px;" rows="1" id="manual-conversion-remarks-text" placeholder="Remarks"></textarea>
                                <span class="close-session-error" id="manual-conversion-text-error"></span>
                            </div>
                            <label class="col-12 mt-3">Suggestions</label>
                            <div class="col-12">
                                <ul id="predefined-remarks-buttons-list" class="custom-remark-button-style">
                                    {% for predefined_remark in predefined_remarks_with_buttons %}
                                    <li class="predefined-remarks-list-item">
                                        <button class="btn predefined-remarks-button" onclick="set_remarks_in_textbox(this)">{{predefined_remark}}</button>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% else %}
                            <div class="col-12 mt-2">
                                <textarea class="form-control close-session-remarks-text" id="manual-conversion-remarks-text" placeholder="Remarks"></textarea>
                                <span class="close-session-error" id="manual-conversion-text-error"></span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-sm-12 mt-4" style="display: none;">
                        <label for="mask-test-cobrowsing-session">Mark as Test Lead.</label>
                        <input id="mask-test-cobrowsing-session" type="checkbox"/>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-dismiss="modal" id="end_session_cancel_btn">Cancel</button>
                <a class="btn btn-primary" href="javascript:void(0)" onclick="call_convert_lead_manually_api(this)">Submit</a>
            </div>
        </div>
    </div>
</div>

<!--Lead converted manually successfully toast-->
<div class="toast-message" id="lead-converted-manually-toast">
    <div class="toast-container">
       <div class="icon">
          <svg width="27" height="22" viewBox="0 0 27 22" fill="none" xmlns="http://www.w3.org/2000/svg">
             <path d="M20.8917 11C20.8917 16.5228 16.4388 21 10.9458 21C5.4529 21 1 16.5228 1 11C1 5.47715 5.4529 1 10.9458 1C13.3195 1 15.4989 1.83604 17.2088 3.23122" stroke="#25B139" stroke-width="2" stroke-linecap="round"/>
             <path d="M9.3877 10.7328L13.0726 14.4378L24.9998 2.44586" stroke="#25B139" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
       </div>
       <p class="m-0">Lead has been Converted Manually</p>
       <div id="lead-converted-manually-toast-close-icon" style="cursor: pointer;">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
             <path d="M2.39705 2.55379L2.46967 2.46967C2.73594 2.2034 3.1526 2.1792 3.44621 2.39705L3.53033 2.46967L8 6.939L12.4697 2.46967C12.7626 2.17678 13.2374 2.17678 13.5303 2.46967C13.8232 2.76256 13.8232 3.23744 13.5303 3.53033L9.061 8L13.5303 12.4697C13.7966 12.7359 13.8208 13.1526 13.6029 13.4462L13.5303 13.5303C13.2641 13.7966 12.8474 13.8208 12.5538 13.6029L12.4697 13.5303L8 9.061L3.53033 13.5303C3.23744 13.8232 2.76256 13.8232 2.46967 13.5303C2.17678 13.2374 2.17678 12.7626 2.46967 12.4697L6.939 8L2.46967 3.53033C2.2034 3.26406 2.1792 2.8474 2.39705 2.55379L2.46967 2.46967L2.39705 2.55379Z" fill="#212121"/>
          </svg>
       </div>
    </div>
 </div>

<!-- Agent auto assign audit trail modal -->
<div class="modal fade auto-assign-transfer-audit-trail" id="auto_assign_audit_trail" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
       <div class="modal-content" style="margin: auto !important;">
          <div class="modal-header">
             <h5 class="modal-title" id="auto_assign_audit_trail_modal_label">Auto Assign Audit Trail
             </h5>
             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                   <path d="M3.34525 3L20.655 21" stroke="#2D2D2D" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round"/>
                   <path d="M20.6548 3L3.34502 21" stroke="#2D2D2D" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
             </button>
          </div>
          <div class="modal-body">
             <div class="table-responsive" id="auto_assign_transfer_audit_trail_table_div">
                <table id="auto_assign_transfer_audit_trail_table" class="table table-bordered" style="width: 100%;">
                   <thead>
                      <tr>
                        <th scope="col">SL No.</th>
                        <th scope="col">Date Time</th>
                        <th scope="col">Auto Assigned Agent</th>
                      </tr>
                   </thead>
                   <tbody>
                   </tbody>
                </table>
             </div>
          </div>
       </div>
    </div>
 </div>

<!-- /.container-fluid -->
<script type="text/javascript">
window.is_filter_applied = false;
window.custom_title_filter_dropdown = null;
window.custom_lead_type_filter_dropdown = null;
window.custom_filter_option_dropdown = null;
window.custom_filter_remarks = null;
window.custom_filter_sub_remarks = null;
window.applied_filter_key_value_map = {};
window.CONSOLE_COLOR = "{{ console_color.hex }}";
window.ENABLE_REMARKS_WITH_BUTTON = "{{ access_token_obj.enable_predefined_remarks_with_buttons }}";
window.ENABLE_PREDEFINED_REMARKS = "{{ access_token_obj.enable_predefined_remarks }}";
window.ENABLE_PREDEFINED_SUB_REMARKS = "{{ access_token_obj.enable_predefined_subremarks }}";
window.REMARKS_OPTIONAL = "{{ access_token_obj.predefined_remarks_optional }}";
window.CONVERT_LEAD_SESSION_ID = "";

function hide_right_sidenav(element) {
    element.parentElement.parentElement.parentElement.style.display = "none";
}

function show_right_sidenav(element_id) {
    var right_sidenav = document.getElementsByClassName("product-session-details");
    for (var index = 0; index < right_sidenav.length; index++) {
        right_sidenav[index].style.display = "none";
    }
    document.getElementById("accordionSidebar-" + element_id).style.display = "block";
}

function show_filter_options(element) {
    custom_title_filter_dropdown.hide_custom_dropdown();
    $("#selected-agent-filter").next().hide();
    if(document.querySelector("#selected-supervisor-filter")){
        $("#selected-supervisor-filter").next().hide();
    }
    custom_lead_type_filter_dropdown.hide_custom_dropdown();
    document.getElementById("filter-start-date").style.display = "none";
    document.getElementById("filter-end-date").style.display = "none";

    if (element.value == "None") {
        document.getElementById("add-filter-btn").disabled = true;
    } else {

        document.getElementById("selected-filter-container").style.display = "block";

        filter_parameters = document.getElementsByClassName("filter-parameter");
        for (var index = 0; index < filter_parameters.length; index++) {
            filter_parameters[index].style.display = "none";
        }
        if (element.value == "title") {
            custom_title_filter_dropdown.show_custom_dropdown();
        } else if (element.value == "agent") {
            $("#selected-agent-filter").next().show();
        } else if (element.value == "supervisor") {
            $("#selected-supervisor-filter").next().show();
        } else if (element.value == "startdate") {
            document.getElementById("filter-start-date").style.display = "block";
        } else if (element.value == "enddate") {
            document.getElementById("filter-end-date").style.display = "block";
        } else if (element.value == "lead-type") {
            custom_lead_type_filter_dropdown.show_custom_dropdown();
        } else {
            show_easyassist_toast("Please select valid filter");
        }

        document.getElementById("reset_filter").removeAttribute("disabled");
        document.getElementById("reset_filter").style.display = "block";
        document.getElementById("add-filter-btn").disabled = false;
    }
}

function add_new_filter_parameter() {
    var filter_key = null;
    var filter_value = null;
    element = document.getElementById("selected-filter-parameter");
    if (element.value == "None") {
        show_easyassist_toast("Please select valid filter parameter");
    } else {
        var value = "None";
        var key = element.value;
        if (element.value == "title") {
            value = custom_title_filter_dropdown.get_value();
            if (value.length == 0) {
                show_easyassist_toast(NO_TITLE_SELECTED_TOAST);
                return;
            }
            filter_key = "Title";
            filter_value = value;
        } else if (element.value == "agent") {
            value = $("#selected-agent-filter").val();
            if (value.length == 0) {
                show_easyassist_toast(NO_AGENT_SELECTED_TOAST);
                return;
            }
            filter_key = "Agent"
            filter_value = value;
        } else if (element.value == "supervisor") {
            value = $("#selected-supervisor-filter").val();
            if (value.length == 0) {
                show_easyassist_toast(NO_SUPERVISOR_SELECTED_TOAST);
                return;
            }
            filter_key = "Supervisor"
            filter_value = value;
        } else if (element.value == "startdate") {
            value = document.getElementById("filter-start-date").value;

            if (value == "") {
                show_easyassist_toast(EMPTY_START_DATE_ERROR_TOAST);
                return;
            }

            var formatted_start_date = get_iso_formatted_date(value);
            if (applied_filter_key_value_map['enddate'] != null) {
                var formatted_end_date = get_iso_formatted_date(applied_filter_key_value_map['enddate'][0]);
                if (formatted_end_date < formatted_start_date) {
                    show_easyassist_toast(INVALID_START_DATE_ERROR_TOAST);
                    return;
                }
            }

            filter_key = "Start Date"
            filter_value = [value];
        } else if (element.value == "enddate") {
            value = document.getElementById("filter-end-date").value;
            if (value == "") {
                show_easyassist_toast(EMPTY_END_DATE_ERROR_TOAST);
                return;
            }

            var formatted_end_date = get_iso_formatted_date(value);
            if (applied_filter_key_value_map['startdate'] != null) {
                var formatted_start_date = get_iso_formatted_date(applied_filter_key_value_map['startdate'][0]);
                if (formatted_start_date > formatted_end_date) {
                    show_easyassist_toast(INVALID_START_DATE_ERROR_TOAST);
                    return;
                }
            }

            var today = get_today_date();
            if (formatted_end_date > today || formatted_end_date.length > 10) {
                show_easyassist_toast("Please select valid date");
                return;
            }
            
            filter_key = "End Date";
            filter_value = [value];
        } else if (element.value == "lead-type") {
            value = document.getElementById("selected-lead-type-filter").value;

            filter_key = "Lead-Type"
            if (value == "inbound") {
                filter_value = "Inbound";
            } else if (value == "reverse") {
                filter_value = "Reverse";
            } else if (value == "drop-link") {
                filter_value = "Drop Link";
            } else if (value == "outbound") {
                filter_value = "Outbound";
            } else if (value == "modified-inbound") {
                filter_value = "Modified Inbound";
            } else {
                filter_value = "All";
            }
            filter_value = [filter_value];
        } else {
            show_easyassist_toast("Please select valid filter parameter");
        }

        if(check_filter_already_applied(applied_filter_key_value_map[key], filter_value)) {
            show_easyassist_toast(filter_key + " filter already applied");
            return;
        }

        if (applied_filter_key_value_map[key] != null) {
            applied_filter_key_value_map[key] = filter_value;
            update_applied_filter_by_key(key, filter_value);
            return;
        }
        applied_filter_key_value_map[key] = filter_value;

        var filter_chip_html = "";
        filter_chip_html = generate_filter_chips(filter_key, filter_value);

        var html_filter = [
            '<div class="col-md-12 filter-parameter-column" filter-key="' + key + '" filter-data=\'' + JSON.stringify(filter_value) + '\' style="padding: 1em;border-bottom: 1px solid #E6E6E6;">',
                '<div class="row filter-custom-row">',
                    '<div class="col-md-2 filter-mb-sm-2 filter-flex-column">',
                        '<span class="filter-text">' + filter_key + '</span>',
                        '<button type="button" class="btn remove-filter-row-btn filter-show-on-mobile" onclick="remove_selected_filter_parameter(this)">',
                            '<svg width="16" height="18" viewBox="0 0 16 18" fill="none" xmlns="http://www.w3.org/2000/svg">',
                                '<path d="M8 0C9.49884 0 10.7237 1.20574 10.8064 2.72496L10.8108 2.88889H15.3514C15.7096 2.88889 16 3.18737 16 3.55556C16 3.89306 15.756 4.17199 15.4394 4.21614L15.3514 4.22222H14.6629L13.5558 15.7948C13.441 16.994 12.4959 17.92 11.3406 17.9951L11.1888 18H4.81118C3.63878 18 2.64965 17.124 2.46385 15.9497L2.44423 15.7948L1.33622 4.22222H0.648649C0.320263 4.22222 0.0488727 3.97142 0.00592144 3.64602L0 3.55556C0 3.21805 0.244025 2.93912 0.560631 2.89497L0.648649 2.88889H5.18919C5.18919 1.2934 6.44763 0 8 0ZM13.3596 4.22222H2.63957L3.73529 15.6643C3.7861 16.1952 4.19488 16.6083 4.70127 16.661L4.81118 16.6667H11.1888C11.7078 16.6667 12.1478 16.289 12.2484 15.7762L12.2647 15.6643L13.3596 4.22222ZM9.51351 6.66667C9.8419 6.66667 10.1133 6.91747 10.1562 7.24287L10.1622 7.33333V13.5556C10.1622 13.9237 9.87175 14.2222 9.51351 14.2222C9.18513 14.2222 8.91374 13.9714 8.87079 13.646L8.86487 13.5556V7.33333C8.86487 6.96514 9.15528 6.66667 9.51351 6.66667ZM6.48649 6.66667C6.81487 6.66667 7.08626 6.91747 7.12921 7.24287L7.13514 7.33333V13.5556C7.13514 13.9237 6.84473 14.2222 6.48649 14.2222C6.1581 14.2222 5.88671 13.9714 5.84376 13.646L5.83784 13.5556V7.33333C5.83784 6.96514 6.12825 6.66667 6.48649 6.66667ZM8 1.33333C7.2059 1.33333 6.55464 1.96188 6.4915 2.76131L6.48649 2.88889H9.51351C9.51351 2.02978 8.83589 1.33333 8 1.33333Z" fill="#757575"/>',
                            '</svg>',
                        '</button>',
                    '</div>',
                    '<div class="col-md-8 filter-chip-column">',
                        filter_chip_html,
                    '</div>',
                    '<div class="col-md-2 filter-hide-on-mobile">',
                        '<button type="button" class="btn remove-filter-row-btn" onclick="remove_selected_filter_parameter(this)">',
                            '<svg width="16" height="18" viewBox="0 0 16 18" fill="none" xmlns="http://www.w3.org/2000/svg">',
                                '<path d="M8 0C9.49884 0 10.7237 1.20574 10.8064 2.72496L10.8108 2.88889H15.3514C15.7096 2.88889 16 3.18737 16 3.55556C16 3.89306 15.756 4.17199 15.4394 4.21614L15.3514 4.22222H14.6629L13.5558 15.7948C13.441 16.994 12.4959 17.92 11.3406 17.9951L11.1888 18H4.81118C3.63878 18 2.64965 17.124 2.46385 15.9497L2.44423 15.7948L1.33622 4.22222H0.648649C0.320263 4.22222 0.0488727 3.97142 0.00592144 3.64602L0 3.55556C0 3.21805 0.244025 2.93912 0.560631 2.89497L0.648649 2.88889H5.18919C5.18919 1.2934 6.44763 0 8 0ZM13.3596 4.22222H2.63957L3.73529 15.6643C3.7861 16.1952 4.19488 16.6083 4.70127 16.661L4.81118 16.6667H11.1888C11.7078 16.6667 12.1478 16.289 12.2484 15.7762L12.2647 15.6643L13.3596 4.22222ZM9.51351 6.66667C9.8419 6.66667 10.1133 6.91747 10.1562 7.24287L10.1622 7.33333V13.5556C10.1622 13.9237 9.87175 14.2222 9.51351 14.2222C9.18513 14.2222 8.91374 13.9714 8.87079 13.646L8.86487 13.5556V7.33333C8.86487 6.96514 9.15528 6.66667 9.51351 6.66667ZM6.48649 6.66667C6.81487 6.66667 7.08626 6.91747 7.12921 7.24287L7.13514 7.33333V13.5556C7.13514 13.9237 6.84473 14.2222 6.48649 14.2222C6.1581 14.2222 5.88671 13.9714 5.84376 13.646L5.83784 13.5556V7.33333C5.83784 6.96514 6.12825 6.66667 6.48649 6.66667ZM8 1.33333C7.2059 1.33333 6.55464 1.96188 6.4915 2.76131L6.48649 2.88889H9.51351C9.51351 2.02978 8.83589 1.33333 8 1.33333Z" fill="#EE2525"/>',
                            '</svg>',
                        '</button>',
                    '</div>',
                '</div>',
            '</div>',
        ].join('');

        document.getElementById("tbody-filter-parameters").innerHTML += html_filter;
        document.getElementById("apply_filter_confirm").removeAttribute("disabled");
        document.getElementById("reset_filter").removeAttribute("disabled");
        document.getElementById("reset_filter").style.display = "block";
        scrollToBottom();
    }
}

function remove_selected_filter_parameter(element){
    remove_element = $(element).closest('.filter-parameter-column')[0];
    var filter_element = $(remove_element).attr("filter-key");
    applied_filter_key_value_map[filter_element] = null;

    remove_element.parentElement.removeChild(remove_element);
    if(document.getElementsByClassName("tr-filter-parameters").length <= 0){
        document.getElementById("apply_filter_confirm").setAttribute("disabled", "disabled");
        if(!is_filter_applied) {
            document.getElementById("reset_filter").setAttribute("disabled", "disabled");
        }
    }
}

function apply_unattended_leads_filter(element) {
    selected_filter_parameters = document.getElementsByClassName("filter-parameter-column");
    var key_value = '';
    
    for(var idx = 0; idx < selected_filter_parameters.length; idx ++) {
        var filter_key = selected_filter_parameters[idx].getAttribute('filter-key');
        var filter_data = selected_filter_parameters[idx].getAttribute('filter-data');

        filter_data = JSON.parse(filter_data);

        for(var index = 0; index < filter_data.length; index ++) {
            key_value += filter_key + "=" + filter_data[index] + "&";
        }
    }

    window.location = window.location.protocol + "//" + window.location.host + window.location.pathname + "?" + key_value;
}


function reset_unattended_leads_filter() {
    document.getElementById("tbody-filter-parameters").innerHTML = "";
    document.getElementById("reset_filter").setAttribute("disabled", "disabled");
    document.getElementById("apply_filter_confirm").setAttribute("disabled", "disabled");
    custom_filter_option_dropdown.update_value("None"); 
    $("#selected-agent-filter").val("").multiselect('refresh');
    if(document.querySelector("#selected-supervisor-filter")){
        $("#selected-supervisor-filter").val("").multiselect('refresh');
    }
    custom_title_filter_dropdown.update_value("None");
    custom_lead_type_filter_dropdown.update_value("all");
    $('#filter-start-date').val("").datepicker("update");
    $('#filter-end-date').val("").datepicker("update");
    initialize_custom_filter_map();
}

function check_select_date_range(element){
    general_error_message = document.getElementById("general-error-message");
    general_error_message.innerHTML = "";

    if(element.value == "0") {
        general_error_message.innerHTML = "Please select valid date range filter";
    } else {
        general_error_message.innerHTML = "";
    }

    if(element.value=="4"){
        document.getElementById("from-date-div").style.display="block";
        document.getElementById("to-date-div").style.display="block";
        document.getElementById("email-id-div").style.display="block";
    }else{
        document.getElementById("from-date-div").style.display="none";
        document.getElementById("to-date-div").style.display="none";
        document.getElementById("email-id-div").style.display="none";
    }
}

function show_manual_lead_conversion_modal() {
    var agent_comments_dict = {{ agent_comments_dict | safe }};
    reset_manually_convert_lead_modal();
    if (agent_comments_dict.hasOwnProperty(window.CONVERT_LEAD_SESSION_ID)) {
        var agent_comments_obj = agent_comments_dict[window.CONVERT_LEAD_SESSION_ID];
        populate_existing_comments(agent_comments_obj);
    }
    $("#convert-lead-manually-modal").modal("show");
}

function reset_manually_convert_lead_modal() {
    if (custom_filter_remarks != null) {
        custom_filter_remarks.reset_dropdown();
        custom_filter_remarks.update_value();
    }
    if (custom_filter_sub_remarks != null) {
        custom_filter_sub_remarks.reset_dropdown();
        custom_filter_sub_remarks.update_value();
    }
    if(document.getElementById("manual-conversion-remarks-text")) {
        document.getElementById("manual-conversion-remarks-text").value = "";
    }

    var sub_remark_div = document.getElementsByClassName("subremarks-container")[0];
    if(sub_remark_div) {
        sub_remark_div.style.display = "none";
    }
    
    if (document.getElementById("predefined-remarks-buttons-list")) {
        var predefined_remarks_list = document.getElementById("predefined-remarks-buttons-list").children;
        for (var idx = 0; idx < predefined_remarks_list.length; idx++) {
            var predefined_remarks = predefined_remarks_list[idx];
            var button_element = predefined_remarks.getElementsByTagName("button")[0];
            predefined_remarks.style.display = "inline-block";
            button_element.classList.remove("predefined-remarks-button-clicked")
        }
    }
}

function populate_existing_comments(agent_comments_obj) {
    var agent_comments = agent_comments_obj["agent_comments"].trim();
    var agent_subcomments = agent_comments_obj["agent_subcomments"].trim();
    var comment_desc = agent_comments_obj["comment_desc"].trim();
    var is_helpful = true;
    if(agent_comments_obj["is_helpful"] == "False") {
        is_helpful = false;
    }
    document.getElementById("mask-successfull-cobrowsing-session").checked = is_helpful;
    
    if(window.ENABLE_PREDEFINED_REMARKS == "True") {
        if (custom_filter_remarks != null && agent_comments != "") {
            custom_filter_remarks.update_value(agent_comments);
        }

        if(window.ENABLE_PREDEFINED_SUB_REMARKS == "True") {
            if (custom_filter_sub_remarks != null && agent_subcomments != "") {
                custom_filter_sub_remarks.update_value(agent_subcomments);
            }
        }
        
        if(document.getElementById("manual-conversion-remarks-text") && comment_desc != "") {
            document.getElementById("manual-conversion-remarks-text").value = comment_desc;
        }
    } else if (window.ENABLE_REMARKS_WITH_BUTTON == "True") {
        if(document.getElementById("manual-conversion-remarks-text") && agent_comments != "") {
            document.getElementById("manual-conversion-remarks-text").value = agent_comments;
        }
    } else {
        if(document.getElementById("manual-conversion-remarks-text") && agent_comments != "") {
            document.getElementById("manual-conversion-remarks-text").value = agent_comments;
        }
    }
}

$(document).ready(function() {
    
    if (document.getElementById("manual-conversion-subremarks")) {
        $('#manual-conversion-subremarks')[0].selectedIndex = -1;
        custom_filter_sub_remarks = new EasyassistCustomSelect("#manual-conversion-subremarks", "Select One", window.CONSOLE_COLOR);

        document.getElementById("manual-conversion-remarks").addEventListener('change', function() {
            var val = this.value;
            var close_session_subremarks = $('#manual-conversion-subremarks')[0];
            var predefined_remarks = {{predefined_remarks | safe}};
            var subremark_list = [];
            for (var idx = 0; idx < predefined_remarks.length; idx++) {
                if (predefined_remarks[idx].remark == val) {
                    subremark_list = predefined_remarks[idx].subremark;
                    break;
                }
            }

            var option_html = `<option value="None">None</option>`;
            for (var idx = 0; idx < subremark_list.length; idx++) {
                var ele = subremark_list[idx].remark;
                option_html += `<option value="${ele}">${ele}</option>`;
            }

            close_session_subremarks.innerHTML = option_html;
            close_session_subremarks.selectedIndex = -1;
            close_session_subremarks.reinitialize();
            close_session_subremarks.closest(".subremarks-container").style.display = "";
        });
    }

    if (document.getElementById("manual-conversion-remarks")) {
        $('#manual-conversion-remarks')[0].selectedIndex = -1;
        custom_filter_remarks = new EasyassistCustomSelect("#manual-conversion-remarks", "Select One", window.CONSOLE_COLOR);
    }

    $('.predefined-remarks-button').css('background', get_color_with_alpha(window.CONSOLE_COLOR, 0.07));

    if (document.getElementById("manual-conversion-remarks-text")) {
        if (ENABLE_REMARKS_WITH_BUTTON == "True") {
            document.getElementById("manual-conversion-remarks-text").addEventListener("keyup", function(event) {
                var input_text = event.target.value;
                var predefined_remarks_list = document.getElementById("predefined-remarks-buttons-list").children;
                for (var idx = 0; idx < predefined_remarks_list.length; idx++) {
                    var predefined_remarks = predefined_remarks_list[idx];
                    var button_element = predefined_remarks.getElementsByTagName("button")[0];
                    if (button_element.innerHTML.toLowerCase().indexOf(input_text.toLowerCase()) >= 0) {
                        predefined_remarks.style.display = "inline-block";
                    } else {
                        predefined_remarks.style.display = "none";
                    }
                    button_element.classList.remove("predefined-remarks-button-clicked")
                }
            });
        }
    }
});

function get_color_with_alpha(color, alpha) {
    var R = parseInt(color.substring(1, 3), 16);
    var G = parseInt(color.substring(3, 5), 16);
    var B = parseInt(color.substring(5, 7), 16);

    return 'rgba(' + R + ', ' + G + ', ' + B + ', ' + alpha + ')';
}

function show_comments_textbox(element) {
    document.getElementById("manual-conversion-remarks-text").value = '';
    document.getElementById("manual-conversion-remarks-error").style.display = "none";
    document.getElementById("manual-conversion-text-error").style.display = "none";
    document.getElementById("manual-conversion-remarks-text").removeAttribute("disabled");

    setTimeout(function() {
        document.getElementById("manual-conversion-remarks-text").focus();
    }, 100);
}

function set_remarks_in_textbox(element) {
    document.getElementById('manual-conversion-remarks-text').value = element.innerHTML;
    $(".predefined-remarks-button").removeClass('predefined-remarks-button-clicked');
    element.classList.add('predefined-remarks-button-clicked');
    document.getElementById("manual-conversion-text-error").style.display = "none";
}

$('#lead-converted-manually-toast-close-icon').on('click', function(){
    $('#lead-converted-manually-toast').css('display','none');
})

$(document).ready(function() {
    {% if cobrowse_io_objs|length %}
        let support_table = $("#support-history-table").DataTable({
        "ordering": false,
        "bPaginate": false,
        "bInfo": false,
        });
    {% else %}
        $("#support-history-table").DataTable({
        "ordering": false,
        "bPaginate": false,
        "bInfo": false,
        "searching": false,
        });
    {% endif %}

    $("#custom-agent-table-search").keyup(function() {
        support_table.search($(this).val()).draw() ;
    })

    initialize_custom_filter_map();
    initialize_custom_dropdown();
    initialize_custom_tabs();
    activate_support_history_sidebar();
    update_applied_filter();
    is_filter_applied = false;

    $('#selected-agent-filter').multiselect({
        nonSelectedText: 'Select Agent',
        enableFiltering: true,
        enableCaseInsensitiveFiltering: true,
        includeSelectAllOption: true
    });
    $("#selected-agent-filter").next().hide();
    if(document.querySelector("#selected-supervisor-filter")){
        $('#selected-supervisor-filter').multiselect({
            nonSelectedText: 'Select Supervisor',
            enableFiltering: true,
            enableCaseInsensitiveFiltering: true,
            includeSelectAllOption: true
        });
        $("#selected-supervisor-filter").next().hide();
    }
    $("#auto_assign_audit_trail").on('hide.bs.modal', function(){
        $("#auto_assign_audit_trail .modal-body").scrollTop(0);
    });
});

function initialize_custom_dropdown() {
    var console_theme_color = getComputedStyle(document.body).getPropertyValue('--color_rgb');
    $("#selected-agent-filter")[0].selectedIndex = -1;
    $("#selected-title-filter")[0].selectedIndex = -1;
    if(document.querySelector("#selected-supervisor-filter")){
        $("#selected-supervisor-filter")[0].selectedIndex = -1;
    }

    custom_filter_option_dropdown = new EasyassistCustomSelect("#selected-filter-parameter", "Select One", console_theme_color);
    custom_title_filter_dropdown = new EasyassistCustomSelectMultiple("#selected-title-filter", "Select Title", console_theme_color);
    custom_lead_type_filter_dropdown = new EasyassistCustomSelect("#selected-lead-type-filter", "Select One", console_theme_color);
}

function initialize_custom_filter_map() {
    applied_filter_key_value_map = {
        'title': null,
        'agent': null,
        'startdate': null,
        'enddate': null,
        'lead-type': null,
    }
}
</script>
{% endblock %}